/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../core/has.js";import{isSome as t,get as o,isNone as r}from"../../core/maybe.js";import n from"../../Color.js";import{px2pt as i}from"../../core/screenUtils.js";import s from"./Symbol3DMaterial.js";import{i as c,c as l}from"../../chunks/symbols.js";import{forEach as a}from"../../core/asyncUtils.js";import{O as u}from"../../chunks/vec3f64.js";import{getStroke as f}from"./gfxUtils.js";const m=/\/resource\/(.*?)\.svg$/,y=new n("white");function p(e){if(!e)return 0;if(c(e)){const r=function(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1);return"outline"in r?o(r,"outline","size"):void 0}(e);return t(r)?r:0}const r=f(e);return r&&i(r.width)||0}function h(e){if(!e||!e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function b(t,o){const r=o.resource.href;return!e("esri-canvas-svg-support")&&t.styleOrigin&&m.test(r)?r.replace(m,"/resource/png/$1.png"):r}function w(e,t){if(null==t)return e;const o=e.toRgba();return o[3]=o[3]*t,new n(o)}function d(e,o,i){e&&(o||null!=i)&&(o&&(o=new n(o)),c(e)?function(e,o,n){const i=e.symbolLayers;if(!i)return;const c=e=>{const r=t(e)?e:null;return w(o=o||r||null!=n&&y,n)};i.forEach((e=>{if("object"!==e.type||null==e.resource.href||o)if("water"===e.type)e.color=c(e.color);else{const o=t(e.material)?e.material.color:null,i=c(o);r(e.material)?e.material=new s({color:i}):e.material.color=i,null!=n&&"outline"in e&&t(e.outline)&&t(e.outline.color)&&(e.outline.color=w(e.outline.color,n))}}))}(e,o,i):l(e)&&function(e,t,o){(t=t||e.color)&&(e.color=w(t,o)),null!=o&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=w(e.outline.color,o))}(e,o,i))}async function g(e,o){const r=e.symbolLayers;r&&await a(r,(async e=>async function(e,o){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,o);break;case"icon":case"line":case"text":!function(e,o){const r=j(o);t(r)&&(e.size=r)}(e,o);break;case"path":!function(e,t){const o=k(t,u,[e.width,void 0,e.height]);e.width=L(t[0],e.width,1,o),e.height=L(t[2],e.height,1,o)}(e,o);break;case"object":await async function(e,t){const{resourceSize:o,symbolSize:r}=await async function(e){const t=await import("./symbolLayerUtils.js"),o=await t.computeObjectLayerResourceSize(e,10),{width:r,height:n,depth:i}=e,s=[r,i,n];let c=1;for(let e=0;e<3;e++)if(null!=s[e]){c=s[e]/o[e];break}for(let e=0;e<3;e++)null==s[e]&&(s[e]=o[e]*c);return{resourceSize:o,symbolSize:s}}(e),n=k(t,o,r);e.width=L(t[0],r[0],o[0],n),e.depth=L(t[1],r[1],o[1],n),e.height=L(t[2],r[2],o[2],n)}(e,o)}}(e,o)))}function j(e){for(const t of e)if("number"==typeof t)return t;return null}function k(e,t,o){for(let r=0;r<3;r++){const n=e[r];switch(n){case"symbol-value":return null!=o[r]?o[r]/t[r]:1;case"proportional":break;default:if(n&&t[r])return n/t[r]}}return 1}function L(e,t,o,r){switch(e){case"proportional":return o*r;case"symbol-value":return null!=t?t:o;default:return e}}async function z(e,t){if(e&&t)return c(e)?g(e,t):void(l(e)&&function(e,t){const o=j(t);if(!r(o))switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=o,e.height=o*t):(e.width=o*t,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}(e,t))}function v(e,t,o){if(e&&null!=t)if(c(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if(e&&"object"===e.type)switch(o){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else l(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}export{d as applyColorToSymbol,w as applyOpacityToColor,v as applyRotationToSymbol,z as applySizesToSymbol,b as getIconHref,p as getSymbolOutlineSize,h as isVolumetricSymbol};
