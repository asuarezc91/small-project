/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{resolve as t}from"../../core/promiseUtils.js";import e from"../../Color.js";import{pt2px as r}from"../../core/screenUtils.js";import o from"../../request.js";import{getAssetUrl as i}from"../../assets.js";import n from"../../core/ItemCache.js";import{getCIMSymbolColor as s}from"./cimSymbolUtils.js";const l=i("esri/symbols/patterns/"),c={left:"start",center:"middle",right:"end",justify:"start"},a={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},m=new n(1e3);function p(t){let e=t.horizontalAlignment;return e=e&&c[e.toLowerCase()]||"middle",e}function u(t){const e=t.verticalAlignment;return e&&a[e.toLowerCase()]||"alphabetic"}function f(t){return"bottom"===t.verticalAlignment?"super":null}function d(t){const e=t.style;let o=null;if(t)switch(t.type){case"simple-marker":"cross"!==e&&"x"!==e&&(o=t.color);break;case"simple-fill":"solid"===e?o=t.color:"none"!==e&&(o={type:"pattern",x:0,y:0,src:l+e+".png",width:5,height:5});break;case"picture-fill":o={type:"pattern",src:t.url,width:r(t.width)*t.xscale,height:r(t.height)*t.yscale,x:r(t.xoffset),y:r(t.yoffset)};break;case"text":o=t.color;break;case"cim":o=s(t)}return o}function h(e,r){const i=e+"-"+r;return void 0!==m.get(i)?t(m.get(i)):o(e,{responseType:"image"}).then((t=>{const e=t.data,o=e.naturalWidth,n=e.naturalHeight,s=document.createElement("canvas");s.width=o,s.height=n;const l=s.getContext("2d");l.fillStyle=r,l.fillRect(0,0,o,n),l.globalCompositeOperation="destination-in",l.drawImage(e,0,0);const c=s.toDataURL();return m.put(i,c),c}))}function g(t){if(!t)return null;let e;switch(t.type){case"simple-fill":case"picture-fill":case"simple-marker":e=g(t.outline);break;case"simple-line":{const o=r(t.width);"none"!==t.style&&0!==o&&(e={color:t.color,style:y(t.style),width:o,cap:t.cap,join:"miter"===t.join?r(t.miterLimit):t.join});break}default:e=null}return e}const y=function(){const t={};return function(e){if(t[e])return t[e];const r=e.replace(/-/g,"");return t[e]=r,r}}(),b=new e([128,128,128]);export{b as defaultThematicColor,d as getFill,h as getPatternUrlWithColor,p as getSVGAlign,u as getSVGBaseline,f as getSVGBaselineShift,g as getStroke};
