/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import t from"../../core/has.js";import e from"../../Color.js";import"../../widgets/support/widgetUtils.js";import{j as i}from"../../chunks/index.js";import{m as r,t as o,i as n,s,r as a}from"../../chunks/mat2d.js";import{c as l}from"../../chunks/mat2df32.js";let h=0,c=0;const f=t("android"),d=t("chrome")||f&&f>=4?"auto":"optimizeLegibility",y={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},p=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let u={},g={};const x={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};function m(t){return t.map((t=>`${t.command} ${t.values.join(" ")}`)).join(" ").trim()}function w(t,e,r,o){if(t){if("circle"===t.type)return i("circle",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,r:t.r});if("ellipse"===t.type)return i("ellipse",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,rx:t.rx,ry:t.ry});if("rect"===t.type)return i("rect",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",x:t.x,y:t.y,width:t.width,height:t.height});if("image"===t.type)return i("image",{href:t.src,x:t.x,y:t.y,width:t.width,height:t.height,preserveAspectRatio:"none"});if("path"===t.type){const o="string"!=typeof t.path?m(t.path):t.path;return i("path",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",d:o})}if("text"===t.type)return i("text",{fill:e,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4","text-anchor":o.align,"text-decoration":o.decoration,kerning:o.kerning,rotate:o.rotate,"text-rendering":d,"font-style":o.font.style,"font-variant":o.font.variant,"font-weight":o.font.weight,"font-size":o.font.size,"font-family":o.font.family,x:t.x,y:t.y},t.text)}return null}function k(t){const i={fill:"none",pattern:null,linearGradient:null};if(t)if("type"in t&&"pattern"===t.type){const e="patternId-"+ ++h;i.fill=`url(#${e})`,i.pattern={id:e,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&"linear"===t.type){const r="linearGradientId-"+ ++c;i.fill=`url(#${r})`,i.linearGradient={id:r,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map((t=>({offset:t.offset,color:t.color&&new e(t.color).toString()})))}}else if(t){const r=new e(t);i.fill=r.toString()}return i}function j(t){const i={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(t&&(null!=t.width&&(i.width=t.width),t.cap&&(i.cap=t.cap),t.join&&(i.join=t.join.toString()),t.color&&(i.color=new e(t.color).toString()),t.style)){let e=null;if(t.style in x&&(e=x[t.style]),Array.isArray(e)){e=e.slice(0);for(let i=0;i<e.length;++i)e[i]*=t.width;if("butt"!==t.cap){for(let i=0;i<e.length;i+=2)e[i]-=t.width,e[i]<1&&(e[i]=1);for(let i=1;i<e.length;i+=2)e[i]+=t.width}e=e.join(",")}i.dashArray=e}return i}function b(t,e){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return t&&(i.align=t.align,i.decoration=t.decoration,i.kerning=t.kerning?"auto":"0",i.rotate=t.rotated?"90":"0",i.font.style=e.style||"normal",i.font.variant=e.variant||"normal",i.font.weight=e.weight||"normal",i.font.size=e.size&&e.size.toString()||"10pt",i.font.family=e.family||"serif"),i}function v(t){const{pattern:e,linearGradient:r}=t;if(e)return i("pattern",{id:e.id,patternUnits:"userSpaceOnUse",x:e.x,y:e.y,width:e.width,height:e.height},i("image",{x:e.image.x,y:e.image.y,width:e.image.width,height:e.image.height,href:e.image.href}));if(r){const t=r.stops.map(((t,e)=>i("stop",{key:`${e}-stop`,offset:t.offset,"stop-color":t.color})));return i("linearGradient",{id:r.id,gradientUnits:"userSpaceOnUse",x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2},t)}return null}function A(t,e,i){return o(t,n(t),[e,i])}function N(t,e,i,r,o){return s(t,n(t),[e,i]),t[4]=t[4]*e-r*e+r,t[5]=t[5]*i-o*i+o,t}function I(t,e){u&&"left"in u?(u.left>t&&(u.left=t),u.right<t&&(u.right=t),u.top>e&&(u.top=e),u.bottom<e&&(u.bottom=e)):u={left:t,bottom:e,right:t,top:e}}function $(t){const e=t.args,i=e.length;let r;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)I(e[r],e[r+1]);g.x=e[i-2],g.y=e[i-1];break;case"H":for(r=0;r<i;++r)I(e[r],g.y);g.x=e[i-1];break;case"V":for(r=0;r<i;++r)I(g.x,e[r]);g.y=e[i-1];break;case"m":{let t=0;"x"in g||(I(g.x=e[0],g.y=e[1]),t=2);for(r=t;r<i;r+=2)I(g.x+=e[r],g.y+=e[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)I(g.x+=e[r],g.y+=e[r+1]);break;case"h":for(r=0;r<i;++r)I(g.x+=e[r],g.y);break;case"v":for(r=0;r<i;++r)I(g.x,g.y+=e[r]);break;case"c":for(r=0;r<i;r+=6)I(g.x+e[r],g.y+e[r+1]),I(g.x+e[r+2],g.y+e[r+3]),I(g.x+=e[r+4],g.y+=e[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)I(g.x+e[r],g.y+e[r+1]),I(g.x+=e[r+2],g.y+=e[r+3]);break;case"A":for(r=0;r<i;r+=7)I(e[r+5],e[r+6]);g.x=e[i-2],g.y=e[i-1];break;case"a":for(r=0;r<i;r+=7)I(g.x+=e[r+5],g.y+=e[r+6])}}function z(t,e,i){const r=y[t.toLowerCase()];let o;"number"==typeof r&&(r?e.length>=r&&(o={action:t,args:e.slice(0,e.length-e.length%r)},i.push(o),$(o)):(o={action:t,args:[]},i.push(o),$(o)))}function M(t){const e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){const i=function(t){const e=("string"!=typeof t.path?m(t.path):t.path).match(p),i=[];if(u={},g={},!e)return null;let r="",o=[];const n=e.length;for(let t=0;t<n;++t){const n=e[t],s=parseFloat(n);isNaN(s)?(r&&z(r,o,i),o=[],r=n):o.push(s)}z(r,o,i);const s={x:0,y:0,width:0,height:0};return u&&"left"in u&&(s.x=u.left,s.y=u.top,s.width=u.right-u.left,s.height=u.bottom-u.top),s}(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function S(t){const e={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const n of t)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),o=Math.max(o,n.y+n.height)):(i=e,i.x=n.x,i.y=n.y,r=n.x+n.width,o=n.y+n.height);return i&&(i.width=r-i.x,i.height=o-i.y),i}function G(t,e,i,o,s,h,c){const f=e/2,d=i/2,y=t.width+o,p=t.height+o,u=l(),g=l();let x=!1;if(s&&0!==y&&0!==p){const t=y/p,o=e>i?e:i;let n=1,s=1;isNaN(o)||(t>1?(n=o/y,s=o/t/p):(s=o/p,n=o*t/y)),r(g,g,N(u,n,s,f,d)),x=!0}const m=t.x+(y-o)/2,w=t.y+(p-o)/2;if(r(g,g,A(u,f-m,d-w)),!x&&(y>e||p>i)){const t=y/e>p/i,o=(t?e:i)/(t?y:p);r(g,g,N(u,o,o,m,w))}return h&&r(g,g,function(t,e,i,r){const o=e%360*Math.PI/180;a(t,n(t),o);const s=Math.cos(o),l=Math.sin(o),h=t[4],c=t[5];return t[4]=h*s-c*l+r*l-i*s+i,t[5]=c*s+h*l-i*l-r*s+r,t}(u,h,m,w)),c&&r(g,g,A(u,c[0],c[1])),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function E(t,e,r,o){const n=[],s=[];for(const a of t){const t=[],l=[];let h=0,c=0,f=0;for(const e of a){const{shape:i,fill:r,stroke:o,font:s,offset:a}=e;h+=o&&o.width||0;const d=k(r),y=j(o),p="text"===i.type?b(i,s):null;n.push(v(d)),t.push(w(i,d.fill,y,p)),l.push(M(i)),a&&(c+=a[0],f+=a[1])}const d=G(S(l),e,r,h,o&&o.scale,o&&o.rotation,[c,f]);s.push(i("g",{transform:d},t))}return i("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:r},i("defs",null,n),s)}export{S as computeBBox,k as generateFillAttributes,j as generateStrokeAttributes,b as generateTextAttributes,M as getBoundingBox,G as getTransformMatrix,v as renderDef,E as renderSVG,w as renderShape};
