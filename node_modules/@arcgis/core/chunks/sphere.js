/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"../core/has.js";import{isNone as t}from"../core/maybe.js";import r from"../core/Logger.js";import{acosClamped as e}from"../core/mathUtils.js";import{b as s,c as n}from"./vec3f64.js";import{g as i,f as o,d as a,b as c,a as u,k as f,l as d,c as m,i as g,o as p,n as l,s as h}from"./vec3.js";import{cartesianToSpherical as j}from"../views/3d/support/mathUtils.js";import{i as M,r as b}from"./mat4.js";import{ObjectStack as v}from"../core/ObjectStack.js";import{sv3d as y,sm4d as w}from"../views/3d/support/stack.js";import{a as S}from"./vector.js";import{g as k,h as x,c as A}from"./ray.js";const O=r.getLogger("esri.views.3d.support.geometryUtils.sphere");function _(t){return t?{radius:t.radius,center:s(t.center)}:{radius:1,center:n()}}function q(t,r){const e=N.get();return e.radius=t,e.center=r||W,e}function P(t,r=_()){return R(t.radius,t.center,r)}function R(t,r,e=_()){return i(e.center,r),e.radius=t,e}function U(t,r,e){return t!==e&&i(e.center,t.center),e.radius=t.radius+r,e}function z(t,r,e){return O.error("sphere.setExtent is not yet supported"),t===e?e:P(t,e)}function E(r,e,s){if(t(e))return!1;const n=o(y.get(),e.origin,r.center),i=a(e.direction,e.direction),f=2*a(e.direction,n),d=f*f-4*i*(a(n,n)-r.radius*r.radius);if(d<0)return!1;const m=Math.sqrt(d);let g=(-f-m)/(2*i);const p=(-f+m)/(2*i);return(g<0||p<g&&p>0)&&(g=p),!(g<0)&&(s&&c(s,e.origin,u(y.get(),e.direction,g)),!0)}function L(t,r,e,s){return E(t,k(r,e,Q),s)}function T(t,r){return E(t,r,null)}function C(t,r,e){if(E(t,r,e))return e;const s=V(t,r,y.get());return c(e,r.origin,u(y.get(),r.direction,f(r.origin,s)/d(r.direction))),e}function V(t,r,e){const s=y.get(),n=w.get();m(s,r.origin,r.direction),m(e,s,r.origin),u(e,e,1/d(e)*t.radius);const i=G(t,r.origin),o=S(r.origin,e);return M(n),b(n,n,o+i,s),g(e,e,n),e}function B(t,r,e){return E(t,r,e)?e:(x(r,t.center,e),D(t,e,e))}function D(t,r,e){const s=o(y.get(),r,t.center),n=u(y.get(),s,t.radius/d(s));return c(e,n,t.center)}function F(t,r){const e=o(y.get(),r,t.center),s=p(e),n=t.radius*t.radius;return Math.sqrt(Math.abs(s-n))}function G(t,r){const s=o(y.get(),r,t.center),n=d(s),i=t.radius+Math.abs(t.radius-n);return e(t.radius/i)}const H=n();function I(t,r,e,s){const n=o(H,r,t.center);switch(e){case 0:{const t=j(n,H)[2];return h(s,-Math.sin(t),Math.cos(t),0)}case 1:{const t=j(n,H),r=t[1],e=t[2],i=Math.sin(r);return h(s,-i*Math.cos(e),-i*Math.sin(e),Math.cos(r))}case 2:return l(s,n);default:return}}function J(t,r){const e=o(X,r,t.center);return d(e)-t.radius}function K(t,r,e,s){const n=J(t,r),i=I(t,r,2,X),o=u(X,i,e-n);return c(s,r,o),s}const N=new v((()=>({center:null,radius:0}))),Q=A(),W=n(),X=n();Object.freeze(W);var Y=Object.freeze({__proto__:null,create:_,wrap:q,copy:P,fromValues:R,elevate:U,setExtent:z,intersectRay:E,intersectScreen:L,intersectsRay:T,intersectRayClosestSilhouette:C,closestPointOnSilhouette:V,closestPoint:B,projectPoint:D,distanceToSilhouette:F,angleToSilhouette:G,axisAt:I,altitudeAt:J,setAltitudeAt:K});export{P as a,z as b,_ as c,L as d,U as e,R as f,T as g,C as h,E as i,V as j,B as k,F as l,G as m,I as n,J as o,D as p,K as q,Y as s,q as w};
