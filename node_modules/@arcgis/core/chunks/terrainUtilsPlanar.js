/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{c as t}from"./vec3f64.js";import{g as o,f as n,d as s,b as r,a as i}from"./vec3.js";import{containsPoint as a,containsPointWithMargin as l,fromExtent as c,create as h}from"../geometry/support/aaBoundingRect.js";import m from"../views/3d/terrain/TilingScheme.js";import{MAX_ROOT_TILES as u}from"../views/3d/terrain/TerrainConst.js";const f=t(),p=t(),g=t(),d=t();function M(e,t,o=0){const n=e.extent;if(0===o)return a(n,t);const s=Math.min(n[2]-n[0],n[3]-n[1]);return l(n,t,o*s)}function w(e,t,a,l){o(f,a),f[l]=t[l];const c=n(f,f,t),h=n(p,e,t),m=s(h,c),u=s(c,c);let g;g=m<=0?t:u<=m?a:r(f,t,i(c,c,m/u));const d=n(f,e,g);return Math.PI/2-Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))}function v(e,t){const o=e.elevationBounds,n=e.extent,s=.5*(o.min+o.max);g[0]=n[0],g[1]=n[1],g[2]=s,d[0]=n[2],d[1]=n[3],d[2]=s;let r=1/0,i=1/0;return t[0]<g[0]?r=w(t,g,d,0):t[0]>d[0]&&(r=w(t,d,g,0)),t[1]<g[1]?i=w(t,g,d,1):t[1]>d[1]&&(i=w(t,d,g,1)),Math.min(r,i)}function x(t,o,n){if(t.spatialReference.isGeographic)return new e("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");const s=m.checkUnsupported(t);if(s)return s;const r=function(t,o){const n=t.lods,s=n[0].resolution*Math.pow(2,n[0].level),r=[s*t.size[0],s*t.size[1]],i=[t.origin.x,t.origin.y],a=c(o),l=h();m.computeRowColExtent(a,r,i,l);const f=(l[2]-l[0])*(l[3]-l[1]);if(f>u){const o=n[0].scale*Math.pow(2,n[0].level);let r=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*o/s;const i=Math.floor(Math.log(r)/Math.log(10));return r=Math.ceil(r/Math.pow(10,i))*Math.pow(10,i),new e("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(o).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:o,suggestedLevel0Scale:r,requiredNumRootTiles:f,allowedNumRootTiles:u})}return null}(t,n);return r||(o&&!t.spatialReference.equals(o)?new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}var S=Object.freeze({__proto__:null,isInsideExtent:M,tiltOnEdge:w,tiltToExtentEdge:v,checkIfTileInfoSupportedForViewSR:x});export{w as a,v as b,x as c,M as i,S as t};
