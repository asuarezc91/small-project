/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"../core/has.js";import s from"../core/Logger.js";import{acosClamped as i}from"../core/mathUtils.js";import{c as n,b as t,f as a}from"./vec3f64.js";import{g as o,a as r,b as e,s as c,k as u,l as g,d as b,f,m as l,i as p,n as m,o as d}from"./vec3.js";import{directionFromTo as h}from"../views/3d/support/mathUtils.js";import{a as j,b as I,r as v,i as w}from"./mat4.js";import{ObjectStack as P}from"../core/ObjectStack.js";import{a as N}from"./mat4f64.js";import{sv3d as M}from"../views/3d/support/stack.js";import{p as T}from"./vector.js";import{p as S,d as _,c as x}from"./lineSegment.js";import{c as A,w as k,f as y,n as E,a as O,i as U,b as V,d as q,e as B,p as F,s as Y}from"./plane.js";import{d as C}from"./ray.js";const L=s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class R{constructor(){this.plane=A(),this.origin=n(),this.basis1=n(),this.basis2=n()}}function z(s=js){return{plane:A(s.plane),origin:t(s.origin),basis1:t(s.basis1),basis2:t(s.basis2)}}function G(s,i,n){const t=Ps.get();return t.origin=s,t.basis1=i,t.basis2=n,t.plane=k(0,0,0,0),J(t),t}function D(s,i=z()){return H(s.origin,s.basis1,s.basis2,i)}function H(s,i,n,t=z()){return o(t.origin,s),o(t.basis1,i),o(t.basis2,n),J(t),function(s,i){Math.abs(b(s.basis1,s.basis2)/(g(s.basis1)*g(s.basis2)))>1e-6&&L.warn(i,"Provided basis vectors are not perpendicular");Math.abs(b(s.basis1,ls(s)))>1e-6&&L.warn(i,"Basis vectors and plane normal are not perpendicular");Math.abs(-b(ls(s),s.origin)-s.plane[3])>1e-6&&L.warn(i,"Plane offset is not consistent with plane origin")}(t,"fromValues()"),t}function J(s){y(s.basis2,s.basis1,s.origin,s.plane)}function K(s,i,n){s!==n&&D(s,n);const t=r(M.get(),ls(s),i);return e(n.origin,n.origin,t),n.plane[3]-=i,n}function Q(s,i,n){return W(i,n),K(n,cs(s,s.origin),n),n}function W(s,i=z()){const n=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return c(i.origin,s[0]+n,s[1]+t,0),c(i.basis1,n,0,0),c(i.basis2,0,t,0),O(0,0,1,0,i.plane),i}function X(s,i,n){return!!U(s.plane,i,n)&&ps(s,n)}function Z(s,i,n){if(X(s,i,n))return n;const t=$(s,i,M.get());return e(n,i.origin,r(M.get(),i.direction,u(i.origin,t)/g(i.direction))),n}function $(s,n,t){const a=Is.get();hs(s,n,a,Is.get());let r=Number.POSITIVE_INFINITY;for(const e of Ns){const c=ds(s,e,vs.get()),u=M.get();if(V(a,c,u)){const s=h(M.get(),n.origin,u),a=Math.abs(i(b(n.direction,s)));a<r&&(r=a,o(t,u))}}return r===Number.POSITIVE_INFINITY?ss(s,n,t):t}function ss(s,i,n){if(X(s,i,n))return n;const t=Is.get(),a=Is.get();hs(s,i,t,a);let r=Number.POSITIVE_INFINITY;for(const e of Ns){const c=ds(s,e,vs.get()),u=M.get();if(q(t,c,u)){const s=C(i,u);if(!B(a,u))continue;s<r&&(r=s,o(n,u))}}return ts(s,i.origin)<r&&is(s,i.origin,n),n}function is(s,i,n){const t=F(s.plane,i,M.get()),a=S(ms(s,s.basis1),t,-1,1,M.get()),o=S(ms(s,s.basis2),t,-1,1,M.get());return f(n,e(M.get(),a,o),s.origin),n}function ns(s,i,n){const{origin:t,basis1:a,basis2:o}=s,r=f(M.get(),i,t),e=T(a,r),u=T(o,r),g=T(ls(s),r);return c(n,e,u,g)}function ts(s,i){const n=ns(s,i,M.get()),{basis1:t,basis2:a}=s,o=g(t),r=g(a),e=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-r,0),u=n[2];return e*e+c*c+u*u}function as(s,i){return Math.sqrt(ts(s,i))}function os(s,i){let n=Number.NEGATIVE_INFINITY;for(const t of Ns){const a=ds(s,t,vs.get()),o=_(a,i);o>n&&(n=o)}return Math.sqrt(n)}function rs(s,i){return B(s.plane,i)&&ps(s,i)}function es(s,i,n,t){return function(s,i,n){switch(i){case 0:o(n,s.basis1),m(n,n);break;case 1:o(n,s.basis2),m(n,n);break;case 2:o(n,ls(s))}return n}(s,n,t)}function cs(s,i){const n=-s.plane[3];return T(ls(s),i)-n}function us(s,i,n,t){const a=cs(s,i),o=r(ws,ls(s),n-a);return e(t,i,o),t}function gs(s,i){return l(s.basis1,i.basis1)&&l(s.basis2,i.basis2)&&l(s.origin,i.origin)}function bs(s,i,n){return s!==n&&D(s,n),j(Ms,i),I(Ms,Ms),p(n.basis1,s.basis1,Ms),p(n.basis2,s.basis2,Ms),p(E(n.plane),E(s.plane),Ms),p(n.origin,s.origin,i),Y(n.plane,n.origin,n.plane),n}function fs(s,i,n,t){return s!==t&&D(s,t),v(Ts,w(Ts),i,n),p(t.basis1,s.basis1,Ts),p(t.basis2,s.basis2,Ts),J(t),t}function ls(s){return E(s.plane)}function ps(s,i){const n=f(M.get(),i,s.origin),t=d(s.basis1),a=d(s.basis2),o=b(s.basis1,n),r=b(s.basis2,n);return-o-t<0&&o-t<0&&-r-a<0&&r-a<0}function ms(s,i){const n=vs.get();return o(n.origin,s.origin),o(n.vector,i),n}function ds(s,i,n){const{basis1:t,basis2:a,origin:o}=s,c=r(M.get(),t,i.origin[0]),u=r(M.get(),a,i.origin[1]);e(n.origin,c,u),e(n.origin,n.origin,o);const g=r(M.get(),t,i.direction[0]),b=r(M.get(),a,i.direction[1]);return r(n.vector,e(g,g,b),2),n}function hs(s,i,n,t){const a=ls(s);y(a,i.direction,i.origin,n),y(E(n),a,i.origin,t)}const js={plane:A(),origin:a(0,0,0),basis1:a(1,0,0),basis2:a(0,1,0)},Is=new P(A),vs=new P(x),ws=n(),Ps=new P((()=>({origin:null,basis1:null,basis2:null,plane:null}))),Ns=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Ms=N(),Ts=N();var Ss=Object.freeze({__proto__:null,BoundedPlaneClass:R,create:z,wrap:G,copy:D,fromValues:H,updateUnboundedPlane:J,elevate:K,setExtent:Q,fromAABoundingRect:W,intersectRay:X,intersectRayClosestSilhouette:Z,closestPointOnSilhouette:$,closestPoint:ss,projectPoint:is,projectPointLocal:ns,distance2:ts,distance:as,distanceToSilhouette:os,extrusionContainsPoint:rs,axisAt:es,altitudeAt:cs,setAltitudeAt:us,equals:gs,transform:bs,rotate:fs,normal:ls,UP:js});export{R as B,js as U,gs as a,Ss as b,z as c,D as d,rs as e,H as f,K as g,W as h,X as i,Z as j,$ as k,ss as l,ns as m,ts as n,as as o,is as p,os as q,es as r,Q as s,cs as t,J as u,us as v,G as w,bs as x,fs as y,ls as z};
