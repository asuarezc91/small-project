/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../request.js";import{mapParameters as t}from"./urlUtils.js";function o(e,t){const o=e.toJSON();return o.objectIds&&(o.objectIds=o.objectIds.join(",")),o.orderByFields&&(o.orderByFields=o.orderByFields.join(",")),!o.outFields||null!=t&&t.returnCountOnly?delete o.outFields:-1!==o.outFields.indexOf("*")?o.outFields="*":o.outFields=o.outFields.join(","),o.outSpatialReference&&(o.outSR=o.outSR.wkid||JSON.stringify(o.outSR.toJSON()),delete o.outSpatialReference),o.dynamicDataSource&&(o.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o}async function r(e,t,o){const r=await a(e,t,o),n=r.data,d=n.geometryType,s=n.spatialReference,c={};for(const e of n.relatedRecordGroups){const t={fields:void 0,objectIdFieldName:void 0,geometryType:d,spatialReference:s,hasZ:!!n.hasZ,hasM:!!n.hasM,features:e.relatedRecords};if(null!=e.objectId)c[e.objectId]=t;else for(const o in e)e.hasOwnProperty(o)&&"relatedRecords"!==o&&(c[e[o]]=t)}return{...r,data:c}}async function n(e,t,o){const r=await a(e,t,o,{returnCountOnly:!0}),n=r.data,d={};for(const e of n.relatedRecordGroups)null!=e.objectId&&(d[e.objectId]=e.count);return{...r,data:d}}async function a(r,n,a={},d){const s=t({...r.query,f:"json",...d,...o(n,d)});return e(r.path+"/queryRelatedRecords",{...a,query:{...a.query,...s}})}export{r as executeRelationshipQuery,n as executeRelationshipQueryForCount,o as toQueryStringParameters};
