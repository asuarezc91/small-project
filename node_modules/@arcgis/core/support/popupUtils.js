/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{getDisplayFieldName as e}from"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import t from"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import i from"../popup/support/FieldInfoFormat.js";import o from"../popup/FieldInfo.js";import n from"../popup/content/FieldsContent.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import l from"../PopupTemplate.js";const r=["oid","global-id"],s=["oid","global-id","guid"];function a({displayField:i,editFieldsInfo:o,fields:r,objectIdField:s,title:a},d){if(!r)return null;const p=F({editFieldsInfo:o,fields:r,objectIdField:s},d);if(!p.length)return null;const u=function(t){const i=e(t),{titleBase:o}=t;return i?`${o}: {${i.trim()}}`:o}({titleBase:a,fields:r,displayField:i}),c=[new n,new t];return new l({title:u,content:c,fieldInfos:p})}const d=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],p=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:o})=>o?o.has(e.name):!c(e.name,t)&&((!i||e.name!==i)&&(!(r.indexOf(e.type)>-1)&&!d.some((t=>t.test(e.name)))));function u(e,t){return"oid"===e.type?-1:"oid"===t.type?1:w(e)?-1:w(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function c(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:o,editDateField:n,editorField:l}=t;return-1!==[i&&i.toLowerCase(),o&&o.toLowerCase(),n&&n.toLowerCase(),l&&l.toLowerCase()].indexOf(e.toLowerCase())}function m(e,t){return e.editable&&-1===s.indexOf(e.type)&&!c(e.name,t)}function f(e,t){return new n({fieldInfos:F(e,t).filter((e=>e.visible))})}function F({editFieldsInfo:e,fields:t,objectIdField:i},n){return function(e,t){const i=e;return t&&(e=e.filter((e=>-1===t.indexOf(e.type)))),e===i&&(e=e.slice()),e.sort(u),e}(t,(null==n?void 0:n.ignoreFieldTypes)||C).map((t=>new o({fieldName:t.name,isEditable:m(t,e),label:t.alias,format:b(t),visible:p(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:null==n?void 0:n.visibleFieldNames})})))}function b(e){switch(e.type){case"small-integer":case"integer":case"single":return new i({digitSeparator:!0,places:0});case"double":return new i({digitSeparator:!0,places:2});case"date":return new i({dateFormat:"long-month-day-year"});default:return null}}function w(e){if("name"===(e.name&&e.name.toLowerCase()))return!0;return"name"===(e.alias&&e.alias.toLowerCase())||void 0}const C=["geometry","blob","raster","guid","xml"];export{F as createFieldInfos,f as createFieldsContent,a as createPopupTemplate};
