/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import r from"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{isPromiseLike as o}from"../core/promiseUtils.js";import i from"../core/Collection.js";import{referenceSetter as a}from"../core/collectionUtils.js";import n from"../layers/Layer.js";function l(e){return e&&"group"===e.type}function d(e,r,t){let s,o;if(e)for(let i=0,a=e.length;i<a;i++){if(s=e.getItemAt(i),s[r]===t)return s;if(l(s)&&(o=d(s.layers,r,t),o))return o}}const y=r.getLogger("esri.support.LayersMixin"),p=r=>{let l=class extends r{constructor(...e){super(...e),this.layers=new i;const r=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||y.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},t=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",(e=>{var r;(r=e.item).parent&&"remove"in r.parent&&r.parent.remove(r)})),this.layers.on("after-add",(e=>r(e.item))),this.layers.on("after-remove",(e=>t(e.item)))}destroy(){const e=this.layers.removeAll();for(const r of e)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(e){this._set("layers",a(e,this._get("layers")))}add(e,r){const t=this.layers;r=t.getNextIndex(r),e instanceof n?e.parent===this?this.reorder(e,r):t.add(e,r):o(e)?e.then((e=>{this.destroyed||this.add(e,r)})):y.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,r){const t=this.layers;r=t.getNextIndex(r),e.slice().forEach((e=>{e.parent!==this?(t.add(e,r),r+=1):this.reorder(e,r)}))}findLayerById(e){return d(this.layers,"id",e)}findLayerByUid(e){return d(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,r){return this.layers.reorder(e,r)}layerAdded(e){}layerRemoved(e){}};return e([t()],l.prototype,"layers",null),l=e([s("esri.support.LayersMixin")],l),l};export{p as LayersMixin};
