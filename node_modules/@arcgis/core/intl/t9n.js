/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import t from"../core/global.js";import{isSome as e}from"../core/maybe.js";import n from"../core/Error.js";import{normalizeMessageBundleLocale as r}from"./messages.js";import o from"../request.js";async function s(t){if(e(c.fetchBundleAsset))return c.fetchBundleAsset(t);return(await o(t,{responseType:"json"})).data}class i{constructor({base:e="",pattern:n,location:r=new URL(window.location.href)}){let o;o="string"==typeof r?e=>new URL(e,new URL(r,t.location)).href:r instanceof URL?t=>new URL(t,r).href:r,this.pattern="string"==typeof n?new RegExp(`^${n}`):n,this.getAssetUrl=o,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,e){return async function(t,e,o,i){const a=e.exec(o);if(!a)throw new n("esri-intl:invalid-bundle",`Bundle id "${o}" is not compatible with the pattern "${e}"`);const c=a[1]?`${a[1]}/`:"",l=a[2],h=r(i),f=`${c}${l}.json`,w=h?`${c}${l}_${h}.json`:f;let u;try{u=await s(t(w))}catch(e){if(w===f)throw e;try{u=await s(t(f))}catch{throw new n("intl:unknown-bundle",`Bundle "${o}" cannot be loaded`,{error:e})}}return u}(this.getAssetUrl,this.matcher,t,e)}}function a(t){return new i(t)}const c={};export{i as JSONLoader,a as createJSONLoader,c as test};
