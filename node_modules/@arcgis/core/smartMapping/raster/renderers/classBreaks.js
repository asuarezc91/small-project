/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../core/maybe.js";import r from"../../../core/Error.js";import a from"../../../renderers/support/AuthoringInfo.js";import{createClassBreaksRenderer as s}from"../../../renderers/support/rasterRendererHelper.js";import{processRasterRendererParameters as t}from"../support/utils.js";async function o(o){o=await async function(a){const s=(a=await t(a)).layer,{rasterInfo:o}=s;if(o.bandCount>1)throw new r("raster-class-breaks-renderer:not-supported","Multiband raster is not supported");if(!e(o.attributeTable)&&!e(o.histograms)&&(await s.updateRasterInfoWithEstimatedStats({renderingRule:a.renderingRule,signal:a.signal}),!e(o.histograms)))throw new r("raster-class-breaks-renderer:not-supported","Histograms or raster attribute table is required on the source raster. Unable to estimate histograms");const{colors:n,numClasses:i}=a;if(n&&i&&n.length!==i)throw new r("raster-class-breaks-renderer:not-supported","The size of the `colors` parameter does not match 'numClasses'");return a.field||(a.field="value"),a.classificationMethod||(a.classificationMethod="equal-interval"),a}(o);const n=s(o.layer.rasterInfo,o);if(!e(n))throw new r("raster-class-breaks-renderer:not-supported","Class breaks renderer is not supported on this data");n.authoringInfo=new a({classificationMethod:o.classificationMethod,colorRamp:o.colorRamp,standardDeviationInterval:o.standardDeviationInterval});const i={minValue:n.minValue,maxValue:n.classBreakInfos[n.classBreakInfos.length-1].maxValue,normalizationTotal:null,classBreakInfos:n.classBreakInfos.map((e=>({minValue:e.minValue,maxValue:e.maxValue,label:e.label})))};return{renderer:n,classBreaksResult:i}}export{o as createRenderer};
