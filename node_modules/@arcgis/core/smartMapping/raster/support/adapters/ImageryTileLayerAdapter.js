/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../chunks/tslib.es6.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/accessorSupport/ensureType.js";import{property as r}from"../../../../core/accessorSupport/decorators/property.js";import{subclass as e}from"../../../../core/accessorSupport/decorators/subclass.js";import s from"../../../../core/Error.js";import"../../../../core/urlUtils.js";import"../../../../core/uuid.js";import"../../../../portal/support/resourceExtension.js";import{resolve as o}from"../../../../core/promiseUtils.js";import a from"../../../../geometry/Extent.js";import{estimateStatisticsHistograms as i}from"../../../../layers/support/rasterFunctions/pixelUtils.js";import m from"./RasterLayerAdapter.js";let l=class extends m{generateRasterInfo(t){return o(this.rasterInfo)}async estimateStatisticsHistograms(t){if(null!==this._statsCache)return this._statsCache;const{raster:r}=this.layer,{extent:e,width:o,height:a}=this.getSamplePixelBlockDescriptor(r.rasterInfo),{pixelBlock:m}=await r.fetchPixels(e,o,a,t);if(null==m)throw new s("raster-layer-adapter","Unable to estimate histograms");return this._statsCache=i(m),this._statsCache}supportsMultidirectionalHillshade(){return!0}load(t){return this.addResolvingPromise(this.layer.load(t).then((()=>this.rasterInfo=this.layer.raster.rasterInfo))),o(this)}getSamplePixelBlockDescriptor(t,r=1e3){const{pyramidScalingFactor:e,maximumPyramidLevel:s}=t.storageInfo;let{extent:o,width:i,height:m,pixelSize:l}=t,p=Math.ceil(Math.log(Math.max(i,m)/r)/Math.log(e))-1,n=0,h=0;if(p<=s){const t=Math.pow(e,p);i=Math.floor(i/t),m=Math.floor(m/t)}else p=0,i=Math.min(i,r),m=Math.min(m,r),n=Math.max(Math.floor(i/2-500),0),h=Math.max(Math.floor(m/2-500),0),o=new a({xmin:o.xmin+n*l.x,xmax:Math.min(o.xmax,o.xmin+n*l.x*r),ymin:o.ymin+h*l.y,ymax:Math.min(o.ymax,o.ymin+h*l.y*r)});return{extent:o,width:i,height:m,origin:{x:n,y:h}}}};t([r()],l.prototype,"layer",void 0),l=t([e("esri.smartMapping.support.adapters.ImageryTileLayerAdapter")],l);var p=l;export default p;
