/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{all as n}from"../../core/promiseUtils.js";import o from"../../popup/FieldInfo.js";import i from"../../popup/ExpressionInfo.js";import t from"../../PopupTemplate.js";import{substitute as r}from"../../intl/substitute.js";import{fetchMessageBundle as s}from"../../intl/messages.js";import{getArcadeForPredominantCategoryAlias as f,getArcadeForPredominantCategoryValue as a,getArcadeForPredominanceMargin as p,getArcadeForStrengthOfPredominance as l,getArcadeForOrderedFields as d,getArcadeForSumOfFields as m}from"../statistics/support/predominanceUtils.js";import{getFieldInfo as I}from"./support/utils.js";function u(e,n){return e.legendOptions&&e.legendOptions.title?e.legendOptions.title:n.competingFields}function c(e,n){return{fieldInfo:new o({fieldName:"expression/predominant-category"}),expressionInfo:new i({name:"predominant-category",title:n.predominantCategory,expression:f(e)})}}function x(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new i({name:"predominant-value",title:n.predominantCategoryValue,expression:a(t),returnType:"number"})}}function g(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new i({name:"predominant-strength",title:n.strengthOfPredominance,expression:l(t),returnType:"number"})}}function y(e,n){const o=c(e.fieldInfos,n),i=new t({expressionInfos:[o.expressionInfo],fieldInfos:[o.fieldInfo],content:r(n.predominantCategoryContent,{expression:`<b>{${o.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category",title:n.predominantCategory,value:i}}function b(e,n){const{fieldInfos:o}=e,i=c(o,n),s=x(o,n),f=new t({expressionInfos:[s.expressionInfo,i.expressionInfo],fieldInfos:[s.fieldInfo,i.fieldInfo],content:r(n.predominantCategoryValueContent,{expression1:`<b>{${i.fieldInfo.fieldName}}</b>`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value",title:n.predominantCategoryValue,value:f}}function N(e,n){const{fieldInfos:s}=e,f=c(s,n),a=x(s,n),l=function(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new i({name:"predominant-margin",title:n.marginOfVictory,expression:p(t),returnType:"number"})}}(s,n),d=new t({expressionInfos:[a.expressionInfo,f.expressionInfo,l.expressionInfo],fieldInfos:[a.fieldInfo,f.fieldInfo,l.fieldInfo],title:r(n.mostCommon,{expression:"{expression/predominant-category}"}),content:r(n.predominantCategoryValueMarginContent,{expression1:`<b>{${f.fieldInfo.fieldName}}</b>`,expression2:`<b>{${a.fieldInfo.fieldName}}</b>`,expression3:`<b>{${l.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value-margin",title:n.marginOfVictory,value:d}}function w(e,n){const{fieldInfos:o}=e,i=c(o,n),s=x(o,n),f=g(o,n),a=new t({expressionInfos:[s.expressionInfo,i.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,i.fieldInfo,f.fieldInfo],content:r(n.predominantCategoryStrengthContent,{expression1:`{${s.fieldInfo.fieldName}}`,expression2:`<b>{${i.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`})});return{name:"predominant-category-strength",title:n.strengthOfPredominance,value:a}}function C(e,n){const{renderer:s,fieldInfos:f}=e,a=c(f,n),p=x(f,n),l=g(f,n),m=function(e,n){return{fieldInfo:new o({fieldName:"expression/predominant-categories-list"}),expressionInfo:new i({name:"predominant-categories-list",title:n.listOfCategories,expression:d(e)})}}(f,n),I=new t({expressionInfos:[a.expressionInfo,p.expressionInfo,l.expressionInfo,m.expressionInfo],fieldInfos:[a.fieldInfo,p.fieldInfo,l.fieldInfo,m.fieldInfo],title:u(s,n),content:[{type:"text",text:r(n.predominantCategoryStrengthContent,{expression1:`{${p.fieldInfo.fieldName}}`,expression2:`<b>{${a.fieldInfo.fieldName}}</b>`,expression3:`<b>{${l.fieldInfo.fieldName}}%</b>`})},{type:"text",text:`{${m.fieldInfo.fieldName}}`}]});return{name:"predominant-categories-list",title:n.orderedListOfValues,value:I}}function h(e,n){const{fieldInfos:s}=e,f=c(s,n),a=x(s,n),p=g(s,n),l=function(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new i({name:"predominant-total",title:n.sumOfCategories,expression:m(t),returnType:"number"})}}(s,n),d=new t({expressionInfos:[a.expressionInfo,f.expressionInfo,l.expressionInfo,p.expressionInfo],fieldInfos:[a.fieldInfo,f.fieldInfo,l.fieldInfo,p.fieldInfo],content:r(n.predominantCategoryTotalStrengthContent,{expression1:`{${a.fieldInfo.fieldName}}`,expression2:`<b>{${f.fieldInfo.fieldName}}</b>`,expression3:`<b>{${p.fieldInfo.fieldName}}%</b>`,expression4:`{${l.fieldInfo.fieldName}}`})});return{name:"predominant-category-total-strength",title:n.predominantCategoryWithTotalAndStrength,value:d}}function $(e,n){const{renderer:o,fieldInfos:i}=e,s=c(i,n),f=x(i,n),a=g(i,n),p=new t({expressionInfos:[f.expressionInfo,s.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,s.fieldInfo,a.fieldInfo],title:u(o,n),content:[{type:"text",text:r(n.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:i.map((e=>e.fieldName))}}}]});return{name:"predominant-category-chart",title:n.predominantCategoryWithChart,value:p}}async function v(n){const{layer:o,renderer:i}=n;await o.load();const t=i||o.renderer;if("unique-value"!==t.type)throw new e("predmoinance-popup:invalid-parameters","renderer.type must be 'unique-value'");return{renderer:t,fieldInfos:function(n,o){const i=n.authoringInfo,t="predominance"===i.type?i.fields:[];if(!t||!t.length)throw new e("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return t.map((e=>I(o,e)))}(t,o)}}async function O(e){const[o,i]=await n([v(e),s("esri/smartMapping/t9n/smartMapping")]);return[y(o,i),b(o,i),N(o,i),h(o,i),C(o,i),w(o,i),$(o,i)]}async function j(e){const[o,i]=await n([v(e),s("esri/smartMapping/t9n/smartMapping")]),t=C(o,i),r=await O(e);return{primaryTemplate:t,secondaryTemplates:r.filter((e=>e.name!==t.name))}}export{O as getAllTemplates,j as getTemplates};
