/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{all as r}from"../../core/promiseUtils.js";import i from"../../PopupTemplate.js";import{fetchMessageBundle as n}from"../../intl/messages.js";import{getContentFromFieldInfos as t,getFieldAndExpressionInfos as o}from"./support/utils.js";async function a(r){const{layer:i,renderer:n}=r;await i.load();const t=n||i.renderer;if("unique-value"!==t.type)throw new e("relationship-popup:invalid-parameters","renderer.type must be 'unique-value'");const o=t.authoringInfo;if(!o||"relationship"!==o.type)throw new e("relationship-popup:invalid-parameters","renderer.authoringInfo.type must be 'relationship'");if(!(o.field1&&o.field1.field&&o.field2&&o.field2.field))throw new e("relationship-popup:invalid-parameters","'field1' and/or 'field2' properties are missing in renderer.authoringInfo");return{layer:i,renderer:t}}async function s(e,r,n="divide"){const{fieldInfos:a,expressionInfos:s}=await o({renderer:e,layer:r,normFieldExpressionTemplate:n});return new i({content:await t(r,{fieldInfos:a,expressionInfos:s}),fieldInfos:a,expressionInfos:s})}async function p(e){const[{renderer:i,layer:t},o]=await r([a(e),n("esri/smartMapping/t9n/smartMapping")]),p={name:"relationship",title:o.relationshipPopupTitle,value:await s(i,t)},l=[];return function(e){const r=e.authoringInfo;return!(!r.field1.normalizationField&&!r.field2.normalizationField)}(i)&&l.push({name:"relationship-percent",title:o.relationshipNormFieldAsPercent,value:await s(i,t,"percentage")}),{primaryTemplate:p,secondaryTemplates:l}}export{p as getTemplates};
