/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as i}from"../../core/maybe.js";import e from"../../core/Error.js";import{isDateField as r,numericTypes as s}from"../../layers/support/fieldUtils.js";import{getNormalizationType as a,getFieldsList as o}from"../support/utils.js";import{verifyBasicFieldValidity as t,verifyFieldType as n}from"./support/utils.js";import{createLayerAdapter as l,getLayerTypeLabels as p}from"../support/adapters/support/layerUtils.js";const m=["date",...s];async function d(s){const{layerAdapter:d,...f}=await async function(s){if(!(s&&s.layer&&(s.field||s.valueExpression||s.sqlExpression)))throw new e("histogram:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(s.valueExpression&&!s.sqlExpression&&!s.view)throw new e("histogram:missing-parameters","View is required when 'valueExpression' is specified");const d=[0,2,1,3,4],{layer:f,...h}=s,u=l(f,d),w={layerAdapter:u,...h};if(w.normalizationType=a(w),!u)throw new e("histogram:invalid-parameters","'layer' must be one of these types: "+p(d).join(", "));const c=i(w.signal)?{signal:w.signal}:null;await u.load(c);const v=w.valueExpression||w.sqlExpression,g=w.field,x=g?u.getField(g):null,E=!w.classificationMethod||"equal-interval"===w.classificationMethod,y=await o({field:g,normalizationField:w.normalizationField,valueExpression:w.valueExpression}),q=t(u,y,"histogram:invalid-parameters");if(q)throw q;if(x){const i=n(u,x,"histogram:invalid-parameters",m);if(i)throw i;if(r(x)){if(w.normalizationType)throw new e("histogram:invalid-parameters","Normalization is not allowed for date fields");if(!E)throw new e("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed for date fields")}}else if(v){if(w.normalizationType)throw new e("histogram:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");if(!E)throw new e("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'valueExpression' or 'sqlExpression' is specified")}return w}(s);return d.histogram(f)}export default d;
