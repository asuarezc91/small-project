/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import r from"../../core/Error.js";import{all as t}from"../../core/promiseUtils.js";import{createLayerAdapter as a,getLayerTypeLabels as i}from"../support/adapters/support/layerUtils.js";import s from"./summaryStatistics.js";import{getAgeExpressions as n,verifyDates as m,supportedAgeUnits as o}from"./support/ageUtils.js";async function l(l){const{layerAdapter:u,...p}=await async function(s){if(!(s&&s.layer&&s.startTime&&s.endTime&&s.unit))throw new r("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const n=[0,2,1,3],{layer:l,...u}=s,p=a(l,n),f={layerAdapter:p,...u};if(!p)throw new r("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+i(n).join(", "));const y=f.view,c=e(f.signal)?{signal:f.signal}:null;await t([y&&y.when(),p.load(c)]);const d=m(p,f.startTime,f.endTime,"summary-statistics-for-age:invalid-parameters");if(d)throw d;if(-1===o.indexOf(f.unit))throw new r("summary-statistics-for-age:invalid-parameters",`Supported units are: ${o.join(", ")}`);return f}(l),{view:f,startTime:y,endTime:c,unit:d,minValue:w,maxValue:g,signal:T}=p,{valueExpression:j,statisticsQuery:v}=n({layer:u,startTime:y,endTime:c,unit:d}),h={layer:u,valueExpression:j,...v,minValue:w,maxValue:g,view:f,signal:T};return s(h)}export default l;
