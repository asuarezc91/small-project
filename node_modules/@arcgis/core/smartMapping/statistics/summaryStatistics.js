/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as s}from"../../core/maybe.js";import i from"../../core/Error.js";import{isDateField as e,numericTypes as r}from"../../layers/support/fieldUtils.js";import{getNormalizationType as a,getFieldsList as t}from"../support/utils.js";import{verifyBasicFieldValidity as o,verifyFieldType as n}from"./support/utils.js";import{createLayerAdapter as l,getLayerTypeLabels as m}from"../support/adapters/support/layerUtils.js";const p=[...r,"date"];async function u(r){const{layerAdapter:u,...d}=await async function(r){if(!(r&&r.layer&&(r.field||r.valueExpression||r.sqlExpression)))throw new i("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(r.valueExpression&&!r.sqlExpression&&!r.view)throw new i("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");const u=[0,2,1,3,4],{layer:d,...f}=r,c=l(d,u),y={layerAdapter:c,...f};if(y.normalizationType=a(y),!c)throw new i("summary-statistics:invalid-parameters","'layer' must be one of these types: "+m(u).join(", "));const w=s(y.signal)?{signal:y.signal}:null;await c.load(w);const v=y.field,x=y.normalizationType,E=y.valueExpression||y.sqlExpression,h=v?c.getField(v):null,j=await t({field:y.field,normalizationField:y.normalizationField,valueExpression:y.valueExpression}),q=o(c,j,"summary-statistics:invalid-parameters");if(q)throw q;if(h){const s=n(c,h,"summary-statistics:invalid-parameters",p);if(s)throw s;if(e(h)&&x)throw new i("summary-statistics:invalid-parameters","Normalization is not allowed for date fields")}else if(E&&x)throw new i("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");return y}(r);return u.summaryStatistics(d)}export default u;
