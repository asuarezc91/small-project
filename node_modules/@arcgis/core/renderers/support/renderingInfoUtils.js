/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as t,isNone as e}from"../../core/maybe.js";import o from"../../Color.js";import{getVisualVariableValues as r}from"../visualVariables/support/visualVariableUtils.js";function i(e,o){if(!e||e.symbol)return null;const r=o&&o.renderer;return e&&t(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function n(e,o){if(t(e.symbol))return e.symbol;const r=i(e,o);return t(r)?r.getSymbol(e,o):null}function a(t,o){const a=i(t,o),l=n(t,o);if(!l)return null;const s={renderer:a,symbol:l};if(e(a)||!("visualVariables"in a)||!a.visualVariables)return s;const u=r(a,t,o),c=["proportional","proportional","proportional"];for(const{variable:t,value:e}of u)switch(t.type){case"color":s.color=e.toRgba();break;case"size":if("outline"===t.target)s.outlineSize=e;else{const o=t.axis,r=t.useSymbolValue?"symbol-value":e;switch(o){case"width":c[0]=r;break;case"depth":c[1]=r;break;case"height":c[2]=r;break;case"width-and-depth":c[0]=c[1]=r;break;default:c[0]=c[1]=c[2]=r}}break;case"opacity":s.opacity=e;break;case"rotation":switch(t.axis){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(s.size=c),s}async function l(e,o){if(t(e.symbol))return e.symbol;const r=i(e,o);return t(r)&&r.getSymbolAsync(e,{...o,abortOptions:{signal:o.signal}})}async function s(t,e){const n=i(t,e),a=await l(t,e);if(!a)return null;const s={renderer:n,symbol:a};if(!n||!("visualVariables"in n)||!n.visualVariables)return s;const u=r(n,t,e),c=["proportional","proportional","proportional"];for(const{variable:t,value:e}of u)if("color"===t.type)s.color=o.toUnitRGBA(e);else if("size"===t.type)if("outline"===t.target)s.outlineSize=e;else{const o=t.axis,r=t.useSymbolValue?"symbol-value":e;"width"===o?c[0]=r:"depth"===o?c[1]=r:"height"===o?c[2]=r:c[0]=c[1]="width-and-depth"===o?r:c[2]=r}else"opacity"===t.type?s.opacity=e:"rotation"===t.type&&"tilt"===t.axis?s.tilt=e:"rotation"===t.type&&"roll"===t.axis?s.roll=e:"rotation"===t.type&&(s.heading=e);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function u(t,e=0){const o=t[e];return"number"==typeof o&&isFinite(o)?o:null}function c(t){for(let e=0;e<3;e++){const o=t[e];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{u as getDriverAxisSizeValue,c as getDriverAxisSizeValueAny,i as getRenderer,a as getRenderingInfo,s as getRenderingInfoAsync,n as getSymbol,l as getSymbolAsync};
