/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import{subclass as t}from"../../../core/accessorSupport/decorators/subclass.js";import s from"../../../core/Error.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{reject as i}from"../../../core/promiseUtils.js";import o from"../../../geometry/Extent.js";import a from"../../../layers/support/ExportWMSImageParameters.js";import{WMSLayerView as p}from"../../layers/WMSLayerView.js";import m from"./DynamicLayerView3D.js";let n=class extends(p(m)){initialize(){this.layer.supportsSpatialReference(this.view.spatialReference)||this.addResolvingPromise(i(new s("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view")));const{layer:e,view:r}=this;this._exportWMSImageParameters=new a({layer:e,view:r}),this.updatingHandles.add(this._exportWMSImageParameters,"version",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())}))}destroy(){this._exportWMSImageParameters&&(this._exportWMSImageParameters.layer=null,this._exportWMSImageParameters.destroy(),this._exportWMSImageParameters=null)}createFetchPopupFeaturesQuery(e){const r=this.findExtentInfoAt(e),t=r.extent,s=new o(t[0],t[1],t[2],t[3],r.spatialReference),i=r.imageSize,a=i.width,p=i.height,m=s.width/a;return{extent:s,width:a,height:p,x:Math.round((e.x-s.xmin)/m),y:Math.round((s.ymax-e.y)/m)}}getFetchOptions(){return{timeExtent:this._exportWMSImageParameters.timeExtent}}};e([r({dependsOn:["view.spatialReference","layer.spatialReferences"]})],n.prototype,"suspended",void 0),n=e([t("esri.views.3d.layers.WMSLayerView3D")],n);var c=n;export default c;
