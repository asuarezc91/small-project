/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as i}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import{isSome as s}from"../../../core/maybe.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as e}from"../../../core/accessorSupport/decorators/property.js";import{subclass as t}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{resolve as r}from"../../../core/promiseUtils.js";import{whenTrueOnce as a,init as p,watch as h}from"../../../core/watchUtils.js";import{enlargeExtent as d}from"./graphics/graphicUtils.js";import{LayerView3D as n}from"./LayerView3D.js";import u from"../../layers/LayerView.js";import{toViewIfLocal as o}from"./support/projectExtentUtils.js";import c from"./graphics/Graphics3DFrustumVisibility.js";import l from"./graphics/Graphics3DGraphicLikeLayerView.js";let g=class extends(n(u)){constructor(){super(...arguments),this.frustumVisibility=new c,this.slicePlaneEnabled=!1,this.drapeSourceType=1,this.suspendResumeExtent=null,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set("graphics3d",new l({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",(()=>this.graphics3d.graphicsCore.opacityChange())),this.handles.add(this.layer.on("graphic-update",(i=>this.graphics3d.graphicsCore.graphicUpdateHandler(i))));const i=o(this).then((i=>{this.fullExtentInLocalViewSpatialReference=i}));i&&this.addResolvingPromise(i),this.handles.add(a(this.view,"basemapTerrain.ready",(()=>this.notifyChange("updating"))))}destroy(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))}get legendEnabled(){return this.canResume()&&!this.frustumVisibility.suspended}get suspendInfo(){var i,s;const e={};return null!=(i=this.graphics3d.scaleVisibility)&&i.suspended&&(e.outsideScaleRange=!0),e.outsideOfView=!(null==(s=this.frustumVisibility)||!s.suspended),e}async fetchPopupFeatures(i,e){return s(e)?e.clientGraphics:null}notifyGraphicUpdate(i,s){this.graphics3d.graphicsCore.notifyGraphicUpdate(i,s)}get graphics3DGraphics(){return this.graphics3d.graphicsCore.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}get symbolUpdateType(){return this.graphics3d.graphicsCore.symbolUpdateType}getGraphicFromGraphicUid(i){return this.graphics3d.getGraphicFromGraphicUid(i)}whenGraphicBounds(i,s){return this.graphics3d.whenGraphicBounds(i,s)}computeAttachmentOrigin(i,s){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(i,s):null}getSymbolLayerSize(i,s){return this.graphics3d.getSymbolLayerSize(i,s)}queryGraphics(){return r(this.loadedGraphics)}maskOccludee(i){return this.graphics3d.maskOccludee(i)}highlight(i){return this.graphics3d.highlight(i)}canResume(){var i;return super.canResume()&&!(null!=(i=this.graphics3d)&&i.suspended)}isUpdating(){return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.ready))}setupSuspendResumeExtent(){const i=()=>{this.suspendResumeExtent=d(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,1.2,this.graphics3d.graphicsCore.extentPadding),this.frustumVisibility.setExtent(this.suspendResumeExtent)};p(this.graphics3d.graphicsCore,"computedExtent",(()=>i()),!0),h(this.graphics3d.graphicsCore,"extentPadding",(()=>i()),!0)}get performanceInfo(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}};i([e({aliasOf:"layer.graphics"})],g.prototype,"loadedGraphics",void 0),i([e({readOnly:!0,dependsOn:["graphics3d.suspended"]})],g.prototype,"suspended",void 0),i([e({readOnly:!0,dependsOn:["graphics3d.suspended","frustumVisibility.suspended"]})],g.prototype,"legendEnabled",null),i([e({readOnly:!0,dependsOn:["frustumVisibility.updating","graphics3d.updating","view.basemapTerrain.ready"]})],g.prototype,"updating",void 0),i([e()],g.prototype,"layer",void 0),i([e({readOnly:!0})],g.prototype,"frustumVisibility",void 0),i([e({readOnly:!0})],g.prototype,"graphics3d",void 0),i([e({type:Boolean})],g.prototype,"slicePlaneEnabled",void 0),i([e({readOnly:!0,dependsOn:["graphics3d.scaleVisibility.suspended","frustumVisibility.suspended"]})],g.prototype,"suspendInfo",null),g=i([t("esri.views.3d.layers.GraphicsLayerView3D")],g);var m=g;export default m;
