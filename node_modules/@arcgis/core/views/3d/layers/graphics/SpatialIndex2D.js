/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import t from"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/accessorSupport/ensureType.js";import{property as s}from"../../../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../../../core/accessorSupport/decorators/subclass.js";import"../../../../core/urlUtils.js";import"../../../../core/uuid.js";import"../../../../portal/support/resourceExtension.js";import o from"../../../../core/Accessor.js";import{fromRect as i}from"../../../../geometry/support/aaBoundingBox.js";import{getObjectId as n}from"../../../../layers/graphics/dehydratedFeatures.js";import{PooledRBush as a}from"../../../../core/libs/rbush/PooledRBush.js";let c=class extends o{constructor(e){super(e),this.index=new a(9,t("csp-restrictions")?e=>({minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),this.boundsByFeature=new Map,this.spatialReference=null,this.hasZ=null,this.hasM=null,this.objectIdField=null}destroy(){this.index.destroy(),this.index=null,this.boundsByFeature.clear(),this.boundsByFeature=null}queryGraphicUIDsInExtent(e,t,s){t.equals(this.spatialReference)&&(u.minX=e[0],u.minY=e[1],u.maxX=e[2],u.maxY=e[3],this.index.search(u,(e=>s(e.graphic.uid))))}add(e){e.computeExtent(this.spatialReference),this.index.insert(e);const t=n(e.graphic,this._get("objectIdField"));null!=t&&this.boundsByFeature.set(t,e.extent)}addMany(e,t=e.length){const s=this._get("objectIdField");for(let r=0;r<t;r++){const t=e[r];t.computeExtent(this.spatialReference);const o=n(t.graphic,s);null!=o&&this.boundsByFeature.set(o,t.extent)}this.index.load(e,t)}remove(e){this.index.remove(e);const t=n(e.graphic,this._get("objectIdField"));null!=t&&this.boundsByFeature.delete(t)}clear(){this.index.clear(),this.boundsByFeature.clear()}forEachInBounds(e,t){u.minX=e[0],u.minY=e[1],u.maxX=e[2],u.maxY=e[3],this.index.search(u,(e=>{t(e)}))}getBounds(e,t){const s=this.boundsByFeature.get(e);return s?i(t,s):null}};e([s({constructOnly:!0})],c.prototype,"spatialReference",void 0),e([s({constructOnly:!0})],c.prototype,"hasZ",void 0),e([s({constructOnly:!0})],c.prototype,"hasM",void 0),e([s({constructOnly:!0})],c.prototype,"objectIdField",void 0),c=e([r("esri.views.3d.layers.graphics.SpatialIndex2D")],c);const u={minX:0,minY:0,maxX:0,maxY:0};var l=c;export default l;export{c as SpatialIndex2D};
