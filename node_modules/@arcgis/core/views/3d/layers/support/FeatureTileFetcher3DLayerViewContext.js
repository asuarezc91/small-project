/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{destroyMaybe as e,isSome as r}from"../../../../core/maybe.js";import{contextCapabilitiesFromLayer as t}from"./FeatureTileFetcher3D.js";import{createFeatureTileQuery3D as i}from"./featureTileQuery3D.js";class a{constructor(e){this.memoryCache=null,this._capabilities=null;const r=e.layerView.layer;this.layerView=e.layerView,this.objectIdField=r.objectIdField,this.returnZ=e.returnZ,this.returnM=e.returnM;const t=this.layerView.view.resourceController;this.query=i(r,t.scheduler),t&&this.memoryCacheEnabled&&(this.memoryCache=t.memoryController.getMemCache(r.uid))}get memoryCacheEnabled(){switch(this.layerView.layer.source.type){case"feature-layer":case"ogc-feature":return!0;case"csv":case"geojson":case"memory":case"stream-layer":return!1}}destroy(){e(this.memoryCache),this.query.destroy()}createQuery(){const e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}get viewingMode(){return this.layerView.view.state.mode}get tilingScheme(){return this.layerView.view.featureTiles.tilingScheme}get scheduler(){const e=this.layerView.view.resourceController;return e?e.scheduler:null}get geometryType(){return this.layerView.layer.geometryType}get fullExtent(){return this.layerView.layer.fullExtent}get tileMaxRecordCount(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this.layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return r(this._capabilities)||(this._capabilities=t(this.layerView.layer)),this._capabilities}logFetchError(e,r){e.error("#fetchTile()",this.layerView.layer,r&&r.message?r.message:r)}}export{a as FeatureTileFetcher3DLayerViewContext};
