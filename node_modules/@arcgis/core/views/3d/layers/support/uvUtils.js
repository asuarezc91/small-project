/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import t from"../../../../geometry/SpatialReference.js";import{c as e}from"../../../../chunks/vec3f64.js";import{s as o,d as r,a as s,g as a,B as n,n as c,c as m,b as f}from"../../../../chunks/vec3.js";import{projectBuffer as i}from"../../../../geometry/projection.js";import{a as u}from"../../../../chunks/mat4f64.js";import{a as I}from"../../../../chunks/vec2f64.js";import{s as p}from"../../../../chunks/vec2.js";import{BufferViewVec3f64 as N}from"../../support/buffer/BufferView.js";import{t as h,c as l,n as V}from"../../../../chunks/plane.js";import{PatternMaterial as b}from"../../webgl-engine/materials/PatternMaterial.js";function M(e,o,r,s=1){if(r.isGeographic){const e=new Float64Array(o.typedBuffer.length);i(o.typedBuffer,r,0,e,t.WebMercator,0,o.count),o=N.fromTypedArray(e),r=t.WebMercator}p(k,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let t=0;t<o.count;t++)o.getVec(t,j),k[0]=Math.min(k[0],j[0]),k[1]=Math.min(k[1],j[1]);const a=k[0]%s,n=k[1]%s;Y[0]=k[0]-a,Y[1]=k[1]-n;for(let t=0;t<o.count;t++)o.getVec(t,j),e.setValues(t,(j[0]-Y[0])/s,(j[1]-Y[1])/s,Y[0]/s,Y[1]/s)}function T(t,e,i,u,I,N,l=1){o(y,1,0,0),o(F,0,1,0),o(d,0,0,1),function(t,e){o(G,0,0,0);for(let t=0;t<e.count-1;t++)e.getVec(t,j),f(G,G,j);s(t,G,1/(e.count-1))}(g,e),function(t,e){const o=t.count-1;return h(t,e,0,Math.floor(o/3),Math.floor(o*(2/3)))}(e,E)&&function(t,e,f,i,u,I){u.basisMatrixAtPosition(I,x),o(B,x[0],x[1],x[2]),o(O,x[4],x[5],x[6]),o(w,x[8],x[9],x[10]);const p=V(t);r(p,w)<0&&s(p,p,-1);a(i,p);const N=r(p,O),h=r(p,B);Math.abs(N)<Math.abs(h)?(n(e,B,p,-h),c(e,e),m(f,e,p),c(f,f),s(f,f,-1)):(n(f,O,p,-N),c(f,f),m(e,f,p),c(e,e))}(E,y,F,d,i,g),p(k,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p(P,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let t=0;t<e.count;t++){e.getVec(t,j);const o=r(y,j),s=r(F,j);k[0]=Math.min(k[0],o),k[1]=Math.min(k[1],s),P[0]=Math.max(P[0],o),P[1]=Math.max(P[1],s)}const b=r(d,g);W(_,k[0],k[1],b,y,F,d),W(A,P[0],k[1],b,y,F,d),W(S,k[0],P[1],b,y,F,d);const M=k[0]%l,T=k[1]%l;Y[0]=k[0]-M,Y[1]=k[1]-T;for(let o=0;o<e.count;o++)e.getVec(o,j),t.setValues(o,(r(y,j)-Y[0])/l,(r(F,j)-Y[1])/l,Y[0]/l,Y[1]/l),u&&I&&N&&(u.setVec(o,_),I.setVec(o,A),N.setVec(o,S))}const g=e(),j=e(),E=l(),y=e(),F=e(),d=e(),k=I(),P=I(),Y=I(),_=e(),A=e(),S=e();function v(t){return t.material instanceof b&&!t.material.params.draped}const x=u(),B=e(),O=e(),w=e();const G=e();function W(t,e,r,s,a,n,c){o(t,e*a[0]+r*n[0]+s*c[0],e*a[1]+r*n[1]+s*c[1],e*a[2]+r*n[2]+s*c[2])}export{T as createMapSpaceUVCoords,M as createMapSpaceUVCoordsDraped,v as requiresUVUpdates};
