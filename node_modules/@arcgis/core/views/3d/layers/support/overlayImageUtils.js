/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{width as t,height as e,intersects as n}from"../../../../geometry/support/aaBoundingRect.js";import{VertexAttrConstants as r}from"../../webgl-engine/lib/Util.js";import{GeometryData as o}from"../../webgl-engine/lib/GeometryData.js";import i from"../../webgl-engine/lib/GeometryUtil.js";function a(n,r,o){const i=t(n)/e(n),a={width:o,height:o};return i>1.0001?a.height=o/i:i<.9999&&(a.width=o*i),a.width=Math.round(a.width/(t(n)/t(r))),a.height=Math.round(a.height/(e(n)/e(r))),a}function h(t,e){const n=[[t[0],t[1],e],[t[2],t[1],e],[t[2],t[3],e],[t[0],t[3],e]];return i.createSquareGeometry(n)}function l(t,e,i){if(!n(t,e))return h(e,i);const a=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],l=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],s=e[2]-e[0],c=e[3]-e[1],g=l[0]>0&&l[2]>0?3:2,u=a[0]>0&&a[2]>0?3:2,w=(u+1)*(g+1),f=new Float64Array(3*w),d=new Float32Array(2*w),y=new Uint32Array(6*(u*g-1));let M=0,p=0,A=0,b=0,O=0;for(let t=0;t<4;t++){const n=a[t];if(n<=0)continue;let r=0;for(let n=0;n<4;n++){const o=l[n];o<=0||(f[p++]=e[0]+r,f[p++]=e[1]+M,f[p++]=i,d[A++]=r/s,d[A++]=M/c,n<3&&t<3&&(1!==n||1!==t)&&(y[O++]=b,y[O++]=b+1,y[O++]=b+g+1,y[O++]=b+1,y[O++]=b+g+2,y[O++]=b+g+1),b++,r+=o)}M+=n}const U={};U[r.POSITION]={size:3,data:f},U[r.NORMAL]={size:3,data:m},U[r.UV0]={size:2,data:d};const j={},I=new Uint32Array(y.length);for(let t=0;t<I.length;t++)I[t]=0;return j[r.POSITION]=y,j[r.NORMAL]=I,j[r.UV0]=y,new o(U,j)}const m=new Float32Array([0,0,1]);export{a as computeImageExportSize,h as createGeometryForExtent,l as createOuterImageGeometry};
