/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{releaseTileData as t}from"./terrainUtils.js";import{computeUpsampleInfo as s}from"./tileUtils.js";import{TILE_AGENT_DONE as i}from"./TileAgent.js";class e{constructor(t,s){this._pool=s,this.waitingAgents=[],this.data=null,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0,this.elevationBounds=void 0,this.init(t)}init(t){this.waitingAgents.length=0,this.data=null,this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0,0===t&&(this.elevationBounds=null)}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestPromise&&(this.requestAbort.abort(),this.requestPromise=null,this.requestAbort=null)}dispose(){this.loadingAgent&&this.loadingAgent!==i&&this.loadingAgent.dispose(),this.loadingAgent=null,this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this.disposeData()}disposeData(){this.data=t(this.data)}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t!==i&&null!=i){if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),s(t,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}static makeEmptyLayerInfo(t,s,i){return i?(i.init(t),i):new e(t,s)}}export{e as TilePerLayerInfo};
