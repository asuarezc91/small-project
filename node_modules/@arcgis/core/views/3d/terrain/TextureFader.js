/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{destroyMaybe as t,isNone as e,isSome as i}from"../../../core/maybe.js";import{b as s}from"../../../chunks/vec4f64.js";class r{constructor(t,e,i,r){this.texture=t,t.retain(),this.offsetAndScale=s(e,i,r,r)}destroy(){this.texture.release()}}export default class{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=t(this._current),this._next=t(this._next),this._waiting=t(this._waiting),this._delayed=t(this._delayed)}get current(){if(e(this._current))return null;if(!this._isFading){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}const s=performance.now();if(i(this._delayed)&&s>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null),i(this._next)){const e=this._fadeDuration;s-this._fadeStart>=e&&(t(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=s)}return this._current}get next(){return this._next}get fadeFactor(){if(e(this._next))return 1;const t=performance.now()-this._fadeStart,i=this._fadeDuration;return t>i?0:1-t/i}get isFading(){return i(this._next)||i(this._delayed)}push(e,s,n,h,a=0){this._delayed=t(this._delayed);const _=i(e)?new r(e,s,n,h):null;this._push(_,a)}_push(i,s){if(this._isFading||this.clear(),e(this._current))return void(this._current=i);const r=performance.now();return 0!==s?(this._delayed=i,void(this._delayedTime=r+s)):e(this._next)?(this._next=i,void(this._fadeStart=r)):void(e(i)||(t(this._waiting),this._waiting=i))}get _fadeDuration(){return e(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}get _isFading(){return this._getFadeDuration()>0}}export{r as TextureReference};
