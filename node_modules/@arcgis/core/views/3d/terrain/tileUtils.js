/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isNone as t}from"../../../core/maybe.js";import e from"../../../core/PooledArray.js";class n{constructor(){this.q=new e,this._last=null}get done(){return 0===this.q.length&&(!this._last||this._last.isLeaf)}resetOne(t){this.q.clear(),this.q.push(t),this._last=null}reset(t){this.q.clear(),t&&this.q.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children),this._last=this.q.pop(),this._last}}class r{constructor(){this.q=new e}get done(){return 0===this.q.length}reset(t){if(this.q.clear(),t){this.q.pushArray(t);for(let t=0;t<this.q.length;++t){const e=this.q.data[t];e.isLeaf||this.q.pushArray(e.children)}}}next(){return this.q.pop()}}function s(t){return t?t[0]+"/"+t[1]+"/"+t[2]:"null"}function i(t){return t?s(t.lij):"null"}function l(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)o(t[n],e);else o(t,e)}function o(t,e){if(e(t),!t.isLeaf)for(const n of t.children)o(n,e)}function a(e,n,r){if(t(n))return!1;const s=n.fullExtent,i=e.extent;if(r){if(i[0]<s.xmin||i[1]<s.ymin||i[2]>s.xmax||i[3]>s.ymax)return!1}else if(s.xmin>i[2]||s.ymin>i[3]||s.xmax<i[0]||s.ymax<i[1])return!1;const l=e.surface.tilingScheme.levels[e.lij[0]].scale;return!(n.minScale>0&&l>1.00000001*n.minScale)&&!(n.maxScale>0&&l<.99999999*n.maxScale)}function h(t,e){e.sort(((e,n)=>c(e,n,t)))}function c(t,e,n){const r=t.screenDepth,s=e.screenDepth;return r<s?-n:r>s?n:0}function u(t,e){const n=new Map;t.forAll((t=>n.set(t,t.distanceToSquared(e)))),t.sort(((t,e)=>n.get(t)-n.get(e)))}function f(t,e,n){let r=1,s=0,i=0;for(;t!==e;)if(r*=.5,s*=.5,i*=.5,1&t.lij[2]&&(s+=.5),0==(1&t.lij[1])&&(i+=.5),null==(t=t.parent))throw new Error("tile was not a descendant of upsampleTile");n.init(e,s,i,r)}function p(t){for(let e=0;e<t.length;e++){const n=t[e],r=n.parent;if(r)for(let t=0;t<4;t++){const e=r.children[t];if(e&&e!==n&&e.visible)return!0}}return!1}function m(t,e){if(!t||!e||t[0]===e[0])return!1;const n=t[0]<e[0],r=n?t:e,s=n?e:t,i=1<<s[0]-r[0];return Math.floor(s[1]/i)===r[1]&&Math.floor(s[2]/i)===r[2]}export{r as IteratorPostorder,n as IteratorPreorder,c as compareTiles,f as computeUpsampleInfo,a as fallsWithinLayer,p as hasVisibleSiblings,s as lij2str,h as sortTiles,u as sortTilesByPOI,i as tile2str,m as tilesAreRelated,l as traverseTilesPreorder};
