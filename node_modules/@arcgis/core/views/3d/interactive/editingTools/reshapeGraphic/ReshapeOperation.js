/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import"../../../../../core/has.js";import{isSome as t,destroyMaybe as i,isNone as a,unwrap as o}from"../../../../../core/maybe.js";import"../../../../../core/Logger.js";import"../../../../../core/accessorSupport/ensureType.js";import{handlesGroup as n}from"../../../../../core/handleUtils.js";import{property as r}from"../../../../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../core/urlUtils.js";import"../../../../../core/uuid.js";import"../../../../../portal/support/resourceExtension.js";import l from"../../../../../core/Evented.js";import{s as p,b as h,a as u}from"../../../../../chunks/vec3.js";import c from"../../../../../core/Handles.js";import{init as d}from"../../../../../core/watchUtils.js";import{getGraphicEffectiveElevationInfo as m}from"../../../../../support/elevationInfoUtils.js";import{makeDehydratedPoint as g}from"../../../../../layers/graphics/dehydratedFeatures.js";import{sv3d as _}from"../../../support/stack.js";import v from"../../../webgl-engine/lib/GeometryUtil.js";import M from"../../../webgl-engine/lib/Geometry.js";import{EditGeometry as y}from"../editGeometry/EditGeometry.js";import{EditGeometryHelper as f}from"../editGeometry/EditGeometryHelper.js";import{addMapDelta as x,createManipulatorDragEventPipeline as b,dragAtLocation as S}from"../../../../interactive/dragEventPipeline.js";import{SnappingContext as E}from"../../../../interactive/snapping/SnappingAlgorithm.js";import{SnappingEngine as G}from"../../../../interactive/snapping/SnappingEngine.js";import{screenToMapXYForGraphicAtLocation as w}from"../dragEventPipeline3D.js";import{Manipulator3D as H}from"../../Manipulator3D.js";import{createManipulatorMaterial as I,createManipulatorOutlineMaterial as O,placeAtGraphic as P}from"../../manipulatorUtils.js";import{canMoveZ as V}from"../manipulatorUtils.js";import{settings as D}from"../settings.js";import{OutlineVisualElement as j}from"../../visualElements/OutlineVisualElement.js";import{GraphicState as k}from"../../../layers/graphics/GraphicState.js";import{createVisualElements as A}from"../visualElementUtils.js";import{DISC_RADIUS_SMALL as U}from"../manipulations/config.js";import{primaryShapeOrientation as L}from"../manipulations/moveUtils.js";import{MoveManipulation as T}from"../manipulations/MoveManipulation.js";import{MoveXYGraphicManipulation as z}from"../manipulations/MoveXYGraphicManipulation.js";let C=class extends l.EventedAccessor{constructor(e){super(e),this._vertexManipulatorMaterial=I(D.colorToVec4(D.reshapeManipulators.vertex.color),D.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=O(D.colorToVec4(D.reshapeManipulators.vertex.outlineColor),D.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=O(D.colorToVec4(D.reshapeManipulators.vertex.hoverOutlineColor),D.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=I(D.colorToVec4(D.reshapeManipulators.edge.color),D.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=O(D.colorToVec4(D.reshapeManipulators.edge.outlineColor),D.reshapeManipulators.edge.renderOccluded),this._selectedManipulatorMaterial=I(D.colorToVec4(D.reshapeManipulators.selected.color),D.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=O(D.colorToVec4(D.reshapeManipulators.selected.outlineColor),D.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=O(D.colorToVec4(D.reshapeManipulators.selected.hoverOutlineColor),D.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._handles=new c,this._manipulatorHandles=new c,this._manipulatorInfos=[],this._reshapeHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._vertexLaserLineVisualElement=null,this.snappingEngine=new G(e.tool.snappingOptions)}initialize(){const e=new k({graphic:this.graphic});this._graphicState=e,this._handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._clear(),this._handles.destroy(),this.snappingEngine.destroy()}get inputGeometry(){return t(this._reshapeHelper)?this._reshapeHelper.geometry:null}set inputGeometry(e){this._recreateManipulators(e)}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZ(){return this.tool.enableZ}get enableMoveGraphic(){return this.tool.enableMoveGraphic}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._moveManipulation=i(this._moveManipulation),this._graphicMoveManipulation=i(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=null,this._numGrabbing=0,this._numDragging=0}_recreateManipulators(e=this.inputGeometry){if(this._clear(),a(e))return;this._reshapeHelper=new Y(y.fromGeometry(e,this.view.viewingMode),e.type);const t=m(this.graphic);for(const e of this._reshapeHelper.data.components){for(const i of e.vertices)this._createPerVertexManipulator(i,t);for(const i of e.edges)this._createPerVertexManipulator(i,t)}this._createGraphicMoveManipulators(t)}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;const i=[],a=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),n=1===e&&a,r=o(this._reshapeHelper);for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&(e.manipulator.grabbing||n&&!e.manipulator.selected||(o(r).moveVertices([e.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(e.handle.pos),this._updateManipulatorPosition(e)));if(0===i.length)return;let s=0;for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&s++;this.outputGeometry=r.geometry;if(i.length===s){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)F(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const t=e.mapDeltaX,i=e.mapDeltaY,a=e.mapDeltaZ;if(!t&&!i&&!a)return;const n=[];for(const t of this._manipulatorInfos)F(t)&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&n.push(t);const r=o(this._reshapeHelper);for(const e of n)r.moveVertices([e.handle],t,i,a);this.outputGeometry=r.geometry;for(const e of n)this._updateManipulatorPosition(e);this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){this._graphicMoveManipulation=new z({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,t,i)=>{t.next((e=>this._trackNumDragging(e))).next((e=>{this._perGraphicManipulatorDragAction(0,e)})),i.next(this._cancelDragOperation())}))):this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null})),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click"),e.stopPropagation()}))]))),this._moveManipulation=new T({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&V(this.graphic),snapToScene:!1,radius:T.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this._handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click"),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const i=o(this.graphic.geometry).spatialReference;let a=null;this._handles.add([this._moveManipulation.createDragPipeline(((i,n,r,s)=>{n.next((e=>this._trackNumDragging(e))).next((i=>{if("start"===i.action){const t=this._manipulatorInfos.filter((e=>F(e)&&e.manipulator.selected));if(1===i.manipulatorType&&1===t.length){const i=t[0].handle;a=new E(o(this._reshapeHelper),this.view,e,s,i)}}return t(a)&&(i.mapEnd=this.snappingEngine.snap(i.mapEnd,a)),"end"===i.action&&(this.snappingEngine.doneSnapping(),a=null),i})).next(x()).next((e=>{this._perGraphicManipulatorDragAction(1,e)})),r.next(this._cancelDragOperation())}),e,i),d(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),d(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this._handles.remove(e)}))]),this._updateMoveManipulationPosition();const n=A({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){t(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});this._outlineVisualElement=n.visualElement instanceof j?n.visualElement:null,t(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(n)}_createPerVertexManipulator(e,t=m(this.graphic)){if(a(this._vertexManipulatorGeometry)||a(this._vertexManipulatorOutlineGeometry)){const e=D.reshapeManipulators.vertex,t=e.size/2,i=t+e.collisionPadding,a=t/i;this._vertexManipulatorGeometry=new M(v.createSphereGeometry(a,16,16),"reshape-manipulator");const o=(t+e.outlineSize)/i;this._vertexManipulatorOutlineGeometry=new M(v.createSphereGeometry(o,16,16),"reshape-manipulator-outline")}if(a(this._edgeManipulatorGeometry)||a(this._edgeManipulatorOutlineGeometry)){const e=D.reshapeManipulators.edge,t=e.size/2,i=t+e.collisionPadding,a=t/i;this._edgeManipulatorGeometry=new M(v.createSphereGeometry(a,16,16),"reshape-manipulator");const o=(t+e.outlineSize)/i;this._edgeManipulatorOutlineGeometry=new M(v.createSphereGeometry(o,16,16),"reshape-manipulator-outline")}const i=new H({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|X.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|X.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|X.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|X.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|X.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|X.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|X.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(i,e,t);const o="edge"===e.type?{manipulator:i,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:i,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(o),this.manipulators.add(i),this._updateManipulatorPosition(o),"edge"===o.type){const e=this._getManipulatorInfoFromHandle(o.handle.left).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(o))),t=this._getManipulatorInfoFromHandle(o.handle.right).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(o)));o.locationUpdateHandle=n([e,t]),this._manipulatorHandles.add(o.locationUpdateHandle,i)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(i,!0),i);const r=b(i,((e,i,a,n)=>{i.next((e=>this._trackNumDragging(e))).next((e=>R(o)?{...e,info:this._splitEdgeManipulator(o)}:{...e,info:o})).next(S(this.view,e.elevationAlignedLocation)).next(w(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference)).next(this._snapDrag(t,n)).next(x()).next((e=>{this._perVertexManipulatorDragAction(e)})),a.next(this._cancelDragOperation())}));return this._manipulatorHandles.add(r,i),this._manipulatorHandles.add([i.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,o))),i.events.on("select-changed",(()=>{o.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),i}_snapDrag(e,i){let a=null;const n=o(this._reshapeHelper);return o=>{if("start"===o.action&&(this.isMultiVertexSelection()||(a={context:new E(n,this.view,e,i,o.info.handle),originalPos:n.data.coordinateHelper.createDehydratedPoint(o.info.handle.pos)})),t(a)){const e={...a.originalPos};e.x+=o.mapEnd.x-o.mapStart.x,e.y+=o.mapEnd.y-o.mapStart.y;const t=this.snappingEngine.snap(e,a.context);o.mapEnd.x=t.x+(o.mapStart.x-a.originalPos.x),o.mapEnd.y=t.y+(o.mapStart.y-a.originalPos.y)}return"end"===o.action&&(this.snappingEngine.doneSnapping(),a=null),o}}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(){const e=t(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{switch(this._numDragging--,this.inputGeometry=e,this.outputGeometry=e,this.snappingEngine.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=X.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=D.reshapeManipulators.vertex.size/2+D.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=X.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=D.reshapeManipulators.edge.size/2+D.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const i=o(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=i.data.coordinateHelper.toPoint(e.handle.pos,N),e.manipulator.grabbing&&t(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,o=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(t(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const t=a.location,n=o.location,r=.5,s=t.x+r*(n.x-t.x),l=t.y+r*(n.y-t.y),p=t.hasZ&&n.hasZ?0:void 0;e.manipulator.location=g(s,l,p,i.geometry.spatialReference)}else{const t=a.elevationAlignedLocation,n=o.elevationAlignedLocation,r=.5,s=t.x+r*(n.x-t.x),l=t.y+r*(n.y-t.y),p=t.hasZ&&n.hasZ?t.z+r*(n.z-t.z):void 0;e.manipulator.elevationAlignedLocation=g(s,l,p,i.geometry.spatialReference)}}}_splitEdgeManipulator(e){const t=o(this._reshapeHelper),i=o(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const a=e;a.handle=i,a.type="vertex";const n=m(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(a),this._updateSelection(e.manipulator);const r=this._updateEventState(2),s=t.data.coordinateHelper.toArray(a.handle.pos),l=t.data.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:o(i.index)}],added:s}),r&&this._updateEventState(0),a}_updateMoveManipulationPosition(){const e=_.get();p(e,0,0,0);let i=0,n=!1,r=null,s=null;for(const t of this._manipulatorInfos)F(t)&&(t.manipulator.selected?(i++,h(e,e,t.manipulator.renderLocation),a(r)||t.selectedIndex>r.selectedIndex?(s=r,r=t):(a(s)||t.selectedIndex>s.selectedIndex)&&(s=t)):n=!0);if(0!==i){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&V(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==i}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&V(this.graphic)}if(0!==i){let e=0;if(t(r)){const i=r.handle.pos,a=t(s)?s.handle.pos:r.handle.left&&r.handle.left.left?r.handle.left.left.pos:null,o=!t(s)&&r.handle.right&&r.handle.right.right?r.handle.right.right.pos:null;a&&o?this._moveManipulation.xyAxisManipulation.available=!1:a?e=Z(a,i):o&&(e=Z(i,o))}this._moveManipulation.angle=e,this._moveManipulation.radius=U}else this._moveManipulation.angleDeferred=()=>L(o(this.graphic.geometry)),this._moveManipulation.radius=T.radiusForSymbol(this.graphic.symbol);0!==i&&n?(u(e,e,1/i),N.spatialReference=o(this._reshapeHelper).geometry.spatialReference,N.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,N),this._moveManipulation.elevationAlignedLocation=N):t(this._outlineVisualElement)&&!this._graphicState.isDraped&&t(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:P(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=o(this._reshapeHelper);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));const e=o(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createPerVertexManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:o(e.index)}}));this.outputGeometry=i.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),R(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function Z(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function F(e){return"vertex"===e.handle.type}function R(e){return"edge"===e.handle.type}e([r({constructOnly:!0})],C.prototype,"tool",void 0),e([r()],C.prototype,"inputGeometry",null),e([r()],C.prototype,"outputGeometry",void 0),C=e([s("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],C);const N=g(0,0,null,null);var X;!function(e){e.Vertex=16,e.Edge=32}(X||(X={}));class Y extends f{constructor(e,t){super(e,t),this.type=t,this._geometry=null}get geometry(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry}}export{Y as ReshapeGeometryHelper,C as ReshapeOperation};
