/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import"../../../../../core/has.js";import{isSome as t,isNone as r}from"../../../../../core/maybe.js";import"../../../../../core/Logger.js";import"../../../../../core/accessorSupport/ensureType.js";import{property as o}from"../../../../../core/accessorSupport/decorators/property.js";import{subclass as i}from"../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../core/urlUtils.js";import"../../../../../core/uuid.js";import"../../../../../portal/support/resourceExtension.js";import s from"../../../../../core/Evented.js";import p from"../../../../../core/Handles.js";import{init as a}from"../../../../../core/watchUtils.js";import{InteractiveToolBase as n}from"../../../../interactive/InteractiveToolBase.js";import{SnappingOptions as h}from"../../../../interactive/snapping/SnappingOptions.js";import{isSupportedGraphic as c}from"./isSupportedGraphic.js";import{ReshapeOperation as m}from"./ReshapeOperation.js";let l=class extends(s.EventedMixin(n)){constructor(e){super(e),this._handles=new p,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingOptions=new h}destroy(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=this.graphic.geometry;0!==c(this.graphic)||!t(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==c(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){r(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new m({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(()=>this.emit("immediate-click"))),a(this,"graphic",(()=>{this._updateGraphic()}),!0)])}beforeUndo(){this._reshapeOperation.snappingEngine.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}};e([o({constructOnly:!0,nonNullable:!0})],l.prototype,"view",void 0),e([o({constructOnly:!0})],l.prototype,"graphic",void 0),e([o({constructOnly:!0,nonNullable:!0})],l.prototype,"enableZ",void 0),e([o({constructOnly:!0,nonNullable:!0})],l.prototype,"enableMoveGraphic",void 0),e([o({readOnly:!0})],l.prototype,"type",void 0),e([o()],l.prototype,"snappingOptions",void 0),l=e([i("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],l);export{l as GraphicReshapeTool};
