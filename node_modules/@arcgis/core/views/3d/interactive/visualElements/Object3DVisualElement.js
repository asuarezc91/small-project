/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as e,isNone as s}from"../../../../core/maybe.js";import t from"../../webgl-engine/lib/Object3D.js";import r from"../../webgl-engine/lib/Geometry.js";import o from"../../webgl-engine/lib/Layer.js";import i from"../../webgl-engine/lib/Texture.js";import{VisualElement as c}from"./VisualElement.js";class n extends c{constructor(e){super(e.view),this._resources=null}get object(){return e(this._resources)?this._resources.object:null}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(s(this._resources))return;const e=this._resources.object,t=this.view._stage;e.geometries.forEach((e=>{t.remove(2,e.id)})),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),e.geometries.forEach((e=>{t.add(2,e)}))}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const s=new o("element",{isPickable:!1});e.add(0,s),e.addToViewContent([s.id]);const r=new t({idHint:"element",castShadow:!1});this.createExternalResources(),this.createGeometries(r),r.geometries.forEach((s=>{e.add(2,s)})),this.forEachExternalResource((s=>{e.add(this._contentTypeFromResource(s),s)})),e.add(1,r),s.addObject(r),this.visible||r.setVisible(!1),this._resources={layer:s,object:r}}_contentTypeFromResource(e){return e instanceof r?2:e instanceof i?4:3}destroyResources(){const e=this.view._stage;!s(this._resources)&&e&&(e.remove(1,this._resources.object.id),e.remove(0,this._resources.layer.id),this.forEachExternalResource((s=>{e.remove(this._contentTypeFromResource(s),s.id),s.dispose()})),this._resources.object.geometries.forEach((s=>{e.remove(2,s.id)})),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){s(this._resources)||this._resources.object.setVisible(e)}}export{n as Object3DVisualElement};
