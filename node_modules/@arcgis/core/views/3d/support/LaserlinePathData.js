/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"../../../core/has.js";import{isSome as e,isNone as t}from"../../../core/maybe.js";import"../../../core/mathUtils.js";import{c as r}from"../../../chunks/vec3f64.js";import{s,f as i}from"../../../chunks/vec3.js";import"../../../chunks/builtins.js";import{glLayout as o}from"./buffer/glUtil.js";import{newLayout as n}from"./buffer/InterleavedLayout.js";import u from"../../webgl/BufferObject.js";import f from"../../webgl/VertexArrayObject.js";import"../../webgl/FramebufferObject.js";import"../../webgl/RenderingContext.js";import{LaserlinePathTechnique as a}from"../webgl-engine/shaders/LaserlinePathTechnique.js";class c{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=r(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);s(this._origin,e[t+0],e[t+1],e[t+2])}else s(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(t){const r=this.ensureVAO(t);e(r)&&(t.bindVAO(r),t.drawArrays(4,0,this._count))}dispose(){e(this._vao)&&this._vao.dispose()}ensureVAO(e){return t(this._buffers)?null:(t(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const r=this.createDataBuffer(t);return this._dirty=!1,new f(e,a.attributeLocations,{data:o(d)},{data:u.createVertex(e,35044,r)})}ensureVertexData(e,t){if(!this._dirty)return;const r=this.createDataBuffer(t);e.vertexBuffers.data.setData(r),this._dirty=!1}numberOfRenderVertices(e){return 3*(2*(e.length/3-1))}createDataBuffer(e){const t=e.reduce(((e,t)=>e+this.numberOfRenderVertices(t)),0);this._count=t;const r=d.createBuffer(t),o=this._origin;let n=0,u=0;for(const t of e){for(let e=0;e<t.length;e+=3){const f=s(l,t[e+0],t[e+1],t[e+2]);0===e?u=this._renderCoordsHelper.getAltitude(f):this._renderCoordsHelper.setAltitude(u,f);const a=this._renderCoordsHelper.worldUpAtPosition(f,h),c=n+2*e,d=i(l,f,o);if(e<t.length-3){r.up.setVec(c,a),r.up.setVec(c+3,a),r.up.setVec(c+5,a);for(let e=0;e<6;e++)r.start.setVec(c+e,d);r.extrude.setValues(c+0,0,-1),r.extrude.setValues(c+1,1,-1),r.extrude.setValues(c+2,1,1),r.extrude.setValues(c+3,0,-1),r.extrude.setValues(c+4,1,1),r.extrude.setValues(c+5,0,1)}if(e>0){r.up.setVec(c-2,a),r.up.setVec(c-4,a),r.up.setVec(c-5,a);for(let e=-6;e<0;e++)r.end.setVec(c+e,d)}}n+=this.numberOfRenderVertices(t)}return r.buffer}}const h=r(),l=r(),d=n().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");export{c as LaserlinePathData};
