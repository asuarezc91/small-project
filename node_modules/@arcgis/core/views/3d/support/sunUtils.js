/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{clamp as t,lerp as i}from"../../../core/mathUtils.js";import{f as e,c as n}from"../../../chunks/vec3f64.js";import{s as o,e as a,i as l}from"../../../chunks/vec3.js";import{i as s,e as u,f as r,g as f}from"../../../chunks/mat4.js";import{a as c}from"../../../chunks/mat4f64.js";import{S as m}from"../../../chunks/SunCalc.js";const d={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function b(n,l){const s=l[2],u=N;o(u.ambient.color,1,1,1),u.ambient.intensity=d.global.ambient,o(u.diffuse.color,1,1,1),u.diffuse.intensity=d.global.diffuse;let r=(Math.abs(s)-d.local.altitude)/(d.global.altitude-d.local.altitude);r=t(r,0,1),u.globalFactor=r;const f=m.getTimes(n,l[1],l[0]);if(r<1){const t=function(t,i){const n=t.valueOf();let o,a;i.polarException===m.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===m.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const l=a-o,s=o+l/2,u=l/4,r=s-u,f=s+u,c=.06*l,b=o-c/2,g=o+c/2,h=a-c/2,A=a+c/2,p=d.local,N=[.01,p.ambientAtNight],y=[.8,.8,1],P=[.01,.01,.01],T=[p.diffuseAtTwilight,p.ambientAtTwilight],E=[1,.75,.75],I=[.8,.8,1],M=[.9*p.diffuseAtNoon,p.ambientAtNoon],z=[1,.98,.98],v=[.98,.98,1],_=[p.diffuseAtNoon,p.ambientAtNoon],j=[1,1,1],D=[1,1,1],H=M,L=z,R=v,k=T,x=E,C=I;let w,F,G=[0,0],S=[0,0,0],X=[0,0,0];n<b||n>A?(G=N,S=P,X=y,F="night"):n<g?(w=g-b,G=O(n-b,w,N,T),S=O(n-b,w,P,E),X=O(n-b,w,y,I),F="sun rising"):n<r?(w=r-g,G=O(n-g,w,T,M),S=O(n-g,w,E,z),X=O(n-g,w,I,v),F="early morning"):n<s?(w=s-r,G=O(n-r,w,M,_),S=O(n-r,w,z,j),X=O(n-r,w,v,D),F="late morning"):n<f?(w=f-s,G=O(n-s,w,_,H),S=O(n-s,w,j,L),X=O(n-s,w,D,R),F="early afternoon"):n<h?(w=h-f,G=O(n-f,w,H,k),S=O(n-f,w,L,x),X=O(n-f,w,R,C),F="late afternoon"):n<A&&(w=A-h,G=O(n-h,w,k,N),S=O(n-h,w,x,P),X=O(n-h,w,C,y),F="sun setting");return{diffuse:{intensity:G[0],color:e(S[0],S[1],S[2])},ambient:{intensity:G[1],color:e(X[0],X[1],X[2])},timeOfDay:F}}(n,f);a(u.ambient.color,t.ambient.color,u.ambient.color,r),u.ambient.intensity=i(t.ambient.intensity,u.ambient.intensity,r),a(u.diffuse.color,t.diffuse.color,u.diffuse.color,r),u.diffuse.intensity=i(t.diffuse.intensity,u.diffuse.intensity,r)}return u.noonFactor=function(i,e){const n=i.valueOf();let o,a;e.polarException===m.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(i.getHours()+48)*60*1e3-60*i.getMinutes()*1e3,a=o+432e6):e.polarException===m.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const l=o+(a-o)/2;return 1-t(Math.abs(n-l)/432e5,0,1)}(n,f),u}function g(i,e,a,c){c||(c=n());const b=p,g=s(A);if("global"===a)m.getPosition(i,0,0,b),o(c,0,0,-1),u(g,g,-b.azimuth),r(g,g,-b.altitude),l(c,c,g);else{const n=d.planarDirection,a=n.globalAngles,s=e[2];let r=(Math.abs(s)-n.localAltitude)/(n.globalAltitude-n.localAltitude);r=t(r,0,1),r<1?(m.getPosition(i,e[1],e[0],b),b.azimuth=(1-r)*b.azimuth+r*a.azimuth,b.altitude=(1-r)*b.altitude+r*a.altitude):(b.azimuth=a.azimuth,b.altitude=a.altitude),o(c,0,-1,0),f(g,g,-b.azimuth),u(g,g,-b.altitude),l(c,c,g)}return c}function h(t,i){if("global"===i)return!0;{const i=d.planarDirection,e=t[2];return Math.abs(e)<i.localAltitude}}const A=c(),p={azimuth:0,altitude:0},N={ambient:{color:n(),intensity:0},diffuse:{color:n(),intensity:0,direction:n()},globalFactor:0,noonFactor:0};function O(t,i,e,n){const o=[];for(let a=0;a<e.length;a++)o[a]=(n[a]-e[a])*t/i+e[a];return o}export{b as computeColorAndIntensity,g as computeDirection,h as computeShadowsEnabled,d as settings};
