/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const t=[0,0,0],n=[0,0,0];function r(r,l){const{data:P,strideIdx:x}=r,j=P.length/x;if(j<=0)return;const I=new z(r);p(t,I.minProj,I.maxProj),k(t,t,.5),B(n,I.maxProj,I.minProj);const b=O(n),V=new G;V.quality=b,j<14&&(r={data:new Float64Array(I.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});const q=[0,0,0],w=[0,0,0],A=[0,0,0],T=[0,0,0],g=[0,0,0],Y=[0,0,0],_=[0,0,0];switch(function(t,n,r,i,o,e,s,a,c,f){if(function(t,n,r){let i=K(t.maxVert[0],t.minVert[0]),o=0;for(let n=1;n<7;++n){const r=K(t.maxVert[n],t.minVert[n]);r>i&&(i=r,o=n)}C(n,t.minVert[o]),C(r,t.maxVert[o])}(t,i,o),K(i,o)<1e-6)return 1;B(s,i,o),H(s,s);if(function(t,n,r,i){const{data:o,offsetIdx:e,strideIdx:s}=t;let a=Number.NEGATIVE_INFINITY,c=0;for(let t=e;t<o.length;t+=s){u[0]=o[t]-n[0],u[1]=o[t+1]-n[1],u[2]=o[t+2]-n[2];const i=r[0]*u[0]+r[1]*u[1]+r[2]*u[2],e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=u[0]*u[0]+u[1]*u[1]+u[2]*u[2]-i*i/e;s>a&&(a=s,c=t)}return C(i,o,c),a}(n,i,s,e)<1e-6)return 2;return B(a,o,e),H(a,a),B(c,e,i),H(c,c),D(r,a,s),H(r,r),d(n,r,s,a,c,f),0}(I,r,_,q,w,A,T,g,Y,V)){case 1:return void y(t,n,l);case 2:return void E(r,T,l)}!function(t,n,r,u,l,P,x,j,I){(function(t,n,r,i,o){!function(t,n,r,i,o){const{data:e,offsetIdx:s,strideIdx:a}=t;C(i,e,s),C(o,i),r[0]=L(N,n),r[1]=r[0];for(let t=s+a;t<e.length;t+=a){const s=e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2];s<r[0]&&(r[0]=s,C(i,e,t)),s>r[1]&&(r[1]=s,C(o,e,t))}}(t,n,m,o,i);const e=L(r,n);m[1]-1e-6<=e&&(i[0]=void 0);m[0]+1e-6>=e&&(o[0]=void 0)})(t,n,r,i,o),void 0!==i[0]&&(B(e,i,r),H(e,e),B(s,i,u),H(s,s),B(a,i,l),H(a,a),D(c,s,P),H(c,c),D(f,a,x),H(f,f),D(h,e,j),H(h,h),d(t,c,P,s,e,I),d(t,f,x,a,s,I),d(t,h,j,e,a,I));void 0!==o[0]&&(B(e,o,r),H(e,e),B(s,o,u),H(s,s),B(a,o,l),H(a,a),D(c,s,P),H(c,c),D(f,a,x),H(f,f),D(h,e,j),H(h,h),d(t,c,P,s,e,I),d(t,f,x,a,s,I),d(t,h,j,e,a,I))}(r,_,q,w,A,T,g,Y,V),v(r,V.b0,V.b1,V.b2,M,F);const J=[0,0,0];B(J,F,M),V.quality=O(J),V.quality<b?S(V.b0,V.b1,V.b2,M,F,J,l):y(t,n,l)}const i=[0,0,0],o=[0,0,0],e=[0,0,0],s=[0,0,0],a=[0,0,0],c=[0,0,0],f=[0,0,0],h=[0,0,0];const u=[0,0,0];const m=[0,0];const l=[0,0,0],P=[0,0,0],x=[0,0,0],j=[0,0,0],I=[0,0,0],b=[0,0,0];function d(t,n,r,i,o,e){if(J(n)<1e-6)return;D(l,r,n),D(P,i,n),D(x,o,n),V(t,n,m),I[1]=m[0],j[1]=m[1],b[1]=j[1]-I[1];const s=[r,i,o],a=[l,P,x];for(let r=0;r<3;++r){V(t,s[r],m),I[0]=m[0],j[0]=m[1],V(t,a[r],m),I[2]=m[0],j[2]=m[1],b[0]=j[0]-I[0],b[2]=j[2]-I[2];const i=O(b);i<e.quality&&(C(e.b0,s[r]),C(e.b1,n),C(e.b2,a[r]),e.quality=i)}}const N=[0,0,0];function V(t,n,r){const{data:i,offsetIdx:o,strideIdx:e}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let t=o;t<i.length;t+=e){const o=i[t]*n[0]+i[t+1]*n[1]+i[t+2]*n[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function y(t,n,r){C(r.center,t),k(r.halfSize,n,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const q=[0,0,0],w=[0,0,0],A=[0,0,0],M=[0,0,0],F=[0,0,0],T=[0,0,0];function E(t,n,r){C(q,n),Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?q[0]=0:Math.abs(n[1])>Math.abs(n[2])?q[1]=0:q[2]=0,J(q)<1e-6&&(q[0]=q[1]=q[2]=1),D(w,n,q),H(w,w),D(A,n,w),H(A,A),v(t,n,w,A,M,F),B(T,F,M),S(n,w,A,M,F,T,r)}function v(t,n,r,i,o,e){V(t,n,m),o[0]=m[0],e[0]=m[1],V(t,r,m),o[1]=m[0],e[1]=m[1],V(t,i,m),o[2]=m[0],e[2]=m[1]}const g=[0,0,0],Y=[1,0,0,0,1,0,0,0,1],_=[0,0,0];function S(t,n,r,i,o,e,s){Y[0]=t[0],Y[1]=t[1],Y[2]=t[2],Y[3]=n[0],Y[4]=n[1],Y[5]=n[2],Y[6]=r[0],Y[7]=r[1],Y[8]=r[2],function(t,n){const r=n[0]+n[4]+n[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(n[5]-n[7])*i,t[1]=(n[6]-n[2])*i,t[2]=(n[1]-n[3])*i}else{let r=0;n[4]>n[0]&&(r=1),n[8]>n[3*r+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;let e=Math.sqrt(n[3*r+r]-n[3*i+i]-n[3*o+o]+1);t[r]=.5*e,e=.5/e,t[3]=(n[3*i+o]-n[3*o+i])*e,t[i]=(n[3*i+r]+n[3*r+i])*e,t[o]=(n[3*o+r]+n[3*r+o])*e}}(s.quaternion,Y),p(_,i,o),k(_,_,.5),k(s.center,t,_[0]),k(g,n,_[1]),p(s.center,s.center,g),k(g,r,_[2]),p(s.center,s.center,g),k(s.halfSize,e,.5)}class z{constructor(t){this.minVert=new Array(7),this.maxVert=new Array(7);this.buffer=new ArrayBuffer(448);let n=0;this.minProj=new Float64Array(this.buffer,n,7),n+=56,this.maxProj=new Float64Array(this.buffer,n,7),n+=56;for(let t=0;t<7;++t)this.minVert[t]=new Float64Array(this.buffer,n,3),n+=24;for(let t=0;t<7;++t)this.maxVert[t]=new Float64Array(this.buffer,n,3),n+=24;for(let t=0;t<7;++t)this.minProj[t]=Number.POSITIVE_INFINITY,this.maxProj[t]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:o,offsetIdx:e,strideIdx:s}=t;for(let t=e;t<o.length;t+=s){let n=o[t];n<this.minProj[0]&&(this.minProj[0]=n,r[0]=t),n>this.maxProj[0]&&(this.maxProj[0]=n,i[0]=t),n=o[t+1],n<this.minProj[1]&&(this.minProj[1]=n,r[1]=t),n>this.maxProj[1]&&(this.maxProj[1]=n,i[1]=t),n=o[t+2],n<this.minProj[2]&&(this.minProj[2]=n,r[2]=t),n>this.maxProj[2]&&(this.maxProj[2]=n,i[2]=t),n=o[t]+o[t+1]+o[t+2],n<this.minProj[3]&&(this.minProj[3]=n,r[3]=t),n>this.maxProj[3]&&(this.maxProj[3]=n,i[3]=t),n=o[t]+o[t+1]-o[t+2],n<this.minProj[4]&&(this.minProj[4]=n,r[4]=t),n>this.maxProj[4]&&(this.maxProj[4]=n,i[4]=t),n=o[t]-o[t+1]+o[t+2],n<this.minProj[5]&&(this.minProj[5]=n,r[5]=t),n>this.maxProj[5]&&(this.maxProj[5]=n,i[5]=t),n=o[t]-o[t+1]-o[t+2],n<this.minProj[6]&&(this.minProj[6]=n,r[6]=t),n>this.maxProj[6]&&(this.maxProj[6]=n,i[6]=t)}for(let t=0;t<7;++t){let n=r[t];C(this.minVert[t],o,n),n=i[t],C(this.maxVert[t],o,n)}}}class G{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function O(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function p(t,n,r){t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2]}function B(t,n,r){t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2]}function k(t,n,r){t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r}function C(t,n,r=0){t[0]=n[r+0],t[1]=n[r+1],t[2]=n[r+2]}function D(t,n,r){const i=n[0],o=n[1],e=n[2],s=r[0],a=r[1],c=r[2];t[0]=o*c-e*a,t[1]=e*s-i*c,t[2]=i*a-o*s}function H(t,n){const r=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(r>0){const i=1/Math.sqrt(r);t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i}}function J(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function K(t,n){const r=n[0]-t[0],i=n[1]-t[1],o=n[2]-t[2];return r*r+i*i+o*o}function L(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}export{r as computeOBB};
