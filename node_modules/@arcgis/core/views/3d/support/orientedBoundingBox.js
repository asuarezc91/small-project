/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{a as t,b as a,c as e}from"../../../chunks/vec3f64.js";import{g as n,f as r,q as s,r as i,s as o,t as f,b as c}from"../../../chunks/vec3.js";import{a as h}from"../../../chunks/mat3f64.js";import{a as u}from"../../../chunks/quatf64.js";import{a as l}from"../../../chunks/vec4f64.js";import{g as m,c as z}from"../../../chunks/mat3.js";import{t as S}from"../../../chunks/vec4.js";import{a as b,c as p}from"../../../chunks/quat.js";import{create as M}from"../../../geometry/support/aaBoundingBox.js";import{b as q,a as j}from"../../../chunks/vec3f32.js";import{plane as k}from"./geometryUtils.js";import{c as g,a as d}from"../../../chunks/quatf32.js";import{computeOBB as v}from"./dito.js";const x=u(),y=e(),w=e(),A=l(),B=h();class D{constructor(a){const e=56*a;this.buffer=new ArrayBuffer(e),this.obbs=new Array(a);for(let e=0;e<a;e++)this.obbs[e]={center:t(this.buffer,56*e+0),halfSize:q(this.buffer,56*e+24),quaternion:g(this.buffer,56*e+36)}}}function I(t=[0,0,0],e=[-1,-1,-1],n=[0,0,0,1]){return{center:a(t),halfSize:j(e),quaternion:d(n)}}function U(t){return I(t.center,t.halfSize,t.quaternion)}function C(t,a){n(a.center,t.center),n(a.halfSize,t.halfSize),b(a.quaternion,t.quaternion)}function E(t,a){return a=a||I(),v(t,a),a}function F(t,a){const e=k.signedDistance(a,t.center),n=Q(t,k.normal(a));return e>n?1:e<-n?-1:0}function G(t,a){a||(a=M());const e=m(B,t.quaternion),n=t.halfSize[0]*Math.abs(e[0])+t.halfSize[1]*Math.abs(e[3])+t.halfSize[2]*Math.abs(e[6]),r=t.halfSize[0]*Math.abs(e[1])+t.halfSize[1]*Math.abs(e[4])+t.halfSize[2]*Math.abs(e[7]),s=t.halfSize[0]*Math.abs(e[2])+t.halfSize[1]*Math.abs(e[5])+t.halfSize[2]*Math.abs(e[8]);return a[0]=t.center[0]-n,a[1]=t.center[1]-r,a[2]=t.center[2]-s,a[3]=t.center[0]+n,a[4]=t.center[1]+r,a[5]=t.center[2]+s,a}function H(t,a){return k.signedDistance(a,t.center)-Q(t,k.normal(a))}function J(t,a){return k.signedDistance(a,t.center)+Q(t,k.normal(a))}function K(t,a){return F(t,a.planes[0])<=0&&F(t,a.planes[1])<=0&&F(t,a.planes[2])<=0&&F(t,a.planes[3])<=0&&F(t,a.planes[4])<=0&&F(t,a.planes[5])<=0}function L(t,a,e,n=0){p(x,t.quaternion),r(y,a,t.center);const i=s(y,y,x),o=s(w,e,x);let f=-1/0,c=1/0;for(let a=0;a<3;a++)if(Math.abs(o[a])>1e-6){const e=(n+t.halfSize[a]-i[a])/o[a],r=(-n-t.halfSize[a]-i[a])/o[a];f=Math.max(f,Math.min(e,r)),c=Math.min(c,Math.max(e,r))}else if(i[a]>t.halfSize[a]+n||i[a]<-t.halfSize[a]-n)return!1;return f<=c}function N(t,a,e,n,r){p(x,t.quaternion),i(y,a,t.center),s(y,y,x);const h=y[0]<-t.halfSize[0]?-1:y[0]>t.halfSize[0]?1:0,u=y[1]<-t.halfSize[1]?-1:y[1]>t.halfSize[1]?1:0,l=y[2]<-t.halfSize[2]?-1:y[2]>t.halfSize[2]?1:0,b=Math.abs(h)+Math.abs(u)+Math.abs(l);if(0===b)return 1/0;const M=1===b?4:6,q=6*(h+3*u+9*l+13);m(B,t.quaternion),z(B,B,t.halfSize);for(let a=0;a<M;a++){const n=P[q+a];o(y,((1&n)<<1)-1,(2&n)-1,((4&n)>>1)-1),f(y,y,B),c(A,t.center,y),A[3]=1,S(A,A,e);const r=1/Math.max(1e-6,A[3]);O[2*a]=A[0]*r,O[2*a+1]=A[1]*r}const j=2*M-2;let k=O[0]*(O[3]-O[j+1])+O[j]*(O[1]-O[j-1]);for(let t=2;t<j;t+=2)k+=O[t]*(O[t+3]-O[t-1]);return Math.abs(k)*n*r*.125}const O=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],P=(()=>{const t=new Int8Array(162);let a=0;const e=e=>{for(let n=0;n<e.length;n++)t[a+n]=e[n];a+=6};return e([6,2,3,1,5,4]),e([0,2,3,1,5,4]),e([0,2,3,7,5,4]),e([0,1,3,2,6,4]),e([0,1,3,2,0,0]),e([0,1,5,7,3,2]),e([0,1,3,7,6,4]),e([0,1,3,7,6,2]),e([0,1,5,7,6,2]),e([0,1,5,4,6,2]),e([0,1,5,4,0,0]),e([0,1,3,7,5,4]),e([0,2,6,4,0,0]),e([0,0,0,0,0,0]),e([1,3,7,5,0,0]),e([2,3,7,6,4,0]),e([2,3,7,6,0,0]),e([2,3,1,5,7,6]),e([0,1,5,7,6,2]),e([0,1,5,7,6,4]),e([0,1,3,7,6,4]),e([4,5,7,6,2,0]),e([4,5,7,6,0,0]),e([4,5,1,3,7,6]),e([0,2,3,7,5,4]),e([6,2,3,7,5,4]),e([6,2,3,1,5,4]),t})();function Q(t,a){p(x,t.quaternion),s(y,a,x);const e=t.halfSize;return Math.abs(y[0]*e[0])+Math.abs(y[1]*e[1])+Math.abs(y[2]*e[2])}function R(t,a){for(let e=0;e<8;++e){const n=a[e];n[0]=1&e?-t.halfSize[0]:t.halfSize[0],n[1]=2&e?-t.halfSize[1]:t.halfSize[1],n[2]=4&e?-t.halfSize[2]:t.halfSize[2],s(n,n,t.quaternion),c(n,n,t.center)}}export{D as ObbArray,U as clone,E as compute,R as corners,I as create,L as intersectLine,F as intersectPlane,K as isVisible,J as maximumDistancePlane,H as minimumDistancePlane,N as projectedArea,Q as projectedRadius,C as set,G as toAaBoundingBox};
