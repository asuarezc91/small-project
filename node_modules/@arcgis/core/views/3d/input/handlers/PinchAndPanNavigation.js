/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{InputHandler as t}from"../../../input/InputHandler.js";import{eventMatchesMousePointerAction as e}from"../../../input/handlers/support.js";import{PinchAndPanController as s}from"../../state/controllers/global/PinchAndPanController.js";import{PinchAndPanController as r}from"../../state/controllers/local/PinchAndPanController.js";class i extends t{constructor(t,e,s){super(!0),this.view=t,this.pointerAction=e,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",s,(t=>this.handleDrag(t)))}handleDrag(t){if("mouse"===t.data.pointerType&&!e(t.data,this.pointerAction))return;const s=t.timestamp-this.lastEndTimestamp,r=this.momentum&&this.momentum.active&&s<40;switch(t.data.action){case"start":case"update":if(r)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this.startController(t);break;case"end":case"removed":this.endController(t,!0);break;case"added":this.endController(t,!1),this.startController(t)}t.stopPropagation()}endController(t,e){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const s=this.controller.end(t.data);e&&s&&(this.momentum=s,this.view.state.switchCameraController(this.momentum))}this.controller=null}startController(t){this.controller=this.createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}createController(){return this.view.state.isGlobal?new s({view:this.view}):new r({view:this.view})}}export{i as PinchAndPanNavigation};
