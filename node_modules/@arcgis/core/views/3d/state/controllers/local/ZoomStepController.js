/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import"../../../../../core/has.js";import"../../../../../core/Logger.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/accessorSupport/decorators/property.js";import{subclass as e}from"../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../core/urlUtils.js";import"../../../../../core/uuid.js";import"../../../../../portal/support/resourceExtension.js";import{c as i}from"../../../../../chunks/vec3f64.js";import{g as o,f as r,l as s,n as a,b as n,a as m,e as c}from"../../../../../chunks/vec3.js";import{disableContextNavigation as p}from"../../../../../support/featureFlags.js";import{Intersector as h}from"../../../webgl-engine/lib/Intersector.js";import{outExpo as l}from"../../../../animation/easing.js";import{applyAll as u}from"../../../camera/constraintUtils.js";import C from"../../../webgl-engine/lib/Camera.js";import{PointToPointAnimationController as g}from"../PointToPointAnimationController.js";let y=class extends g{constructor(){super(...arguments),this.zoomLocation=i(),this.tmpCamera=new C,this.tmpRayDir=i(),this.tmpCenter=i(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new C,interactionDirection:null,tiltMode:0}}zoomStep(t,e){if(!this.active)return;const c=this.view.state,{interactionStartCamera:l}=this.constraintOptions;this.animation.finished?l.copyFrom(c.camera):this.animation.cameraAt(1,l),this.tmpCamera.copyFrom(c.camera);const u=new h(this.view.state.mode);t>0?(this.intersectionHelper.intersectScreenFreePointFallback(e,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,u,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,u,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:o(this.zoomLocation,this.tmpCamera.center);const C=Math.pow(.6,t);if(!p()&&this.view._stage.getCamera()._contextNavigation){let t=this.view._stage.renderView.getMinimalDepthForArea(e[0],e[1],this.view._stage.getCamera(),60);const o=Math.max(14*Math.abs(this.view.camera.position.z),20);if(t=t?Math.min(t,o):o,t){const e=i();r(e,this.zoomLocation,this.tmpCamera.eye),t<s(e)&&(a(e,e),n(this.zoomLocation,this.tmpCamera.eye,m(e,e,t)))}}this.updateCamera(this.tmpCamera,C,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:.6,easing:l}}updateCamera(t,e,i){r(this.tmpRayDir,i,t.eye);const o=s(this.tmpRayDir);let a=o*e;e<=1&&a<4&&(a=4,e=a/o),Math.abs(o-a)<1e-6||(m(this.tmpRayDir,this.tmpRayDir,e),r(t.eye,i,this.tmpRayDir),c(t.center,t.center,i,1-e),u(this.view,t,this.constraintOptions))}};y=t([e("esri.views.3d.state.controllers.local.ZoomStepController")],y);export{y as ZoomStepController};
