/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import"../../../../../core/has.js";import"../../../../../core/Logger.js";import"../../../../../core/accessorSupport/ensureType.js";import{property as i}from"../../../../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../core/urlUtils.js";import"../../../../../core/uuid.js";import"../../../../../portal/support/resourceExtension.js";import{sign as e}from"../../../../../core/mathUtils.js";import{createScreenPointArray as s}from"../../../../../core/screenUtils.js";import{c as n}from"../../../../../chunks/vec3f64.js";import{f as a,n as o,a as m,b as c,p as h,g as p,l,e as u}from"../../../../../chunks/vec3.js";import{a as C}from"../../../../../chunks/vec2f64.js";import{c as g}from"../../../../../chunks/vec2.js";import{plane as P}from"../../../support/geometryUtils.js";import{pixelDistanceToInteractionFactor as D,applyAll as f}from"../../../camera/constraintUtils.js";import{normalizeCoordinate as v,intersectPlaneFromScreenPoint as y}from"../../utils/navigationUtils.js";import{InteractiveController as d}from"../InteractiveController.js";let j=class extends d{constructor(t){super(t),this.view=null,this.tmpP=n(),this.tmpDir=n(),this.tmpN=n(),this.tmpP0=C(),this.tmpPoi=n(),this.tmpRayDir=n(),this.dragBeginPoint=s(),this.normalizedAnchorPoint=C(),this.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:n(),tiltMode:0},this.plane=P.create()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;let i;g(this.dragBeginPoint,t),v(this.beginCamera,t,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(t,this.tmpP),a(this.tmpDir,this.tmpP,this.beginCamera.eye),o(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let r=30*i;const e=this.view._stage.renderView.getMinimalDepthForArea(t[0],t[1],this.view._stage.getCamera(),70);r=r>e?e:r,m(this.tmpDir,this.tmpDir,r),c(this.tmpP,this.beginCamera.eye,this.tmpDir),a(this.tmpN,this.beginCamera.eye,this.beginCamera.center),o(this.tmpN,this.tmpN),this.tmpN[1]<0&&h(this.tmpN,this.tmpN),P.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.beginCamera}update(t){if(!this.active)return;y(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||p(this.tmpPoi,this.currentCamera.center),v(this.currentCamera,t,this.tmpP0);let i=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);g(this.normalizedAnchorPoint,this.tmpP0),a(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const r=l(this.tmpRayDir);let s=r*(1-i);p(this.constraintOptions.interactionDirection,this.tmpRayDir),m(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,e(i)/r);const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(m(this.tmpRayDir,this.tmpRayDir,i),c(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),u(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,i),this.tmpPoi[2]>this.beginCamera.center[2]?this.currentCamera.center[2]=Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):this.currentCamera.center[2]=Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=D(this.dragBeginPoint,t),f(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};t([i({constructOnly:!0})],j.prototype,"view",void 0),j=t([r("esri.views.3d.state.controllers.local.ZoomController")],j);export{j as ZoomController};
