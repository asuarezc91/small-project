/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isNone as e}from"../../../../core/maybe.js";import{deg2rad as t,sign as n,clamp as r,acosClamped as a}from"../../../../core/mathUtils.js";import{createScreenPointArray as o}from"../../../../core/screenUtils.js";import{c as i}from"../../../../chunks/vec3f64.js";import{g as s,d as c,a as u,f as m,n as l,c as f,i as p,b as h,l as y,e as M,s as d,h as g}from"../../../../chunks/vec3.js";import{cyclicalPI as b}from"../../support/mathUtils.js";import{i as w,r as v,m as P}from"../../../../chunks/mat4.js";import{a as k}from"../../../../chunks/mat4f64.js";import{a as x}from"../../../../chunks/vec2f64.js";import{s as z}from"../../../../chunks/vec2.js";import{sv3d as j,sm4d as I}from"../../support/stack.js";import{a as A}from"../../../../chunks/vector.js";import{axisAngle as S,plane as V,ray as E,sphere as R}from"../../support/geometryUtils.js";import D from"../../webgl-engine/lib/Camera.js";import{coordinateSystemFromOneAxisAndNormalVector as H,vectorCoordinates as U}from"../../support/geometryUtils/coordinateSystem.js";function G(e,t,n){return n[0]=t[0]/(e.fullWidth/e.pixelRatio),n[1]=t[1]/(e.fullHeight/e.pixelRatio),n}function q(e,t,n){const r=j.get(),a=j.get(),o=j.get();s(a,e),s(o,t);const i=c(a,n),p=c(o,n);u(r,n,i),m(a,a,r),l(a,a),u(r,n,p),m(o,o,r),l(o,o);const h=c(a,o);f(r,n,a);const y=c(o,r);return Math.atan2(y,h)}function F(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function C(e,t,n){const r=I.get();w(r),v(r,r,n[3],S.axis(n)),m(e.eye,e.eye,t),p(e.eye,e.eye,r),h(e.eye,e.eye,t),m(e.center,e.center,t),p(e.center,e.center,r),h(e.center,e.center,t),p(e.up,e.up,r),e.markViewDirty()}function O(e,t,n,r){return V.intersectRay(e,E.fromScreen(t,n,qe),r)}function T(e,t,n,r){const a=j.get();let o=1-n;m(a,t,e.eye);const i=y(a);let s=i*(1-o);o>=0&&s<r&&(s=r,o=-(s-i)/i),Math.abs(i-s)<1e-6||(u(a,a,o),h(e.eye,e.eye,a),M(e.center,e.center,t,o))}function N(e,t,n){t.getScreenCenter(W),R.intersectScreen(e,t,W,t.center),t.markViewDirty();const r=t.distance,a=r*n;if(Math.abs(r-a)<1e-6)return;const o=u(j.get(),t.viewForward,a);m(t.eye,t.center,o),t.markViewDirty()}const W=o();function B(e,t,n){J(t,n),l(n,n),u(n,n,e)}function J(e,t){d(t,0,0,0);for(const n of e)h(t,t,n);u(t,t,1/e.length)}function K(e,t,n,r){return Math.sin(e/y(t))*(n+r.radius)}function L(e,t,n,r){return K(Math.PI/2,t,n,r)+(e-Math.PI/2)}var Q;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(Q||(Q={}));const X={Elevation:3e4,Angle:t(6)},Y={Pole:.95,Angle:t(18),Tilt:45},Z=t(80);function $(e,t,n,r,a){const o=i(),s=R.create();let c=!0,u=!0;return e.intersectScreen(n,o)?s.radius=y(o):(u=!1,t.aboveGround?s.radius=Math.max(y(t.center),.9*a.radius):s.radius=y(t.eye)-t.relativeElevation,r?ne(s,t,n,o):c=R.intersectScreen(s,t,n,o)),{sphere:s,scenePickPoint:c?o:null,hasGeometryIntersection:u}}function _(e,t,r,a){if(y(e.eye)-a.radius>X.Elevation)return Q.Horizontal;if(!r)return Q.Vertical;E.fromScreenAtEye(e,t,Fe);return-n(e.relativeElevation)*(.5*Math.PI+A(e.eye,Fe.direction))<X.Angle?Q.Vertical:Q.Horizontal}function ee(e,t,n){m(te,n,t),m(e.eye,e.eye,te),m(e.center,e.center,te),e.markViewDirty()}const te=i();function ne(t,n,r,a){const o=E.fromScreenAtEye(n,r,qe);return!e(o)&&(R.closestPointOnSilhouette(t,o,re),R.intersectRay(t,o,a)?!(g(re,o.origin)<g(a,o.origin))||(s(a,re),!1):(m(ae,n.eye,n.center),l(ae,ae),V.fromNormalAndOffset(ae,-c(l(ae,ae),re),oe),V.intersectRay(oe,o,a),!1))}const re=i(),ae=i(),oe=V.create();function ie(e,n,o,i,s,p){let h;if(f(Ue,e,n),m(De,e,n),y(e)<=s||!i.aboveGround){f(o,De,i.eye);const u=c(e,n)/(y(e)*y(n)),m=Math.cos(r(b.normalize(t(p)),0,Z));h=-a(u)-Math.max(0,y(n)-s)/(m*s)}else m(se,i.eye,i.center),f(o,De,se),h=-y(De)/s;return l(o,o),u(o,o,y(Ue)),h}const se=i();function ce(e,n,o,i){let s,c;const u=Math.cos(r(b.normalize(t(i)),0,Z));return s=n>o?-(n-o)/(u*o):n<-o?Math.PI-(n+o)/(u*o):a(n/o),c=e>o?-(e-o)/(u*o):e<-o?Math.PI-(e+o)/(u*o):a(e/o),(c-s)*o}function ue(e,t,n,r,a,o,i,s,u,m){const f=ce(e[2],t[2],i.radius,u),p=m?ce(e[0],t[0],i.radius,180):t[0]-e[0],h=Math.sin(s)*p-Math.cos(s)*f,y=Math.cos(s)*p+Math.sin(s)*f;l(Re,a);const M=m?h/Math.sqrt(Math.abs(Math.pow(i.radius,2)-Math.pow(c(n,Re),2))):h/i.radius,d=y/Math.sqrt(Math.abs(Math.pow(i.radius,2)-Math.pow(c(n,r),2)));z(o,M,d)}function me(e,t,n,r,a,o,i,c,m,p){f(Ue,e,t),H(o.up,o.eye,ve,Pe,ke),H([0,0,1],o.eye,ge,be,we),s(n,be),s(r,ge),l(n,n),u(n,n,y(Ue)),U(e,l(Pe,Pe),l(ke,ke),l(ve,ve),xe),U(t,Pe,ke,ve,ze),ue(xe,ze,e,ge,be,a,i,c,m,p)}function le(e,t,n,r,a,o,i){w(Ae),w(Se),w(Ve),v(Ae,Ae,a,r),v(Se,Se,i,o),P(Ve,Ae,Se),m(t,e,n),p(t,t,Ve),h(t,t,n)}function fe(e,t,n,r,a,o){w(Ae),w(Se),w(Ve),v(Ae,Ae,r,n),v(Se,Se,o,a),P(Ve,Ae,Se),m(e.eye,e.eye,t),p(e.eye,e.eye,Ve),h(e.eye,e.eye,t),m(e.center,e.center,t),p(e.center,e.center,Ve),h(e.center,e.center,t),m(e.up,e.up,t),p(e.up,e.up,Ve),h(e.up,e.up,t),e.markViewDirty()}function pe(e,t,n,r,a,o,i=Y.Pole,s=Y.Angle){const c=Math.abs(r)>Math.PI-s||Math.abs(r)<s,u=Math.abs(e[2])<n*i||Math.abs(t)>n;return!!(c&&u&&o.aboveGround&&a<Y.Tilt)}function he(e,t,n,r,a,o){if(o)S.fromPoints(n,r,Ie),C(t,e.center,Ie);else{const o=ie(n,r,Ge,t,e.radius,a);C(t,e.center,S.wrapAxisAngle(Ge,o))}}function ye(e,t,n,r,a,o,i){const c=i?20:1;let u,m;s(Ee,r),He.copyFrom(t);for(let r=0;r<c&&g(n,Ee)>1e-12&&(u=g(n,Ee),me(n,Ee,be,ge,je,He,e,a,o,i),fe(He,e.center,ge,je[1],be,je[0]),le(Ee,Ee,e.center,ge,je[1],be,je[0]),m=g(n,Ee),m<u||0===r);r++)t.copyFrom(He)}function Me(e,n,r,a,o,i,s){pe(r,c(n.up,r),e.radius,-b.normalize(t(o)),i,n,Y.Pole,Y.Angle)?ye(e,n,r,a,-b.normalize(t(o)),i,s):he(e,n,r,a,i,s)}function de(e,n,r,a,o,i,s,u,m){pe(e.center,c(e.up,e.center),y(e.center),-b.normalize(t(i)),s,n)?function(e,t,n,r,a,o){const{eye:i}=e;H([0,0,1],i,ge,be,we);const s=t.translation[0]*n.pan,u=t.translation[1]*n.pan,m=Math.max(Math.sqrt(Math.abs(1-Math.pow(c(e.center,ge),2)/Math.pow(y(e.center),2))),.5),l=(Math.sin(o)*u+Math.cos(o)*s)/m,f=-Math.cos(o)*u+Math.sin(o)*s;switch(v(r.pan.matrix,r.pan.matrix,l,ge),r.pan.enabled=!0,a.mode){case"pan":v(r.pan.matrix,r.pan.matrix,f,be),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*n.zoom}}(n,r,a,u,m,-b.normalize(t(o))):function(e,t,n,r,a){const{eye:o,viewRight:i}=e,s=f(j.get(),i,o),c=t.translation[0]*n.pan;switch(0!==c&&(v(r.pan.matrix,r.pan.matrix,-c,s),r.pan.enabled=!0),a.mode){case"pan":{const e=t.translation[1]*n.pan;0!==e&&(v(r.pan.matrix,r.pan.matrix,e,i),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*n.zoom}}(n,r,a,u,m)}const ge=i(),be=i(),we=i(),ve=i(),Pe=i(),ke=i(),xe=i(),ze=i(),je=x(),Ie=S.create(),Ae=k(),Se=k(),Ve=k(),Ee=i(),Re=i(),De=i(),He=new D,Ue=i(),Ge=i(),qe={origin:i(),direction:i()},Fe={origin:i(),direction:i()};export{Q as NavigationMode,Y as PreservingHeadingThreshold,Z as TiltThresholdPanningSpeed,X as VerticalPanTresholds,ee as applyPanPlanar,he as applyPanSphericalDirectRotation,ye as applyPanSphericalPreserveHeading,C as applyRotation,fe as applyRotationWithTwoAxes,N as applyZoomOnSphere,T as applyZoomToPoint,J as centroid,B as centroidOnSphere,_ as decideNavigationMode,O as intersectPlaneFromScreenPoint,ce as lengthFromPoints,G as normalizeCoordinate,F as normalizeRotationDelta,L as offSurfaceTiltToEyeTiltGlobal,K as onSurfaceTiltToEyeTiltGlobal,de as panMotionToRotationMatrix,Me as panToPosition,$ as pickPointAndInitSphere,pe as preserveHeadingThreshold,le as rotatePointAroundTwoAxes,ie as rotationAngleAndAxisDirectRotation,me as rotationAnglesAndAxesHeadingPreserving,ue as rotationAnglesHeadingPreserving,q as rotationFromPointsAroundAxis,ne as sphereOrPlanePointFromScreenPoint};
