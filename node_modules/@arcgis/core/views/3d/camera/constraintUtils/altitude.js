/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{clamp as t,sign as e}from"../../../../core/mathUtils.js";import{c as r}from"../../../../chunks/vec3f64.js";import{g as n,a as i}from"../../../../chunks/vec3.js";import{ray as o}from"../../support/geometryUtils.js";import{defaultApplyOptions as s,interactionDirectionTowardsConstraintMinimization as c,hasConstraintType as a,adjustRangeForInteraction as m}from"./common.js";import{closestPointOnRay as u}from"../../support/intersectionUtils.js";function f(t,r,a=s){const m=p(t,r,a);if(0===m)return!1;const f=t.renderCoordsHelper,l=f.getAltitude(r.eye)+m,j=c(r,a.interactionDirection,function(t,e,r,n){return t.renderCoordsHelper.worldUpAtPosition(e.eye,n),i(n,n,r),n}(t,r,e(m),y),d),g=n(x,r.viewForward);return f.intersectInfiniteManifold(o.wrap(r.eye,j),l,r.eye)||f.setAltitude(l,r.eye),u(r.eye,g,r.center,r.center),r.markViewDirty(),!0}function p(e,r,n=s){if(!function(t,e){const r=t.state.constraints.altitude;if(!t.state.isGlobal||!r)return!1;if(2===e.interactionType&&a(e.selection,1))return!1;return!0}(e,n))return 0;const i=function(t,e){return e.min=t.min,e.max=t.max,e}(e.state.constraints.altitude,l);!function(t,e,r){const n=e.interactionType;if(0===n)return;const{min:i,max:o}=r,{interactionStartCamera:s,interactionFactor:c}=e,a=2===n||1===n,u=p(t,s),f=0===u?0:t.renderCoordsHelper.getAltitude(s.eye);r.min=i,r.max=o;m(u,f,a,c,.05*f,r)}(e,n,i);const o=e.renderCoordsHelper.getAltitude(r.eye),c=t(o,i.min,i.max)-o;return Math.abs(c)<=1e-6?0:c}const l={min:0,max:0},d=r(),y=r(),x=r();export{f as applyAltitudeConstraint,p as getAltitudeConstraintError};
