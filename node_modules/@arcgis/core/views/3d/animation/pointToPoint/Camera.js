/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{lerp as t}from"../../../../core/mathUtils.js";import{c as e,b as i,f as s}from"../../../../chunks/vec3f64.js";import{l as a,k as o,e as h,g as r,f as n,t as c,a as p,c as m,d,b as w,n as u}from"../../../../chunks/vec3.js";import{angle as l,slerp as y}from"../../support/mathUtils.js";import{a as M}from"../../../../chunks/mat3f64.js";import{t as A}from"../../../../chunks/mat3.js";const f=e(),P=e(),_=e(),g=e(),k=e(),v=e(),x={upward:s(0,0,1),forward:s(0,1,0),sideway:s(1,0,0)},z=M();export default class{constructor(t=1){this.viewingMode=t,this.center=e(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=i(x.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,e){if(e||(e={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),1===this.viewingMode){const i=(a(this.center)+a(t.center))/2;e.pan=l(this.center,t.center)*i}else e.pan=o(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t.pitch-this.pitch);return e.rotate=Math.max(i,s),e.sourceZoom=this.distance,e.targetZoom=t.distance,e}interpolate(e,i,s){1===this.viewingMode?y(e.center,i.center,s.pan,this.center):h(this.center,e.center,i.center,s.pan),this.distance=t(e.distance,i.distance,s.zoom),this.pitch=t(e.pitch,i.pitch,s.rotate);let a=e.yaw;const o=i.yaw;Math.abs(o-a)>=Math.PI&&(a+=2*(a<o?1:-1)*Math.PI),this.yaw=t(a,o,s.rotate)}copyFrom(t){r(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,r(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const e=this._lookAtOrientation(t.center,z);r(this.center,t.center),n(g,t.center,t.eye),c(g,g,e),c(k,t.up,e),this.distance=a(g),g[0]/=this.distance,g[1]/=this.distance,g[2]/=this.distance,this.pitch=this._eyeUpToPitch(g),this.yaw=this._eyeUpToYaw(g,k),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const e=this._lookAtOrientation(this.center,z);A(e,e),this._axisAngleVec3(x.sideway,this.pitch-Math.PI/2,x.forward,g),this._axisAngleVec3(x.upward,this.yaw,g),this._axisAngleVec3(x.sideway,this.pitch-Math.PI/2,x.upward,k),this._axisAngleVec3(x.upward,this.yaw,k),p(g,g,this.distance),c(g,g,e),c(k,k,e),t.center=this.center,t.eye=n(g,this.center,g),t.up=k}_axisAngleVec3(t,e,i,s=i){const a=Math.cos(e),o=Math.sin(e);return p(f,i,a),m(P,t,i),p(P,P,o),p(_,t,(1-a)*d(t,i)),w(s,w(s,f,P),_)}_lookAtOrientation(t,e){return this._upAtLookAt(t,_),m(f,this.lookAtDirection,_),u(f,f),0===f[0]&&0===f[1]&&0===f[2]&&r(f,x.sideway),m(P,_,f),u(P,P),e||(e=M()),e[0]=f[0],e[1]=P[0],e[2]=_[0],e[3]=f[1],e[4]=P[1],e[5]=_[1],e[6]=f[2],e[7]=P[2],e[8]=_[2],e}_upAtLookAt(t,e){return 2===this.viewingMode?r(e,x.upward):u(e,t)}_eyeUpToPitch(t){return Math.PI-l(x.upward,t)}_eyeUpToYaw(t,e){const i=v;return Math.abs(e[2])<.5?(r(i,e),t[2]>0&&p(i,i,-1)):r(i,t),m(P,i,x.upward),u(P,P),l(x.sideway,P,x.upward)}}
