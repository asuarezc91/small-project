/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as i}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as r,parameter as o}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import{Default3D as s}from"../lib/DefaultVertexAttributeLocations.js";import a from"../../../webgl/Program.js";import{makePipelineState as n,defaultDepthWriteParams as l,defaultColorWriteParams as p}from"../../../webgl/renderState.js";import{View as c}from"../core/shaderLibrary/util/View.glsl.js";import{Slice as d}from"../core/shaderLibrary/Slice.glsl.js";import{OutputHighlight as h}from"../core/shaderLibrary/output/OutputHighlight.glsl.js";import{blendingDefault as u,OITBlending as g,OITDepthTest as m,OITDepthWrite as f,getOITPolygonOffset as y}from"../lib/OrderIndependentTransparency.js";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as P,stencilBaseAllZerosParams as v}from"../lib/StencilUtils.js";import{P as S}from"../../../../chunks/Pattern.glsl.js";class T extends i{initializeProgram(e){const t=T.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,style:i.style,patternSpacing:i.patternSpacing,lineWidth:i.lineWidth,draped:i.draped,OITEnabled:0===i.transparencyPassType});return new a(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),s)}bindPass(e,t,i){c.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("matColor",t.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/i.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/i.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/i.camera.perScreenPixelRatio),4===this.configuration.output&&h.bindOutputHighlight(e,this.program,i),1===this.configuration.output&&this.program.setUniform2fv("nearFar",i.camera.nearFar)}bindDraw(e){c.bindView(this.program,e),c.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),d.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,r=3===e,o=2===e;return n({blending:0===i.output||7===i.output?i.transparent&&r?u:g(e):null,culling:(s=i.cullFace,0!==s&&{face:1===s?1028:1029,mode:2305}),depthTest:{func:m(e)},depthWrite:r?i.writeDepth&&l:f(e),colorWrite:p,stencilWrite:i.sceneHasOcludees?b:null,stencilTest:i.sceneHasOcludees?t?P:v:null,polygonOffset:r||o?i.polygonOffset&&j:y(i.enableOffset)});var s}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}T.shader=new t(S,(()=>import("./Pattern.glsl.js")));const j={factor:1,units:1};class x extends r{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.vertexColors=!1,this.transparent=!0,this.polygonOffset=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.enableOffset=!0,this.transparencyPassType=3}}e([o({count:8})],x.prototype,"output",void 0),e([o({count:3})],x.prototype,"cullFace",void 0),e([o()],x.prototype,"slicePlaneEnabled",void 0),e([o()],x.prototype,"sliceHighlightDisabled",void 0),e([o()],x.prototype,"vertexColors",void 0),e([o()],x.prototype,"transparent",void 0),e([o()],x.prototype,"polygonOffset",void 0),e([o()],x.prototype,"writeDepth",void 0),e([o()],x.prototype,"sceneHasOcludees",void 0),e([o({count:6})],x.prototype,"style",void 0),e([o()],x.prototype,"patternSpacing",void 0),e([o()],x.prototype,"lineWidth",void 0),e([o()],x.prototype,"enableOffset",void 0),e([o()],x.prototype,"draped",void 0),e([o({count:4})],x.prototype,"transparencyPassType",void 0);export{T as PatternTechnique,x as PatternTechniqueConfiguration};
