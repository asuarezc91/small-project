/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as i}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as r,parameter as s}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import{Default3D as o}from"../lib/DefaultVertexAttributeLocations.js";import n from"../../../webgl/Program.js";import{makePipelineState as a,defaultDepthWriteParams as l,defaultColorWriteParams as p,simpleBlendingParams as c}from"../../../webgl/renderState.js";import{View as u}from"../core/shaderLibrary/util/View.glsl.js";import{Slice as h}from"../core/shaderLibrary/Slice.glsl.js";import{OITBlending as d,OITDepthTest as g,OITDepthWrite as f,getOITPolygonOffset as m}from"../lib/OrderIndependentTransparency.js";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as y,stencilBaseAllZerosParams as P}from"../lib/StencilUtils.js";import{I as j}from"../../../../chunks/ImageMaterial.glsl.js";class O extends i{initializeProgram(e){const t=O.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType});return new n(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),o)}bindPass(e,t,i){u.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity)}bindDraw(e){u.bindView(this.program,e),h.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,r=3===e,s=2===e;return a({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?T:d(e),culling:(o=i.cullFace,0!==o&&{face:1===o?1028:1029,mode:2305}),depthTest:{func:g(e)},depthWrite:r?i.writeDepth&&l:f(e),colorWrite:p,stencilWrite:i.sceneHasOcludees?b:null,stencilTest:i.sceneHasOcludees?t?y:P:null,polygonOffset:r||s?i.polygonOffset&&S:m(i.enableOffset)});var o}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}O.shader=new t(j,(()=>import("./ImageMaterial.glsl.js")));const S={factor:1,units:1},T=c(1,771);class v extends r{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3}}e([s({count:8})],v.prototype,"output",void 0),e([s({count:3})],v.prototype,"cullFace",void 0),e([s()],v.prototype,"slicePlaneEnabled",void 0),e([s()],v.prototype,"sliceHighlightDisabled",void 0),e([s()],v.prototype,"transparent",void 0),e([s()],v.prototype,"polygonOffset",void 0),e([s()],v.prototype,"enableOffset",void 0),e([s()],v.prototype,"writeDepth",void 0),e([s()],v.prototype,"sceneHasOcludees",void 0),e([s({count:4})],v.prototype,"transparencyPassType",void 0);export{O as ImageMaterialTechnique,v as ImageMaterialTechniqueConfiguration};
