/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../core/maybe.js";import t from"../../../../core/Evented.js";import{nextHighestPowerOfTwo as r}from"../../../../core/mathUtils.js";import i from"../../../webgl/Texture.js";import s from"../../../webgl/capabilities/isWebGL2Context.js";import h from"./Texture.js";import{TextRenderer as d,getTextHelperCanvas as n}from"./TextRenderer.js";const o={canvas:null};export default class{constructor(e,r,i,h){this._idHint=h,this._glTexture=null,this.events=new t,this._requiresPowerOfTwo=!s(e.gl),this._renderer=new d(r,i)}get id(){return null==this._id&&(this._id=h.idGen.gen(this._idHint)),this._id}get width(){return this._renderer.renderedWidth}get height(){return this._renderer.renderedHeight}get textureWidth(){const e=this.width;return this._requiresPowerOfTwo?r(e):e}get textureHeight(){const e=this.height;return this._requiresPowerOfTwo?r(e):e}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}get texcoordScale(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}get requiresFrameUpdates(){return!1}createDescriptor(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}load(t){if(e(this._glTexture))return this._glTexture;const r=n(o,this.textureWidth,this.textureHeight),s=r.getContext("2d");return s.save(),this._renderer.render(s,0,this.textureHeight-this._renderer.renderedHeight),this._glTexture=new i(t,this.createDescriptor(t),r),s.restore(),this._glTexture}unload(){e(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),this.events.emit("unloaded")}}
