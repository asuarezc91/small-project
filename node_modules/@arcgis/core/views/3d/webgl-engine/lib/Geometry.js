/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isNone as t}from"../../../../core/maybe.js";import{computeAttachmentOriginTriangles as n,computeAttachmentOriginPoints as i,generateDefaultIndexArray as e}from"./geometryDataUtils.js";import{VertexAttrConstants as r,assert as o}from"./Util.js";import{IdGen as s}from"./IdGen.js";import a from"./BoundingInfo.js";class u{constructor(t,n){this._boundingInfo=null,this._id=u.__idGen.gen(n),this._data=t}get id(){return this._id}get data(){return this._data}getIndices(t){return this.data.getIndices(t)}get indexCount(){return this.data.indexCount}getAttribute(t){return this.data.getAttribute(t)}get vertexCount(){return this.data.indexCount}get faceCount(){return this.data.indexCount/3}get boundingInfo(){return t(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(t):this.computeAttachmentOriginPoints(t)}computeAttachmentOriginTriangles(t){const i=this.getIndices(r.POSITION),e=this.getAttribute(r.POSITION);return n(e,i,t)}computeAttachmentOriginPoints(t){const n=this.getIndices(r.POSITION),e=this.getAttribute(r.POSITION);return i(e,n,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.data.getIndices(r.POSITION);const n=this.data.getAttribute(r.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===t.length){t=new Uint32Array(i);for(let n=0;n<i;++n)t[n]=n}const s=t.length;o(s%i==0,"Indexing error: "+s.toFixed(0)+" not divisible by "+i.toFixed(0));const u=e(s/i);return new a(u,i,t,n)}}u.__idGen=new s;export default u;
