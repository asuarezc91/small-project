/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import t from"../../../../core/Evented.js";import{b as e,c as i}from"../../../../chunks/vec3f64.js";import{IdGen as r}from"./IdGen.js";import s from"./Octree.js";class a extends t{constructor(t,r,s){super(),this._parentStages=new Map,this._objects=new Set,this.id=a._idGen.gen(t),this.apiLayerUid=s,this.name=t,r=r||{},this.group=r.group||"",this.isVisible=null==r.isVisible||r.isVisible,this.isPickable=null==r.isPickable||r.isPickable,this.isSliceable=!1,this.translation=r.translation?e(r.translation):i()}addParentStage(t){if(!this._parentStages.has(t)){const e=this.on("dirty",(e=>{t.notifyDirty(e.origin,e.dirtyType,e.subObject)}));this._parentStages.set(t,e)}}removeParentStage(t){const e=this._parentStages.get(t);e&&(e.remove(),this._parentStages.delete(t)),this.invalidateSpatialQueryAccelerator()}getName(){return this.name}getGroup(){return this.group}getTranslation(){return this.translation}getObjectIds(){return Array.from(this._objects,(t=>t.id))}getObjects(){return[...this._objects]}addObject(t){this._objects.add(t),t.parentLayer=this,this.notifyDirty("layerObjectAdded",t),this._octree&&this._octree.add(t)}hasObject(t){return this._objects.has(t)}removeObject(t){return!!this._objects.delete(t)&&(t.parentLayer=null,this.notifyDirty("layerObjectRemoved",t),this._octree&&this._octree.remove(t),!0)}notifyObjectBBChanged(t,e){this._octree&&this._octree.update(t,e)}getSpatialQueryAccelerator(){return!this._octree&&this._objects.size>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.notifyDirty("shaderTransformationChanged",null)}invalidateSpatialQueryAccelerator(){this._octree&&(this._octree.destroy(),this._octree=null)}notifyDirty(t,e,i,r){const s={origin:r||this,dirtyType:t,subObject:e};this.emit("dirty",s)}_createOctree(){this._octree=new s({getRadius:t=>t.getBSRadius(),getCenter:t=>t.getCenter()}),this._octree.add([...this._objects])}}a._idGen=new r;export default a;
