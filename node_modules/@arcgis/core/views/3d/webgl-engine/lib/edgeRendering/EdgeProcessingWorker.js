/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{deduplicate as e}from"../../../../../geometry/support/meshUtils/deduplicate.js";import{EdgeInputBufferLayout as r}from"./bufferLayouts.js";import{RegularEdgeBufferWriter as t,SilhouetteEdgeBufferWriter as n}from"./edgeBufferWriters.js";import{packInterleavedBuffer as i}from"../../../support/buffer/workerHelper.js";import{computeNeighbors as s}from"../../../support/meshProcessing.js";import{extractEdges as o}from"./edgePreprocessing.js";async function a(e){const t=function(e){return{data:r.createView(e.dataBuffer),originalIndices:"Uint32Array"===e.originalIndicesType?new Uint32Array(e.originalIndicesBuffer):"Uint16Array"===e.originalIndicesType?new Uint16Array(e.originalIndicesBuffer):void 0,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}(e),n=u(t),s=[t.data.buffer];return{result:function(e,r){r.push(e.regular.lodInfo.lengths.buffer),r.push(e.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:i(e.regular.instancesData,r),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:i(e.silhouette.instancesData,r),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}(n,s),transferList:s}}function u(t){const n=function(t,n,i){if(n&&i){return{faces:i,neighbors:s(i,t.count),vertices:t}}{const n=e(t.buffer,t.stride/4,{originalIndices:i}),o=s(n.indices,n.uniqueCount);return{faces:n.indices,neighbors:o,vertices:r.createView(n.buffer)}}}(t.data,t.skipDeduplicate,t.originalIndices);return f.updateSettings(t.writerSettings),c.updateSettings(t.writerSettings),o(n,f,c)}const f=new t,c=new n;export{u as work,a as wrappedWork};
