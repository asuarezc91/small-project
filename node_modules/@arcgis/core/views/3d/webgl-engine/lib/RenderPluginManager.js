/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{assert as e}from"./Util.js";import{union as t}from"./depthRange.js";class n{constructor(e){this.pluginContext=e,this.renderPlugins=new Array,this.slots=[];for(let e=0;e<23;++e)this.slots[e]=[]}add(e,t){this.renderPlugins.push(t);for(let n=0;n<e.length;++n){const r=e[n];this.slots[r].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginContext.requestRender()}remove(t){const n=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter((e=>e!==t)),e(this.renderPlugins.length<n,"Removing non-added render plugin");for(let e=0;e<this.slots.length;++e)this.slots[e]=this.slots[e].filter((e=>e!==t));t.uninitializeRenderContext(),this.pluginContext.requestRender()}prepareRender(e){for(const t of this.renderPlugins)t.prepareRender&&t.prepareRender(e)}render(e,t){t.slot=e;const n=this.slots[e];let r=!1;for(const e of n)e.canRender&&e.render(t)&&(r=!0);return r}queryDepthRange(e){const n=r;n.near=1/0,n.far=-1/0;for(const r of this.renderPlugins)if(r.queryDepthRange){const s=r.queryDepthRange(e);s&&t(n,s,n)}return n}get needsHighlight(){return this.renderPlugins.some((e=>e.needsHighlight))}get needsLinearDepth(){return this.renderPlugins.some((e=>e.needsLinearDepth))}get needsLaserlineWithContrastControl(){const e=this.slots[17];return!!e&&e.length>0}get renderOccludedFlags(){let e=0;return this.renderPlugins.forEach((t=>{t.renderOccludedFlags&&(e|=t.renderOccludedFlags)})),e}}const r={near:0,far:0};export{n as RenderPluginManager};
