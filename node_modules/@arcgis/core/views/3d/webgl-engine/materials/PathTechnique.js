/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{ReloadableShaderModule as i}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as t}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as r,parameter as o}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import s from"../../../webgl/Program.js";import{makePipelineState as a,defaultDepthWriteParams as n,defaultColorWriteParams as p}from"../../../webgl/renderState.js";import{View as l}from"../core/shaderLibrary/util/View.glsl.js";import{Slice as c}from"../core/shaderLibrary/Slice.glsl.js";import{blendingDefault as d,OITBlending as u,OITDepthTest as h,OITPolygonOffset as m}from"../lib/OrderIndependentTransparency.js";import{stencilWriteMaskOn as f,stencilBaseAllZerosParams as g}from"../lib/StencilUtils.js";import{ReadShadowMap as v}from"../core/shaderLibrary/shading/ReadShadowMap.glsl.js";import{VertexNormal as b}from"../core/shaderLibrary/attributes/VertexNormal.glsl.js";import{setVVUniforms as y}from"../core/shaderLibrary/attributes/PathVertexPosition.glsl.js";import{P as S}from"../../../../chunks/Path.glsl.js";const P={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"},O={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};class T extends t{initializeProgram(e){const i=T.shader.get(),t=this.configuration,r=i.build({OITEnabled:0===t.transparencyPassType,output:t.output,viewingMode:e.viewingMode,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:t.receiveShadows,vvSize:t.vvSize,vvColor:t.vvColor,vvInstancingEnabled:!0,vvOpacity:t.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:t.receiveSSAO,doubleSidedMode:t.doubleSidedMode});return new s(e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),O)}bindPass(e,i,t){l.bindProjectionMatrix(this.program,t.camera.projectionMatrix),this.program.setUniform3fv("size",i.size),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",i.opacity),0===this.configuration.output?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",i.ambient),this.program.setUniform3fv("diffuse",i.diffuse),this.program.setUniform3fv("specular",i.specular),this.program.setUniform1f("opacity",i.opacity)):1!==this.configuration.output&&3!==this.configuration.output||l.bindNearFar(this.program,t.camera.nearFar),y(this.program,i)}bindDraw(e){l.bindView(this.program,e),c.bindUniformsWithOrigin(this.program,this.configuration,e),0!==this.configuration.output&&7!==this.configuration.output||l.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&v.bindView(this.program,e),2===this.configuration.output&&b.bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)}setPipelineState(e){const i=this.configuration,t=3===e,r=2===e;return a({blending:0!==i.output&&7!==i.output||!i.transparent?null:t?d:u(e),culling:(o=i,(e=>!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode))(o)&&{face:1028,mode:2305}),depthTest:{func:h(e)},depthWrite:t||r?n:null,colorWrite:p,stencilWrite:i.sceneHasOcludees?f:null,stencilTest:i.sceneHasOcludees?g:null,polygonOffset:t||r?null:m});var o}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}T.shader=new i(S,(()=>import("../shaders/Path.glsl.js")));class w extends r{constructor(){super(...arguments),this.output=0,this.doubleSidedMode=0,this.receiveShadows=!1,this.receiveSSAO=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.slicePlaneEnabled=!1,this.shadowMap=!1,this.transparent=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3}}e([o({count:8})],w.prototype,"output",void 0),e([o({count:3})],w.prototype,"doubleSidedMode",void 0),e([o()],w.prototype,"receiveShadows",void 0),e([o()],w.prototype,"receiveSSAO",void 0),e([o()],w.prototype,"vvSize",void 0),e([o()],w.prototype,"vvColor",void 0),e([o()],w.prototype,"vvOpacity",void 0),e([o()],w.prototype,"slicePlaneEnabled",void 0),e([o()],w.prototype,"shadowMap",void 0),e([o()],w.prototype,"transparent",void 0),e([o()],w.prototype,"sceneHasOcludees",void 0),e([o({count:4})],w.prototype,"transparencyPassType",void 0);export{T as PathTechnique,w as PathTechniqueConfiguration,P as PathVertexAttrConstants,O as pathVertexAttributeLocations};
