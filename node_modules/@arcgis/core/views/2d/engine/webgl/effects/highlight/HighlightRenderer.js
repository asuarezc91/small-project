/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"../../../../../../core/has.js";import"../../../../../../core/mathUtils.js";import{TEXTURE_BINDING_HIGHLIGHT_0 as r,TEXTURE_BINDING_HIGHLIGHT_1 as e}from"../../definitions.js";import"../../../../../../chunks/builtins.js";import s from"../../../../../webgl/BufferObject.js";import i from"../../../../../webgl/VertexArrayObject.js";import"../../../../../webgl/FramebufferObject.js";import{createProgram as t}from"../../../../../webgl/programUtils.js";import"../../../../../webgl/RenderingContext.js";import{ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX as o,RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX as h,SIGMAS as u}from"./parameters.js";import{highlight as n,blur as a}from"../../shaders/HighlightPrograms.js";export default class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(e,s){e.bindTexture(s,r),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",o),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}finalBlur(e,s){e.bindTexture(s,r),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",h),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}renderHighlight(e,s,i){e.bindTexture(s,r),e.bindProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(1,771),e.drawArrays(5,0,4),e.bindVAO()}_initialize(o,h,m){this._width=h,this._height=m;const d=new s(o,34962,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),g=new i(o,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:d}),l=t(o,n),_=t(o,a);l.setUniform1i("u_texture",r),l.setUniform1i("u_shade",e),l.setUniform4fv("u_sigmas",u),_.setUniform1i("u_texture",r),_.setUniform4fv("u_sigmas",u),this._resources={quadGeometry:d,quadVAO:g,highlightProgram:l,blurProgram:_}}setup(r,e,s){this._resources?(this._width=e,this._height=s):this._initialize(r,e,s)}}
