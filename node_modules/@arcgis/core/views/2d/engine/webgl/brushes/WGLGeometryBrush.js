/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"../../../../../core/has.js";import"../../../../../core/mathUtils.js";import{TEXTURE_BINDING_ATTRIBUTE_DATA_0 as t,TEXTURE_BINDING_ATTRIBUTE_DATA_1 as e,TEXTURE_BINDING_ATTRIBUTE_DATA_2 as i,TEXTURE_BINDING_ATTRIBUTE_DATA_3 as r}from"../definitions.js";import"../../../../../chunks/builtins.js";import s from"../../../../webgl/VertexArrayObject.js";import"../../../../webgl/FramebufferObject.js";import"../../../../webgl/RenderingContext.js";import a from"./WGLBrush.js";export default class extends a{prepareState({context:t},e,i){const r=i&&-1!==i.indexOf("id");t.setBlendingEnabled(!r),t.setBlendFunctionSeparate(1,771,1,771),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilFunction(514,e.stencilRef,255)}draw(t,e,i){if(e.commitChanges(t),!e.visible)return;const r=this.getGeometryType(),s=e.getDisplayList(),a=e.getGeometry(r);a&&s&&(t.timeline.begin(this.name),t.attributeView.bindTextures(t.context),s.byType(r,(r=>{this.drawGeometry(t,e,r,a,i)})),t.timeline.end(this.name))}_getVAO(t,e,i,r){return r.vao||(r.vao=new s(t,i,e,r.vertexBufferMap,r.indexBuffer)),r.vao}_setSharedUniforms(s,a,n){s.setUniform1f("u_pixelRatio",a.pixelRatio),s.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs),s.setUniformMatrix3fv("u_displayViewMat3",a.state.displayViewMat3),s.setUniform1i("u_attributeTextureSize",a.attributeView.size),s.setUniform1i("u_attributeData0",t),s.setUniform1i("u_attributeData1",e),s.setUniform1i("u_attributeData2",i),s.setUniform1i("u_attributeData3",r)}}
