/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{nextHighestPowerOfTwo as t}from"../../../../../../core/mathUtils.js";import{pt2px as e}from"../../../../../../core/screenUtils.js";import{SPRITE_PADDING as r,PICTURE_FILL_COLOR as l}from"../../definitions.js";import{i8888to32 as i,i1616to32 as o}from"../../number.js";import{FillMaterialKey as s}from"../../materialKey/MaterialKey.js";import{premultiplyAlphaRGBAArray as n,premultiplyAlphaRGBA as c}from"../../color.js";import{degToByte as f}from"../../GeometryUtils.js";import a from"./WGLMeshTemplate.js";import m from"./WGLBaseFillTemplate.js";class h extends(m(a)){constructor(t,e,r,l,i,o,n,c,f){super(),this.effects=f;const a=s.load(t);e&&(a.sdf=e.sdf,a.pattern=!0,a.textureBinding=e.textureBinding),this.fillColor=r,this.tl=l,this.br=i,this.aux1=o,this.aux2=n,this.aux3=c,this._materialKey=a.data}static fromCIMFill(l,s){const n=l.color,a=n&&c(n)||0,m=l.materialKey;if(!s){const t=i(0,0,0,l.colorLocked?1:0);return new h(m,null,a,0,0,0,0,t,l.effects)}const{rect:u,width:d,height:p}=s,y=u.x+r,x=u.y+r,g=y+d,j=x+p;let w=t(e(l.height||0));w>255?w=255:w<=0&&(w=t(j-x));let K=t(e(l.height/p*d||0));K>255?K=255:K<=0&&(K=t(g-y));let F=e(l.offsetX||0)+128;F>255&&(F=255);let L=e(-l.offsetY||0)+128;L>255&&(L=255);const B=l.scaleX||1,G=o(y,x),M=o(g,j),S=i(K,w,F,L),U=o(128*B,128),b=i(0,0,f(l.angle),l.colorLocked?1:0);return new h(m,s,a,G,M,S,U,b,l.effects)}static fromSimpleFill(e,l,s=!1){const{color:c}=e,f=c&&"esriSFSNull"!==e.style&&n(c)||0,a=i(0,0,0,s?255:0),m=e.materialKey;if(!l)return new h(m,null,f,0,0,0,0,a,null);const{rect:u,width:d,height:p}=l,y=u.x+r,x=u.y+r,g=y+d,j=x+p,w=o(y,x),K=o(g,j),F=i(t(g-y),t(j-x),0,0),L=o(128,128);return new h(m,l,f,w,K,F,L,a,null)}static fromPictureFill(s,n,c=!1){const f=l,{rect:a,width:m,height:u}=n,d=a.x+r,p=a.y+r,y=d+m,x=p+u,g=o(d,p),j=o(y,x);let w=t(e(s.width));w>255&&(w=255);let K=t(e(s.height));K>255&&(K=255);let F=e(s.xoffset)+128;F>255&&(F=255);let L=e(-s.yoffset)+128;L>255&&(L=255);const B=i(w,K,F,L),G=o(128*s.xscale,128*s.yscale),M=i(0,0,0,c?255:0),S=s.materialKey;return new h(S,n,f,g,j,B,G,M,null)}}export default h;
