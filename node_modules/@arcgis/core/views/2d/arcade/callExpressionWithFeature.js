/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import r from"../../../core/Error.js";import{unquantizeMultipoint as t,unquantizePolyline as o,unquantizePolygon as n,unquantizePoint as a}from"../../../geometry/support/quantizationUtils.js";function s(s,u,c,m,p){const g=s.referencesGeometry()&&p?function(s,u,c){const{transform:m,hasZ:p,hasM:g}=c;i.has(u)||i.set(u,function(s){const i={};switch(s){case"esriGeometryPoint":return(e,r,t,o)=>a(r,i,e,t,o);case"esriGeometryPolygon":return(e,r,t,o)=>n(r,i,e,t,o);case"esriGeometryPolyline":return(e,r,t,n)=>o(r,i,e,t,n);case"esriGeometryMultipoint":return(e,r,o,n)=>t(r,i,e,o,n);default:return e.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r("mapview-arcade",`Unable to handle geometryType: ${s}`)),e=>e}}(u));const l=i.get(u)(s.geometry,m,p,g);return{...s,geometry:l}}(u,m,p):u,l=s.repurposeFeature(g);try{return s.evaluate({...c,$feature:l})}catch(r){return e.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",r),null}}const i=new Map;export default s;
