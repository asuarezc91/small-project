/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{create as o}from"../../../geometry/support/aaBoundingRect.js";import{RefreshableLayerView as r}from"../../layers/RefreshableLayerView.js";import"../tiling/TileKey.js";import"../tiling/PagedTileQueue.js";import i from"../tiling/TileInfoView.js";import"../tiling/TileQueue.js";import"../tiling/TileStrategy.js";import l from"../../layers/LayerView.js";import{LayerView2DMixin as n}from"./LayerView2D.js";import{Display as a}from"./support/Display.js";const p=new Set,c=[],h=[];class u{constructor(e,t,s,r,i,l,n,a=[0,0],p=o()){this.id=e,this.level=t,this.row=s,this.col=r,this.world=i,this.resolution=l,this.scale=n,this.coords=a,this.bounds=p}}let d=class extends(r(n(l))){constructor(e){super(e),this._tileMap=new Map,this.container=new a(this),this.layer=null,this.tiles=[]}get _tileInfoView(){const e=this.layer&&this.layer.tileInfo;return e?new i(e):null}attach(){}detach(){}requestRender(){this.container.requestRender()}tilesChanged(e,t){}async doRefresh(){}isUpdating(){return!1}update(e){const t=this._tileInfoView,s=this.tiles;if(t){const o=t.getTileCoverage(e.state,0),{spans:r,lodInfo:i}=o,{level:l}=i;if(r.length)for(const{row:e,colFrom:t,colTo:o}of r)for(let r=t;r<=o;r++){const t=i.normalizeCol(r),o=i.getWorldForColumn(r),n=`${l}/${e}/${t}/${o}`;if(!this._tileMap.has(n)){const r=new u(n,l,e,t,o,i.resolution,i.scale);i.getTileCoords(r.coords,r,!1),i.getTileBounds(r.bounds,r,!0),this._tileMap.set(n,r),s.push(r),c.push(r)}p.add(n)}}for(let e=s.length-1;e>=0;e--){const t=s[e];p.has(t.id)||(s.splice(e,1),h.push(t),this._tileMap.delete(t.id))}(c.length||h.length)&&(this.tilesChanged(c,h),c.length=h.length=0),p.clear(),this.requestRender()}moveStart(){}viewChange(){this.requestUpdate()}moveEnd(){}};e([t({dependsOn:["layer.loaded"]})],d.prototype,"_tileInfoView",null),e([t()],d.prototype,"layer",void 0),d=e([s("esri.views.2d.layers.BaseLayerView2D")],d);var m=d;export default m;
