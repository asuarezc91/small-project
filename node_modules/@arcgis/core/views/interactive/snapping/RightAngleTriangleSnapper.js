/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{unwrap as e}from"../../../core/maybe.js";import{a as o}from"../../../chunks/vec2f64.js";import{m as t,i as r}from"../../../chunks/vec2.js";import{defaults as s}from"./Settings.js";import{anyMapPointToScreenPoint as i,squareDistance as n}from"./snappingUtils.js";import{SnappingAlgorithm as p}from"./SnappingAlgorithm.js";import{projectPointToCircle as a}from"../../3d/support/geometryUtils/vector2d.js";import{RightAngleTriangleSnappingCandidate as l}from"./RightAngleTriangleSnappingCandidate.js";class h extends p{constructor({enabled:e=s.lineSnapper.enabled,proximityThreshold:o=s.lineProximityThreshold,shortLineThreshold:t=s.shortLineThreshold}={}){super({enabled:e,proximityThreshold:o,shortLineThreshold:t})}snapNewVertex(e,o){const t=o.geometry.data.components[0],r=[],s=t.vertices.length;if("polygon"!==o.geometry.type||s<2)return r;const i=t.vertices[0],n=t.vertices[s-1];return this._processCandidateProposal(i.pos,n.pos,e,o,r),r}snapExistingVertex(o,t){const r=[],s=e(t.vertexHandle),i=s.component;return i.edges.length<2?r:"polyline"!==t.geometry.type||0!==s.index&&s.index!==i.vertices.length-1?(this._processCandidateProposal(s.left.left.pos,s.right.right.pos,o,t,r),r):r}_processCandidateProposal(e,s,p,h,d){if(!this.exceedsShortLineThreshold(e,s,h))return;const m=t(o(),e,s,.5),c=.5*r(e,s),g=a(o(),[p.x,p.y],m,c),f=h.geometry.data.coordinateHelper,y=f.fromXYZ(g,p.hasZ?p.z:0),x=f.fromPoint(p),v=i(x,f,h.elevationInfo,h.view);n(v,i(y,f,h.elevationInfo,h.view))<this.squaredProximityTreshold(h.pointer)&&d.push(new l({coordinateHelper:f,targetPoint:y,point1:e,point2:s}))}}export{h as RightAngleTriangleSnapper};
