/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{InputHandler as t}from"../InputHandler.js";import{DragEventSeparator as a}from"../DragEventSeparator.js";class e extends t{constructor(t=20,e=40){super(!1),this._threshold=t,this._maxDelta=e,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new a({start:(t,a)=>this.observeStart(t,a),update:(t,a,e)=>this.observeUpdate(t,a,e),end:(t,a)=>this.observeEnd(a)}),this.registerIncoming("drag",(t=>this.dragEventSeparator.handle(t)))}get failed(){return"failed"===this.state}observeStart(t,a){1===t&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:a.data.button,buttons:a.data.buttons,pointerType:a.data.pointerType,timestamp:a.data.timestamp,pointers:a.data.pointers,pointer:a.data.pointer,angle:a.data.angle,radius:a.data.radius,center:a.data.center,artifical:!0}),a.stopPropagation()),this.state=2===t?"ready":"failed"}observeUpdate(t,a,e){if("failed"!==this.state&&2===t)return"active"===this.state?(this._vertical.emit({delta:a.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void a.stopPropagation()):void(this.checkMovementWithinLimits(a.data,e.data)?this.checkVerticalThresholdReached(a.data,e.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=a.data.center,this._artificalDrag.emit({action:"end",button:a.data.button,buttons:a.data.buttons,pointerType:a.data.pointerType,timestamp:a.data.timestamp,pointers:a.data.pointers,pointer:a.data.pointer,angle:a.data.angle,radius:a.data.radius,center:a.data.center,artifical:!0}),this._vertical.emit({delta:a.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),a.stopPropagation()):this.state="failed")}observeEnd(t){"active"===this.state&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}checkMovementWithinLimits(t,a){let e=-1/0,i=1/0,r=-1/0,s=1/0;a.pointers.forEach((t=>{e=Math.max(e,t.x),i=Math.min(i,t.x),r=Math.max(r,t.y),s=Math.min(s,t.y)}));let n=-1/0,h=1/0,d=-1/0,o=1/0;t.pointers.forEach((t=>{n=Math.max(n,t.x),h=Math.min(h,t.x),d=Math.max(d,t.y),o=Math.min(o,t.y)}));const c=e-i,l=r-s,p=n-h,m=d-o;return Math.abs(t.center.x-a.center.x)<this._threshold&&Math.abs(p-c)<=this._maxDelta&&Math.abs(m-l)<=this._maxDelta}checkVerticalThresholdReached(t,a){let e=Math.abs(t.center.y-a.center.y);return t.pointers.forEach(((t,i)=>{const r=a.pointers.get(i);e=Math.min(e,Math.abs(t.y-r.y))})),e>=this._threshold}}export{e as VerticalTwoFingerDrag};
