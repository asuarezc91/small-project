/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import o from"../geometry/SpatialReference.js";import s from"../geometry/Extent.js";import{typeKebabDictionary as p}from"../geometry/support/typeUtils.js";import"../geometry.js";import{fixRendererFields as i,fixTimeInfoFields as n}from"./support/fieldUtils.js";import l from"../PopupTemplate.js";import u from"./Layer.js";import{ReadOnlyMultiOriginJSONMixin as d}from"../core/ReadOnlyMultiOriginJSONSupport.js";import a from"../symbols/support/ElevationInfo.js";import"../renderers/Renderer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../renderers/DictionaryRenderer.js";import"../renderers/DotDensityRenderer.js";import"../renderers/HeatmapRenderer.js";import"../renderers/SimpleRenderer.js";import{rendererTypes as y}from"../renderers/support/types.js";import{read as c}from"../renderers/support/jsonUtils.js";import m from"./support/Field.js";import h from"./support/FieldsIndex.js";import{BlendLayer as f}from"./mixins/BlendLayer.js";import{RefreshableLayer as v}from"./mixins/RefreshableLayer.js";import{ScaleRangeLayer as g}from"./mixins/ScaleRangeLayer.js";import{TemporalLayer as j}from"./mixins/TemporalLayer.js";import O from"./support/FeatureReduction.js";import S from"./support/LabelClass.js";import R from"./support/FeatureReductionCluster.js";import F from"./support/FeatureReductionSelection.js";import b from"./support/FeatureType.js";import{createPopupTemplate as x}from"../support/popupUtils.js";import I from"../tasks/support/Query.js";import E from"./graphics/sources/OGCFeatureSource.js";let D=class extends(f(j(g(v(d(u)))))){constructor(e){super(e),this.collectionId=null,this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureReduction=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=null,this.spatialReference=o.WGS84,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}load(e){const t=new E({layer:this});return this._set("source",t),this.addResolvingPromise(t.load(e).then((()=>{const{geometryType:e,hasZ:t,objectIdField:r}=this.source.layerDefinition;this.set({geometryType:p.fromJSON(e),hasZ:t,objectIdField:r}),i(this.renderer,this.fields),n(this.timeInfo,this.fields)}))),this.when()}get capabilities(){return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!!this.hasZ},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:1e4,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsStatistics:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}}get defaultPopupTemplate(){return this.createPopupTemplate()}get description(){var e,t,r;return null!=(e=null==(t=this.source)||null==(r=t.collection)?void 0:r.description)?e:null}get fields(){var e,t,r;const o=null==(e=this.source)||null==(t=e.layerDefinition)?void 0:t.fields;return null!=(r=null==o?void 0:o.map((e=>m.fromJSON(e))))?r:null}set fields(e){e?this._override("fields",e):this._clearOverride("fields")}get fieldsIndex(){return new h(this.fields)}get renderer(){var e,t,r;const o=null==(e=this.source)||null==(t=e.layerDefinition)||null==(r=t.drawingInfo)?void 0:r.renderer;return o?c(o,null,{origin:"service"}):null}set renderer(e){e?(i(e,this.fields),this._override("renderer",e)):this._clearOverride("renderer")}get spatialReferences(){var e,t;return null==(e=this.source)||null==(t=e.collection)?void 0:t.crs}get title(){var e,t;return null==(e=this.source)||null==(t=e.collection)?void 0:t.title}set title(e){e?this._override("title",e):this._clearOverride("title")}on(e,t){return super.on(e,t)}createPopupTemplate(e){return x(this,e)}createQuery(){return new I}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r;let o,s=!1;const p=null==t||null==(r=t.feature)?void 0:r.attributes,i=this.typeIdField&&(null==p?void 0:p[this.typeIdField]);return null!=i&&this.types&&(s=this.types.some((t=>{var r,s;return t.id==i&&(o=null==(r=t.domains)?void 0:r[e],"inherited"===(null==(s=o)?void 0:s.type)&&(o=this._getLayerDomain(e)),!0)}))),s||o||(o=this._getLayerDomain(e)),o}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(I.from(e)||this.createQuery(),t))).then((e=>{var t;return null==e||null==(t=e.features)||t.forEach((e=>{e.layer=e.sourceLayer=this})),e}))}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};e([t({readOnly:!0,dependsOn:["hasZ"],autoTracked:!1})],D.prototype,"capabilities",null),e([t({type:String})],D.prototype,"collectionId",void 0),e([t({type:String})],D.prototype,"copyright",void 0),e([t({readOnly:!0,dependsOn:["fields","title"]})],D.prototype,"defaultPopupTemplate",null),e([t({type:String})],D.prototype,"definitionExpression",void 0),e([t({dependsOn:["source.collection"],readOnly:!0,type:String})],D.prototype,"description",null),e([t({type:String})],D.prototype,"displayField",void 0),e([t({type:a})],D.prototype,"elevationInfo",void 0),e([t({types:{key:"type",base:O,typeMap:{selection:F,cluster:R}}})],D.prototype,"featureReduction",void 0),e([t({dependsOn:["source.layerDefinition"],type:[m]})],D.prototype,"fields",null),e([t({readOnly:!0,dependsOn:["fields"]})],D.prototype,"fieldsIndex",null),e([t({type:s,aliasOf:"source.fullExtent"})],D.prototype,"fullExtent",void 0),e([t({type:["point","polygon","polyline","multipoint"]})],D.prototype,"geometryType",void 0),e([t({type:Boolean})],D.prototype,"hasZ",void 0),e([t({type:String})],D.prototype,"id",void 0),e([t({type:[S]})],D.prototype,"labelingInfo",void 0),e([t({type:Boolean})],D.prototype,"labelsVisible",void 0),e([t({type:Boolean})],D.prototype,"legendEnabled",void 0),e([t({type:["show","hide"]})],D.prototype,"listMode",void 0),e([t({type:String})],D.prototype,"objectIdField",void 0),e([t({type:Boolean})],D.prototype,"popupEnabled",void 0),e([t({type:l})],D.prototype,"popupTemplate",void 0),e([t({dependsOn:["source.layerDefinition"],types:y})],D.prototype,"renderer",null),e([t({type:Boolean})],D.prototype,"screenSizePerspectiveEnabled",void 0),e([t({readOnly:!0})],D.prototype,"source",void 0),e([t({type:o,readOnly:!0})],D.prototype,"spatialReference",void 0),e([t({dependsOn:["source.collection"],readOnly:!0,type:[String]})],D.prototype,"spatialReferences",null),e([t({dependsOn:["source.collection"]})],D.prototype,"title",null),e([t({readOnly:!0})],D.prototype,"type",void 0),e([t({type:String,readOnly:!0})],D.prototype,"typeIdField",void 0),e([t({type:[b]})],D.prototype,"types",void 0),e([t({type:String})],D.prototype,"url",void 0),D=e([r("esri.layers.OGCFeatureLayer")],D);var T=D;export default T;
