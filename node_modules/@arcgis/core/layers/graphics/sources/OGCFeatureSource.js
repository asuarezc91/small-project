/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import{isSome as o}from"../../../core/maybe.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../../core/accessorSupport/decorators/subclass.js";import i from"../../../core/Error.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{all as n}from"../../../core/promiseUtils.js";import s from"../../../geometry/SpatialReference.js";import l from"../../../geometry/Extent.js";import{typeKebabDictionary as c}from"../../../geometry/support/typeUtils.js";import"../../../geometry.js";import p from"../../../core/Loadable.js";import{getServerLandingPage as a,getServerConformance as u,getServerCollection as m,getCollectionDefinition as d,queryFeatureSet as f,queryFeatureSetJSON as y}from"../../ogc/ogcFeatureUtils.js";let g=class extends p{constructor(){super(...arguments),this.collection=null,this.conformance=null,this.landingPage=null,this.layerDefinition=null,this.type="ogc-feature"}load(e){const t=o(e)?e.signal:null,{collectionId:r,fields:s,geometryType:l,hasZ:p,objectIdField:f,spatialReference:y,timeInfo:g,url:h}=this.layer,j={fields:null==s?void 0:s.map((e=>e.toJSON())),geometryType:c.toJSON(l),hasZ:p,objectIdField:f,spatialReference:null==y?void 0:y.toJSON(),timeInfo:null==g?void 0:g.toJSON()};return this.addResolvingPromise(n([a(h,t),u(h,t),m(h,r,t),d(h,r,j,t)]).then((e=>{const[o,t,r,n]=e;this.set({landingPage:o,conformance:t,collection:r,layerDefinition:n});const s="www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson";if(!(-1!==(null==t?void 0:t.conformsTo.indexOf(`http://${s}`))||-1!==(null==t?void 0:t.conformsTo.indexOf(`https://${s}`))))throw new i("ogc-feature-layer:no-geojson-support","Server does not support geojson")}))),this.when()}get fullExtent(){var e,o;const t=null==(e=this.collection)||null==(o=e.extent)?void 0:o.spatial;if(!t)return null;const r=t.bbox[0],i=4===r.length,n=r[0],c=r[1],p=i?void 0:r[2],a=i?r[2]:r[3],u=i?r[3]:r[4],m=i?void 0:r[5],d=s.WGS84;return new l({xmin:n,ymin:c,xmax:a,ymax:u,zmin:p,zmax:m,spatialReference:d})}queryExtent(e,o={}){return null}queryFeatureCount(e,o={}){return null}queryFeatures(e,o={}){const t=this._getFeatureDefinition();return this.load(o).then((()=>f(t,e,o)))}queryFeaturesJSON(e,o={}){const t=this._getFeatureDefinition();return this.load(o).then((()=>y(t,e,o)))}queryObjectIds(e,o={}){return null}_getFeatureDefinition(){const{layer:{capabilities:e,collectionId:o,url:t},layerDefinition:r}=this;return{capabilities:e,collectionId:o,layerDefinition:r,url:t}}};e([t()],g.prototype,"collection",void 0),e([t()],g.prototype,"conformance",void 0),e([t({dependsOn:["collection"],readOnly:!0,type:l})],g.prototype,"fullExtent",null),e([t()],g.prototype,"landingPage",void 0),e([t({constructOnly:!0})],g.prototype,"layer",void 0),e([t()],g.prototype,"layerDefinition",void 0),e([t()],g.prototype,"type",void 0),g=e([r("esri.layers.graphics.sources.OGCFeatureSource")],g);var h=g;export default h;export{g as OGCFeatureSource};
