/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{c as t}from"../../../chunks/vec3f64.js";import{getSphericalPCPF as r}from"../../projectionEllipsoid.js";import{a as i,m as o,b as n}from"../../../chunks/mat4.js";import{projectPointToVector as s,computeLinearTransformation as c}from"../../projection.js";import{a}from"../../../chunks/mat4f64.js";import{projectToECEF as p,projectNormalToECEF as f,transformBufferInPlace as l,projectFromECEF as m,projectNormalFromECEF as d}from"./projection.js";const u=e.getLogger("esri.geometry.support.meshUtils.centerAt");function g(e,t,a){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const g=e.spatialReference,x=g.isWGS84||g.isWebMercator&&(!a||!1!==a.geographic),A=a&&a.origin||e.extent.center;x?function(e,t,a){const g=e.spatialReference,x=r(g),A=j,R=h;if(!s(t,R,x))return void u.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to ECEF`);s(a,A,x)||s(e.extent.center,A,x);const v=e.vertexAttributes.position,b=e.vertexAttributes.normal,F=new Float64Array(v.length),$=new Float32Array(b?b.length:0);p(v,g,F),b&&f(b,v,F,g,$);c(x,A,k,x),c(x,R,w,x),i(k,k),o(w,w,k),l(F,w),i(w,w),n(w,w),b&&l($,w,!0);m(F,v,g),b&&d($,v,F,g,b);e.clearCache()}(e,t,A):function(e,t,r){const i=j,o=h;if(!s(t,o,e.spatialReference))return void u.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`);if(!s(r,i,e.spatialReference)){const t=e.extent.center;i[0]=t.x,i[1]=t.y,i[2]=t.z,u.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Using mesh extent.center instead`)}(function(e,t,r){if(!e)return;for(let i=0;i<e.length;i+=3)for(let o=0;o<3;o++)e[i+o]+=t[o]-r[o]})(e.vertexAttributes.position,o,i),e.clearCache()}(e,t,A)}const h=t(),j=t(),k=a(),w=a();export{g as centerAt};
