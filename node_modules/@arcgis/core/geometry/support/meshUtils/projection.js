/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import r from"../../../core/Logger.js";import{isCGCS2000 as e,isMars as o,isMoon as t}from"../spatialReferenceUtils.js";import{c as f}from"../../../chunks/vec3f64.js";import{i as n,n as a,t as s}from"../../../chunks/vec3.js";import{getSphericalPCPF as i,SphericalECEFSpatialReference as c}from"../../projectionEllipsoid.js";import{projectBuffer as m,computeLinearTransformation as p,webMercator as y}from"../../projection.js";import{a as u}from"../../../chunks/mat3f64.js";import{a as l}from"../../../chunks/mat4f64.js";import{f as T,t as E}from"../../../chunks/mat3.js";import{BufferViewVec3f as d,BufferViewVec3f64 as A}from"../../../views/3d/support/buffer/BufferView.js";const g=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function j(r,e,o,t,f){return t.isWebMercator||t.isWGS84?(M(0,d.fromTypedArray(r),A.fromTypedArray(e),A.fromTypedArray(o),t,d.fromTypedArray(f)),f):(g.error("Cannot convert PCS spatial reference buffer to ECEF"),f)}function h(r,e,o,t,f){return t.isWebMercator||t.isWGS84?(M(1,d.fromTypedArray(r),A.fromTypedArray(e),A.fromTypedArray(o),t,d.fromTypedArray(f)),f):(g.error("Cannot convert to PCS spatial reference buffer from ECEF"),f)}function C(r,e,o){return m(r,e,0,o,i(e),0,r.length/3),o}function S(r,e,o){return m(r,i(o),0,e,o,0,r.length/3),e}function b(r,e,o=!1){if(r)for(let t=0;t<r.length;t+=3){for(let e=0;e<3;e++)P[e]=r[t+e];n(P,P,e),o&&a(P,P);for(let e=0;e<3;e++)r[t+e]=P[e]}}function W(r,e,o,t,f){if(!t.isWebMercator&&!t.isWGS84)return g.error("Cannot convert PCS spatial reference buffer to ECEF"),f;M(0,d.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),A.fromTypedArray(e),A.fromTypedArray(o),t,d.fromTypedArray(f,4*Float32Array.BYTES_PER_ELEMENT));for(let e=3;e<r.length;e+=4)f[e]=r[e];return f}function v(r,e,o,t,f){if(!t.isWebMercator&&!t.isWGS84)return g.error("Cannot convert to PCS spatial reference buffer from ECEF"),f;M(1,d.fromTypedArray(r,16),A.fromTypedArray(e),A.fromTypedArray(o),t,d.fromTypedArray(f,16));for(let e=3;e<r.length;e+=4)f[e]=r[e];return f}function M(r,f,n,m,u,l){if(!f)return;const d=u.isWGS84||e(u)||o(u)||t(u),A=n.count;if(d)for(let e=0;e<A;e++){m.getVec(e,P),f.getVec(e,V);const o=i(u);p(o,P,F,o),T(k,F),1===r&&E(k,k),s(V,V,k),l.setVec(e,V)}else for(let e=0;e<A;e++){m.getVec(e,P),f.getVec(e,V),p(c,P,F,c),T(k,F);const o=y.y2lat(n.get(e,1));let t=Math.cos(o);0===r&&(t=1/t),k[0]*=t,k[1]*=t,k[2]*=t,k[3]*=t,k[4]*=t,k[5]*=t,1===r&&E(k,k),s(V,V,k),a(V,V),l.setVec(e,V)}return l}const P=f(),V=f(),F=l(),k=u();export{S as projectFromECEF,h as projectNormalFromECEF,j as projectNormalToECEF,v as projectTangentFromECEF,W as projectTangentToECEF,C as projectToECEF,b as transformBufferInPlace};
