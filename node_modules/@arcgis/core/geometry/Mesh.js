/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../core/has.js";import{clone as e}from"../core/lang.js";import o from"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import s from"../core/Error.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{create as i,throwIfAborted as a}from"../core/promiseUtils.js";import c from"./Geometry.js";import p from"./Point.js";import m from"./Extent.js";import l from"./Polygon.js";import{f as h,c as u}from"../chunks/vec3f64.js";import{a as f}from"../chunks/vec4f64.js";import{MeshVertexAttributes as x}from"./support/MeshVertexAttributes.js";import d from"./support/MeshComponent.js";import{triangulate as y}from"./support/triangulationUtils.js";import{centerAt as g}from"./support/meshUtils/centerAt.js";import{merge as j}from"./support/meshUtils/merge.js";import{offset as v}from"./support/meshUtils/offset.js";import{convertUnitGeometry as w,createUnitSizeBox as b,createUnitSizeSphere as A,createUnitSizeCylinder as M,createUnitSizePlane as F,boxFaceOrder as P}from"./support/meshUtils/primitives.js";import{axisAngleFrom as U,axisAngleMultiply as z,rotate as E}from"./support/meshUtils/rotate.js";import{scale as T}from"./support/meshUtils/scale.js";var C;const O=o.getLogger("esri.geometry.Mesh");let L=C=class extends c{constructor(t){super(t),this.components=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new x,this.type="mesh"}get extent(){const t=this.spatialReference,e=this.vertexAttributes&&this.vertexAttributes.position;if(!e||0===e.length||this.components&&0===this.components.length)return new m({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t});const o={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,zmin:1/0,zmax:-1/0,spatialReference:t};if(!this.components)return new m(this.extendExtent(o,e,null));for(const t of this.components){if(!t.faces){this.extendExtent(o,e,null);break}this.extendExtent(o,e,t.faces)}return new m(o)}addComponent(t){this.components||(this.components=[]),this.components.push(d.from(t)),this.clearCache()}removeComponent(t){if(this.components){const e=this.components.indexOf(t);if(-1!==e)return void(this.components=this.components.splice(e,1))}O.error("removeComponent()","Provided component is not part of the list of components")}rotate(t,e,o,r){return U(G.x,S(t),k),U(G.y,S(e),B),U(G.z,S(o),N),z(k,B,k),z(k,N,k),E(this,k,r),this}offset(t,e,o,r){return R[0]=t,R[1]=e,R[2]=o,v(this,R,r),this}scale(t,e){return T(this,t,e),this}centerAt(t,e){return g(this,t,e),this}clone(){const t=this.components?new Map:null,o=this.components?new Map:null,r=this.components?this.components.map((e=>e.cloneWithDeduplication(t,o))):null;return new C({components:r,spatialReference:this.spatialReference,vertexAttributes:e(this.vertexAttributes)})}vertexAttributesChanged(){this.clearCache()}toJSON(t){return this.write(null,t)}forEachVertex(t,e,o){if(e)for(let r=0;r<e.length;r++){const n=3*e[r];o(t[n+0],t[n+1],t[n+2])}else for(let e=0;e<t.length;e+=3)o(t[e+0],t[e+1],t[e+2])}extendExtent(t,e,o){return this.forEachVertex(e,o,((e,o,r)=>{t.xmin=Math.min(t.xmin,e),t.xmax=Math.max(t.xmax,e),t.ymin=Math.min(t.ymin,o),t.ymax=Math.max(t.ymax,o),t.zmin=Math.min(t.zmin,r),t.zmax=Math.max(t.zmax,r)})),t}async toBinaryGLTF(t){const{toBinaryGLTF:e}=await import("./support/meshUtils/exporters/gltf/gltfexport.js");return e(this,t)}static createBox(t,e){if(!(t instanceof p))return O.error(".createBox()","expected location to be a Point instance"),null;const o=new C(w(b(),t,e));return e&&e.imageFace&&"all"!==e.imageFace?function(t,e){const o=t.components[0],r=o.faces,n=P[e],s=6*n,i=new Uint32Array(6),a=new Uint32Array(r.length-6);let c=0,p=0;for(let t=0;t<r.length;t++)t>=s&&t<s+6?i[c++]=r[t]:a[p++]=r[t];const m=new Float32Array(t.vertexAttributes.uv),l=4*n*2,h=[0,1,1,1,1,0,0,0];for(let t=0;t<h.length;t++)m[l+t]=h[t];return t.vertexAttributes.uv=m,t.components=[new d({faces:i,material:o.material}),new d({faces:a})],t}(o,e.imageFace):o}static createSphere(t,e){return t instanceof p?new C(w(A(e&&e.densificationFactor||0),t,e)):(O.error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(t,e){return t instanceof p?new C(w(M(e&&e.densificationFactor||0),t,e)):(O.error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(t,e){return t instanceof p?new C(w(F(e&&e.facing||"up"),t,e)):(O.error(".createPlane()","expected location to be a Point instance"),null)}static createFromPolygon(t,e){if(!(t instanceof l))return O.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const o=y(t);return new C({vertexAttributes:{position:o.position},components:[{faces:o.faces,shading:"flat",material:e&&e.material||null}],spatialReference:t.spatialReference})}static async createFromGLTF(t,e,o){if(!(t instanceof p))throw O.error(".createfromGLTF()","expected location to be a Point instance"),new s("invalid-input","Expected location to be a Point instance");return i(((r,n)=>{import("./support/loadGLTFMesh.js").then((async i=>{try{a(o);const n=await i.loadGLTFMesh(t,e,o);r(new C(j(n.map((t=>new C(t))),{reuseMaterials:!0})))}catch(t){n(new s("gltf-loader-error","Failed to load glTF.",`[${t.name}] ${t.message}`))}}))}))}};function S(t){return t/180*Math.PI}t([r({dependsOn:["vertexAttributes","vertexAttributes.position","components"],json:{read:!1}})],L.prototype,"cache",void 0),t([r({type:[d]})],L.prototype,"components",void 0),t([r({readOnly:!0,dependsOn:["cache"],autoTracked:!1,json:{read:!1}})],L.prototype,"extent",null),t([r({readOnly:!0,json:{read:!1,write:!1}})],L.prototype,"hasZ",void 0),t([r({readOnly:!0,json:{read:!1,write:!1}})],L.prototype,"hasM",void 0),t([r({type:x,nonNullable:!0,json:{write:!0}})],L.prototype,"vertexAttributes",void 0),L=C=t([n("esri.geometry.Mesh")],L),L.prototype.toJSON.isDefaultToJSON=!0;const G={x:h(1,0,0),y:h(0,1,0),z:h(0,0,1)},R=u(),k=f(),B=f(),N=f();var J=L;export default J;
