/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as i}from"../../core/maybe.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as l}from"../../core/accessorSupport/decorators/property.js";import{aliasOf as r}from"../../core/accessorSupport/decorators/aliasOf.js";import{subclass as s}from"../../core/accessorSupport/decorators/subclass.js";import o from"../../core/Error.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import t from"../../renderers/visualVariables/support/ColorStop.js";import a from"../../renderers/visualVariables/support/SizeStop.js";import{storeNode as n}from"../support/widgetUtils.js";import{messageBundle as d}from"../support/decorators/messageBundle.js";import{renderable as p}from"../support/decorators/renderable.js";import{j as u}from"../../chunks/index.js";import{getDynamicPathForSizeStops as m,getPathForSizeStops as c}from"./support/utils.js";import{SmartMappingSliderBase as v}from"./SmartMappingSliderBase.js";import h from"../../renderers/visualVariables/support/ColorSizeStop.js";import b from"./ColorSizeSlider/ColorSizeSliderViewModel.js";var f;const g="esri-color-size-slider",z="esri-color-size-slider__ramp",S="esri-color-size-slider__slider-container",w="esri-color-size-slider__histogram-container",y="esri-widget",x="esri-widget--panel",V="esri-disabled";let _=f=class extends v{constructor(e,i){super(e,i),this._bgFillId=null,this._backgroundFillColor="#e0e0e0",this._minRampFillWidth=.2,this._rampFillId=null,this._rampNode=null,this._maxRampFillWidth=1,this.handlesSyncedToPrimary=null,this.label=void 0,this.messages=null,this.primaryHandleEnabled=null,this.stops=null,this.viewModel=new b,this.zoomOptions=null,this._bgFillId=`${this.id}-bg-fill`,this._rampFillId=`${this.id}-linear-gradient`}static fromRendererResult(e,i){const{renderer:{authoringInfo:{univariateTheme:l}},color:{visualVariable:{stops:r}},size:{visualVariables:s},statistics:t}=e,{avg:a,stddev:n}=t;if(!r)throw new o("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const d="above-and-below"===l,p=e.renderer.authoringInfo.visualVariables[0],u=p.minSliderValue,m=p.maxSliderValue,c=s.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),v=c.stops,b=r.map(((e,i)=>{const{color:l,label:s,value:o}=e;let t;return t=v&&v.length>0?v[i].size:0===i?c.minSize:i===r.length-1?c.maxSize:null,new h({color:l,label:s,value:o,size:t})}));return new f({max:m,min:u,stops:b,primaryHandleEnabled:d,handlesSyncedToPrimary:d,histogramConfig:{average:a,standardDeviation:n,bins:i?i.bins:[]}})}updateFromRendererResult(e,i){const{renderer:{authoringInfo:{univariateTheme:l}},color:{visualVariable:{stops:r}},size:{visualVariables:s},statistics:t}=e,{avg:a,stddev:n}=t;if(!r)throw new o("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const d="above-and-below"===l,p=e.renderer.authoringInfo.visualVariables[0],u=p.minSliderValue,m=p.maxSliderValue,c=s.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),v=c.stops,b=r.map(((e,i)=>{const{color:l,label:s,value:o}=e;let t;return t=v&&v.length>0?v[i].size:0===i?c.minSize:i===r.length-1?c.maxSize:null,new h({color:l,label:s,value:o,size:t})}));this.set({max:m,min:u,stops:b,primaryHandleEnabled:d,handlesSyncedToPrimary:d,histogramConfig:{average:a,standardDeviation:n,bins:i?i.bins:[]}})}updateRenderer(e){const{stops:l}=this,r=l[0],s=l[l.length-1],o=l[Math.floor(l.length/2)],n=e.clone(),d=n.visualVariables.map((e=>{if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return e;i(e.minSize)&&i(e.maxSize)?e.set({maxDataValue:s.value,minDataValue:r.value,maxSize:s.size,minSize:r.size}):e.stops&&e.set({stops:l.map((e=>{const{label:i,size:l,value:r}=e;return new a({label:i,size:l,value:r})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:i,label:l,value:r}=e;return new t({color:i,label:l,value:r})}))});return e}));if(n.visualVariables=d,n.classBreakInfos.length>1){const e=o.value;n.classBreakInfos[0].maxValue=e,n.classBreakInfos[1].minValue=e}return n}updateVisualVariables(e){return e.map((e=>{const l=e.clone();if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return l;if(i(e.minSize)&&i(e.maxSize)){const{stops:e}=this,i=e[0],r=e[e.length-1];l.set({maxDataValue:r.value,minDataValue:i.value,maxSize:r.size,minSize:i.size})}else e.stops&&l.set({stops:this.stops.map((e=>{const{label:i,size:l,value:r}=e;return new a({label:i,size:l,value:r})}))})}else"color"===e.type&&l.set({stops:this.stops.map((e=>{const{color:i,label:l,value:r}=e;return new t({color:i,label:l,value:r})}))});return l}))}render(){const{state:e,label:i}=this,l="disabled"===e,r=this.classes(g,y,x,{[V]:l});return u("div",{"aria-label":i,class:r},l?null:this.renderContent(this.renderRamp(),S,w))}renderRamp(){const{_bgFillId:e,_rampFillId:i,viewModel:l,zoomOptions:r}=this,s=l.getStopInfo();return u("div",{afterCreate:n,bind:this,class:z,"data-node-ref":"_rampNode"},u("svg",{xmlns:"http://www.w3.org/2000/svg"},u("defs",null,this.renderRampFillDefinition(i,s),this.renderBackgroundFillDefinition(e)),u("rect",{x:"0",y:"0",fill:this._backgroundFillColor,height:"100%",width:"100%"}),this.renderPaths()),r?this.renderZoomCaps():null)}renderPaths(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:l=0}=this._rampNode;if(!i(e)||!i(l))return;const{primaryHandleEnabled:r,stops:s,values:o,viewModel:{max:t,min:a},_bgFillId:n,_maxRampFillWidth:d,_minRampFillWidth:p,_rampFillId:v}=this,h=[d,p];s[0].size<s[s.length-1].size&&h.reverse();const[b,f]=h,[g,z]=o,S=r?m({max:t,min:a,pathHeight:e,pathWidth:l,stops:s,padding:f}):c({bottomValue:g,bottomWidth:b,max:t,min:a,pathHeight:e,pathWidth:l,topValue:z,topWidth:f});return[u("path",{key:"background",d:S,fill:`url(#${n})`}),u("path",{key:"fill",d:S,fill:`url(#${v})`})]}};e([r("viewModel.handlesSyncedToPrimary")],_.prototype,"handlesSyncedToPrimary",void 0),e([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_.prototype,"label",void 0),e([l(),p(),d("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],_.prototype,"messages",void 0),e([r("viewModel.primaryHandleEnabled")],_.prototype,"primaryHandleEnabled",void 0),e([r("viewModel.stops")],_.prototype,"stops",void 0),e([l(),p(["viewModel.handlesSyncedToPrimary","viewModel.hasTimeData","viewModel.inputFormatFunction","viewModel.inputParseFunction","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.primaryHandleEnabled","viewModel.stops","viewModel.values","viewModel.zoomOptions"])],_.prototype,"viewModel",void 0),e([r("viewModel.zoomOptions")],_.prototype,"zoomOptions",void 0),_=f=e([s("esri.widgets.smartMapping.ColorSizeSlider")],_);var M=_;export default M;
