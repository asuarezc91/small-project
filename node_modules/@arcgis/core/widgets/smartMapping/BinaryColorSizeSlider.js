/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as r}from"../../core/maybe.js";import"../../core/Logger.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import{aliasOf as s}from"../../core/accessorSupport/decorators/aliasOf.js";import{cast as i}from"../../core/accessorSupport/decorators/cast.js";import{subclass as t}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import l from"../../Color.js";import a from"../../renderers/visualVariables/support/SizeStop.js";import{getCIMSymbolColor as n}from"../../symbols/support/cimSymbolUtils.js";import{storeNode as d}from"../support/widgetUtils.js";import{messageBundle as p}from"../support/decorators/messageBundle.js";import{renderable as m}from"../support/decorators/renderable.js";import{j as u}from"../../chunks/index.js";import{getSizesFromVariable as c,getFillFromColor as v,getDynamicPathForSizeStops as h}from"./support/utils.js";import{SmartMappingSliderBase as y}from"./SmartMappingSliderBase.js";import f from"./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel.js";var b;const g="esri-binary-color-size-slider",w="esri-binary-color-size-slider__ramp",S="esri-binary-color-size-slider__slider-container",F="esri-binary-color-size-slider__histogram-container",j="esri-widget",z="esri-widget--panel",k="esri-disabled",C={trackBackgroundColor:new l([224,224,224]),trackAboveFillColor:new l([149,149,149]),trackBelowFillColor:new l([149,149,149])};let M=b=class extends y{constructor(e,r){super(e,r),this._minRampFillWidth=.2,this._rampNode=null,this._rampFillId=null,this.handlesSyncedToPrimary=null,this.label=void 0,this.messages=null,this.stops=null,this.style={...C},this.viewModel=new f,this.zoomOptions=null,this._rampFillId=`${this.id}-linear-gradient`}castStyle(e){return{...C,...e}}static fromRendererResult(e,r){const{size:{visualVariables:o},statistics:s}=e,{avg:i,stddev:t}=s,l=o[0].stops,a=e.renderer.authoringInfo.visualVariables[0],d=a.minSliderValue,p=a.maxSliderValue,m=e.renderer.classBreakInfos;let u,c,v=null;const h=e=>{if("cim"===e.type)return n(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(m.length>1){const e=m[0].symbol,r=m[1].symbol;c=h(e),u=h(r)}return 1===m.length&&(v=h(m[0].symbol)),new b({max:p,min:d,stops:l,histogramConfig:{average:i,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:u,trackBelowFillColor:c,trackFillColor:v},handlesSyncedToPrimary:!0})}updateFromRendererResult(e,r){const{size:{visualVariables:o},statistics:s}=e,{avg:i,stddev:t}=s,l=o[0].stops,a=e.renderer.authoringInfo.visualVariables[0],d=a.minSliderValue,p=a.maxSliderValue,m=e.renderer.classBreakInfos;let u,c,v=null;const h=e=>{if("cim"===e.type)return n(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(m.length>1){const e=m[0].symbol,r=m[1].symbol;c=h(e),u=h(r)}1===m.length&&(v=h(m[0].symbol)),this.set({max:p,min:d,stops:l,histogramConfig:{average:i,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:u,trackBelowFillColor:c,trackFillColor:v},handlesSyncedToPrimary:!0})}updateRenderer(e){var r,o;if("univariate-color-size"!==(null==(r=e.authoringInfo)?void 0:r.type)||"above-and-below"!==(null==(o=e.authoringInfo)?void 0:o.univariateTheme))return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const s=e.clone(),i=s.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:t}=this;if(!i||!t)return console.error("No size stops available."),null;const l=s.visualVariables.indexOf(i);s.visualVariables.splice(l,1),i.stops=t,s.visualVariables.push(i);const a=t[5===t.length?2:1].value;return s.classBreakInfos[0].maxValue=a,s.classBreakInfos[1].minValue=a,s}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:r,minDataValue:o,stops:s}=e;if(s)this.stops=s;else{const[s,i]=c(e);this.stops=[new a({value:o,size:i}),new a({value:r,size:s})]}}render(){const{state:e,label:r}=this,o="disabled"===e,s=this.classes(g,j,z,{[k]:o});return u("div",{"aria-label":r,class:s},o?null:this.renderContent(this.renderRamp(),S,F))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return u("div",{afterCreate:d,bind:this,class:w,"data-node-ref":"_rampNode"},u("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},u("rect",{x:"0",y:"0",fill:v(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)}renderPrimaryRamp(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:o},viewModel:s}=this;return[u("defs",null,this.renderRampFillDefinition(e,s.getGradientStopInfo(r,o)))]}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:o=0}=this._rampNode;if(!r(e)||!r(o))return;const{stops:s,viewModel:{max:i,min:t},_rampFillId:l,_minRampFillWidth:a}=this,n=h({max:i,min:t,pathHeight:e,pathWidth:o,stops:s,padding:a});return u("path",{d:n,fill:`url(#${l})`})}};e([s("viewModel.handlesSyncedToPrimary")],M.prototype,"handlesSyncedToPrimary",void 0),e([o({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],M.prototype,"label",void 0),e([o(),m(),p("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],M.prototype,"messages",void 0),e([s("viewModel.stops")],M.prototype,"stops",void 0),e([o(),m()],M.prototype,"style",void 0),e([i("style")],M.prototype,"castStyle",null),e([o(),m(["viewModel.hasTimeData","viewModel.inputFormatFunction","viewModel.inputParseFunction","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.stops","viewModel.values","viewModel.zoomOptions"])],M.prototype,"viewModel",void 0),e([s("viewModel.zoomOptions")],M.prototype,"zoomOptions",void 0),M=b=e([t("esri.widgets.smartMapping.BinaryColorSizeSlider")],M);var V=M;export default V;
