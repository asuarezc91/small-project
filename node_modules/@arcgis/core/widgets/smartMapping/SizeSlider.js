/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as s}from"../../core/maybe.js";import"../../core/Logger.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import{aliasOf as t}from"../../core/accessorSupport/decorators/aliasOf.js";import{cast as r}from"../../core/accessorSupport/decorators/cast.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import a from"../../Color.js";import l from"../../renderers/visualVariables/support/SizeStop.js";import n from"../../renderers/visualVariables/SizeVariable.js";import{storeNode as p}from"../support/widgetUtils.js";import{messageBundle as d}from"../support/decorators/messageBundle.js";import{renderable as m}from"../support/decorators/renderable.js";import{j as u}from"../../chunks/index.js";import{getSizesFromVariable as c,getFillFromColor as h,getDynamicPathForSizeStops as v,getPathForSizeStops as f}from"./support/utils.js";import{SmartMappingSliderBase as g}from"./SmartMappingSliderBase.js";import z from"./SizeSlider/SizeSliderViewModel.js";var w;const b="esri-size-slider",S="esri-size-slider__ramp",y="esri-size-slider__slider-container",V="esri-size-slider__histogram-container",j="esri-widget",x="esri-widget--panel",M="esri-disabled",_={trackFillColor:new a([149,149,149]),trackBackgroundColor:new a([224,224,224])};let F=w=class extends g{constructor(e,s){super(e,s),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.handlesSyncedToPrimary=null,this.label=void 0,this.messages=null,this.primaryHandleEnabled=null,this.stops=null,this.style={..._},this.viewModel=new z,this.zoomOptions=null}castStyle(e){return{..._,...e}}static fromRendererResult(e,s){const{visualVariables:i,statistics:t}=e,{avg:r,stddev:o}=t,a=i[0],[l,n]=c(a),p=e.renderer.authoringInfo.visualVariables[0],d=p.minSliderValue,m=p.maxSliderValue;return new w({max:m,min:d,stops:[{value:a.minDataValue,size:n},{value:a.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:o,bins:s?s.bins:[]}})}updateFromRendererResult(e,s){const{visualVariables:i,statistics:t}=e,{avg:r,stddev:o}=t,a=i[0],[l,n]=c(a),p=e.renderer.authoringInfo.visualVariables[0],d=p.minSliderValue,m=p.maxSliderValue;this.set({max:m,min:d,stops:[{value:a.minDataValue,size:n},{value:a.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:o,bins:s?s.bins:[]}})}updateVisualVariable(e){const s=e.clone(),{stops:i}=this;if(!e||!i)return null;if(s.stops)return s.stops=i,s;const t=i[0],r=i[i.length-1];let o=s.maxSize,a=s.minSize;if(o instanceof n){const e=o.stops,s=r.size/e[0].size,i=e.map((e=>(e.size*=s,e)));o.stops=i}else o=r.size;if(a instanceof n){const e=a.stops,s=t.size/e[0].size,i=e.map((e=>(e.size*=s,e)));a.stops=i}else a=t.size;return s.set({maxDataValue:r.value,minDataValue:t.value,maxSize:o,minSize:a}),s}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:s,minDataValue:i,stops:t}=e;if(t)this.stops=t;else{const[t,r]=c(e);this.stops=[new l({value:i,size:r}),new l({value:s,size:t})]}}render(){const{state:e,label:s}=this,i="disabled"===e,t=this.classes(b,j,x,{[M]:i});return u("div",{"aria-label":s,class:t},i?null:this.renderContent(this.renderRamp(),y,V))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:s}=this;return u("div",{afterCreate:p,bind:this,class:S,"data-node-ref":"_rampNode"},u("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},u("rect",{x:"0",y:"0",fill:h(e),height:"100%",width:"100%"}),this.renderPath()),s?this.renderZoomCaps():null)}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:i=0}=this._rampNode;if(!s(e)||!s(i))return;const{primaryHandleEnabled:t,stops:r,style:{trackFillColor:o},values:a,viewModel:{max:l,min:n},_maxRampFillWidth:p,_minRampFillWidth:d}=this,m=[p,d];r[0].size<r[r.length-1].size&&m.reverse();const[c,g]=m,[z,w]=a,b=t?v({max:l,min:n,pathHeight:e,pathWidth:i,stops:r,padding:g}):f({bottomValue:z,bottomWidth:c,max:l,min:n,pathHeight:e,pathWidth:i,topValue:w,topWidth:g});return u("path",{d:b,fill:h(o)})}};e([t("viewModel.handlesSyncedToPrimary")],F.prototype,"handlesSyncedToPrimary",void 0),e([i({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],F.prototype,"label",void 0),e([i(),m(),d("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],F.prototype,"messages",void 0),e([t("viewModel.primaryHandleEnabled")],F.prototype,"primaryHandleEnabled",void 0),e([t("viewModel.stops")],F.prototype,"stops",void 0),e([i(),m()],F.prototype,"style",void 0),e([r("style")],F.prototype,"castStyle",null),e([i(),m(["viewModel.hasTimeData","viewModel.inputFormatFunction","viewModel.inputParseFunction","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.stops","viewModel.values","viewModel.zoomOptions"])],F.prototype,"viewModel",void 0),e([t("viewModel.zoomOptions")],F.prototype,"zoomOptions",void 0),F=w=e([o("esri.widgets.smartMapping.SizeSlider")],F);var D=F;export default D;
