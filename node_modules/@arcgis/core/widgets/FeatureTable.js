/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{aliasOf as l}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as s}from"../core/accessorSupport/decorators/cast.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import o from"../core/Collection.js";import{onLocaleChange as r}from"../intl/locale.js";import{substitute as n}from"../intl/substitute.js";import{fetchMessageBundle as a}from"../intl/messages.js";import"../intl.js";import{on as d,watch as u}from"../core/watchUtils.js";import{HandleOwnerMixin as c}from"../core/HandleOwner.js";import"./support/widgetUtils.js";import{messageBundle as m}from"./support/decorators/messageBundle.js";import{renderable as h}from"./support/decorators/renderable.js";import{j as p}from"../chunks/index.js";import v from"./Widget.js";import g from"./FeatureTable/Grid/support/ButtonMenuItem.js";import w from"./FeatureTable/Grid/support/ButtonMenu.js";import b from"./FeatureTable/FeatureTableViewModel.js";const f={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0},selectionColumn:!0},M="esri-feature-table",_="esri-feature-table__header",y="esri-feature-table__title",C="esri-feature-table__content",E="esri-feature-table__loader",j="esri-feature-table__loader-container",I="esri-feature-table__menu",S="esri-icon-handle-horizontal",F="esri-icon-down",R="esri-icon-right",T="esri-icon-check-mark",k="esri-widget";let H=class extends(c(v)){constructor(e,t){super(e,t),this._menu=null,this.attachmentsEnabled=null,this.columns=new o,this.editingEnabled=null,this.fieldConfigs=null,this.grid=null,this.highlightOnRowSelectEnabled=!0,this.label=void 0,this.layer=null,this.messages=null,this.menuConfig=null,this.view=null,this.viewModel=new b,this.visibleElements={...f}}initialize(){var e,t,l;const s=async()=>this.messages=await a("esri/widgets/FeatureTable/t9n/FeatureTable");s(),this.handles.add([r(s),d(this,"grid.selectedItems","change",(e=>this._onSelectionChange(e))),u(this,["viewModel.store.querying","viewModel.store.syncing","grid.size"],(()=>this.scheduleRender())),d(this,"viewModel.columns","change",(()=>this._updateMenuItems())),u(this,"menuConfig",(()=>this._updateMenuItems())),u(this,"messages",(()=>{var e;this._menu.label=null==(e=this.messages)?void 0:e.options,this._updateMenuItems()}))]),this._menu=new w({label:null==(e=this.messages)?void 0:e.options,iconClass:S,...this.menuConfig});const{attachmentsEnabled:i,relatedRecordsEnabled:o}=this;null==(t=this.viewModel)||null==(l=t.store)||l.set({attachmentsEnabled:i,relatedRecordsEnabled:o})}destroy(){this.clearSelection(),this.handles.removeAll()}castVisibleElements(e){var t;const l={...f,...e};return null==(t=this.grid)||t.set("visibleElements",{...this.grid.visibleElements,selectionColumn:l.selectionColumn}),l}clearHighlights(){}clearSelection(){}deselectRows(){}hideColumn(e){var t;null==(t=this.grid)||t.hideColumn(e),this._updateMenuItems()}refresh(){}showColumn(e){var t;null==(t=this.grid)||t.showColumn(e),this._updateMenuItems()}sortColumn(){}selectRows(){}render(){var e;return p("div",{bind:this,class:this.classes(M,k)},this.visibleElements.header?this._renderHeader():null,p("div",{class:C},"disabled"!==this.state&&(null==(e=this.grid)?void 0:e.render())))}_renderHeader(){return p("div",{key:"header",class:_},this._renderLoader(),this._renderTitle(),this._renderMenu())}_renderTitle(){return p("div",{class:y,key:"title"},this._getTitle())}_getTitle(){const{grid:e,layer:{title:t},messages:l,viewModel:{size:s}}=this;return e?n(l.header,{title:t,count:s,selected:e.selectedItems.length||0}):""}_renderLoader(){const{state:e,store:t}=this.viewModel,l="loading"===e||t.syncing||t.querying;return p("div",{class:j},l?p("div",{class:E,key:"loader"}):null)}_renderMenu(){return p("div",{class:I},this._menu.render())}_onSelectionChange(e){const{added:t,removed:l}=e;this.emit("selection-change",{added:[...t],removed:[...l]})}_updateMenuItems(){var e,t;const l=null==(e=this.menuConfig)?void 0:e.items,s=this._getDefaultMenuItems(),i=[];(null==s?void 0:s.length)&&i.push(...s),(null==l?void 0:l.length)&&i.push(...l),i.length&&(null==(t=this._menu)||t.set("items",i))}_getDefaultMenuItems(){var e;const{messages:t,viewModel:l,visibleElements:s}=this,{menuItems:i}=s,o=[];return(null==i?void 0:i.clearSelection)&&o.push(new g({selectionEnabled:!1,label:null==t?void 0:t.clearSelection,clickFunction:()=>this.clearSelection()})),(null==i?void 0:i.refreshData)&&o.push(new g({selectionEnabled:!1,label:null==t?void 0:t.refreshData,clickFunction:()=>this.refresh()})),(null==i?void 0:i.toggleColumns)&&o.push(new g({iconClass:R,label:null==t?void 0:t.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:null==l||null==(e=l.columns)?void 0:e.items.map((({header:e,hidden:t,path:l})=>new g({label:e||l,selected:!t,selectionEnabled:!0,iconClass:T,clickFunction:()=>this._toggleColumnFromMenuItem(l)})))})),o.length?o:null}_toggleMenuItemSelectedIcon({item:e}){null==e||e.set("iconClass",null!=e&&e.selected?F:R)}_toggleColumnFromMenuItem(e){var t;const l=null==(t=this.viewModel)?void 0:t.findColumn(e);null!=l&&l.hidden?this.showColumn(e):this.hideColumn(e)}};e([l("viewModel.attachmentsEnabled")],H.prototype,"attachmentsEnabled",void 0),e([l("viewModel.columns")],H.prototype,"columns",void 0),e([l("viewModel.editingEnabled")],H.prototype,"editingEnabled",void 0),e([l("viewModel.fieldConfigs")],H.prototype,"fieldConfigs",void 0),e([l("viewModel.grid")],H.prototype,"grid",void 0),e([l("viewModel.highlightOnRowSelectEnabled")],H.prototype,"highlightOnRowSelectEnabled",void 0),e([t({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],H.prototype,"label",void 0),e([l("viewModel.layer")],H.prototype,"layer",void 0),e([t(),h(),m("esri/widgets/FeatureTable/t9n/FeatureTable")],H.prototype,"messages",void 0),e([t()],H.prototype,"menuConfig",void 0),e([l("viewModel.relatedRecordsEnabled")],H.prototype,"relatedRecordsEnabled",void 0),e([l("viewModel.state")],H.prototype,"state",void 0),e([l("viewModel.view")],H.prototype,"view",void 0),e([t(),h(["viewModel.attachmentsEnabled","viewModel.columns","viewModel.editingEnabled","viewModel.layer","viewModel.relatedRecordsEnabled","viewModel.state"])],H.prototype,"viewModel",void 0),e([t(),h()],H.prototype,"visibleElements",void 0),e([s("visibleElements")],H.prototype,"castVisibleElements",null),e([l("viewModel.clearHighlights")],H.prototype,"clearHighlights",null),e([l("viewModel.clearSelection")],H.prototype,"clearSelection",null),e([l("viewModel.deselectRows")],H.prototype,"deselectRows",null),e([l("viewModel.refresh")],H.prototype,"refresh",null),e([l("viewModel.sortColumn")],H.prototype,"sortColumn",null),e([l("viewModel.selectRows")],H.prototype,"selectRows",null),H=e([i("esri.widgets.FeatureTable")],H);var O=H;export default O;
