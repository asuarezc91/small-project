/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import t from"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{ignoreAbortErrors as i}from"../../core/promiseUtils.js";import o from"../../core/Handles.js";import{init as n}from"../../core/watchUtils.js";import{measurementAreaUnits as l}from"../../core/unitUtils.js";import{defaultUnitPropertyMetadata as a}from"../support/commonProperties.js";import{InteractiveToolViewModel as u}from"../support/InteractiveToolViewModel.js";import d from"../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool.js";const m=t.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let p=class extends u{constructor(e){super(e),this.supportedViewType="3d",this._handles=new o,this._userUnitOptions=null,this._userUnit=null,this.tool=null}initialize(){this._handles.add([n(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get measurement(){if(!this.tool||this.isDisabled)return null;const e=this.tool.model,t=e.measurementMode,r=e.measurementData,s=e.validMeasurement,i=0===("euclidean"===t?r.intersectingSegments:r.geodesicIntersectingSegments).size,o=i?s?"available":"unavailable":"invalid";return{mode:t,area:{text:i&&s?e.areaLabel:null,state:o},perimeterLength:{text:i&&s?e.perimeterLengthLabel:null,state:o}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}newMeasurement(){i(this.start())}clearMeasurement(){this.clear()}createToolParams(){return{toolConstructor:d,constructorArguments:()=>({unit:this.unit})}}logUnsupportedError(){m.error("AreaMeasurement3D widget is not implemented for MapView")}logError(...e){m.error(...e)}_findSelectableUnit(e,t){const r=this.unitOptions;return-1!==r.indexOf(e)?e:t?this._findSelectableUnit(t):r[0]}_filteredOrAllUnits(e){if(!e)return l.slice();const t=e.filter((e=>-1!==l.indexOf(e)));return 0===t.length?l.slice():t}};e([r({readOnly:!0,dependsOn:["isDisabled","tool.state"]})],p.prototype,"state",null),e([r({readOnly:!0,dependsOn:["view.ready","tool.model.area","tool.model.geodesicArea","tool.model.areaLabel","tool.model.perimeterLength","tool.model.geodesicPerimeterLength","tool.model.perimeterLengthLabel","tool.model.measurementMode","tool.model.measurementData"]})],p.prototype,"measurement",null),e([r({constructOnly:!0})],p.prototype,"tool",void 0),e([r(a)],p.prototype,"defaultUnit",void 0),e([r({dependsOn:["view.spatialReference"]})],p.prototype,"unitOptions",null),e([r({dependsOn:["unitOptions","defaultUnit"]})],p.prototype,"unit",null),e([r()],p.prototype,"clearMeasurement",null),p=e([s("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],p);var c=p;export default c;
