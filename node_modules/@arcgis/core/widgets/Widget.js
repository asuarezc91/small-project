/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import t from"../core/Logger.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{cast as s}from"../core/accessorSupport/decorators/cast.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{debounce as i,isAbortError as n,eachAlways as a}from"../core/promiseUtils.js";import l from"../core/Evented.js";import d from"../core/Collection.js";import{onLocaleChange as c}from"../intl/locale.js";import{fetchMessageBundle as h}from"../intl/messages.js";import"../intl.js";import{EsriPromiseMixin as p}from"../core/Promise.js";import m from"../core/Handles.js";import{init as u,whenOnce as _}from"../core/watchUtils.js";import{byId as g}from"../core/domUtils.js";import{classes as j}from"./support/widgetUtils.js";import"../libs/maquette/projection.js";import{createProjector as y}from"../libs/maquette/projector.js";const f=t.getLogger("esri.widgets.Widget");let v=0;const w="esri-icon-checkbox-unchecked",b=y();let C=class extends(p(l.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new m,this._projector=b,this.domNode=null,this.iconClass=w,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this._loadLocale=i((async()=>{this._messageBundleProps&&this._messageBundleProps.length&&await a(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{this[t]=await h(e)}))).then((e=>{for(const t of e)t.error&&f.error("widget-intl:locale-error",this.declaredClass,t.error)})),await this.loadLocale()}));const r="esri-widget-uid-"+Date.now().toString(16),s=this.render.bind(this);let o=!1;this.render=()=>{if(!o||this.destroyed)return null;const e=s();return e.properties?e.properties.key||(e.properties.key=r):e.properties={key:r},e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{o=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch((e=>{if(!n(e))throw e}))}async loadLocale(){}destroy(){this.destroyed||(this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return g(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+v++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return j.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e,t;this.destroyed||(null!=(e=this._renderableProps)&&e.length&&this._internalHandles.add(this._renderableProps.map((e=>u(this,e,(function(t,r){if(d.isCollection(r)&&this._internalHandles.remove(`${this.declaredClass}:${e}-collection-change-event-listener`),d.isCollection(t)){const r=t.on("change",(()=>this.scheduleRender()));this._internalHandles.add(r,`${this.declaredClass}:${e}-collection-change-event-listener`)}this.scheduleRender()}))))),null!=(t=this._delegatedEventNames)&&t.length&&this._internalHandles.add(u(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(c((async()=>{await this._loadLocale().catch((e=>{if(!n(e))throw e})),this.scheduleRender()}))),this._internalHandles.add(_(this,"container",(async e=>{this.destroyed||this._attach(e)}))))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};e([r({value:null})],C.prototype,"container",null),e([s("container")],C.prototype,"castContainer",null),e([r({aliasOf:"container"})],C.prototype,"domNode",void 0),e([r()],C.prototype,"iconClass",void 0),e([r({dependsOn:["container"]})],C.prototype,"id",null),e([r()],C.prototype,"label",void 0),e([r()],C.prototype,"renderable",null),e([r()],C.prototype,"viewModel",void 0),e([r()],C.prototype,"visible",void 0),C=e([o("esri.widgets.Widget")],C);var H=C;export default H;
