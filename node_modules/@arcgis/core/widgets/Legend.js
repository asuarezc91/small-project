/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as t}from"../core/accessorSupport/decorators/cast.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import i from"../core/Handles.js";import{on as n,init as a}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as d}from"./support/decorators/messageBundle.js";import{renderable as l}from"./support/decorators/renderable.js";import{j as p}from"../chunks/index.js";import c from"./Widget.js";import h from"./Legend/LegendViewModel.js";import y from"./Legend/styles/Card.js";import v from"./Legend/styles/Classic.js";const f="esri-legend",m="esri-widget",u="esri-widget--panel",g="esri-icon-layer-list";let w=class extends c{constructor(e,s){super(e,s),this._handles=new i,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=g,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new v,this.view=null,this.viewModel=new h}initialize(){this.own(n(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),a(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof y||e instanceof v)return e;if("string"==typeof e)return"card"===e?new y:new v;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?y:v)(s)}return new v}render(){return p("div",{class:this.classes(f,m,this.style instanceof v?u:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=a(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const r=n(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(r,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([r("viewModel.activeLayerInfos"),l()],w.prototype,"activeLayerInfos",void 0),e([r("viewModel.basemapLegendVisible"),l()],w.prototype,"basemapLegendVisible",void 0),e([r("viewModel.groundLegendVisible"),l()],w.prototype,"groundLegendVisible",void 0),e([r("viewModel.keepCacheOnDestroy")],w.prototype,"keepCacheOnDestroy",void 0),e([r("viewModel.respectLayerVisibility"),l()],w.prototype,"respectLayerVisibility",void 0),e([s()],w.prototype,"iconClass",void 0),e([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],w.prototype,"label",void 0),e([r("viewModel.layerInfos"),l()],w.prototype,"layerInfos",void 0),e([s(),l(),d("esri/widgets/Legend/t9n/Legend")],w.prototype,"messages",void 0),e([s(),l()],w.prototype,"style",void 0),e([t("style")],w.prototype,"castStyle",null),e([r("viewModel.view"),l()],w.prototype,"view",void 0),e([s(),l(["view.size"])],w.prototype,"viewModel",void 0),w=e([o("esri.widgets.Legend")],w);var L=w;export default L;
