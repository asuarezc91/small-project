/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as t}from"../../core/maybe.js";import i from"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{ignoreAbortErrors as o}from"../../core/promiseUtils.js";import n from"../../core/Handles.js";import{init as l}from"../../core/watchUtils.js";import{measurementLengthUnits as a}from"../../core/unitUtils.js";import{defaultUnitPropertyMetadata as u}from"../support/commonProperties.js";import{InteractiveToolViewModel as d}from"../support/InteractiveToolViewModel.js";import m from"../../views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DTool.js";const p=i.getLogger("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel");let c=class extends d{constructor(e){super(e),this.supportedViewType="3d",this._handles=new n,this._userUnitOptions=null,this._userUnit=null}initialize(){this._handles.add([l(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])}destroy(){this._handles.destroy(),this._handles=null}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get measurement(){if(!this.tool)return null;const e=this.tool.model,i=e.measurementMode,r="geodesic"===i,s=t(e.model.measurement),o=this.tool.directLineMeasurementView;return{mode:i,directDistance:{text:r?null:o.directLabelText,state:s&&!r?"available":"unavailable"},horizontalDistance:{text:o.horizontalLabelText,state:s?"available":"unavailable"},verticalDistance:{text:o.verticalLabelText,state:s?"available":"unavailable"}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}start(){return this.createTool()}clear(){this.removeTool()}newMeasurement(){o(this.start())}clearMeasurement(){this.clear()}createToolParams(){return{toolConstructor:m,constructorArguments:()=>({unit:this.unit})}}logUnsupportedError(){p.error("DirectLineMeasurement3D widget is not implemented for MapView")}logError(...e){p.error(...e)}_findSelectableUnit(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if(!e)return a.slice();const t=e.filter((e=>-1!==a.indexOf(e)));return 0===t.length?a.slice():t}};e([r({dependsOn:["isDisabled","tool.state"],readOnly:!0})],c.prototype,"state",null),e([r({dependsOn:["view.ready","unit","tool.model.messages","tool.model.startPoint","tool.model.endPoint","tool.directLineMeasurementView.triangleCollapseRatioThreshold","tool.model.model.measurement","tool.model.measurementMode"],readOnly:!0})],c.prototype,"measurement",null),e([r()],c.prototype,"tool",void 0),e([r(u)],c.prototype,"defaultUnit",void 0),e([r({dependsOn:["view.spatialReference"]})],c.prototype,"unitOptions",null),e([r({dependsOn:["unitOptions","defaultUnit"]})],c.prototype,"unit",null),c=e([s("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],c);var h=c;export default h;
