/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/has.js";import i from"../core/Logger.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as n}from"../core/accessorSupport/decorators/cast.js";import{deprecatedProperty as a}from"../core/deprecate.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{eventKey as o}from"../core/events.js";import d from"../core/Collection.js";import{on as c,init as m}from"../core/watchUtils.js";import{HandleOwnerMixin as h}from"../core/HandleOwner.js";import"./support/widgetUtils.js";import{accessibleHandler as u}from"./support/decorators/accessibleHandler.js";import{messageBundle as p}from"./support/decorators/messageBundle.js";import{renderable as g}from"./support/decorators/renderable.js";import{vmEvent as b}from"./support/decorators/vmEvent.js";import{j as _}from"../chunks/index.js";import y from"./Widget.js";import f from"sortablejs";import{findSelectedItem as v}from"./LayerList/support/layerListUtils.js";import I from"./LayerList/ListItem.js";import L from"./BasemapLayerList/BasemapLayerListViewModel.js";const w=d.ofType(I);function A(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const E="esri-basemap-layer-list esri-widget esri-widget--panel",T="esri-basemap-layer-list--new-ui",C="esri-basemap-layer-list__title-container",S="esri-basemap-layer-list__main-heading",k="esri-basemap-layer-list__editing-card",B="esri-basemap-layer-list__editing-input",x="esri-basemap-layer-list__editing-actions",R="esri-basemap-layer-list__edit-button",O="esri-basemap-layer-list__edit-button-icon",M="esri-basemap-layer-list__no-items",j="esri-basemap-layer-list__hr",U="esri-basemap-layer-list__list-heading",N="esri-basemap-layer-list__list",$="esri-basemap-layer-list__list--root",V="esri-basemap-layer-list__list--exclusive",P="esri-basemap-layer-list__list--inherited",F="esri-basemap-layer-list__list--independent",H="esri-basemap-layer-list__item",K="esri-basemap-layer-list__item--only-child",D="esri-basemap-layer-list__item--error",z="esri-basemap-layer-list__item--invisible",W="esri-basemap-layer-list__item--invisible-at-scale",q="esri-basemap-layer-list__item--updating",G="esri-basemap-layer-list__item--has-children",J="esri-basemap-layer-list__item--selectable",Q="esri-basemap-layer-list__item-container",X="esri-basemap-layer-list__item-actions-menu",Y="esri-basemap-layer-list__item-actions-menu-item",Z="esri-basemap-layer-list__item-actions-menu-item--active",ee="esri-basemap-layer-list__item-actions",te="esri-basemap-layer-list__item-actions-list",ie="esri-basemap-layer-list__item-action",se="esri-basemap-layer-list__item-action-icon",re="esri-basemap-layer-list__item-action-image",ne="esri-basemap-layer-list__item-action-title",ae="esri-basemap-layer-list__action-toggle",le="esri-basemap-layer-list__action-toggle--on",oe="esri-basemap-layer-list__item-label",de="esri-basemap-layer-list__item-error-message",ce="esri-basemap-layer-list__item-title",me="esri-basemap-layer-list__item-toggle",he="esri-basemap-layer-list__item-toggle-icon",ue="esri-basemap-layer-list__item-toggle-icon",pe="esri-basemap-layer-list__item-radio-icon",ge="esri-basemap-layer-list__child-toggle",be="esri-basemap-layer-list__child-toggle--open",_e="esri-basemap-layer-list__child-toggle-icon--opened",ye="esri-basemap-layer-list__child-toggle-icon--closed",fe="esri-basemap-layer-list__child-toggle-icon--closed-rtl",ve="esri-basemap-layer-list--chosen",Ie="esri-button",Le="esri-button--tertiary",we="esri-input",Ae="esri-disabled",Ee="esri-disabled-element",Te="esri-hidden",Ce="esri-rotating",Se="esri-widget__heading",ke="esri-icon-edit",Be="esri-icon-handle-horizontal",xe="esri-icon-visible",Re="esri-icon-non-visible",Oe="esri-icon-radio-checked",Me="esri-icon-radio-unchecked",je="esri-icon-notice-triangle",Ue="esri-icon-down-arrow",Ne="esri-icon-right-triangle-arrow",$e="esri-icon-left-triangle-arrow",Ve="esri-icon-loading-indicator",Pe="esri-icon-default-action",Fe="esri-icon-layers",He="base-items",Ke="reference-items",De={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function ze(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>ze(e)))}const We=i.getLogger("esri.widgets.BasemapLayerList"),qe={baseLayers:!0,referenceLayers:!0,statusIndicators:!0};let Ge=class extends(h(y)){constructor(e,i){super(e,i),this._editingTitle=!1,this._editTitleInput=null,this._editTitleButton=null,this._focusOnElement=null,this._sortableBaseLayers=null,this._sortableReferenceLayers=null,this._sortableBaseLayersNode=null,this._sortableReferenceLayersNode=null,this._focusSortUid=null,this._newUI=t("esri-basemaplayerlist-new-ui"),this.basemapTitle=null,this.baseListItemCreatedFunction=null,this.editingEnabled=!1,this.iconClass=Fe,this.label=void 0,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.referenceListItemCreatedFunction=null,this.baseItems=null,this.referenceItems=null,this.selectedItems=new w,this.view=null,this.viewModel=new L,this.visibleElements={...qe}}initialize(){const{baseItems:e,referenceItems:t}=this;this.own([c(this,"baseItems","change",(()=>{this._itemsChanged(e,He),this._toggleSortingBaseLayers()})),c(this,"referenceItems","change",(()=>this._itemsChanged(t,Ke))),m(this,"editingEnabled",(()=>this._toggleSorting()))])}destroy(){this._destroyBaseSortable(),this._destroyReferenceSortable()}set statusIndicatorsVisible(e){a(We,"statusIndicatorsVisible",{replacement:"visibleElements.statusIndicators",version:"4.15"}),this.visibleElements={...this.visibleElements,statusIndicators:e}}castVisibleElements(e){return{...qe,...e}}triggerAction(e,t){this.viewModel.triggerAction(e,t)}render(){const{state:e}=this.viewModel,t={[T]:this._newUI,[Te]:"loading"===e,[Ae]:"disabled"===e},i=this.renderReferenceSection(),s=this.renderBaseSection(),r=i&&s?_("hr",{class:j}):null;return _("div",{class:this.classes(E,t)},this.renderTitleContainer(),i,r,s)}renderEditingInput(){const{messages:e}=this,{basemapTitle:t}=this.viewModel;return _("label",{class:B},e.basemapTitle,_("input",{bind:this,class:we,title:e.basemapTitle,"aria-label":e.basemapTitle,placeholder:e.basemapTitle,type:"text",role:"textbox",value:t,afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement}))}renderCancelButton(){const{messagesCommon:e}=this;return _("button",{title:e.cancel,"aria-label":e.cancel,type:"button",bind:this,class:this.classes(Ie,Le),onclick:this._toggleEditingTitle},e.cancel)}renderSubmitButton(){const{messagesCommon:e}=this;return _("button",{title:e.form.submit,"aria-label":e.form.submit,type:"button",bind:this,class:Ie,onclick:this._formSubmit},e.form.ok)}renderEditingForm(){return _("div",{class:k},_("form",{bind:this,onsubmit:this._formSubmit},this.renderEditingInput(),_("div",{class:x},this.renderCancelButton(),this.renderSubmitButton())))}renderBasemapTitle(){const{basemapTitle:e}=this.viewModel;return _("h2",{class:this.classes(Se,S)},e)}renderEditTitleButton(){const{_editingTitle:e,editingEnabled:t,messagesCommon:i}=this;return t&&!e?_("button",{bind:this,class:R,title:i.edit,"aria-label":i.edit,onclick:this._toggleEditingTitle,afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"data-node-ref":"_editButtonNode"},_("span",{"aria-hidden":"true",class:this.classes(ke,O)})):null}renderTitleContainer(){return _("div",{class:C},this._editingTitle?this.renderEditingForm():this.renderBasemapTitle(),this.renderEditTitleButton())}renderNoLayersInfo(e,t){return _("div",{key:t,class:M},e)}renderList(e,t){const{messages:i}=this,s="reference"===t?this._destroyReferenceSortable:this._destroyBaseSortable;return _("ul",{key:t,"aria-label":i.widgetLabel,role:this.editingEnabled&&e.length?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:s,"data-node-ref":t,bind:this,class:this.classes(N,$,F)},e.map((i=>this.renderItem({item:i,parent:null,itemType:t,isOnlyChild:1===e.length}))))}renderBaseHeader(){return _("h3",{key:"base-heading",class:this.classes(Se,U)},this.messages.baseHeading)}renderBaseSection(){const{baseItems:e,messages:t,visibleElements:i}=this;if(!i.baseLayers)return null;const s=this._getItems(e),r="base";return[this.renderBaseHeader(),[0===s.length?this.renderNoLayersInfo(t.noBaseLayers,r):null,this.renderList(s,r)]]}renderReferenceHeader(){return _("h3",{key:"reference-heading",class:this.classes(Se,U)},this.messages.referenceHeading)}renderReferenceSection(){const{referenceItems:e,messages:t,visibleElements:i}=this;if(!i.referenceLayers)return null;const s=this._getItems(e),r="reference";return[this.renderReferenceHeader(),[0===s.length?this.renderNoLayersInfo(t.noReferenceLayers,r):null,this.renderList(s,r)]]}renderChildrenToggle(e,t){const{messagesCommon:i}=this,{children:s}=e,r=!!e.error,n=!!s.length&&!r,a={[be]:e.open},l=e.open?i.collapse:i.expand;return n?_("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(ge,a),tabindex:"0",role:"button","aria-controls":t,"aria-label":l,title:l},_("span",{"aria-hidden":"true",class:this.classes(ye,Ne)}),_("span",{"aria-hidden":"true",class:this.classes(_e,Ue)}),_("span",{"aria-hidden":"true",class:this.classes(fe,$e)})):null}renderError(e){return e.error?_("div",{key:"error",class:de,role:"alert"},_("span",null,this.messages.layerError)):null}renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[Z]:e.actionsOpen},r=e.actionsOpen?i.close:i.open;return _("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(Y,s),tabindex:"0",role:"button","aria-controls":t,"aria-label":r,title:r},_("span",{"aria-hidden":"true",class:Be}))}renderActionsMenu(e,t,i,s){const{panel:r}=e,n=r&&r.visible?this.renderPanelButton(r):null,a=1===i&&this._getSingleActionButton(t),l=a?this.renderAction({item:e,action:a,singleAction:!0}):null,o=!a&&i?this.renderActionsMenuIcon(e,s):null;return o||n||a?_("div",{key:"actions-menu",class:X},n,l,o):null}renderChildList(e,t){const{editingEnabled:i}=this,{visibilityMode:s,children:r}=e,n=!!e.error,a=!!r.length&&!n,{exclusive:l,inherited:o}=De,d={[V]:s===l,[P]:s===o,[F]:s!==o&&s!==l};return a?_("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,class:this.classes(N,d),"aria-expanded":e.open?"true":"false",role:i?"listbox":s===l?"radiogroup":"group",hidden:!e.open||null},null==r?void 0:r.map((t=>this.renderItem({item:t,parent:e}))).toArray()):null}renderItemContent(e,t,i){const{id:s}=this,r=`${s}_${e.uid}`,n=`${r}_actions`,a=`${r}__list`,{panel:l}=e,o=this._filterActions(e.actionsSections),d=this._countActions(o);return[_("div",{key:"list-item-container",class:Q},this.renderChildrenToggle(e,a),this.renderLabel(e,t,i),this.renderActionsMenu(e,o,d,n)),this.renderError(e),d?this.renderActionsSections(e,o,n):null,l&&l.open?l.render():null,this.renderChildList(e,a)]}renderItem({item:e,parent:t,itemType:i,isOnlyChild:s}){const{_newUI:r,id:n,editingEnabled:a,selectedItems:l,visibleElements:o}=this,{children:d}=e,c=`${`${n}_${e.uid}`}__title`,m=!!e.error,h=!!d.length&&!m,u={[G]:h,[D]:!!m,[q]:e.updating&&!t&&o.statusIndicators,[z]:r&&!e.visible,[W]:!e.visibleAtCurrentScale,[J]:a};if(a){var p;const r={"data-layer-uid":null==(p=e.layer)?void 0:p.uid};return _("li",Object.assign({key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(H,u,{[K]:s}),"aria-labelledby":c,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item-type":i,"data-item":e,tabIndex:0,"aria-selected":v(e,l)?"true":"false",role:"option"},r),this.renderItemContent(e,t,c))}return _("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(H,u),"aria-labelledby":c},this.renderItemContent(e,t,c))}renderItemTitle(e,t){const{messages:i}=this,s=e.title||i.untitledLayer,r=e.visibleAtCurrentScale?s:`${s} (${i.layerInvisibleAtScale})`;return _("span",{key:"layer-title-container",id:t,title:r,"aria-label":r,class:ce},s)}renderItemToggleIcon(e,t){const{_newUI:i}=this,{exclusive:s}=De,r=t&&t.visibilityMode,n={[he]:i,[ue]:i&&r!==s,[pe]:i&&r===s,[Oe]:r===s&&e.visible,[Me]:r===s&&!e.visible,[xe]:r!==s&&e.visible,[Re]:r!==s&&!e.visible};return _("span",{key:"item-toggle-icon",class:this.classes(n),"aria-hidden":"true"})}renderItemToggle(e,t,i){const{editingEnabled:s}=this,{exclusive:r}=De,n=t&&t.visibilityMode,a=n===r?"radio":"switch";return _("span",s?{key:"item-toggle-selection-enabled",class:me,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":n,tabIndex:0,"aria-checked":e.visible?"true":"false",role:a,"aria-labelledby":i}:{key:"item-toggle",class:me},this.renderItemToggleIcon(e,t))}renderItemError(e){return e.error?_("span",{key:"notice-triangle","aria-hidden":"true",class:je}):null}renderLabel(e,t,i){const{editingEnabled:s,_newUI:r}=this,{inherited:n,exclusive:a}=De,l=null==t?void 0:t.visibilityMode,o=l===a?"radio":"switch",d=[this.renderItemToggle(e,t,i),this.renderItemTitle(e,i)];r&&d.reverse();const c=_("div",s?{key:`item-label-no-selection-${e.uid}`,class:oe}:{key:`item-label-with-selection-${e.uid}`,class:oe,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,"aria-checked":e.visible?"true":"false",role:o,"aria-labelledby":i},d);return l===n||e.error?_("div",{key:`item-label-container-${e.uid}`,class:oe},this.renderItemError(e),this.renderItemTitle(e,i)):c}renderPanelButton(e){const{className:t,open:i,title:s,image:r}=e,n=r||t?t:Pe,a=this._getIconImageStyles(e),l={[Z]:i},o={[re]:!!a["background-image"]};return n&&(o[n]=!!n),_("div",{key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(Y,l),role:"button",tabindex:"0",title:s,"aria-label":s},_("span",{class:this.classes(o),styles:a}))}renderActionsSections(e,t,i){const s=t.toArray().map(((t,i)=>_("ul",{key:`${e}-action-section-${i}`,class:te},this.renderActionSection(e,t))));return _("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:ee,hidden:!e.actionsOpen||null},s)}renderActionSection(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))}renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),r="button"!==e.type||e.image||i?i:Pe,n={[re]:!t&&!!s["background-image"],[Ve]:t,[Ce]:t};return r&&!t&&(n[r]=!0),_("span",{key:"action-icon","aria-hidden":"true",class:this.classes(se,n),styles:s})}renderActionTitle(e,t){return t?null:_("span",{key:"action-title",class:ne},e)}renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:r,disabled:n,title:a}=i,l={[Y]:s&&"button"===i.type,[ie]:r||!s&&"toggle"!==i.type,[ae]:!r&&"toggle"===i.type,[le]:!r&&"toggle"===i.type&&i.value,[Ee]:n},o=[this.renderActionIcon(i),this.renderActionTitle(a,s)];return s?_("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:l,tabindex:"0",title:a,"aria-label":a},o):_("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:l,tabindex:"0",role:"button",title:a,"aria-label":a},o)}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_destroyReferenceSortable(){const{_sortableReferenceLayers:e}=this;(null==e?void 0:e.el)&&e.destroy(),this._sortableReferenceLayersNode=null}_destroyBaseSortable(){const{_sortableBaseLayers:e}=this;(null==e?void 0:e.el)&&e.destroy(),this._sortableBaseLayersNode=null}_toggleEditingTitle(){const{_editingTitle:e}=this,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()}_storeEditTitleInput(e){this._editTitleInput=e,this._focusEditElement()}_focusEditElement(){this._editTitleInput&&"edit-input"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&"edit-button"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleButton.focus())}_storeEditTitleButton(e){this._editTitleButton=e,this._focusEditElement()}_formSubmit(e){e.preventDefault();const{_editTitleInput:t}=this;t&&(this.basemapTitle=t.value),this._toggleEditingTitle()}_itemMovedList(e){const t=e.item["data-item"],i=e.to.dataset.nodeRef,s=e.from.dataset.nodeRef,{newIndex:r}=e;this.viewModel.transferListItem({listItem:t,from:s,to:i,newIndex:r})}_toggleSortingBaseLayers(){const{_sortableBaseLayers:e,_sortableBaseLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const e=f.create(t,{dataIdAttr:"data-layer-uid",group:"root-layers",filter:`.${K}`,fallbackTolerance:4,disabled:s,onSort:()=>this._sortLayersToItems({type:"base",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:ve});this._sortableBaseLayers=e}}_toggleSortingReferenceLayers(){const{_sortableReferenceLayers:e,_sortableReferenceLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const e=f.create(t,{dataIdAttr:"data-layer-uid",group:"root-layers",disabled:s,fallbackTolerance:4,onSort:()=>this._sortLayersToItems({type:"reference",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:ve});this._sortableReferenceLayers=e}}_toggleSorting(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()}_sortNodeCreated(e){const t=e.getAttribute("data-node-ref");"base"===t&&(this._sortableBaseLayersNode=e),"reference"===t&&(this._sortableReferenceLayersNode=e),this._toggleSorting()}_getItems(e){return e.toArray().filter((e=>this.errorsVisible||!e.error))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).getItemAt(0)}_sortLayersToItems({type:e,itemIds:t}){const i="base"===e?this.get("view.map.basemap.baseLayers"):"reference"===e?this.get("view.map.basemap.referenceLayers"):null;i&&i.sort(((e,i)=>{const s=t.indexOf(e.uid),r=t.indexOf(i.uid);return s>r?-1:s<r?1:0}))}_focusListItem(e){var t;const{_focusSortUid:i}=this;if(!e||!i)return;(null==(t=e["data-item"].layer)?void 0:t.uid)===i&&(e.focus(),this._focusSortUid=null)}_selectionKeydown(e){const t=o(e);if(-1===["ArrowDown","ArrowUp"].indexOf(t))return void this._toggleSelection(e);e.stopPropagation();const i=e.currentTarget,s=i["data-item"],r=i.dataset.itemType,{_sortableBaseLayers:n,_sortableReferenceLayers:a,selectedItems:l}=this,d="base"===r?n:"reference"===r?a:null;if(!d)return;const c=v(s,l),m=d.toArray(),h=e.target,u=m.indexOf(h.dataset.layerUid),{baseItems:p,referenceItems:g}=this.viewModel;if(-1!==u){if("ArrowDown"===t){var b;const e=u+1,t=e>=m.length;if(t&&"reference"===r&&c){var _;const e=p.length;return this.viewModel.transferListItem({listItem:s,from:"reference",to:"base",newIndex:e}),this._focusSortUid=null==(_=s.layer)?void 0:_.uid,void this.scheduleRender()}if(t&&"reference"===r){var y;const e=p.getItemAt(0);return this._focusSortUid=null==e||null==(y=e.layer)?void 0:y.uid,void this.scheduleRender()}if(t)return;return c&&(A(m,u,e),d.sort(m),this._sortLayersToItems({type:r,itemIds:d.toArray()})),this._focusSortUid=null==(b=s.layer)?void 0:b.uid,void this.scheduleRender()}if("ArrowUp"===t){var f;const e=u-1,t=e<0;if(t&&"base"===r&&c){var I;if(1===p.length)return;const e=0;return this.viewModel.transferListItem({listItem:s,from:"base",to:"reference",newIndex:e}),this._focusSortUid=null==(I=s.layer)?void 0:I.uid,void this.scheduleRender()}if(t&&"base"===r){var L;const e=g.getItemAt(g.length-1);return this._focusSortUid=null==e||null==(L=e.layer)?void 0:L.uid,void this.scheduleRender()}if(t)return;c&&(A(m,u,e),d.sort(m),this._sortLayersToItems({type:r,itemIds:d.toArray()})),this._focusSortUid=null==(f=s.layer)?void 0:f.uid,this.scheduleRender()}}}_watchActionSectionChanges(e,t){this.handles.add(e.on("change",(()=>this.scheduleRender())),t),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){"toggle"!==e.type?"slider"!==e.type?this.handles.add([m(e,["className","image","id","title","visible"],(()=>this.scheduleRender()))],t):this.handles.add([m(e,["className","id","title","visible","value","displayValueEnabled","max","min","step"],(()=>this.scheduleRender()))],t):this.handles.add([m(e,["className","image","id","title","visible","value"],(()=>this.scheduleRender()))],t)}_renderOnItemChanges(e,t){this.handles.add([m(e,["actionsOpen","visible","open","updating","title","visibleAtCurrentScale","error","visibilityMode","panel","panel.title","panel.content","panel.className"],(()=>this.scheduleRender())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],t),e.children.forEach((e=>this._renderOnItemChanges(e,t))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e,t){this.handles.remove(t),e.forEach((e=>this._renderOnItemChanges(e,t))),this.scheduleRender()}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:null}}_toggleActionsOpen(e){e.stopPropagation();const t=e.currentTarget["data-item"],{actionsOpen:i}=t,s=!i,{baseItems:r,referenceItems:n}=this;s&&(r.forEach((e=>ze(e))),n.forEach((e=>ze(e)))),t.actionsOpen=s}_triggerPanel(e){e.stopPropagation();const t=e.currentTarget["data-panel"];t&&(t.open=!t.open)}_triggerAction(e){e.stopPropagation();const t=e.currentTarget,i=t["data-action"],s=t["data-item"];"toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,s)}_toggleVisibility(e){e.stopPropagation();const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=t["data-item"];i===De.exclusive&&s.visible||(s.visible=!s.visible)}_toggleChildrenClick(e){e.stopPropagation();const t=e.currentTarget["data-item"];t.open=!t.open}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=t&&(e.metaKey||e.ctrlKey),r=e.currentTarget["data-item"],n=v(r,i),{length:a}=i;if(!s)return a&&!(n&&1===a)?(i.removeAll(),void i.add(r)):void(n?i.remove(n):i.add(r));n?i.remove(n):i.add(r)}};e([r("viewModel.basemapTitle")],Ge.prototype,"basemapTitle",void 0),e([r("viewModel.baseListItemCreatedFunction"),g()],Ge.prototype,"baseListItemCreatedFunction",void 0),e([s(),g()],Ge.prototype,"editingEnabled",void 0),e([s(),g()],Ge.prototype,"errorsVisible",void 0),e([s()],Ge.prototype,"iconClass",void 0),e([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ge.prototype,"label",void 0),e([s(),g(),p("esri/widgets/BasemapLayerList/t9n/BasemapLayerList")],Ge.prototype,"messages",void 0),e([s(),g(),p("esri/t9n/common")],Ge.prototype,"messagesCommon",void 0),e([s()],Ge.prototype,"multipleSelectionEnabled",void 0),e([r("viewModel.referenceListItemCreatedFunction"),g()],Ge.prototype,"referenceListItemCreatedFunction",void 0),e([r("viewModel.baseItems"),g()],Ge.prototype,"baseItems",void 0),e([r("viewModel.referenceItems"),g()],Ge.prototype,"referenceItems",void 0),e([s(),g()],Ge.prototype,"selectedItems",void 0),e([s(),g()],Ge.prototype,"statusIndicatorsVisible",null),e([r("viewModel.view"),g()],Ge.prototype,"view",void 0),e([b("trigger-action"),s({type:L}),g("viewModel.state")],Ge.prototype,"viewModel",void 0),e([s(),g()],Ge.prototype,"visibleElements",void 0),e([n("visibleElements")],Ge.prototype,"castVisibleElements",null),e([u()],Ge.prototype,"_toggleActionsOpen",null),e([u()],Ge.prototype,"_triggerPanel",null),e([u()],Ge.prototype,"_triggerAction",null),e([u()],Ge.prototype,"_toggleVisibility",null),e([u()],Ge.prototype,"_toggleChildrenClick",null),e([u()],Ge.prototype,"_toggleSelection",null),Ge=e([l("esri.widgets.BasemapLayerList")],Ge);var Je=Ge;export default Je;
