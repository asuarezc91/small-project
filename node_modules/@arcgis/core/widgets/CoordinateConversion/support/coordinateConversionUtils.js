/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../../core/Error.js";import{resolve as t}from"../../../core/promiseUtils.js";import o from"../../../geometry/SpatialReference.js";import{project as r}from"../../../geometry/support/webMercatorUtils.js";import n from"../../../geometry/Point.js";import"../../../geometry.js";import i from"../../../tasks/support/ProjectParameters.js";const c={utm:{conversionMode:"utmDefault",addSpaces:!0},usng:{numOfDigits:5,rounding:!1,addSpaces:!1},mgrs:{rounding:!1}},a=new Array(3);function s(e,t){const o=u(t);return[e[0].toFixed(o),e[1].toFixed(o)]}function u(e){return e>=500?6:e<500&&e>=50?7:e<50&&e>=5?8:9}function f(t){const{geometryServicePromise:o,coordinate:r,spatialReference:i,formatName:c}=t;return o.then((t=>t.fromGeoCoordinateString({strings:[r],sr:i,conversionType:c}).then((e=>{const t=new n({x:e[0][0],y:e[0][1],spatialReference:i});if(!p(t))throw e;return t})).catch((t=>{throw new e("coordinate-conversion:from-geo-coordinate-string-failed","Failed to convert coordinate notation",{notationResult:t})}))))}function m(e,t){const r=e.indexOf(",")>=0?",":" ",[i,c,a]=e.split(r).map((e=>{const t=e.trim();return t?Number(t):null}));if(!d(i)||!d(c))return null;const s=new n({x:i,y:c,spatialReference:t||o.WGS84});return a&&(s.z=a,s.hasZ=!0),s}function d(e){return"number"==typeof e&&isFinite(e)}function p(e){return e&&d(e.x)&&d(e.y)}function l(e,t){if(e.spatialReference.isGeographic&&t){const[o,r]=s([e.x,e.y],t);return`${o}, ${r}`}return`${e.x.toFixed(3)}, ${e.y.toFixed(3)}`}function g(o,n){const{spatialReference:c,geometryServicePromise:s,location:u,scale:f}=o;if(!c||u.spatialReference.wkid===c.wkid)return t({location:u,coordinate:l(u,f)});if((u.spatialReference.isWGS84||u.spatialReference.isWebMercator)&&(c.isWGS84||c.isWebMercator))return t({location:r(u,c),coordinate:l(u,f)});if(a[0]===u&&a[1]===c.wkid)return a[2];a[0]=u,a[1]=c.wkid;const m=s.then((t=>t.project(new i({geometries:[u],outSpatialReference:c}),{signal:n}).then((e=>{if(!p(e[0]))throw e[0];return{location:e[0],coordinate:l(e[0],f)}})).catch((t=>{throw new e("coordinate-conversion:projection-failed","Failed to project point",{projectionResult:t})}))));return a[2]=m,m}function w(t){const{formatName:o,location:r,geometryServicePromise:n}=t,i=c[o]||{},a={coordinates:[[r.x,r.y]],sr:r.spatialReference,conversionType:o,...i};return n.then((t=>t.toGeoCoordinateString(a).then((e=>{const t=e[0];if(!t)throw e;return t})).catch((t=>{throw new e("coordinate-conversion:to-geo-coordinate-string-failed","Failed to convert coordinate notation",{notationResult:t})}))))}function h(e){return"dd"===e||"dms"===e||"ddm"===e||"mgrs"===e||"usng"===e||"utm"===e}export{s as clipLonLat,f as fromGeoCoordinateString,m as fromXY,u as getDegreePrecision,h as isSupportedNotation,p as isValidPoint,l as pointToCoordinate,g as project,w as toGeoCoordinateString};
