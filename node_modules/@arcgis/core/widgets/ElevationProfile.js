/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../core/has.js";import{isNone as e,isSome as s}from"../core/maybe.js";import"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{createTask as n}from"../core/promiseUtils.js";import{init as a}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as l}from"./support/decorators/messageBundle.js";import{renderable as c}from"./support/decorators/renderable.js";import{j as h}from"../chunks/index.js";import d from"./Widget.js";import{CSS as p}from"./ElevationProfile/css.js";import u from"./ElevationProfile/ChartLegend.js";import{ElevationProfileState as m,PORTRAIT_MODE_PIXEL_BREAKPOINT as v}from"./ElevationProfile/support/constants.js";import _ from"./ElevationProfile/ElevationProfileViewModel.js";import g from"./ElevationProfile/ElevationProfileVisibleElements.js";import{SettingsButton as C}from"./ElevationProfile/SettingsButton.js";import{Statistics as w}from"./ElevationProfile/Statistics.js";import{createChart as b}from"./ElevationProfile/support/chartUtils.js";const f=[4,0];let y=class extends d{constructor(t,e){super(t,e),this.viewModel=null,this.view=null,this.input=null,this.profiles=null,this.unitOptions=[],this.unit="metric",this.geodesicDistanceThreshold=1e5,this.visibleElements=new g,this.iconClass=p.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._settingsButton=new C({viewModel:this.viewModel}),this._statisticsWidget=new w({viewModel:this.viewModel}),this._legend=new u({viewModel:this.viewModel}),this._resizeObserver=null,this._portrait=!1,this._chartInitTask=null,t.viewModel||(this._defaultViewModel=new _({view:t.view}),this.viewModel=this._defaultViewModel)}postInitialize(){this.own([a(this,"_chartContainer",(()=>{this._destroyChart();const t=this._chartContainer;e(t)||(this._chartInitTask=n((e=>this._initializeChart(t,e))))})),a(this,"viewModel",(t=>{this._settingsButton.viewModel=t,this._statisticsWidget.viewModel=t,this._legend.viewModel=t})),a(this,"_chartUpdateParams",(()=>this._updateChart()))])}destroy(){this._destroyChart(),s(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._statisticsWidget.destroy(),this._statisticsWidget=null,this._legend.destroy(),this._legend=null,this._settingsButton.destroy(),this._settingsButton=null,s(this._resizeObserver)&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}get _chartUpdateParams(){return{chart:this._chart,data:this.viewModel.chartData,stationary:this.view.stationary,elevationUnitsPerPixel:this.viewModel.elevationUnitsPerPixel,messages:{...this.messagesUnits,...this.messages}}}render(){const{viewModel:t}=this,e=t.progress;return h("div",{key:this,class:this.classes(p.base,p.esriWidget,{[p.esriWidgetDisabled]:"disabled"===t.state,[p.portrait]:this._portrait}),"aria-label":this.messages.widgetLabel,bind:this,afterCreate:this._onAfterCreate},h("div",{key:"progress-bar",class:this.classes(p.progressBar,{[p.progressBarVisible]:e<1}),styles:{width:100*e+"%"},role:"presentation","aria-hidden":"true",title:this.messagesCommon.loading}),this._renderContentForState())}_renderContentForState(){switch(this.viewModel.state){case m.Ready:return this._renderContentForReadyState();case m.Selecting:return this._renderContentForSelectingState();case m.Creating:return this._renderContentForCreatingState();case m.Selected:case m.Created:return this._renderContentForCreatedState();case m.Disabled:return null}}_renderContentForReadyState(){return this._renderContent({prompt:this.messages.readyPrompt,statistics:!1,chart:!1,legend:!1,actions:f})}_renderContentForSelectingState(){return this._renderContent({prompt:this.messages.selectingPrompt,statistics:!1,chart:!1,legend:!1,actions:[5]})}_renderContentForCreatingState(){const t={statistics:!1,chart:!1,legend:!1,actions:[1,3]};switch(this.viewModel.errorState){case 0:return this._renderContent({...t,prompt:this.messages.creatingPrompt});case 1:return this._renderContent({...t,prompt:this.messages.noMultiPathSupport});case 2:case 3:return this._renderContent({...t,prompt:this.messages.noProfile,legend:!0});case 4:{const t=this.viewModel.canStopCreating?2:3;return this._renderContent({statistics:!0,chart:!0,legend:!0,actions:[1,t]})}}}_renderContentForCreatedState(){const t={statistics:!1,chart:!1,legend:!1,actions:f};switch(this.viewModel.errorState){case 0:return this._renderContent({...t,prompt:this.messages.noProfile});case 1:return this._renderContent({...t,prompt:this.messages.noMultiPathSupport});case 2:case 3:return this._renderContent({...t,prompt:this.messages.noProfile,legend:!0});case 4:return this._renderContent({statistics:!0,chart:!0,legend:!0,actions:f})}}_renderContent({statistics:t,prompt:e,chart:i,legend:r,actions:o}){return[this._renderHeader({statistics:t}),s(e)?this._renderPrompt(e):i&&this._renderChart(),this._renderActions({legend:r,actions:o})]}_renderHeader(t){const{progress:e}=this.viewModel,s=1===e&&t.statistics&&this.visibleElements.statistics,i=e>0&&e<1;return h("header",{key:"header",class:p.header},i&&h("div",{key:"loading-message",class:p.loadingMessage},this.messages.loading),s?this._statisticsWidget.render():h("div",{key:"header-spacer",class:p.headerSpacer}),this._settingsButton.render())}_renderPrompt(t){return h("div",{key:"prompt-container",bind:this,class:p.promptContainer},h("p",null,t))}_renderChart(){return h("div",{key:"chart-container",bind:this,class:p.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})}_renderActions({legend:t,actions:e}){const s=e.map((t=>{switch(t){case 0:return this.visibleElements.sketchButton&&h("button",{key:"sketch",class:this.classes(p.actionButton,p.sketchButton),bind:this,onclick:this._onSketchButtonClick},this.messages.sketchButtonLabel);case 1:return this.visibleElements.sketchButton&&h("button",{key:"sketch-cancel",class:this.classes(p.actionButton,p.sketchCancelButton),bind:this,onclick:this._onCancelButtonClick},this.messagesCommon.cancel);case 2:return this.visibleElements.sketchButton&&h("button",{key:"sketch-done",class:this.classes(p.actionButton,p.sketchDoneButton),bind:this,onclick:this._onDoneButtonClick},this.messagesCommon.done);case 3:return this.visibleElements.sketchButton&&h("button",{key:"sketch-done-disabled",class:this.classes(p.actionButton,p.sketchDoneButton,p.buttonDisabled),bind:this,disabled:!0},this.messagesCommon.done);case 4:return this.visibleElements.selectButton&&h("button",{key:"select",class:this.classes(p.actionButton,p.selectButton),bind:this,onclick:this._onSelectButtonClick},this.messages.selectButtonLabel);case 5:return this.visibleElements.selectButton&&h("button",{key:"select-cancel",class:this.classes(p.actionButton,p.selectCancelButton),bind:this,onclick:this._onCancelButtonClick},this.messagesCommon.cancel)}}));return h("div",{class:p.footer},h("div",{class:p.legendContainer},this.visibleElements.legend&&t&&this._legend.render()),h("div",{class:p.actionsContainer},s))}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(){const t=this._chartUpdateParams;t.stationary&&s(t.chart)&&t.messages&&t.chart.update(t)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}async _initializeChart(t,e){this._chart=await b({container:t,abortOptions:{signal:e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}}),this._updateChart()}_destroyChart(){s(this._chartInitTask)&&(this._chartInitTask.abort(),this._chartInitTask=null),s(this._chart)&&(this._chart.destroy(),this._chart=null)}_onAfterCreate(t){const e=()=>{this._portrait=t.getBoundingClientRect().width<v};e(),this._resizeObserver=new ResizeObserver((()=>e())),this._resizeObserver.observe(t)}};t([i({type:_}),c(["chartData","progress","statistics","canStopCreating"])],y.prototype,"viewModel",void 0),t([r("viewModel.view"),c()],y.prototype,"view",void 0),t([r("viewModel.input"),c()],y.prototype,"input",void 0),t([r("viewModel.profiles"),c()],y.prototype,"profiles",void 0),t([r("viewModel.unitOptions"),c()],y.prototype,"unitOptions",void 0),t([r("viewModel.unit"),c()],y.prototype,"unit",void 0),t([r("viewModel.geodesicDistanceThreshold"),c()],y.prototype,"geodesicDistanceThreshold",void 0),t([i({type:g}),c()],y.prototype,"visibleElements",void 0),t([i(),c()],y.prototype,"iconClass",void 0),t([r("messages.widgetLabel",{overridable:!0}),c()],y.prototype,"label",void 0),t([i(),c(),l("esri/widgets/ElevationProfile/t9n/ElevationProfile")],y.prototype,"messages",void 0),t([i(),c(),l("esri/t9n/common")],y.prototype,"messagesCommon",void 0),t([i(),c(),l("esri/core/t9n/Units")],y.prototype,"messagesUnits",void 0),t([i()],y.prototype,"_chartContainer",void 0),t([i()],y.prototype,"_chart",void 0),t([i(),c()],y.prototype,"_portrait",void 0),t([i()],y.prototype,"_chartUpdateParams",null),y=t([o("esri.widgets.ElevationProfile")],y);var k=y;export default k;
