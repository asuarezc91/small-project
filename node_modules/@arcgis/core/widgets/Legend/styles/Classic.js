/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as s}from"../../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{formatNumber as t}from"../../../intl/number.js";import"../../../intl.js";import"../../support/widgetUtils.js";import{messageBundle as l}from"../../support/decorators/messageBundle.js";import{renderable as i}from"../../support/decorators/renderable.js";import{j as a}from"../../../chunks/index.js";import n from"../../Widget.js";import{renderRelationshipRamp as o,getUnivariateAboveAndBelowRampElements as d,getUnivariateAboveAndBelowColorRampSize as p,getUnivariateAboveAndBelowColorRampPreview as c,getUnivariateAboveAndBelowColorRampMargin as m}from"./support/utils.js";import{getTitle as y,isRendererTitle as g,attachToNode as _,isImageryStretchedLegend as h}from"../support/styleUtils.js";const v="esri-legend__service",u="esri-legend__service-label",b="esri-legend__layer",f="esri-legend__group-layer",L="esri-legend__group-layer-child",w="esri-legend__layer-table",j="esri-legend__layer-table--size-ramp",x="esri-legend__layer-child-table",A="esri-legend__layer-caption",F="esri-legend__layer-body",$="esri-legend__layer-row",E="esri-legend__layer-cell esri-legend__layer-cell--info",S="esri-legend__imagery-layer-image--stretched",k="esri-legend__imagery-layer-info--stretched",I="esri-legend__layer-cell esri-legend__layer-cell--symbols",C="esri-legend__symbol",R="esri-legend__ramps",U="esri-legend__size-ramp",z="esri-legend__color-ramp",B="esri-legend__opacity-ramp",T="esri-legend__ramp-labels",O="esri-legend__ramp-label",N="esri-univariate-above-and-below-ramp__label",W="esri-legend__message",q="esri-widget__heading",D={display:"flex",alignItems:"flex-start"},G={marginLeft:"3px"},H={display:"table-cell",verticalAlign:"middle"};let J=class extends n{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return a("div",null,s&&s.length?s:a("div",{class:W},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,r=`esri-legend__${e.layer.uid}-version-${e.version}`,t=e.title?a("h3",{class:this.classes(q,u)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return a("div",{key:r,class:this.classes(v,f)},t,s)}{const s=e.legendElements;if(s&&!s.length)return null;const l=s.map((s=>this._renderLegendForElement(s,e.layer))).filter((e=>!!e));if(!l.length)return null;const i={[L]:!!e.parent};return a("div",{key:r,class:this.classes(v,i)},t,a("div",{class:b},l))}}_renderLegendForElement(e,s,r){const t="color-ramp"===e.type,l="opacity-ramp"===e.type,i="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||i){const r=e.infos.map((r=>this._renderLegendForElementInfo(r,s,i,e.legendType))).filter((e=>!!e));r.length&&(n=a("div",{class:F},r))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?n=o(e,this.id,s.opacity):"univariate-above-and-below-ramp"===e.type&&(n=this._renderUnivariateAboveAndBelowRamp(e,s.opacity));if(!n)return null;const d=e.title;let p=null;if("string"==typeof d)p=d;else if(d){const e=y(this.messages,d,t||l);p=g(d,t||l)&&d.title?`${d.title} (${e})`:e}const c=r?x:w,m=p?a("div",{class:A},p):null,_={[j]:i||!r};return a("div",{class:this.classes(c,_)},m,n)}_renderUnivariateAboveAndBelowRamp(e,s){const{sizeRampElement:r,colorRampElement:t}=d(e,s),l=p(r,"above"),i=p(r,"below"),n=c(t,{width:12,height:l,rampAlignment:"vertical",opacity:s,type:"above"}),o=c(t,{width:12,height:i,rampAlignment:"vertical",opacity:s,type:"below"}),y=m(r),g=r.infos.map((e=>e.label)),h=g.map(((e,s)=>{const r=2===s;return 0===s?a("div",{key:s,class:e?n?N:O:null},e):r?a("div",null):null})),v=g.map(((e,s)=>2===s||4===s?a("div",{key:s,class:e?n?N:O:null},e):null)),u={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${y}px`},f={height:`${l}px`},L={height:`${i}px`};return a("div",{key:"univariate-above-and-below-ramp-preview",styles:D},a("div",{class:F},r.infos.map(((e,s)=>a("div",{class:this.classes($,U)},a("div",{class:C,styles:u,bind:e.preview,afterCreate:_}),n||s%2!=0?null:a("div",{class:E},g[s]))))),n?a("div",{styles:b,key:"color-ramp-preview"},a("div",{styles:G},a("div",{styles:H},a("div",{class:R,bind:n,afterCreate:_})),a("div",{styles:H},a("div",{class:T,styles:f},h))),a("div",{styles:G},a("div",{styles:H},a("div",{class:R,bind:o,afterCreate:_})),a("div",{styles:H},a("div",{class:T,styles:L},v)))):null)}_renderLegendForRamp(e,s){const r=e.infos,t="opacity-ramp"===e.type,l="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,n=e.preview,o=t?B:"";n.className=`${z} ${o}`,null!=s&&(n.style.opacity=s.toString());const d=r.map((e=>a("div",{class:e.label?O:null},l?this.messages[e.label]:i?this._getStretchStopLabel(e):e.label))),p={width:"24px"},c={height:n.style.height};return a("div",{class:$},a("div",{class:I,styles:p},a("div",{class:R,bind:n,afterCreate:_})),a("div",{class:E},a("div",{class:T,styles:c},d)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+t(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""}_renderLegendForElementInfo(e,s,r,t){if(e.type)return this._renderLegendForElement(e,s,!0);let l=null;const i=h(s,t);if(e.preview?l=a("div",{class:C,bind:e.preview,afterCreate:_}):e.src&&(l=this._renderImage(e,s,i)),!l)return null;const n={[k]:i},o={[k]:i,[U]:!i&&r};return a("div",{class:$},a("div",{class:this.classes(I,o)},l),a("div",{class:this.classes(E,n)},y(this.messages,e.label,!1)||""))}_renderImage(e,s,r){const{label:t,src:l,opacity:i}=e,n={[S]:r,[C]:!r},o={opacity:`${null!=i?i:s.opacity}`};return a("img",{alt:y(this.messages,t,!1),src:l,border:0,width:e.width,height:e.height,class:this.classes(n),styles:o})}};e([i(),s()],J.prototype,"activeLayerInfos",void 0),e([s(),i(),l("esri/widgets/Legend/t9n/Legend")],J.prototype,"messages",void 0),e([s({readOnly:!0})],J.prototype,"type",void 0),J=e([r("esri.widgets.Legend.styles.Classic")],J);var K=J;export default K;
