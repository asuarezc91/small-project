/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as t,applySome as o,destroyMaybe as s}from"../../core/maybe.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{handlesGroup as r}from"../../core/handleUtils.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{on as p}from"../../core/events.js";import{isMeasurementSystem as l}from"../../core/unitUtils.js";import"../support/widgetUtils.js";import{messageBundle as a}from"../support/decorators/messageBundle.js";import{renderable as c}from"../support/decorators/renderable.js";import{j as u}from"../../chunks/index.js";import h from"../Widget.js";import m from"../support/Popover.js";import{SETTINGS_CSS as _}from"./css.js";let v=class extends h{constructor(e,t){super(e,t),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._clickOutsideHandle=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const e=t(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return u("button",{class:this.classes(_.base),title:e,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":e})}_initializePopover(e){this._destroyPopover(),this._buttonElement=e;const t=parseInt(getComputedStyle(e).getPropertyValue("--button-offset"),10);this._popover=new m({owner:this,placement:"bottom-end",offset:[t,0],anchorElement:e,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){o(this._clickOutsideHandle,(e=>e.remove())),s(this._popover)}_renderPopoverContent(){const e=this._messagesUnits,{unit:t,unitOptions:o}=this.viewModel;return u("div",{class:_.popoverContent,bind:this,onkeydown:this._onPopoverKeyDown,afterCreate:this._onPopoverContentAfterCreate},u("label",{class:_.selectLabel},this._messages.unitSelectLabel),u("select",{class:_.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},o.map((t=>u("option",{key:t,value:t},l(t)?e.systems[t]:e.units[t].pluralCapitalized)))))}_onUnitChange(e){const t=e.target;this.viewModel.unit=t.value,this._closePopover()}_onUnitSelectAfterCreate(e){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,e.focus())}_onPopoverKeyDown(e){switch(e.key){case"Enter":case"Escape":e.stopPropagation(),e.preventDefault(),this._closePopover()}}_togglePopover(e){t(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){o(this._popover,(e=>e.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:e=!0}={}){o(this._popover,(e=>e.open=!1)),o(this._clickOutsideHandle,(e=>e.remove())),e&&o(this._buttonElement,(e=>e.focus()))}_onPopoverContentAfterCreate(e){o(this._clickOutsideHandle,(e=>e.remove())),this._clickOutsideHandle=r([p(e,"click",(e=>e.stopPropagation())),p(window,"click",(()=>this._closePopover({focusOnButton:!1})))])}};e([i(),c(["unit","unitOptions"])],v.prototype,"viewModel",void 0),e([i(),c(),a("esri/widgets/ElevationProfile/t9n/ElevationProfile")],v.prototype,"_messages",void 0),e([i(),c(),a("esri/core/t9n/Units")],v.prototype,"_messagesUnits",void 0),v=e([n("esri.widgets.ElevationProfile.SettingsButton")],v);export{v as SettingsButton};
