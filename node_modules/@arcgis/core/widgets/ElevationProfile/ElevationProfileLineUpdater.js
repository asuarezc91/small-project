/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isNone as e,unwrapOr as s,applySome as o,isSome as r}from"../../core/maybe.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{createTask as l,throwIfAborted as p,ignoreAbortErrors as n}from"../../core/promiseUtils.js";import h from"../../core/Accessor.js";import c from"../../core/Handles.js";import{init as m}from"../../core/watchUtils.js";import{throttle as d}from"../../core/throttle.js";import{isPolyline as u,isValidInputPath as _}from"./support/geometryUtils.js";import{DEFAULT_DEM_RESOLUTION as f,MAX_SAMPLES as g,UPDATE_THROTTLE_MILLIS as j}from"./support/constants.js";import{generateProfile as v}from"./support/profileUtils.js";let U=class extends h{constructor(t){super(t),this._handles=new c,this._updateTask=null,this._lastParams=null,this._lastSamplingDistance=null,this._update=async()=>{if(!this.viewModel.view.stationary)return;const t=this.line,o=this._generateProfileParams;if(e(o))return this._abortUpdate(),void(t.result=null);if(!t.visible)return;const r=s(this.viewModel.minDemResolution,f);(this._generateProfileParams!==this._lastParams||this._lastSamplingDistance!==r||t.progress<1)&&(this._abortUpdate(),this._updateTask=l((async e=>{const s=v({...o,options:{...o.options,samplingDistance:r},signal:e});for await(const o of s)p(e),t.result=o;this._lastParams=o,this._lastSamplingDistance=r})))},this._throttledUpdate=d((()=>n(this._update())),j)}initialize(){const t=this.viewModel,e=this.line;this._handles.add([this._throttledUpdate,e.attach(t),e.on("change",this._throttledUpdate),m(t,["view.stationary","minDemResolution"],this._throttledUpdate),m(e,"visible",this._throttledUpdate),m(this,"_generateProfileParams",this._throttledUpdate)])}destroy(){this._handles.destroy(),this._abortUpdate()}get _generateProfileParams(){const{input:t,queue:s,view:r,tileCache:i,geodesicDistanceThreshold:a}=this.viewModel,l=o(t,(t=>t.geometry));return u(l)&&_(l)&&!e(s)?{view:r,path:l,provider:this.line,options:{geodesicDistanceThreshold:a,samplingDistance:f,maxSamples:g},queue:s,cache:i}:null}_abortUpdate(){r(this._updateTask)&&(this._updateTask.abort(),this._updateTask=null)}};t([i({nonNullable:!0})],U.prototype,"line",void 0),t([i({nonNullable:!0})],U.prototype,"viewModel",void 0),t([i()],U.prototype,"_generateProfileParams",null),U=t([a("esri.widgets.ElevationProfile.ElevationProfileLineUpdater")],U);var P=U;export default P;
