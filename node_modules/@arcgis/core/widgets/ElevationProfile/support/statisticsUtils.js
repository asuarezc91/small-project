/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isNone as n,isSome as e,unwrapOr as t}from"../../../core/maybe.js";import{getMetersPerVerticalUnitForSR as i,getMetersPerUnitForSR as l,convertUnit as a}from"../../../core/unitUtils.js";function o(t,o){const s=t.length;if(0===s)return null;const u=t[0].z;let m=u,r=u,x=0,f=0,g=null,p=null,E=e(u)?u:0,S=0,D=0,h=e(u)?1:0,N=0,P=0;for(let e=1;e<s;++e){const s=t[e-1],u=t[e],d=u.z,z=u.distance-s.distance;if(0===z||n(d))continue;h++,E+=d,m=c(m,d),r=v(r,d);const M=s.z;if(n(M))continue;const j=d-M,G=j*i(o),L=z*l(o),b=a(Math.atan2(G,L),"radians","degrees");b>0?(x+=j,S+=b,g=v(g,b),N++):b<0&&(f-=j,D-=b,p=v(p,-b),P++)}return 0===h?null:{maxDistance:t[s-1].distance,minElevation:m,maxElevation:r,avgElevation:0===h?null:E/h,elevationGain:x,elevationLoss:f,maxPositiveSlope:g,maxNegativeSlope:p,avgPositiveSlope:0===N?null:S/N,avgNegativeSlope:0===P?null:D/P}}function s(n){const t=n.filter(e),i=t.length;if(0===i)return null;const l=t[0];if(1===i)return l;let a=l.maxDistance,o=l.minElevation,s=l.maxElevation,u=l.maxPositiveSlope,m=l.maxNegativeSlope;for(let n=1;n<t.length;++n){const e=t[n];a=v(a,e.maxDistance),o=c(o,e.minElevation),s=v(s,e.maxElevation),u=v(u,e.maxPositiveSlope),m=v(m,e.maxNegativeSlope)}return{maxDistance:a,minElevation:o,maxElevation:s,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:u,maxNegativeSlope:m,avgPositiveSlope:null,avgNegativeSlope:null}}function u(e){let a=null,o=null,s=null;for(const t of e){if(n(t))continue;const{statistics:e,spatialReference:u}=t;if(n(e))continue;const r=l(u);a=v(a,m(e.maxDistance,r));const x=i(u);s=c(s,m(e.minElevation,x)),o=v(o,m(e.maxElevation,x))}return{minDistance:0,maxDistance:t(a,0),minElevation:t(s,0),maxElevation:t(o,0)}}function c(t,i){return n(i)?t:e(t)?Math.min(t,i):i}function v(t,i){return n(i)?t:e(t)?Math.max(t,i):i}function m(n,t){return e(n)&&e(t)?n*t:null}export{u as getBoundsInMeters,o as getStatistics,s as mergeStatistics};
