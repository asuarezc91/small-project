/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{isNone as e,unwrapOr as t,isSome as s}from"../../../core/maybe.js";import o from"../../../geometry/Polyline.js";import i from"../../../Color.js";import{f as r}from"../../../chunks/vec4f64.js";import{throttle as l}from"../../../core/throttle.js";import{PROFILE_LINES_STYLE_3D as n}from"./constants.js";import{OutlineVisualElement as a}from"../../../views/3d/interactive/visualElements/OutlineVisualElement.js";class m{constructor(e){this._params=e,this._visualElements=[],this.updateGeometry=l((e=>this._updateGeometry(e)),100)}destroy(){this.updateGeometry.remove(),this._destroyVisualElements()}_updateGeometry(t){if(e(t)||1!==t.progress)return void this._destroyVisualElements();const s=t.lines.length;for(;this._visualElements.length>s;)this._visualElements.pop().destroy();for(;this._visualElements.length<s;){const e=new a({view:this._params.view,elevationInfo:{mode:"absolute-height",offset:0},renderOccluded:4,innerWidth:n.width-n.outlineSize,width:n.width,falloff:n.falloff});this._visualElements.push(e)}for(let e=0;e<s;++e){const s=t.lines[e],o=this._visualElements[e];o.geometry=this._createLineGeometry(s),o.innerColor=r(i.toUnitRGBA(s.color))}}_createLineGeometry(i){const r=t(i.samples,[]),l=r.length-1,n=[];let a=[];for(let t=0;t<=l;t++){const{x:o,y:i,z:m}=r[t];s(m)&&a.push([o,i,m]),(t===l||e(m))&&a.length&&(n.push(a),a=[])}return new o({paths:n,hasZ:!0,spatialReference:this._params.view.spatialReference})}_destroyVisualElements(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0}}export{m as ProfileLines3D};
