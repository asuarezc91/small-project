/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import{isSome as i}from"../core/maybe.js";import s from"../core/Logger.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{aliasOf as o}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as r}from"../core/accessorSupport/decorators/cast.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{init as l}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as d}from"./support/decorators/messageBundle.js";import{renderable as n}from"./support/decorators/renderable.js";import{j as h}from"../chunks/index.js";import c from"./Widget.js";import{formatSliderLabel as p,getGMTOffsets as m,ORDERED_SEASONS as g}from"./Daylight/daylightUtils.js";import w from"./Daylight/DaylightViewModel.js";import v from"./Daylight/support/SliderWithDropdown.js";import u from"./support/DatePicker.js";const y="esri-daylight",_="esri-button",b="esri-daylight__checkbox",S="esri-icon-checkbox-checked",M="esri-daylight__container esri-daylight__day-container",f="esri-daylight__container esri-daylight__date-container",k="esri-widget__heading",O="esri-interactive",P=" esri-widget__anchor",j="esri-daylight__container__labelled-tick",D="esri-icon-pause",E="esri-icon-play",x="esri-daylight__play-pause-button",C="esri-select",T="esri-daylight__season-picker",V="esri-daylight__shadow-container",B="esri-slider--shadow-off",z="esri-slider--shadow-on",F="esri-daylight__container__tick",U="esri-icon-checkbox-unchecked",I="esri-widget",L="esri-slider--date-on",$="esri-slider--date-off",N="esri-daylight__panel--error",Y={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},W=s.getLogger("esri.widgets.Daylight");let A=class extends c{constructor(e,i){var s;super(e,i),this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new w,this.visibleElements={...Y},this.dateOrSeason="date",this._timeSlider=new v({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:p,inputFormatFunction:p,min:0,max:1439,steps:null!=(s=this.timeSliderSteps)?s:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new u({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0})}get gmtOffsets(){return this.messages?m(this.messages):null}castVisibleElements(e){return{...Y,...e}}postInitialize(){this.viewModel.isSupported&&this.own(l(this.viewModel,"datePickerViewModel",(e=>{this._datePicker.viewModel=e})),l(this.viewModel,"timeSliderViewModel",(e=>{this._timeSlider.viewModel=e})),l(this,"messages",(()=>{this._timeSlider.buttonTooltip=this.messages.chooseTimezone})),l(this,"visibleElements",(()=>{this._timeSlider.showDropDown=this.visibleElements.timezone})),l(this,"gmtOffsets",(e=>{i(e)&&(this._timeSlider.items=e)})),l(this,["viewModel.utcOffset","gmtOffsets"],(()=>this._onUTCOffsetChange())))}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){return this.viewModel.isSupported?h("div",{class:this.classes(y,I)},h("h3",{class:k},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):h("div",{class:this.classes(y,I)},h("div",{key:"daylight__unsupported",class:N},h("p",null,this.messages.unsupported)))}renderTimeOptions(){const e={[E]:!this.viewModel.dayPlaying,[D]:this.viewModel.dayPlaying},i={[z]:this.viewModel.directShadowsEnabled,[B]:!this.viewModel.directShadowsEnabled},s={[L]:this.visibleElements.datePicker,[$]:!this.visibleElements.datePicker};return h("div",{class:this.classes(M,i,s),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?h("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(_,x,e)},h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},h("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderDateOptions(){const e={[E]:!this.viewModel.yearPlaying,[D]:this.viewModel.yearPlaying};return h("div",{class:f,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?h("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(_,x,e)},h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},h("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderShadowOptions(){const e=`${this.id}__shadowButton`,i={[S]:this.viewModel.directShadowsEnabled,[U]:!this.viewModel.directShadowsEnabled};return h("div",{class:V,key:"daylight-shadow-options"},h("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(_,b,i),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),h("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(P,O),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))}renderSeasonOptions(){return h("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(C,T),value:this.viewModel.currentSeason,"aria-label":this.messages.season},g.map((e=>h("option",{value:e},this.messages[e]))))}_onSeasonChange(e){const i=e.target;this.viewModel.currentSeason=i.value}_onUTCOffsetChange(){var e;const s=this.viewModel.utcOffset,t=null==(e=this._timeSlider.currentItem)?void 0:e.abbr,o=this.gmtOffsets;if(!i(o)||t===s)return;const r=o.findIndex((({abbr:e})=>e===s));r>-1&&(this._timeSlider.currentIndex=r)}_onPrimaryTickCreated(e,i,s){i.className+=" esri-interactive esri-widget__anchor "+F+" "+j,s.className+=" esri-interactive esri-widget__anchor";const t=()=>{this.viewModel.timeSliderPosition=e};i.onclick=t,s.onclick=t;const o=s.innerText;-1!==o.indexOf(" ")&&(s.innerHTML=o.replace(/(.*) (.*)/,'$1<br><div class="esri-label__ampm">$2</div>'))}_onSecondaryTickCreated(e,i){i.className+=" esri-interactive esri-widget__anchor "+F,i.onclick=()=>{this.viewModel.timeSliderPosition=e}}};e([t({readOnly:!0,dependsOn:["messages"]})],A.prototype,"gmtOffsets",null),e([t(),n(),d("esri/widgets/Daylight/t9n/Daylight")],A.prototype,"messages",void 0),e([o("viewModel.playSpeedMultiplier")],A.prototype,"playSpeedMultiplier",void 0),e([o("_timeSlider.steps")],A.prototype,"timeSliderSteps",void 0),e([o("viewModel.view")],A.prototype,"view",void 0),e([t({type:w}),n(["viewModel.directShadowsEnabled","viewModel.timeSliderPosition","viewModel.currentSeason","viewModel.localDate","viewModel.utcOffset"])],A.prototype,"viewModel",void 0),e([t(),n()],A.prototype,"visibleElements",void 0),e([r("visibleElements")],A.prototype,"castVisibleElements",null),e([t({cast:e=>"season"===e||"date"===e?e:(W.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "date".`),"date")}),n()],A.prototype,"dateOrSeason",void 0),e([t(),n()],A.prototype,"_timeSlider",void 0),e([t(),n()],A.prototype,"_datePicker",void 0),A=e([a("esri.widgets.Daylight")],A);var H=A;export default H;
