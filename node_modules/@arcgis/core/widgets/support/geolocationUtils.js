/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import t from"../../core/has.js";import e from"../../config.js";import r from"../../core/Logger.js";import o from"../../core/Error.js";import"../../core/urlUtils.js";import{create as i,resolve as s}from"../../core/promiseUtils.js";import"../../geometry/Geometry.js";import{geographicToWebMercator as n}from"../../geometry/support/webMercatorUtils.js";import a from"../../geometry/Point.js";import"../../geometry/Extent.js";import"../../geometry/Multipoint.js";import"../../geometry/Polygon.js";import"../../geometry/Polyline.js";import"../../geometry.js";import"../../request.js";import m from"../../portal/Portal.js";import u from"../../tasks/support/ProjectParameters.js";import"../../rest/geometryService/units.js";import"../../tasks/operations/generalize.js";import"../../tasks/support/GeneralizeParameters.js";import"../../tasks/operations/lengths.js";import"../../tasks/support/LengthsParameters.js";import"../../tasks/operations/offset.js";import"../../tasks/support/OffsetParameters.js";import{project as c}from"../../rest/geometryService/project.js";import"../../tasks/operations/relation.js";import"../../tasks/support/RelationParameters.js";import"../../tasks/operations/trimExtend.js";import"../../tasks/support/TrimExtendParameters.js";const p=r.getLogger("esri.widgets.support.geolocationUtils"),l={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function g(){return function(){const e=t("esri-geolocation");return e||p.warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=t("esri-secure-context");return e||p.warn("insecure-context","Geolocation requires a secure origin."),e}()}function f(t){return t||(t=l),i(((e,r)=>{setTimeout((()=>r(new o("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(e,r,t)}))}function j(t,r){const{position:i,view:p}=t;return function(t,r,i){if(!r)return s(t);const a=r.spatialReference;if(a.isWGS84)return s(t);if(a.isWebMercator)return s(n(t));return function(t){if(e.geometryServiceUrl)return s(e.geometryServiceUrl);const r=m.getDefault();return r.load(t).catch((()=>{})).then((()=>r.get("helperServices.geometry.url")))}(i).then((e=>{if(!e)throw new o("geometry-service:missing-url","Geometry service URL is missing");const r=new u({geometries:[t],outSR:a});return c(e,r,i).then((t=>t[0]))}))}(function(t){const e=t&&t.coords;if(!e)return null;return new a({longitude:e.longitude,latitude:e.latitude,z:e.altitude||null,spatialReference:{wkid:4326}})}(function(t){const e=t&&t.coords||{},r={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};return t?{coords:r,timestamp:t.timestamp}:t}(i)),p,r)}export{f as getCurrentPosition,j as positionToPoint,g as supported};
