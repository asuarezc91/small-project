/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{aliasOf as i}from"../../core/accessorSupport/decorators/aliasOf.js";import{subclass as s}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{eventKey as r}from"../../core/events.js";import{formatDate as o}from"../../intl/date.js";import"../../intl.js";import{loadMoment as a}from"../../intl/moment.js";import"./widgetUtils.js";import{messageBundle as n}from"./decorators/messageBundle.js";import{renderable as u}from"./decorators/renderable.js";import{j as l}from"../../chunks/index.js";import h from"../Widget.js";import c from"./TimePickerViewModel.js";const m="esri-time-picker esri-widget",p="esri-time-picker__input",d="esri-input",_={hour:"numeric",minute:"numeric"},v=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function f(e){return o(e.valueOf(),_).indexOf(" ")>-1}let P=class extends h{constructor(e,t){super(e,t),this._activeTime=null,this.label=void 0,this.messages=null,this.value=null,this.viewModel=new c}async loadLocale(){this._moment=await a()}render(){const e=this._activeTime||this.viewModel.value;return l("div",{class:m},l("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(p,d),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:o(e.valueOf(),_)}))}_handleInputBlur(){this._activeTime.isValid()&&(this.viewModel.value=this._activeTime.toDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(e){this._selectPart(e,this._activePart)}_selectPart(e,t){const i=this._activeTime;if(!i)return;const s=o(i.valueOf(),_),r=s.indexOf(":");if("hours"===t)return void e.setSelectionRange(0,r);const a=r+1,n=a+2;if("minutes"===t)return void e.setSelectionRange(a,n);const u=n+1,l=s.length;"meridiem"!==t||e.setSelectionRange(u,l)}_handleInputFocus(e){this._activePart="hours",this._activeTime=this._moment(this.viewModel.value).startOf("minute"),this._selectPart(e.target,"hours")}_caretIndexToPartName(e){const t=this._activeTime.format("LT"),i=t.indexOf(":"),s=t.indexOf(" ");return e<=i?"hours":e>i&&e<=s?"minutes":"meridiem"}_handleInputKeydown(e){const{ctrlKey:t,metaKey:i,shiftKey:s}=e,o=r(e),a=this._activeTime,n=this._activePart,u=/\d/.test(o),l=/^a|p$/i.test(o),h=i||t;if(v.indexOf(o)>-1||u||"meridiem"===n&&l&&!h){if("ArrowLeft"===o)this._activePart=this._prevPart();else if("ArrowRight"===o)this._activePart=this._nextPart();else if("Tab"===o){const e=s?this._prevPart():this._nextPart();if(e===this._activePart)return;this._activePart=e}else if("ArrowUp"===o)this._shift("up",a,n);else if("ArrowDown"===o)this._shift("down",a,n);else if(u)this._setTime(a,n,Number(o));else if(l){const e=o.toLowerCase(),t=a.hour();("a"===e&&t>=12||"p"===e&&t<12)&&this._shift("up",a,n)}e.preventDefault(),e.stopImmediatePropagation()}else h||(e.preventDefault(),e.stopImmediatePropagation())}_handleInputClick(e){const t=e.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(t.selectionStart)}_getOrderedParts(){return f(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)-1;return e[Math.max(t,0)]}_nextPart(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)+1;return e[Math.min(t,e.length-1)]}_setTime(e,t,i){if("hours"===t){const t=f(e)?12:24,s=""+e.hour()%t,r=i,o=Number(`${s}${i}`);2===s.length||o>t?e.hour(r):o<=t&&e.hour(o)}else if("minutes"===t){const t=59,s=`${e.minute()}`,r=i,o=Number(`${s}${i}`);2===s.length||o>t?e.minute(r):o<t&&e.minute(o)}}_handleInputPaste(e){const t=e.clipboardData.getData("text/plain"),i=this._moment(t);i.isValid()&&(this._activeTime=i),e.preventDefault(),e.stopImmediatePropagation()}_handleInputWheel(e){const t=e.deltaY<0?"up":"down";this._shift(t,this._activeTime,this._activePart)}_shift(e,t,i){if(!e||!t||!i)return;const s="meridiem"===i?12:1,r="hours"===i?"hour":"minutes"===i?"minute":"hours";t["up"===e?"add":"subtract"](s,r)}};e([t({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],P.prototype,"label",void 0),e([t(),u(),n("esri/widgets/support/t9n/TimePicker")],P.prototype,"messages",void 0),e([i("viewModel.value")],P.prototype,"value",void 0),e([t({type:c}),u("viewModel.value")],P.prototype,"viewModel",void 0),P=e([s("esri.widgets.support.TimePicker")],P);var w=P;export default w;
