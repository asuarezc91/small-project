/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import s from"../../../core/Evented.js";import i from"../../../core/Collection.js";import l from"../../../symbols/SimpleLineSymbol.js";import r from"../../../symbols/SimpleFillSymbol.js";import n from"../../../symbols/SimpleMarkerSymbol.js";import"../../../chunks/symbols.js";import c from"../../../core/Handles.js";import a from"../../../layers/GraphicsLayer.js";import p from"../../Sketch/SketchViewModel.js";import{updateSelection as d}from"./selectorUtils.js";let h=class extends s.EventedAccessor{constructor(e){super(),this._activeOptions=null,this._dashedFillSymbol=new r({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new l({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={tool:"rectangle",createOptions:null,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._completed=!1,this._handles=new c,this._sketchViewModel=new p,this._sketchGraphicsLayer=new a({listMode:"hide"}),this._transparentPointSymbol=new n({color:[0,0,0,0],outline:{style:"none",width:0}}),this.candidates=null,this.geometry=null,this.options=null,this.selection=new i,this.view=null,this.candidates=e.candidates,this.options=e.options,this.view=e.view;const{_dashedFillSymbol:t,_dashedLineSymbol:o,_sketchViewModel:s,_sketchGraphicsLayer:d,_transparentPointSymbol:h}=this;s.set({layer:d,view:this.view,activePointSymbol:h,activeLineSymbol:o,activeVertexSymbol:h,activeFillSymbol:t,pointSymbol:h,polygonSymbol:t,polylineSymbol:o,vertexSymbol:h}),this._handles.add([s.on("create",(e=>this._onSketchEvent(e))),s.on(["undo","redo"],(e=>this._onSketchEvent(e)))])}initialize(){this._load()}destroy(){this._handles.destroy(),this._handles=null}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}cancel(){this._sketchViewModel.cancel()}async _load(){await this.view.whenReady();const{options:e}=this,{tool:t,createOptions:o}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,o)}_onSketchEvent(e){const t="create"===e.type?e.graphic:e.graphics[0],o=(null==t?void 0:t.geometry)||null,s="create"===e.type&&"cancel"===e.state,i="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(o,i,s)}_processSelectionGeometry(e,t,o){if(this._set("geometry",e),(t||o)&&(this._completed=!0),o)return void this._onComplete([],!0);const{_activeOptions:s,candidates:i,selection:l,view:r}=this;d({selector:e,candidates:i,currentSelection:l,options:s.selectionOptions,view:r}).then((({added:e,removed:o})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||o.length)&&this.emit("selection-change",{added:e,removed:o,type:"selection-change"})}))}_onComplete(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};e([t()],h.prototype,"_completed",void 0),e([t()],h.prototype,"candidates",void 0),e([t({readOnly:!0})],h.prototype,"geometry",void 0),e([t()],h.prototype,"options",void 0),e([t({readOnly:!0})],h.prototype,"selection",void 0),e([t({dependsOn:["_completed","_sketchViewModel.state"],readOnly:!0})],h.prototype,"state",null),e([t({value:null})],h.prototype,"view",void 0),h=e([o("esri.widgets.support.Selector")],h);var m=h;export default m;
