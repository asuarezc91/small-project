/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import{subclass as e}from"../../core/accessorSupport/decorators/subclass.js";import i from"../../core/Error.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{resolve as r}from"../../core/promiseUtils.js";import s from"../../core/Accessor.js";import a from"../../core/Evented.js";import{getAssetUrl as n}from"../../assets.js";import c from"../../symbols/PictureMarkerSymbol.js";import p from"../../Graphic.js";import{GoToMixin as l}from"./GoTo.js";import{supported as d,positionToPoint as h}from"./geolocationUtils.js";let g=class extends(l(a.EventedMixin(s))){constructor(){super(...arguments),this._geolocationUsable=!0,this._iconPath=n("esri/images/support/sdk_gps_location.png"),this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new p({symbol:new c({url:this._iconPath,width:21,height:21})}),this.scale=null,this.useHeadingEnabled=!0,this.view=null}initialize(){d()||(this._geolocationUsable=!1)}destroy(){this._clear(),this.view=null}_clear(){this.view&&this.view.graphics.remove(this.graphic)}_getScaleWithinConstraints(t,o){if(!o)return t;if("2d"===o.type){const{effectiveMaxScale:e,effectiveMinScale:i}=o.constraints;return Math.min(i,Math.max(e,t))}return t}_getScale(t){const{scale:o}=this,e="number"==typeof o?o:2500;return this._getScaleWithinConstraints(e,t)}_getHeading(t,o){const e=o&&o.spatialReference,i=e&&(e.isWebMercator||e.isGeographic),r=t.coords&&t.coords.heading;if(!(!i||"number"!=typeof r||isNaN(r)||r<0||r>360))return r}_addHeading(t){const{heading:o,target:e,view:i}=t;i&&"number"==typeof o&&!isNaN(o)&&("3d"!==i.type?"2d"===i.type&&(e.rotation=360-o):e.heading=o)}_animatePoint(t,o,e,i){const{view:s}=this;if(!this.goToLocationEnabled||!s)return r(o);const a=this.useHeadingEnabled?this._getHeading(o,s):void 0,n={target:t,scale:e};return this._addHeading({heading:a,target:n,view:s}),this.callGoTo({target:n,options:i}).then((()=>o))}async _setPosition(t,o){try{const e=await h({position:t,view:this.view},o),{graphic:i}=this,{timestamp:r}=t,{coords:s}=t,{accuracy:a,altitude:n,altitudeAccuracy:c,heading:p,latitude:l,longitude:d,speed:g}=s,u={timestamp:r,accuracy:a,altitude:n,altitudeAccuracy:c,heading:p,latitude:l,longitude:d,speed:g};i&&(i.geometry=e,i.attributes=u);const m=this._getScale(this.view);return this._animatePoint(e,t,m,o)}catch(t){throw new i("positioning:invalid-point","Cannot position invalid point",{error:t})}}};t([o()],g.prototype,"_geolocationUsable",void 0),t([o()],g.prototype,"geolocationOptions",void 0),t([o()],g.prototype,"goToLocationEnabled",void 0),t([o()],g.prototype,"graphic",void 0),t([o()],g.prototype,"scale",void 0),t([o()],g.prototype,"useHeadingEnabled",void 0),t([o()],g.prototype,"view",void 0),g=t([e("esri.widgets.support.GeolocationPositioning")],g);var u=g;export default u;
