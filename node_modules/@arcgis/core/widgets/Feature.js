/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{aliasOf as s}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as i}from"../core/accessorSupport/decorators/cast.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{substitute as n}from"../intl/substitute.js";import"../intl.js";import{init as o}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as d}from"./support/decorators/messageBundle.js";import{renderable as l}from"./support/decorators/renderable.js";import{j as a}from"../chunks/index.js";import c from"./Widget.js";import u from"./Attachments.js";import p from"./Feature/FeatureContent.js";import h from"./Feature/FeatureFields.js";import m from"./Feature/FeatureMedia.js";import v from"./Feature/FeatureViewModel.js";import{FeatureContentMixin as y}from"./Feature/support/FeatureContentMixin.js";const f="esri-icon-loading-indicator esri-rotating",g="esri-widget",w="esri-feature",_="esri-feature__size-container",M="esri-feature__title",b="esri-feature__main-container",j="esri-feature__content-element",E="esri-feature__text",C="esri-feature__last-edited-info",W="esri-feature__attachments",F="esri-feature__loading-container",x="esri-feature__loading-spinner",k={title:!0,content:!0,lastEditedInfo:!0};let T=class extends(y(c)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...k},this.map=null,this.view=null,this.viewModel=new v}initialize(){this.own(o(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...k,...e}}render(){const{waitingForContent:e}=this.viewModel;return a("div",{class:this.classes(w,g)},a("div",{class:_},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return a("div",{key:"loading-container",class:F},a("span",{class:this.classes(f,x)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?a("div",{class:b},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?a("h4",{class:M,innerHTML:t}):null}renderContent(){const e=this.viewModel.content;if(!e)return null;if(Array.isArray(e))return e.length?a("div",{key:"content-content-elements"},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:a("div",{key:"content-content"},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:s}=this;if("boolean"!=typeof s.content&&!s.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:s,attachmentInfos:i}=t.viewModel;return"loading"===s||i.length>0?a("div",{key:this._buildKey("attachments-element",e),class:this.classes(W,j)},a("h2",null,this.messages.attach),t.render()):null}renderCustom(e,t){const{creator:s}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:s?a("div",{key:this._buildKey("custom-element",t),class:j},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:a("div",{key:this._buildKey("fields-element",e),class:j},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:a("div",{key:this._buildKey("media-element",e),class:j},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:s}=this.viewModel;if(!s||!e.lastEditedInfo)return null;const{date:i,user:r}=s,o="edit"===s.type?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,d=n(o,{date:i,user:r});return a("div",{key:"edit-info-element",class:this.classes(C,j)},d)}renderText(e,t){const s=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:s?a("div",{key:this._buildKey("text-element",t),class:this.classes(j,E)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach(((e,s)=>{"attachments"===e.type&&(this._contentWidgets[s]=new u({displayType:e.displayType,viewModel:t[s]})),"fields"===e.type&&(this._contentWidgets[s]=new h({viewModel:t[s]})),"media"===e.type&&(this._contentWidgets[s]=new m({viewModel:t[s]})),"text"===e.type&&(this._contentWidgets[s]=new p({viewModel:t[s]})),"custom"===e.type&&(this._contentWidgets[s]=new p({viewModel:t[s]}))}),this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new p({viewModel:e}))}this.scheduleRender()}};e([s("viewModel.graphic")],T.prototype,"graphic",void 0),e([s("viewModel.defaultPopupTemplateEnabled")],T.prototype,"defaultPopupTemplateEnabled",void 0),e([t({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],T.prototype,"label",void 0),e([t(),l(),d("esri/widgets/Feature/t9n/Feature")],T.prototype,"messages",void 0),e([t(),l(),d("esri/widgets/support/t9n/uriUtils")],T.prototype,"messagesURIUtils",void 0),e([s("viewModel.spatialReference")],T.prototype,"spatialReference",void 0),e([s("viewModel.title")],T.prototype,"title",void 0),e([t(),l()],T.prototype,"visibleElements",void 0),e([i("visibleElements")],T.prototype,"castVisibleElements",null),e([s("viewModel.map")],T.prototype,"map",void 0),e([s("viewModel.view")],T.prototype,"view",void 0),e([t({type:v}),l(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo","viewModel.contentViewModels"])],T.prototype,"viewModel",void 0),T=e([r("esri.widgets.Feature")],T);var U=T;export default U;
