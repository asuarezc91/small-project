/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{aliasOf as o}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as i}from"../core/accessorSupport/decorators/cast.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import n from"../core/Collection.js";import{substitute as l}from"../intl/substitute.js";import"../intl.js";import{isRTL as a}from"./support/widgetUtils.js";import{messageBundle as r}from"./support/decorators/messageBundle.js";import{renderable as c}from"./support/decorators/renderable.js";import{vmEvent as d}from"./support/decorators/vmEvent.js";import{j as h}from"../chunks/index.js";import u from"./Widget.js";import p from"./Sketch/SketchViewModel.js";import v from"./support/Selector.js";const m="esri-sketch",b="esri-sketch--vertical",_="esri-sketch__panel",g="esri-sketch__info-panel",f="esri-sketch__section",y="esri-sketch__tool-section",w="esri-sketch__info-section",S="esri-sketch__info-count-section",C="esri-sketch__feature-count-badge",M="esri-sketch__feature-count-number",T="esri-sketch__button",k="esri-sketch__button--selected",B="esri-icon-map-pin",O="esri-icon-polygon",j="esri-icon-polyline",I="esri-icon-radio-unchecked",R="esri-icon-checkbox-unchecked",P="esri-icon-cursor",E="esri-icon-trash",G="esri-icon-undo",U="esri-icon-redo",L="esri-icon-cursor-marquee",D="esri-icon-lasso",x="esri-widget",F="esri-icon-edit",z="esri-disabled",V={createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{"rectangle-selection":!0,"lasso-selection":!0},undoRedoMenu:!0};let A=class extends u{constructor(e,t){super(e,t),this._activeCreateOptions=null,this._activeSelectionInfo=null,this._selector=new v,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.createGraphic=null,this.creationMode="continuous",this.defaultCreateOptions=null,this.defaultUpdateOptions=null,this.iconClass=F,this.label=void 0,this.layer=null,this.messages=null,this.updateGraphics=new n,this.view=null,this.viewModel=new p,this.visibleElements={...V},this._activateCreateTool=this._activateCreateTool.bind(this)}initialize(){const{view:e}=this;this._selector.view=e,this.own([this.viewModel.on("create",(()=>this.scheduleRender())),this.viewModel.on("update",(()=>this.scheduleRender())),this.viewModel.on("create",(e=>this._onCreateOperation(e))),this.viewModel.on("delete",(e=>this.emit("delete",e))),this.viewModel.on("undo",(()=>this.scheduleRender())),this.viewModel.on("redo",(()=>this.scheduleRender())),this.viewModel.watch("view",(e=>this._selector.set({view:e}))),this.viewModel.watch("state",(()=>this.notifyChange("state")))])}get activeTool(){var e;return(null==(e=this._activeSelectionInfo)?void 0:e.tool)||this.viewModel.activeTool}set layout(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}get state(){return this._activeSelectionInfo?"active":this.viewModel.state}castVisibleElements(e){return{...V,...e,createTools:{...V.createTools,...null==e?void 0:e.createTools},selectionTools:{...V.selectionTools,...null==e?void 0:e.selectionTools}}}create(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)}update(e,t){return this.viewModel.update(e,t)}complete(){}cancel(){this._cancelSelectionOperation(),this.viewModel.cancel()}undo(){}redo(){}delete(){}render(){const{label:e,layout:t,viewModel:{state:o}}=this;return h("div",{"aria-label":e,class:this.classes(m,x,{[z]:"disabled"===o,[b]:"vertical"===t})},h("div",{class:_},this.renderTopPanelContents()),h("div",{class:this.classes(_,g)},this.renderInfoPanelContents()))}renderTopPanelContents(){const e=this.classes(f,y),{availableCreateTools:t,visibleElements:o}=this;return[h("div",{key:"selection-button-container",class:e},this.renderSelectionTools()),t&&t.length?h("div",{class:e},this.renderDrawButtons()):null,o.undoRedoMenu?h("div",{key:"menu-button-container",class:e},this.renderMenuButtons()):null]}renderInfoPanelContents(){if(this.updateGraphics.length)return[h("div",{class:this.classes(f,w,S),key:"feature-count-container"},this.renderFeatureCount()),h("div",{class:this.classes(f,w),key:"delete-button-container"},this.renderDeleteButton())]}renderFeatureCount(){const{layout:e,messages:t,updateGraphics:{length:o}}=this,i=l(1===o?t.featureCount:t.featuresCount,{count:o});return h("div",{class:C,"aria-label":i},h("span",{class:M},"vertical"===e?o:i))}renderDeleteButton(){const e=this.messages.deleteFeature;return h("button",{"aria-label":e,bind:this,class:this.classes(T,E),onclick:this.delete,title:e,type:"button"})}renderSelectionTools(){return[this.renderDefaultSelectionButton(),this.renderRectangleSelectionButton(),this.renderLassoSelectionButton()]}renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return h("button",{"aria-label":e,bind:this,class:this.classes(T,P,{[k]:"ready"===this.state}),onclick:this.cancel,title:e})}renderRectangleSelectionButton(){var e,t;if("2d"!==(null==(e=this.view)?void 0:e.type)||!this.visibleElements.selectionTools["rectangle-selection"])return;const o=this.messages.selectRectangle;return h("button",{"aria-label":o,bind:this,class:this.classes(T,L,{[k]:"rectangle-selection"===(null==(t=this._activeSelectionInfo)?void 0:t.tool)}),onclick:this._activateRectangleSelectTool,title:o})}renderLassoSelectionButton(){var e,t;if("2d"!==(null==(e=this.view)?void 0:e.type)||!this.visibleElements.selectionTools["lasso-selection"])return;const o=this.messages.selectLasso;return h("button",{"aria-label":o,bind:this,class:this.classes(T,D,{[k]:"lasso-selection"===(null==(t=this._activeSelectionInfo)?void 0:t.tool)}),onclick:this._activateLassoSelectTool,title:o})}renderDrawButtons(){const e=this.visibleElements.createTools;return this.availableCreateTools.map((t=>"point"===t&&e.point?this.renderPointButton():"polyline"===t&&e.polyline?this.renderPolylineButton():"polygon"===t&&e.polygon?this.renderPolygonButton():"rectangle"===t&&e.rectangle?this.renderRectangleButton():"circle"===t&&e.circle?this.renderCircleButton():void 0))}renderPointButton(){const e="point",t=this.messages.drawPoint,o=[T,B];return this.activeTool===e&&o.push(k),h("button",{"aria-label":t,bind:this,class:this.classes(o),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderPolygonButton(){const e="polygon",t=this.messages.drawPolygon,o=[T,O];return this.activeTool===e&&o.push(k),h("button",{"aria-label":t,bind:this,class:this.classes(o),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderPolylineButton(){const e="polyline",t=this.messages.drawPolyline,o=[T,j];return this.activeTool===e&&o.push(k),h("button",{"aria-label":t,bind:this,class:this.classes(o),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderCircleButton(){const e="circle",t=this.messages.drawCircle,o=[T,I];return this.activeTool===e&&o.push(k),h("button",{"aria-label":t,bind:this,class:this.classes(o),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderRectangleButton(){const e="rectangle",t=this.messages.drawRectangle,o=[T,R];return this.activeTool===e&&o.push(k),h("button",{"aria-label":t,bind:this,class:this.classes(o),"data-tool-name":e,onclick:this._activateCreateTool,title:t,type:"button"})}renderMenuButtons(){return[this.renderUndoButton(),this.renderRedoButton()]}renderUndoButton(){const e=this.messages.undo,t=!this.viewModel.canUndo(),o=a()?U:G;return h("button",{"aria-label":e,bind:this,class:this.classes(T,o),disabled:t,onclick:this.undo,title:e,type:"button"})}renderRedoButton(){const e=this.messages.redo,t=!this.viewModel.canRedo(),o=a()?G:U;return h("button",{"aria-label":e,bind:this,class:this.classes(T,o),disabled:t,onclick:this.redo,title:e,type:"button"})}_cancelSelectionOperation(){var e,t;null==(e=this._activeSelectionInfo)||null==(t=e.operation)||t.cancel(),this._activeSelectionInfo=null,this._selector.candidates=null}_activateCreateTool(e){const t=e.target.getAttribute("data-tool-name");this.activeTool!==t?(this._activeSelectionInfo&&this._cancelSelectionOperation(),this.create(t)):this.cancel()}_onCreateOperation(e){if("complete"!==e.state)return;const{creationMode:t}=this,{type:o}=e;if("create"===o){const{tool:o,graphic:i}=e,s=this._activeCreateOptions;this._activeCreateOptions=null,"continuous"===t?this.create(o,s):"update"===t&&this.update([i])}}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:o}=e;if(this._activeSelectionInfo=null,!e.aborted&&o.length){const e=t.tool,i=o.length>1&&"reshape"===e?"transform":e;this.update(o,{...t,tool:i})}this.notifyChange("state")}_activateRectangleSelectTool(){if(this._activeSelectionInfo){const e=this._activeSelectionInfo.tool;if(this._cancelSelectionOperation(),"rectangle-selection"===e)return}else"active"===this.state&&this.cancel();this._selector.candidates=this._getSelectionCandidates();const e=this._selector.draw({tool:"rectangle"});e.once("complete",(e=>this._onSelectionOperationComplete(e))),this._activeSelectionInfo={tool:"rectangle-selection",operation:e}}_activateLassoSelectTool(){if(this._activeSelectionInfo){const e=this._activeSelectionInfo.tool;if(this._cancelSelectionOperation(),"lasso-selection"===e)return}else"active"===this.state&&this.cancel();this._selector.candidates=this._getSelectionCandidates();const e=this._selector.draw({tool:"polygon",createOptions:{mode:"freehand"}});e.once("complete",(e=>this._onSelectionOperationComplete(e))),this._activeSelectionInfo={tool:"lasso-selection",operation:e}}_getSelectionCandidates(){var e,t;return(null==(e=this.layer)||null==(t=e.graphics)?void 0:t.toArray())||[]}};e([t()],A.prototype,"_activeSelectionInfo",void 0),e([t({dependsOn:["_activeSelectionInfo","viewModel.activeTool"]})],A.prototype,"activeTool",null),e([t({cast:e=>{if(!e||!e.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter((e=>t.has(e)))}}),c()],A.prototype,"availableCreateTools",void 0),e([o("viewModel.createGraphic"),c()],A.prototype,"createGraphic",void 0),e([t()],A.prototype,"creationMode",void 0),e([o("viewModel.defaultCreateOptions"),c()],A.prototype,"defaultCreateOptions",void 0),e([o("viewModel.defaultUpdateOptions"),c()],A.prototype,"defaultUpdateOptions",void 0),e([t()],A.prototype,"iconClass",void 0),e([t({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],A.prototype,"label",void 0),e([o("viewModel.layer"),c()],A.prototype,"layer",void 0),e([t({value:"horizontal"}),c()],A.prototype,"layout",null),e([t(),c(),r("esri/widgets/Sketch/t9n/Sketch")],A.prototype,"messages",void 0),e([t({dependsOn:["_activeSelectionInfo","viewModel.state"]}),c()],A.prototype,"state",null),e([o("viewModel.updateGraphics"),c(["updateGraphics","updateGraphics.length"])],A.prototype,"updateGraphics",void 0),e([o("viewModel.view"),c()],A.prototype,"view",void 0),e([t(),c("viewModel.state"),d(["create","update","undo","redo"])],A.prototype,"viewModel",void 0),e([t(),c()],A.prototype,"visibleElements",void 0),e([i("visibleElements")],A.prototype,"castVisibleElements",null),e([o("viewModel.complete")],A.prototype,"complete",null),e([o("viewModel.undo")],A.prototype,"undo",null),e([o("viewModel.redo")],A.prototype,"redo",null),e([o("viewModel.delete")],A.prototype,"delete",null),A=e([s("esri.widgets.Sketch")],A);var q=A;export default q;
