/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isNone as s,isSome as l}from"../../core/maybe.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{binaryIndexOf as o}from"../../core/arrayUtils.js";import{isAbortError as r}from"../../core/promiseUtils.js";import i from"../../core/Accessor.js";import n from"../../core/Collection.js";import{referenceSetter as d}from"../../core/collectionUtils.js";import u from"../../core/Handles.js";import{createLoadLayersFunction as h}from"./support/layerUtils.js";import{getDomainInfo as p,getValidNumber as c,getMin as m,getMax as y}from"./support/validation.js";let v=class extends i{constructor(e){super(e),this.state="disabled",this._handles=new u,this._domainInfo=p([]),this._loadLayers=h(),this.layers=new n}initialize(){this._handles.add(this.layers.on("change",(()=>this._onLayersChange()))),this._onLayersChange()}destroy(){this._set("state","disabled"),this._handles.destroy()}get enabled(){return this.allowedValues.length>0&&this._get("enabled")}set enabled(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}set value(e){if(e===this.value)return;const l=c(e,this);s(l)||this._set("value",l)}get min(){return m(this.allowedValues)}get max(){return y(this.allowedValues)}get allowedValues(){return this._domainInfo.allowedValues}get hasNext(){if(!this.enabled)return!0;const e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}get hasPrevious(){return!this.enabled||this._valueIndex>0}set layers(e){const s=this._get("layers");this._set("layers",d(e,s))}get filterExpressions(){return{solid:null,xRay:null}}get _valueIndex(){return o(this.allowedValues,this.value)}select(e){const s=c(e,this);l(s)&&(this.enabled=!0,this.value=e)}clear(){this.enabled=!1}next(){if(0!==this.allowedValues.length)return this.enabled?void(this.hasNext&&(this.value=this.allowedValues[this._valueIndex+1])):(this.enabled=!0,void(this.value=this.allowedValues[0]))}previous(){if(0!==this.allowedValues.length)return this.enabled?void(this.hasPrevious&&(this.value=this.allowedValues[this._valueIndex-1])):(this.enabled=!0,void(this.value=this.allowedValues[this.allowedValues.length-1]))}getValueLabel(e){var s;return 0===this.layers.length?null:null!=(s=this._domainInfo.fieldValueMap.get(e))?s:null}async _onLayersChange(){if(this._set("state","loading"),this._domainInfo=p([]),0!==this.layers.length)try{await this._loadLayers(this.layers),this._setup(),this._set("state","ready")}catch(e){r(e)||this._set("state","failed")}}};e([t({value:!1,nonNullable:!0,dependsOn:["allowedValues"]})],v.prototype,"enabled",null),e([t({value:0,nonNullable:!0})],v.prototype,"value",null),e([t({readOnly:!0,dependsOn:["allowedValues"]})],v.prototype,"min",null),e([t({readOnly:!0,dependsOn:["allowedValues"]})],v.prototype,"max",null),e([t({readOnly:!0,dependsOn:["_domainInfo"]})],v.prototype,"allowedValues",null),e([t({readOnly:!0,dependsOn:["allowedValues","_valueIndex","enabled"]})],v.prototype,"hasNext",null),e([t({readOnly:!0,dependsOn:["_valueIndex","enabled"]})],v.prototype,"hasPrevious",null),e([t({type:n,nonNullable:!0})],v.prototype,"layers",null),e([t({nonNullable:!0})],v.prototype,"state",void 0),e([t({readOnly:!0,dependsOn:["value","allowedValues"]})],v.prototype,"_valueIndex",null),e([t()],v.prototype,"_domainInfo",void 0),v=e([a("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],v);var _=v;export default _;
