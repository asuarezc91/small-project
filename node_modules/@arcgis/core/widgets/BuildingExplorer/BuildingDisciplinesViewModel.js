/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as s}from"../../core/maybe.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import{subclass as t}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{isAbortError as o}from"../../core/promiseUtils.js";import i from"../../core/Accessor.js";import a from"../../core/Collection.js";import{referenceSetter as l}from"../../core/collectionUtils.js";import d from"../../core/Handles.js";import{findFullModelSublayer as p}from"./support/buildingLayerUtils.js";import{LayerTreeNode as n}from"./support/LayerTreeNode.js";import{createLoadLayersFunction as h}from"./support/layerUtils.js";let c=class extends i{constructor(e){super(e),this.root=new n,this.state="disabled",this._handles=new d,this._loadLayers=h(),this.layers=new a}initialize(){this._handles.add(this.layers.on("change",(()=>this._onLayersChange()))),this._onLayersChange()}destroy(){this._set("state","disabled"),this._handles.destroy(),this.root.destroy()}set layers(e){const s=this._get("layers");this._set("layers",l(e,s))}_updateLayerTree(){this.root.destroy(),this._set("root",new n({collapsed:!1}));const e=new Map,r=this.layers.length>1?"modelName":"id";return this.layers.forEach((t=>{const o=p(t);s(o)&&this._addNodesForSublayers(o,this.root,e,r)})),this}_addNodeForLayer(e,r,t,o){const i=String(e.get(o)).toLowerCase();if(!s(i)||e.isEmpty)return;const a=`${r.id}/${i}`;let l=t.get(a);l||(l=new n({id:i,level:r.level+1}),t.set(a,l)),l.layers.push(e),r.children.push(l),this._addNodesForSublayers(e,l,t,o)}_addNodesForSublayers(e,s,r,t){"building-group"!==e.type||e.isEmpty||e.sublayers.forEach((e=>this._addNodeForLayer(e,s,r,t)))}async _onLayersChange(){if(this._set("state","loading"),0!==this.layers.length)try{await this._loadLayers(this.layers),this._updateLayerTree(),this._set("state","ready")}catch(e){o(e)||this._set("state","failed")}}};e([r({readOnly:!0})],c.prototype,"root",void 0),e([r({type:a,nonNullable:!0})],c.prototype,"layers",null),e([r({readOnly:!0,nonNullable:!0})],c.prototype,"state",void 0),c=e([t("esri.widgets.BuildingExplorer.BuildingDisciplineViewModel")],c);var y=c;export default y;
