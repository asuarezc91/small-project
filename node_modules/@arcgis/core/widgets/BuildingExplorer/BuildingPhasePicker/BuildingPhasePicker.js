/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import{isSome as s,unwrap as t,isNone as r}from"../../../core/maybe.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import{aliasOf as o}from"../../../core/accessorSupport/decorators/aliasOf.js";import{subclass as a}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{storeNode as h,isRTL as n}from"../../support/widgetUtils.js";import{renderable as l}from"../../support/decorators/renderable.js";import{j as d}from"../../../chunks/index.js";import u from"../../Widget.js";import c from"../BuildingPhase.js";const p={nextPhase:"nextPhase",previousPhase:"previousPhase",currentPhase:"{{value}}"},_="esri-building-phase-picker",v={container:`${_}`,phasesContainer:`${_}__phases-container`,phase:`${_}__phase`,phaseActive:`${_}__phase--active`,phaseCurrent:`${_}__phase--current`,divider:`${_}__divider`,dividerActive:`${_}__divider--active`,arrowLeft:`${_}__arrow-left`,arrowRight:`${_}__arrow-right`};let w=class extends u{constructor(e,s){super(e,s),this._defaultViewModel=new c,this.viewModel=this._defaultViewModel,this.messages=p,this._phasesContainer=null,this._shouldScrollCurrentPhaseIntoView=!0,this._shouldFocusCurrentPhase=!1}initialize(){this.own(this.watch(["_currentPhase","_container"],(()=>{this._shouldScrollCurrentPhaseIntoView=!0})))}destroy(){this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get _currentPhase(){return this.viewModel.enabled?this.viewModel.value:null}render(){if(this._phases.length<2)return d("div",null);const e=n(),s=this.messages.previousPhase,t=this.messages.nextPhase;return d("div",{bind:this,key:this,class:this.classes("esri-widget",v.container),onkeydown:this._onKeyDown},d("button",{bind:this,class:e?v.arrowRight:v.arrowLeft,disabled:!this.viewModel.hasPrevious,onclick:this._onArrowLeftClick,"aria-label":s,title:s,type:"button"}),d("div",{bind:this,class:v.phasesContainer,afterCreate:h,"data-node-ref":"_phasesContainer",afterUpdate:this._onPhasesContainerAfterUpdate},this._renderPhaseButtons()),d("button",{bind:this,class:e?v.arrowLeft:v.arrowRight,disabled:!this.viewModel.hasNext,onclick:this._onArrowRightClick,"aria-label":t,title:t,type:"button"}))}_renderPhaseButtons(){const e=this._phases,t=[];for(let r=0;r<e.length;++r){const i=e[r],o={phase:i,active:!!s(this._currentPhase)&&i<=this._currentPhase,current:!!s(this._currentPhase)&&i===this._currentPhase};r>0&&t.push(this._renderDivider(o)),t.push(this._renderPhaseButton(o))}return t}_renderPhaseButton({phase:e,active:s,current:r}){const i=t(this.viewModel.getValueLabel(e));return d("button",{key:`phase-${e}`,class:this.classes(v.phase,{[v.phaseActive]:s,[v.phaseCurrent]:r}),"aria-label":i,title:i,onclick:()=>this.viewModel.select(e),type:"button"},e)}_renderDivider({phase:e,active:s}){return d("div",{key:`phase-divider-${e}`,class:this.classes(v.divider,{[v.dividerActive]:s})})}_onKeyDown(e){switch(e.key){case"ArrowDown":case"ArrowLeft":e.stopPropagation(),e.preventDefault(),this.viewModel.previous(),this._shouldFocusCurrentPhase=!0;break;case"ArrowUp":case"ArrowRight":e.stopPropagation(),e.preventDefault(),this.viewModel.next(),this._shouldFocusCurrentPhase=!0}}_onArrowLeftClick(){this.viewModel.previous()}_onArrowRightClick(){this.viewModel.next()}_onPhasesContainerAfterUpdate(){if(r(this._phasesContainer))return;const e=this._phasesContainer.querySelector(`.${v.phaseCurrent}`);if(!r(e)){if(this._shouldScrollCurrentPhaseIntoView){const s=this._phasesContainer.offsetWidth,t=e.offsetLeft,r=e.offsetWidth;this._phasesContainer.scrollLeft=-s/2+t-r/2,this._shouldScrollCurrentPhaseIntoView=!1}this._shouldFocusCurrentPhase&&(e.focus(),this._shouldFocusCurrentPhase=!1)}}};e([i({type:c}),l(["viewModel.layers.length","viewModel.hasNext","viewModel.hasPrevious"])],w.prototype,"viewModel",void 0),e([i(),l()],w.prototype,"messages",void 0),e([o("viewModel.allowedValues"),l()],w.prototype,"_phases",void 0),e([i({readOnly:!0,dependsOn:["viewModel.enabled","viewModel.value"]}),l()],w.prototype,"_currentPhase",null),e([i()],w.prototype,"_phasesContainer",void 0),w=e([a("esri.widgets.BuildingExplorer.BuildingPhasePicker.BuildingPhasePicker")],w);var f=w;export default f;
