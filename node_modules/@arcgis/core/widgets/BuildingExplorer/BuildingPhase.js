/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as s}from"../../core/maybe.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{findFieldInfoByModelName as o}from"./support/buildingLayerUtils.js";import{getDomainInfo as i}from"./support/validation.js";import l from"./BuildingNumericFilterViewModel.js";import{getValueFromFilters as a}from"./support/filterUtils.js";let d=class extends l{constructor(){super(...arguments),this._createdPhaseFieldName=null,this._demolishedPhaseFieldName=null,this._parseValueFromFilter=e=>{const s=this._createdPhaseFieldName,t=new RegExp(`${s}\\s*<=\\s*(\\d+)\\s*OR\\s*${s}\\s*IS\\s*NULL`,"gi"),r=this._demolishedPhaseFieldName,o=new RegExp(`${r}\\s*>\\s*(\\d+)\\s*OR\\s*${r}\\s*IS\\s*NULL`,"gi");for(const{filterExpression:s}of e.filterBlocks.items){var i;const e=null!=(i=t.exec(s))?i:o.exec(s);if(e)return parseInt(e[1],10)}return null}}get filterExpressions(){if(!this.enabled)return{solid:null,xRay:null};const e=[],s=this._createdPhaseFieldName;s&&e.push(`(${s} <= ${this.value} OR ${s} IS NULL)`);const t=this._demolishedPhaseFieldName;t&&e.push(`(${t} > ${this.value} OR ${t} IS NULL)`);const r=e.join(" AND ");return{solid:r,xRay:r}}get _lastValue(){const e=this.allowedValues;return e.length>0?e[e.length-1]:0}_setup(){const e=[];this.layers.forEach((t=>{const r=o(t,"createdphase");s(r)&&(this._createdPhaseFieldName=r.fieldName,e.push(r));const i=o(t,"demolishedphase");s(i)&&(this._demolishedPhaseFieldName=i.fieldName,e.push(i))})),this._domainInfo=i(e);const t=a(this.layers,this._parseValueFromFilter);this.allowedValues.length>0?this.select(s(t)?t:this._lastValue):this.clear()}};e([t({readOnly:!0,dependsOn:["enabled","value","_createdPhaseFieldName","_demolishedPhaseFieldName"]})],d.prototype,"filterExpressions",null),e([t()],d.prototype,"_createdPhaseFieldName",void 0),e([t()],d.prototype,"_demolishedPhaseFieldName",void 0),e([t({readOnly:!0,dependsOn:["allowedValues.length"]})],d.prototype,"_lastValue",null),d=e([r("esri.widgets.BuildingExplorer.BuildingPhase")],d);var p=d;export default p;
