/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import{isSome as t}from"../../../core/maybe.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import l from"../../../core/Accessor.js";import r from"../../../core/Collection.js";import o from"../../../core/Handles.js";import{init as n}from"../../../core/watchUtils.js";let a=class extends l{constructor(){super(...arguments),this.id="root",this.parent=null,this.children=new r,this.layers=new r,this.level=0,this.collapsed=!0,this._handles=new o,this._childIds=new Set,this._layerUniqueIds=new Set}initialize(){this._handles.add([this.layers.on("before-add",(e=>{this._layerUniqueIds.has(e.item.uid)?e.preventDefault():this._layerUniqueIds.add(e.item.uid)})),this.layers.on("after-add",(({item:e})=>{this._handles.add([n(e,"visible",(()=>this.notifyChange("visible"))),n(e,"title",(()=>this.notifyChange("title")))],e.uid)})),this.layers.on("before-remove",(({item:e})=>{this._handles.remove(e.uid),this.notifyChange("title"),this.notifyChange("visible")})),this.children.on("before-add",(e=>{this._childIds.has(e.item.id)?e.preventDefault():(e.item._set("parent",this),this._childIds.add(e.item.id))}))])}destroy(){this._handles.destroy(),this.children.forEach((e=>e.destroy()))}get hasChildren(){return this.children.length>0}get isRoot(){return 0===this.level}get isLeaf(){return!this.hasChildren}get isDiscipline(){return 1===this.level}get visible(){return d(this.layers,(e=>e.visible))}get title(){return d(this.layers,(e=>e.title))||this.layers.items.map((e=>e.title)).join(", ")||null}toggleVisibility(e){const i=void 0===e?!this.visible:e;this.layers.forEach((e=>{e.visible=i})),i&&t(this.parent)&&this.parent.toggleVisibility(!0)}toggleCollapsed(e){this.collapsed=void 0===e?!this.collapsed:e}expand(){this.collapsed=!1}expandAll(){this.expand(),this.children.forEach((e=>e.expandAll()))}collapse(){this.collapsed=!0}collapseAll(){this.collapse(),this.children.forEach((e=>e.collapseAll()))}toggleAllSiblingsVisibility(e){const i=void 0===e?!this.visible:e;this.toggleVisibility(i),t(this.parent)&&(this.parent.toggleVisibility(i),this.parent.children.forEach((e=>e.toggleVisibility(i))))}};function d(e,i){let s=null;for(const l of e.items){const e=i(l);if(t(s)&&s!==e)return null;s=e}return s}e([i({nonNullable:!0})],a.prototype,"id",void 0),e([i()],a.prototype,"parent",void 0),e([i({nonNullable:!0,readOnly:!0})],a.prototype,"children",void 0),e([i({nonNullable:!0,readOnly:!0})],a.prototype,"layers",void 0),e([i({nonNullable:!0})],a.prototype,"level",void 0),e([i({nonNullable:!0})],a.prototype,"collapsed",void 0),e([i({readOnly:!0,dependsOn:["children.length"]})],a.prototype,"hasChildren",null),e([i({readOnly:!0,dependsOn:["level"]})],a.prototype,"isRoot",null),e([i({readOnly:!0,dependsOn:["hasChildren"]})],a.prototype,"isLeaf",null),e([i({readOnly:!0,dependsOn:["level"]})],a.prototype,"isDiscipline",null),e([i({readOnly:!0})],a.prototype,"visible",null),e([i({readOnly:!0})],a.prototype,"title",null),a=e([s("esri.widgets.BuildingExplorer.support.LayerTreeNode")],a);export{a as LayerTreeNode};
