/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{subclass as i}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import r from"../../core/Accessor.js";import n from"../../layers/support/CodedValueDomain.js";import{validateDomainValue as o,DomainValidationError as l,getDomainRange as s}from"../../layers/support/domains.js";import{isNumericField as a,isStringField as d,isDateField as u,TypeValidationError as p,validateFieldValue as c,getFeatureEditFields as f,getFeatureGeometryFields as h,NumericRangeValidationError as m,getFieldRange as g}from"../../layers/support/fieldUtils.js";import{substitute as y}from"../../intl/substitute.js";import"../../intl.js";const v={type:"number"},b={type:"number",intlOptions:{notation:"scientific"}},O={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"2-digit",hour:"numeric",minute:"numeric",second:"numeric"}};let _=class extends r{constructor(e){super(e),this.arcade=null,this.config=null,this.feature=null,this.field=null,this.layer=null,this.description=null,this.editorType=null,this.error=null,this.format=null,this.group=null,this.hint=null,this.messages=null,this.name=null}get compiledFunc(){var e;const{arcade:t}=this;return t&&t.arcadeUtils.createFunction(null==(e=this.config)?void 0:e.visibilityExpression)}get compiledRequiredFunc(){var e;const{arcade:t}=this;return t&&t.arcadeUtils.createFunction(null==(e=this.config)?void 0:e.requiredExpression)}get evaluatedRequirement(){const e=this.compiledRequiredFunc;if(!e)return null;const{arcade:t}=this;return t.arcadeUtils.executeFunction(e,t.arcadeUtils.createExecContext(this.feature))}get evaluatedVisibility(){const e=this.compiledFunc;if(!e)return null;const{arcade:t}=this;return t.arcadeUtils.executeFunction(e,t.arcadeUtils.createExecContext(this.feature))}get domain(){var e,t;const{typeIdField:i}=this.layer,r=i===this.name,o=null==(e=this.field)?void 0:e.domain;if(r&&!o)return new n({name:"__internal-type-based-coded-value-domain__",codedValues:this.layer.types.map((({id:e,name:t})=>({code:e,name:t})))});const{feature:l}=this,s=i&&this.layer.getFieldDomain(this.name,{feature:l})||o,a=null==(t=this.config)?void 0:t.domain;return this._isDomainCompatible(a)?a:s}get editable(){var e;return this.layer.capabilities.operations.supportsEditing&&this.field.editable&&!1!==(null==(e=this.config)?void 0:e.editable)}get errorMessage(){return this._toErrorMessage()}get includeTime(){var e;const t=null==(e=this.config)?void 0:e.includeTime;return void 0===t||t}get label(){var e;return(null==(e=this.config)?void 0:e.label)||this.field.alias||this.field.name}get maxLength(){var e,t;if("date"===this.type)return-1;const i=null==(e=this.field)?void 0:e.length,r=null==(t=this.config)?void 0:t.maxLength;return!isNaN(r)&&r>=-1&&(-1===i||r<=i)?r:i}get minLength(){var e,t;if("date"===this.type)return-1;const i=null==(e=this.field)?void 0:e.length,r=null==(t=this.config)?void 0:t.minLength;return!isNaN(r)&&r>=-1&&(-1===i||r<=i)?r:-1}get required(){var e,t;if(!this.editable)return!1;if(!(null==(e=this.field)?void 0:e.nullable))return!0;if("boolean"==typeof this.evaluatedRequirement)return this.evaluatedRequirement;return!0===(null==(t=this.config)?void 0:t.required)}get type(){const{field:e}=this;return a(e)?"number":d(e)?"text":u(e)?"date":"unsupported"}get valid(){const e=this.editable?this._validate():null;return this._set("error",e),null===e}get value(){return this._get("value")}set value(e){this.notifyChange("evaluatedVisibility"),this._set("value",e)}get visible(){if(this._isEditorField())return!1;return"boolean"==typeof this.evaluatedVisibility?this.evaluatedVisibility:!!this.config||this._shownByDefault()}_isDomainCompatible(e){const{field:t}=this;if("coded-value"===(null==e?void 0:e.type)){const i=typeof e.codedValues[0].code;if("string"===i&&d(t)||"number"===i&&a(t))return!0}return!!("range"===(null==e?void 0:e.type)&&a(t)||u(t))}_validate(){const{domain:e,field:t,minLength:i,required:r,type:n,value:l}=this;return"text"===n&&i>-1&&"string"==typeof l&&l.length<i?"length-validation-error::too-short":e?null!==l||r?o(e,l):null:r&&null===l?p.INVALID_TYPE:c(t,l)}_shownByDefault(){var e;const t=null==(e=this.field)?void 0:e.type;return"oid"!==t&&"global-id"!==t&&!this._isGeometryField()}_isEditorField(){return f(this.layer).indexOf(this.name)>-1}_isGeometryField(){return h(this.layer).indexOf(this.name)>-1}_toErrorMessage(){const{domain:e,field:t,messages:i,minLength:r,value:n,required:o,type:a}=this,d=this.error;if(o&&null===n)return i.validationErrors.cannotBeNull;if(d===l.VALUE_OUT_OF_RANGE||d===m.OUT_OF_RANGE){const r=s(e)||g(t);return y(i.validationErrors.outsideRange,r,{format:{max:"date"===a?O:r.isInteger?v:b,min:"date"===a?O:r.isInteger?v:b}})}return d===l.INVALID_CODED_VALUE?i.validationErrors.invalidCodedValue:d===p.INVALID_TYPE?i.validationErrors.invalidType:"length-validation-error::too-short"===d?y(i.validationErrors.tooShort,{min:r}):null}};e([t()],_.prototype,"arcade",void 0),e([t({dependsOn:["arcade","config.visibilityExpression"]})],_.prototype,"compiledFunc",null),e([t({dependsOn:["arcade","config.requiredExpression"]})],_.prototype,"compiledRequiredFunc",null),e([t()],_.prototype,"config",void 0),e([t({dependsOn:["compiledRequiredFunc","feature"]})],_.prototype,"evaluatedRequirement",null),e([t({dependsOn:["compiledFunc","feature"]})],_.prototype,"evaluatedVisibility",null),e([t()],_.prototype,"feature",void 0),e([t()],_.prototype,"field",void 0),e([t()],_.prototype,"layer",void 0),e([t({aliasOf:"config.description"})],_.prototype,"description",void 0),e([t({dependsOn:["config","feature","field","layer"]})],_.prototype,"domain",null),e([t({dependsOn:["config","field","layer"]})],_.prototype,"editable",null),e([t({aliasOf:"config.editorType"})],_.prototype,"editorType",void 0),e([t({readOnly:!0})],_.prototype,"error",void 0),e([t({dependsOn:["error","messages","value"],autoTracked:!1})],_.prototype,"errorMessage",null),e([t({aliasOf:"config.format"})],_.prototype,"format",void 0),e([t()],_.prototype,"group",void 0),e([t({aliasOf:"config.hint"})],_.prototype,"hint",void 0),e([t({dependsOn:["config.includeTime"]})],_.prototype,"includeTime",null),e([t({dependsOn:["field","config"]})],_.prototype,"label",null),e([t({dependsOn:["field.length","config"]})],_.prototype,"maxLength",null),e([t({dependsOn:["field.length","config"]})],_.prototype,"minLength",null),e([t()],_.prototype,"messages",void 0),e([t({aliasOf:"field.name"})],_.prototype,"name",void 0),e([t({dependsOn:["config","evaluatedRequirement","field"]})],_.prototype,"required",null),e([t({dependsOn:["field"]})],_.prototype,"type",null),e([t({dependsOn:["config","domain","field","layer","value"]})],_.prototype,"valid",null),e([t({value:null})],_.prototype,"value",null),e([t({dependsOn:["config","evaluatedVisibility","field","layer"]})],_.prototype,"visible",null),_=e([i("esri.widgets.FeatureForm.InputField")],_);var E=_;export default E;
