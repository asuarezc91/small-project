/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{isSome as t,isNone as o}from"../../core/maybe.js";import r from"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{aliasOf as l}from"../../core/accessorSupport/decorators/aliasOf.js";import{subclass as i}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import{ignoreAbortErrors as a}from"../../core/promiseUtils.js";import d from"../../core/Accessor.js";import n from"../../core/Collection.js";import{referenceSetter as c,castForReferenceSetter as p}from"../../core/collectionUtils.js";import u from"../../core/Handles.js";import{c as h,a as m}from"../../chunks/boundedPlane.js";import{InteractiveToolViewModel as y}from"../support/InteractiveToolViewModel.js";import{planeToShape as f,shapeToPlane as x}from"../../views/3d/interactive/analysisTools/slice/sliceToolUtils.js";import g from"../../views/3d/interactive/analysisTools/slice/SliceTool.js";import w from"./SlicePlane.js";const v=r.getLogger("esri.widgets.Slice.SliceViewModel"),S=new Set;let j=class extends y{constructor(e){super(e),this.supportedViewType="3d",this.handles=new u,S.add(this)}destroy(){S.delete(this),this.handles.destroy()}get state(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}get plane(){return this.tool?this.tool.plane:this._get("plane")}set plane(e){this._clearOverride("shape"),this._set("plane",e),t(e)?this.tool?this.tool.plane=e:e&&a(this.createTool()):this.removeTool()}get shape(){if(o(this.plane))return null;const e=this._get("shape"),r=this.view,s=f(this.plane,r.renderCoordsHelper,r.spatialReference,new w);return o(s)||o(e)?s:s.heading===e.heading&&s.tilt===e.tilt&&t(s.position)&&t(e.position)&&s.position.equals(e.position)&&s.width===e.width&&s.height===e.height?e:s}set shape(e){if(o(this.view)||!this.view.ready)return void this._override("shape",e);const r=x(e,this.view.renderCoordsHelper,h());t(this.plane)&&t(r)&&m(this.plane,r)||(this.plane=r)}get tiltEnabled(){var e,t,o;return null!=(e=null!=(t=null==(o=this.tool)?void 0:o.tiltEnabled)?t:this._get("tiltEnabled"))&&e}set tiltEnabled(e){this._set("tiltEnabled",e),this._updateToolOrRecreate((t=>t.tiltEnabled=e))}get excludedLayers(){return this.tool?this.tool.excludedLayers:this._get("excludedLayers")||new n}set excludedLayers(e){this._set("excludedLayers",c(e,this.excludedLayers)),this._updateToolOrRecreate((t=>t.excludedLayers=e))}get excludeGroundSurface(){return this.tool?this.tool.excludeGroundSurface:this._get("excludeGroundSurface")||!1}set excludeGroundSurface(e){this._set("excludeGroundSurface",e),this._updateToolOrRecreate((t=>t.excludeGroundSurface=e))}start(){return S.forEach((e=>{e.view===this.view&&e!==this&&e.clear()})),this.createTool()}clear(){this.removeTool(),this._set("plane",null),this._set("excludeGroundSurface",!1),this._set("excludedLayers",new n)}newSlice(){a(this.start())}clearSlice(){this.clear()}removeSliceAndStart(){return this.removeTool(),this.plane=null,this.start()}enterExcludeLayerMode(){this.tool&&this.tool.enterExcludeLayerMode()}exitExcludeLayerMode(){this.tool&&this.tool.exitExcludeLayerMode()}async createTool(){if(await this.view.whenReady(),this._isOverridden("shape")){const e=this.shape;this._clearOverride("shape"),this.shape=e}await super.createTool()}_updateToolOrRecreate(e){this.tool?e(this.tool):this.creatingTool&&a(this.createTool())}createToolParams(){return{toolConstructor:g,constructorArguments:()=>({excludeGroundSurface:this.excludeGroundSurface,plane:this.plane,excludedLayers:this.excludedLayers,tiltEnabled:this.tiltEnabled})}}logUnsupportedError(){this.logError("Slice widget is not implemented for MapView")}logError(...e){v.error(...e)}};e([s({dependsOn:["isDisabled","tool.attached","tool.state"],readOnly:!0})],j.prototype,"state",null),e([s()],j.prototype,"tool",void 0),e([s({dependsOn:["tool.plane"]})],j.prototype,"plane",null),e([s({types:{key:"type",base:d,typeMap:{plane:w},defaultKeyValue:"plane"},dependsOn:["plane"]})],j.prototype,"shape",null),e([s({type:Boolean,dependsOn:["tool.tiltEnabled"]})],j.prototype,"tiltEnabled",null),e([l("tool.layersMode")],j.prototype,"layersMode",void 0),e([s({dependsOn:["tool.excludedLayers"],cast:p})],j.prototype,"excludedLayers",null),e([s({dependsOn:["tool.excludeGroundSurface"],nonNullable:!0})],j.prototype,"excludeGroundSurface",null),j=e([i("esri.widgets.slice.SliceViewModel")],j);var T=j;export default T;
