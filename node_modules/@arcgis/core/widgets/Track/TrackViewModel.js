/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import o from"../support/GeolocationPositioning.js";let s=class extends o{constructor(t){super(t),this._watchId=null,this._trackStartingTimeoutId=null,this._settingPosition=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||null!==this._trackStartingTimeoutId?"waiting":this.tracking?"tracking":"ready":"feature-unsupported"}get tracking(){return null!==this._watchId}start(){"disabled"!==this.state&&"feature-unsupported"!==this.state&&this._startTracking()}stop(){"disabled"!==this.state&&"feature-unsupported"!==this.state&&this._stopTracking()}_stopWatchingPosition(){null!==this._watchId&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=null)}_stopTracking(){this._clearWaitingTimer(),this._stopWatchingPosition(),this._clear()}_startTracking(){this._stopTracking();const t=navigator.geolocation.watchPosition((i=>{this._watchId=t,this._settingPosition=this._setPosition(i).then((t=>{this._clearWaitingTimer();const{view:i,graphic:r}=this;if(i&&i.graphics.remove(r),r){const t=r.clone();this.graphic=t,i&&i.graphics.push(t)}this.emit("track",{position:t})})).catch((t=>{throw this._emitError(t),this._clearWaitingTimer(),t}))}),this._handleWatchPositionError.bind(this),this.geolocationOptions);this._trackStartingTimeoutId=setTimeout((()=>{this._trackStartingTimeoutId=null}),15e3)}_handleWatchPositionError(t){this._emitError(t),this._stopTracking()}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=null,this._settingPosition=null}_emitError(t){this.emit("track-error",{error:t})}};t([i()],s.prototype,"_watchId",void 0),t([i()],s.prototype,"_trackStartingTimeoutId",void 0),t([i()],s.prototype,"_settingPosition",void 0),t([i({dependsOn:["view.ready","tracking","_geolocationUsable","_trackStartingTimeoutId","_settingPosition"],readOnly:!0})],s.prototype,"state",null),t([i({readOnly:!0,dependsOn:["_watchId"]})],s.prototype,"tracking",null),t([i()],s.prototype,"start",null),t([i()],s.prototype,"stop",null),s=t([r("esri.widgets.Track.TrackViewModel")],s);var e=s;export default e;
