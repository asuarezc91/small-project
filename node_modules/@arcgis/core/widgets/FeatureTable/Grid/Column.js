/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import r from"../../../core/Evented.js";import{watch as i}from"../../../core/watchUtils.js";import{HandleOwnerMixin as n}from"../../../core/HandleOwner.js";import{renderingSanitizer as s}from"../../support/widgetUtils.js";import l from"./support/ButtonMenu.js";const d="esri-icon-arrow-up",u="esri-icon-arrow-down",a="esri-column__menu-container",h="esri-icon-handle-horizontal",c="esri-column__sorter",p="Enter",m="Spacebar";let v=class extends(n(r.EventedAccessor)){constructor(e){super(e),this._menuContainer=null,this.activeRowIndex=null,this.autoWidth=!1,this.cellValueFormatFunction=({value:e})=>s.sanitize(e),this.flexGrow=1,this.footerRenderFunction=null,this.frozen=!1,this.grid=null,this.header=null,this.headerRenderFunction=e=>{const{root:t}=e,{header:o,headerMenuEnabled:r,path:i,sortable:n}=this;if(this.removeCellContent(t),n)return this.headerSorterRenderFunction(e),void(r&&this.headerMenuRenderFunction(e));r&&this.headerMenuRenderFunction(e);const s=o||i;t.innerHTML!==s&&(t.innerHTML=s)},this.headerMenuRenderFunction=({root:e})=>{var t,o;(null==(t=this.menu)||null==(o=t.items)?void 0:o.length)&&e.appendChild(this._menuContainer)},this.headerSorterRenderFunction=({root:e})=>{var t;const{header:o,path:r,sortElement:i}=this,n=o||r;if(!i)return void(e.innerHTML=n);i.setAttribute("innerHTML",n),e.appendChild(i);const s=null==(t=this.grid)?void 0:t.getSlotElementByName(e.slot),l=null==s?void 0:s.parentElement;l&&!l.onkeydown&&(l.onkeydown=({key:e})=>{e!==p&&e!==m||i.click()})},this.hidden=!1,this.headerMenuEnabled=!0,this.menu=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.renderFunction=({root:e,column:t,rowData:o})=>{const r=this.getCellValue(t,o),i=this.cellValueFormatFunction({column:t,rowData:o,value:r});e.innerHTML!==i&&(e.innerHTML=i)},this.resizable=!0,this.sortable=!0,this.sortElement=null,this.textAlign="start",this.width=200}initialize(){const{path:e}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",e),this._menuContainer=document.createElement("div"),this._menuContainer.classList.add(a),this.menu=new l({iconClass:h,...this.menuConfig}),this.menu.container=this._menuContainer,this.menu.set("items",this.getMenuItems()),this.handles.add([i(this,"hidden",(()=>{var e;return null==(e=this.menu)?void 0:e.set("open",!1)}))])}destroy(){var e;null==(e=this.menu)||e.destroy()}set direction(e){if(this.sortable){var t,o;if(e)null==(t=this.sortElement)||t.setAttribute("direction",e);else null==(o=this.sortElement)||o.removeAttribute("direction");this._set("direction",e)}}set path(e){var t;null==(t=this.sortElement)||t.setAttribute("path",e),this._set("path",e)}getMenuItems(){const{menuConfig:e,sortable:t}=this,o=null==e?void 0:e.items,r=this.getSortMenuItems(),i=[];return t&&i.push(...r),(null==o?void 0:o.length)&&i.push(...o),i.length?i:null}getSortMenuItems(){const{messages:e}=this;return[{selected:"asc"===this.direction,iconClass:d,label:null==e?void 0:e.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:u,label:null==e?void 0:e.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]}getCellValue(e,t){var o;return null!=(o=null==t?void 0:t.item[null==e?void 0:e.path])?o:""}createSortElement(){const{direction:e,header:t,path:o}=this,r=t||o,i=document.createElement("vaadin-grid-sorter");return i.classList.add(c),i.setAttribute("path",o),e&&i.setAttribute("direction",e),i.innerHTML=r,i}removeCellContent(e){if(e)for(;e.firstChild;)try{e.removeChild(e.firstChild)}catch(e){}}};e([t()],v.prototype,"activeRowIndex",void 0),e([t()],v.prototype,"autoWidth",void 0),e([t()],v.prototype,"cellValueFormatFunction",void 0),e([t()],v.prototype,"direction",null),e([t()],v.prototype,"flexGrow",void 0),e([t()],v.prototype,"footerRenderFunction",void 0),e([t()],v.prototype,"frozen",void 0),e([t()],v.prototype,"grid",void 0),e([t()],v.prototype,"header",void 0),e([t()],v.prototype,"headerRenderFunction",void 0),e([t()],v.prototype,"headerMenuRenderFunction",void 0),e([t()],v.prototype,"headerSorterRenderFunction",void 0),e([t()],v.prototype,"hidden",void 0),e([t()],v.prototype,"headerMenuEnabled",void 0),e([t()],v.prototype,"menu",void 0),e([t()],v.prototype,"menuConfig",void 0),e([t()],v.prototype,"messages",void 0),e([t()],v.prototype,"messagesCommon",void 0),e([t()],v.prototype,"path",null),e([t()],v.prototype,"renderFunction",void 0),e([t()],v.prototype,"resizable",void 0),e([t()],v.prototype,"sortable",void 0),e([t({readOnly:!0})],v.prototype,"sortElement",void 0),e([t()],v.prototype,"textAlign",void 0),e([t()],v.prototype,"width",void 0),v=e([o("esri.widgets.FeatureTable.Grid.Column")],v);var y=v;export default y;
