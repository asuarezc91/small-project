/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as e}from"../../../core/accessorSupport/decorators/property.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import n from"./Column.js";const i="esri-editor-column__cell-input",r="esri-editor-column__cell-input--container",a="Enter",u="Escape";let l=class extends n{constructor(t){super(t),this.activeEditInfo=null,this.cellValueValidatorFunction=({oldValue:t,value:e})=>t!==e,this.editable=!1,this.inputRenderFunction=({root:t,column:e,rowData:o})=>{var n,i;if(null!=(n=this.activeEditInfo)&&n.updating)return;if(!this.editable)return;const r=this.getCellValue(e,o),a=this.createInputElement({root:t,column:e,rowData:o,value:r});this._set("activeEditInfo",{column:e,input:a,root:t,rowData:o,updating:!0,oldValue:r});const u=this.createInputContainer();u.appendChild(a),this.removeCellContent(t),t.appendChild(u),a.focus(),a instanceof HTMLInputElement&&a.select(),null==(i=this.grid)||i.notifyResize()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.parseInputValueFunction=({input:t})=>t.value,this.renderFunction=t=>{var e;const{root:o,column:n,rowData:i}=t,{activeEditInfo:r}=this;if(r&&r.updating)return;const l=this.getCellValue(n,i),s=this.cellValueFormatFunction({column:n,rowData:i,value:l});o.onclick=()=>o.focus(),o.ondblclick=()=>this.inputRenderFunction(t),o.ontouchend=()=>this.inputRenderFunction(t);const c=null==(e=this.grid)?void 0:e.getSlotElementByName(o.slot),p=null==c?void 0:c.parentElement;p&&(p.onkeydown=e=>{e.key!==a||this.activeEditInfo||this.inputRenderFunction(t),e.key===u&&this.activeEditInfo&&this.cancel()}),(null==s?void 0:s.toString())!==o.innerHTML&&(o.innerHTML=s)},this.required=!1,this.store=null,this.updateRowItemFunction=({rowData:t,column:e,value:o})=>{t.item[e.path]=o},this.updateStoreItemFunction=({rowData:t,column:e,value:o})=>{var n;return null==(n=this.store)?void 0:n.updateItem({index:t.index,name:e.path,value:o})}}cancel(){var t;const{activeEditInfo:e}=this;if(!e)return;const{column:o,root:n,rowData:i,oldValue:r}=e;this._set("activeEditInfo",null);const a=this.cellValueFormatFunction({column:o,rowData:i,value:r});n.innerHTML=a,null==(t=this.grid)||t.notifyResize()}createInputContainer(){const t=document.createElement("div");return t.classList.add(r),t}createInputElement({value:t}){const e=document.createElement("input");return e.classList.add(i),e.maxLength=this.maxLength,e.type=this.inputType,e.value=t,e.onblur=()=>{e.onblur=null,this.submit()},e}async submit(){var t;const{activeEditInfo:e}=this;if(!e)return;const{column:o,input:n,root:i,rowData:r,oldValue:a}=e,u=this.parseInputValueFunction({input:n,column:o,rowData:r});if(!this.cellValueValidatorFunction({value:u,oldValue:a,column:o,rowData:r}))this.cancel();else{i.innerHTML=this.loadingMessage,null==(t=this.grid)||t.notifyResize();try{var l;await this.updateStoreItemFunction({rowData:r,column:o,value:u}),this.updateRowItemFunction({rowData:r,column:o,value:u});const t=this.getCellValue(o,r),e=this.cellValueFormatFunction({column:o,rowData:r,value:t});i.innerHTML=e,this.emit("value-change",{column:o,rowData:r,value:t}),this._set("activeEditInfo",null),null==(l=this.grid)||l.notifyResize()}catch(t){this.cancel()}}}};t([e({readOnly:!0})],l.prototype,"activeEditInfo",void 0),t([e()],l.prototype,"cellValueValidatorFunction",void 0),t([e()],l.prototype,"editable",void 0),t([e()],l.prototype,"inputRenderFunction",void 0),t([e({constructOnly:!0})],l.prototype,"loadingMessage",void 0),t([e()],l.prototype,"inputType",void 0),t([e()],l.prototype,"maxLength",void 0),t([e()],l.prototype,"parseInputValueFunction",void 0),t([e()],l.prototype,"renderFunction",void 0),t([e()],l.prototype,"required",void 0),t([e()],l.prototype,"store",void 0),t([e()],l.prototype,"updateRowItemFunction",void 0),t([e()],l.prototype,"updateStoreItemFunction",void 0),l=t([o("esri.widgets.FeatureTable.EditorColumn")],l);var s=l;export default s;
