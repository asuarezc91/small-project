/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import{Integer as t}from"../core/accessorSupport/ensureType.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import s from"../Color.js";import{watch as o}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as n}from"./support/decorators/messageBundle.js";import{renderable as l}from"./support/decorators/renderable.js";import{j as d}from"../chunks/index.js";import h from"./Widget.js";import u from"./Slider.js";import p from"./Histogram.js";import m from"./HistogramRangeSlider/HistogramRangeSliderViewModel.js";import{getDeviationValues as c}from"./smartMapping/support/utils.js";const g="esri-histogram-range-slider",v="esri-histogram-range-slider__slider-container",b="esri-histogram-range-slider__histogram-container",_="esri-histogram-range-slider__range-type--",F="esri-widget",w="esri-disabled";let C=class extends h{constructor(e,t){super(e,t),this._barElements=[],this._histogram=null,this._slider=null,this.average=null,this.barCreatedFunction=null,this.bins=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.excludedBarColor=new s("#d7e5f0"),this.hasTimeData=null,this.includedBarColor=new s("#599dd4"),this.label=void 0,this.labelFormatFunction=null,this.max=null,this.messages=null,this.min=null,this.precision=4,this.rangeType=null,this.standardDeviation=null,this.standardDeviationCount=1,this.values=null,this.viewModel=new m}initialize(){const{average:e,bins:t,hasTimeData:i,max:r,min:a,viewModel:s}=this;this._updateBarFill=this._updateBarFill.bind(this),this._histogram=new p({average:e,bins:t,barCreatedFunction:(e,t)=>{0===e&&(this._barElements=[]),this._barElements.push(t),this._updateBarFill(e,t),this.barCreatedFunction&&this.barCreatedFunction(e,t)},dataLines:this._getDataLines(),dataLineCreatedFunction:(e,t)=>{this.dataLineCreatedFunction&&this.dataLineCreatedFunction(e,t)},labelFormatFunction:this.labelFormatFunction,layout:"horizontal",max:r,min:a}),this._slider=new u({labelFormatFunction:this.labelFormatFunction,layout:"horizontal",visibleElements:{labels:!0,rangeLabels:!0},rangeLabelInputsEnabled:!i,viewModel:s}),this.own(this._slider.on(["max-change","min-change"],(e=>this.emit(e.type,e))),this._slider.on(["segment-drag","thumb-change","thumb-drag"],(e=>{this._updateBarFills(),this.emit(e.type,e)})),o(this,"bins",(()=>{const{_histogram:e,bins:t}=this;if(t&&e.bins){const i=e.bins.length-t.length;this._barElements.splice(-i,i)}else this._barElements=[];e.set({bins:t}),this._updateBarFills(),this.scheduleRender()})),o(this,["max","min","rangeType","values"],(()=>{const{_histogram:e,max:t,min:i}=this;e.set({max:t,min:i}),this._updateBarFills(),this.scheduleRender()})),o(this,["average","dataLines","standardDeviation","standardDeviationCount"],(()=>{const{_histogram:e,average:t}=this;e.set({average:t,dataLines:this._getDataLines()})})),o(this,"labelFormatFunction",(()=>{const{_histogram:e,labelFormatFunction:t}=this;e.set({labelFormatFunction:t})})),o(this,"hasTimeData",(()=>{this._slider.set({rangeLabelInputsEnabled:!this.hasTimeData})})))}generateWhereClause(e){return this.viewModel.generateWhereClause(e)}render(){const{rangeType:e,viewModel:t,label:i}=this,r=this.classes(g,F,`${_}${e}`,"disabled"===t.state?w:null);return d("div",{"aria-label":i,class:r},"disabled"===t.state?null:this.renderContent())}renderContent(){return[this.renderHistogram(),this.renderSlider()]}renderSlider(){return d("div",{key:`${this.id}-slider-container`,class:v},this._slider.render())}renderHistogram(){return d("div",{class:b},this._histogram.render())}_getDataLines(){return[...this._getStandardDeviationDataLines(),...this.dataLines||[]]}_getStandardDeviationDataLines(){const{average:e,standardDeviation:t,standardDeviationCount:i}=this;return c(t,e,i).map((e=>({value:e})))}_updateBarFills(){this._barElements.forEach(((e,t)=>this._updateBarFill(t,e)))}_updateBarFill(e,t){t.setAttribute("fill",this._getFillForBar(e).toHex())}_getFillForBar(e){const{bins:t,rangeType:i,values:r}=this;if(!(t&&t.length&&i&&r.length))return null;const a=t[e];if(!a)return null;const{maxValue:s,minValue:o}=a,n=s-o,l=r[0]>o&&r[0]<s;switch(i){case"equal":case"not-equal":return this.includedBarColor;case"less-than":case"at-most":return l?this._getBlendedColor((r[0]-o)/n):s<=r[0]?this.includedBarColor:this.excludedBarColor;case"greater-than":case"at-least":return l?this._getBlendedColor(1-(r[0]-o)/n):o>=r[0]?this.includedBarColor:this.excludedBarColor;case"between":if(2===r.length)return r[0]>o&&r[0]<s?this._getBlendedColor(1-(r[0]-o)/n):r[1]>o&&r[1]<s?this._getBlendedColor((r[1]-o)/n):o>=r[0]&&s<=r[1]?this.includedBarColor:this.excludedBarColor;case"not-between":if(2===r.length)return r[0]>o&&r[0]<s?this._getBlendedColor((r[0]-o)/n):r[1]>o&&r[1]<s?this._getBlendedColor(1-(r[1]-o)/n):o>r[0]&&s<r[1]?this.excludedBarColor:this.includedBarColor;default:return this.includedBarColor}}_getBlendedColor(e){return s.blendColors(this.excludedBarColor,this.includedBarColor,e)}};e([r("viewModel.average")],C.prototype,"average",void 0),e([i(),l()],C.prototype,"barCreatedFunction",void 0),e([r("viewModel.bins")],C.prototype,"bins",void 0),e([i(),l()],C.prototype,"dataLines",void 0),e([i(),l()],C.prototype,"dataLineCreatedFunction",void 0),e([i({type:s,json:{type:[t],write:!0}})],C.prototype,"excludedBarColor",void 0),e([r("viewModel.hasTimeData")],C.prototype,"hasTimeData",void 0),e([i({type:s,json:{type:[t],write:!0}})],C.prototype,"includedBarColor",void 0),e([i({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],C.prototype,"label",void 0),e([r("viewModel.labelFormatFunction")],C.prototype,"labelFormatFunction",void 0),e([r("viewModel.max")],C.prototype,"max",void 0),e([i(),l(),n("esri/widgets/HistogramRangeSlider/t9n/HistogramRangeSlider")],C.prototype,"messages",void 0),e([r("viewModel.min")],C.prototype,"min",void 0),e([r("viewModel.precision")],C.prototype,"precision",void 0),e([r("viewModel.rangeType")],C.prototype,"rangeType",void 0),e([r("viewModel.standardDeviation")],C.prototype,"standardDeviation",void 0),e([i(),l()],C.prototype,"standardDeviationCount",void 0),e([l(),r("viewModel.values")],C.prototype,"values",void 0),e([i(),l(["viewModel.average","viewModel.hasTimeData","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.precision","viewModel.rangeType","viewModel.standardDeviation","viewModel.values"])],C.prototype,"viewModel",void 0),C=e([a("esri.widgets.HistogramRangeSlider")],C);var y=C;export default y;
