/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{validateLanguage as n,findScriptDependencies as e,checkScript as r,findFieldLiterals as o,validateScript as t,referencesMember as i,referencesFunction as c}from"./treeAnalysis.js";import{parse as l}from"./lib/esprima.js";function s(r,o=[]){const t=l("function _() { "+r+"\n}");if(null===t.body||void 0===t.body)throw new Error("No formula provided.");if(0===t.body.length)throw new Error("No formula provided.");if(0===t.body.length)throw new Error("No formula provided.");if("BlockStatement"!==t.body[0].body.type)throw new Error("Invalid formula content.");const i=n(t);if(""!==i)throw new Error(i);return e(t,o),t}function u(n,e,o,t,i){const c=[],s="function _() { \n".length-1,u="function _() { \n"+n+"\n}";try{const n=l(u,{tolerant:!0,loc:!0,range:!0}),a=n.errors;if(a.length>0)for(let n=0;n<a.length;n++)c.push({line:a[n].lineNumber-2,character:a[n].column,reason:a[n].description});const f=r(n,e,o,t,i);for(let n=0;n<f.length;n++)f[n].line=f[n].line-2,f[n].range&&(f[n].range=[f[n][0]-s,f[n][1]-s]),f[n].loc&&(f[n].loc.start.line=f[n].loc.start.line-2,f[n].loc.end.line=f[n].loc.end.line-2),c.push(f[n])}catch(n){try{if("Unexpected token }"===n.description){const e=u.split("\n").length;n.lineNumber===e?(n.index=u.length-1,c.push({line:n.lineNumber-4,character:n.column,reason:"Unexpected end of script"})):(n.index=u.length-1,c.push({line:n.lineNumber-2,character:n.column,reason:"Unexpected end of script"}))}else c.push({line:n.lineNumber-2,character:n.column,reason:n.description})}catch(n){}}return c}function a(n,e){return o(n)}function f(n,e,r){return t(n,e,r)}function d(n,e){return i(n,e)}function h(n,e){return c(n,e)}export{a as extractFieldLiterals,s as parseScript,h as referencesFunction,d as referencesMember,u as scriptCheck,f as validateScript};
