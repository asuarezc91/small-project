/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../../../geometry/Geometry.js";import n from"../../FunctionWrapper.js";import{a as t,f as r,g as o,b as a,z as s,o as l,h as u}from"../../../chunks/languageUtils.js";function i(f,b){switch(b.type){case"EmptyStatement":return"";case"VariableDeclarator":return function(e,n){const t=null===n.init?null:i(e,n.init),r=p(n.name,e.mangles);return""===t?r:r+" = "+t}(f,b);case"VariableDeclaration":return function(e,n){const t=[];for(let r=0;r<n.declarations.length;r++)t.push(i(e,n.declarations[r]));return"var "+t.join(",")+"; "}(f,b);case"BlockStatement":return function(e,n){let t="{\n";for(let r=0;r<n.body.length;r++)t+=i(e,n.body[r])+" \n";return t+="}\n",t}(f,b);case"FunctionDeclaration":return function(e,n){let t="function "+m(n.id.name,e.globalMangles,{});const r=[];let o={};o={};const a={};for(const e of n.params){const n=p(e.name,a);r.push(n),o[e.name]=1}return t+="("+r.join(",")+") ",t+=i({functions:e.functions,globals:e.globals,symbols:e.symbols,context:e.context,globalMangles:e.globalMangles,localMangles:a,locals:o},n.body),t}(f,b);case"ReturnStatement":return function(e,n){return null===n.argument?"return;":"return "+i(e,n.argument)+";\n"}(f,b);case"IfStatement":return function(e,n){return"if "+i(e,n.test)+" "+i(e,n.consequent)+(null!==n.alternate?"else "+i(e,n.alternate):"")}(f,b);case"ExpressionStatement":return function(e,n){return i(e,n.expression)+";"}(f,b);case"AssignmentExpression":return function(e,n){return i(e,n.left)+" "+n.operator+" "+i(e,n.right)}(f,b);case"UpdateExpression":return function(e,n){return!0===n.prefix?n.operator+i(e,n.argument):i(e,n.argument)+n.operator}(f,b);case"BreakStatement":return"break;";case"ContinueStatement":return"continue;";case"ForStatement":return function(e,n){let t="for(";return null!==n.init&&(t+=i(e,n.init)),t+=";",null!==n.test?t+=i(e,n.test):t+=" ;",null!==n.update?t+=i(e,n.update):t+=" ;",t+=") ",t+=i(e,n.body)+"\n",t}(f,b);case"ForInStatement":return function(e,n){return"for( "+i(e,n.left)+" in "+i(e,n.right)+") "+i(e,n.body)+"\n"}(f,b);case"Identifier":return function(i,f){const p=f.name.toLowerCase();if(void 0!==i.locals[p])return m(f.name,i.globalMangles,i.localMangles);{const m=i.context.globalScope[p];if(void 0===m)return f.name;if(null!==m){if(m.value instanceof n){return g(m.value,i.functions,i.globals,i.symbols)}if(null==m){const e=c(i.symbols);return i.globals.push({name:e,type:"null",params:{value:null}}),e}if(m instanceof e){const e=c(i.symbols);return i.globals.push({name:e,type:"geometry",params:{value:m}}),e}if(t(m)){const e=c(i.symbols);return i.globals.push({name:e,type:"number",params:{value:m}}),e}if(r(m)){const e=c(i.symbols);return i.globals.push({name:e,type:"date",params:{value:o(m).getTime()}}),e}if(a(m)){const e=c(i.symbols);return i.globals.push({name:e,type:"string",params:{value:m}}),e}if(s(m));else if(l(m));else if(!u(m))throw new Error("Unsupported Type")}}return f.name}(f,b);case"MemberExpression":return function(e,n){return"true"===n.computed?i(e,n.object)+"["+i(e,n.property)+"]":i(e,n.object)+"."+n.property.name}(f,b);case"Literal":return null===b.value||void 0===b.value?"null":JSON.stringify(b.value);case"ThisExpression":throw new Error("NOTSUPPORTED");case"CallExpression":return function(e,n){let t=i(e,n.callee)+"(";const r=[];for(const t of n.arguments)r.push(i(e,t));return t+=r.join(",")+")",t}(f,b);case"UnaryExpression":return function(e,n){return!0===n.prefix?n.operator+i(e,n.argument):i(e,n.argument)+n.operator}(f,b);case"BinaryExpression":return function(e,n){return"("+i(e,n.left)+" "+n.operator+" "+i(e,n.right)+")"}(f,b);case"LogicalExpression":return function(e,n){return i(e,n.left)+" "+n.operator+" "+i(e,n.right)}(f,b);case"ConditionalExpression":throw new Error("NOTSUPPORTED");case"ArrayExpression":return function(e,n){const t=[];for(let r=0;r<n.elements.length;r++)t.push(i(e,n.elements[r]));return"["+t.join(",")+"]"}(f,b);case"ObjectExpression":return function(e,n){let t="{";for(let r=0;r<n.properties.length;r++){const o=n.properties[r];t+=("Identifier"===o.key.type?JSON.stringify(o.key.name):i(e,o.key))+":"+i(e,o.value)}return t+="}",t}(f,b);case"Property":return function(){throw new Error("Not Supported")}();case"Array":throw new Error("NOTSUPPORTED");default:throw new Error("UNREOGNISED")}}function c(e){let n=!1,t="";for(;!1===n;)t="$gi_"+f.toString(),f++,void 0===e.syms[t]&&(n=!0);return t}let f=0;function p(e,n){const t="$$fc_"+f.toString();return f++,n[e]=t,t}function m(e,n,t){return void 0===t[e]?void 0===n[e]?e:n[e]:t[e]}function g(e,n,t,r){const o={functions:n,globals:t,symbols:r,context:e.context,locals:{},globalMangles:{},localMangles:{}},a=e.definition.id.name;if(void 0!==n.lkp[a])return n.lkp[a].mangledname;const s=p(a,o.globalMangles),l={name:a,mangledname:s,script:""};return l.script=i(o,e.definition),n.lkp[l.name]=l,n.stack.push(l),s}export{g as exportFunctionAsArcade};
