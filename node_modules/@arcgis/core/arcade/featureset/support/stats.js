/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{reject as t,create as n}from"../../../core/promiseUtils.js";import{Q as e}from"../../../chunks/languageUtils.js";import{isNumber as r,isString as u,equalityTest as l}from"./shared.js";import{isSingleField as a,predictType as c}from"./sqlUtils.js";function s(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n/t.length}function o(t){const n=s(t);let e=0;for(let r=0;r<t.length;r++)e+=Math.pow(n-t[r],2);return e/t.length}function i(t){const n=s(t);let e=0;for(let r=0;r<t.length;r++)e+=Math.pow(n-t[r],2);return e/(t.length-1)}function h(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function f(t){switch(t.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function g(t,n,e=1e3){switch(t.toLowerCase()){case"distinct":return function(t,n){const e=[],a={},c=[];for(let s=0;s<t.length;s++){if(void 0!==t[s]&&null!==t[s]){const n=t[s];if(r(n)||u(n))void 0===a[n]&&(e.push(n),a[n]=1);else{let t=!1;for(let e=0;e<c.length;e++)!0===l(c[e],n)&&(t=!0);!1===t&&(c.push(n),e.push(n))}}if(e.length>=n&&-1!==n)return e}return e}(n,e);case"avg":case"mean":return s(n);case"min":return Math.min.apply(Math,n);case"sum":return h(n);case"max":return Math.max.apply(Math,n);case"stdev":case"stddev":return Math.sqrt(o(n));case"var":case"variance":return o(n);case"count":return n.length}return 0}function m(t,n,e){return w(t,n,e,!0).then((t=>0===t.length?null:Math.min.apply(Math,t)))}function p(t,n,e){return w(t,n,e,!0).then((t=>0===t.length?null:Math.max.apply(Math,t)))}function v(t,n,e){let r="";return!1===a(n)&&(r=c(n,t.fields,null)),w(t,n,e,!0).then((t=>{if(0===t.length)return null;const n=s(t);return null===n?n:"integer"===r?(e=+(e=n),isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e):n;var e}))}function d(t,n,e){return w(t,n,e,!0).then((t=>0===t.length?null:i(t)))}function M(t,n,e){return w(t,n,e,!0).then((t=>0===t.length?null:Math.sqrt(i(t))))}function x(t,n,e){return w(t,n,e,!0).then((t=>0===t.length?null:h(t)))}function y(n,e){try{return n.iterator(e).count()}catch(n){return t(n)}}function w(e,r,u,l=!1){try{const t=e.iterator(u);return n(((n,e)=>{j(t,[],r,l,n,e)}))}catch(n){return t(n)}}function j(t,n,r,u,l,a){e(t.next().then((e=>{try{if(null!==e){const c=r.calculateValue(e);return null===c?!1===u&&(n[n.length]=c):n[n.length]=c,j(t,n,r,u,l,a)}l(n)}catch(t){a(t)}}),a))}function q(n,e,r=1e3,u=null){return function(n,e,r,u){try{return U(n.iterator(u),{},[],e,r)}catch(n){return t(n)}}(n,e,r,u)}function U(t,n,e,r,u){return t.next().then((l=>{if(null!==l){const a=r.calculateValue(l);return null!=a&&void 0===n[a]&&(e.push(a),n[a]=1),e.length>=u&&-1!==u?e:U(t,n,e,r,u)}return e}))}export{g as calculateStat,y as count,f as decodeStatType,q as distinct,p as max,v as mean,m as min,M as stdev,x as sum,d as variance};
