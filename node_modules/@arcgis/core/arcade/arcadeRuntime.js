/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import e from"../geometry/SpatialReference.js";import r from"../geometry/Geometry.js";import t from"../geometry/Point.js";import n from"../geometry/Extent.js";import o from"../geometry/Multipoint.js";import a from"../geometry/Polygon.js";import i from"../geometry/Polyline.js";import s from"./FunctionWrapper.js";import l from"./ImmutablePointArray.js";import c from"./ImmutablePathArray.js";import{p as u,i as f,n as p,N as h,R as w,I as m,v as E,x as d,y as g,q as N,b as I,h as y,o as v,a as T,c as R,e as O,s as S,u as b,r as U,f as A,z as C,A as M}from"../chunks/languageUtils.js";import x from"./Dictionary.js";import F from"./ArcadePortal.js";import P from"./Attachment.js";import D from"./Feature.js";import{addFunctionDeclaration as L,findFieldLiterals as _,validateScript as j,referencesMember as k,referencesFunction as V,findFunctionCalls as B,nodeErrorMessage as Y}from"./treeAnalysis.js";import{registerFunctions as G}from"./functions/array.js";import{registerFunctions as z}from"./functions/date.js";import{registerFunctions as q}from"./functions/geometry.js";import{registerFunctions as Z}from"./functions/geomsync.js";import{registerFunctions as H}from"./functions/maths.js";import{registerFunctions as W}from"./functions/stats.js";import{registerFunctions as K}from"./functions/string.js";function X(e,r){const t=[];for(let n=0;n<r.arguments.length;n++)t.push(Q(e,r.arguments[n]));return t}function J(e,r,t){try{return t(e,r,X(e,r))}catch(e){throw e}}function Q(e,t){try{switch(t.type){case"EmptyStatement":return E;case"VariableDeclarator":return function(e,r){let t=null===r.init?null:Q(e,r.init);t===E&&(t=null);if("Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const n=r.id.name.toLowerCase();null!==e.localScope?e.localScope[n]={value:t,valueset:!0,node:r.init}:e.globalScope[n]={value:t,valueset:!0,node:r.init};return E}(e,t);case"VariableDeclaration":return function(e,r){for(let t=0;t<r.declarations.length;t++)Q(e,r.declarations[t]);return E}(e,t);case"BlockStatement":return function(e,r){let t=E;for(let n=0;n<r.body.length;n++)if(t=Q(e,r.body[n]),t instanceof w||t===d||t===g)return t;return t}(e,t);case"FunctionDeclaration":return function(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new s(r,e)},E}(e,t);case"ReturnStatement":return function(e,r){if(null===r.argument)return new w(E);const t=Q(e,r.argument);return new w(t)}(e,t);case"IfStatement":return function(e,r){if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error(Y(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=Q(e,r.test);if(!0===t)return Q(e,r.consequent);if(!1===t)return null!==r.alternate?Q(e,r.alternate):E;throw new Error(Y(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}(e,t);case"ExpressionStatement":return function(e,r){if("AssignmentExpression"===r.expression.type||"UpdateExpression"===r.expression.type)return Q(e,r.expression);if("CallExpression"===r.expression.type){const t=Q(e,r.expression);return t===E?E:new m(t)}{const t=Q(e,r.expression);return t===E?E:new m(t)}}(e,t);case"AssignmentExpression":return function(e,r){const t=Q(e,r.right);let n=null,o="";if("MemberExpression"===r.left.type){if(n=Q(e,r.left.object),!0===r.left.computed?o=Q(e,r.left.property):"Identifier"===r.left.property.type&&(o=r.left.property.name),y(n)){if(!T(o))throw new Error("Invalid Parameter");if(o<0&&(o=n.length+o),o<0||o>n.length)throw new Error("Assignment outside of array bounds");if(o===n.length){if("="!==r.operator)throw new Error("Invalid Parameter");n[o]=ee(t,r.operator,n[o],r)}else n[o]=ee(t,r.operator,n[o],r)}else if(n instanceof x){if(!1===I(o))throw new Error("Dictionary accessor must be a string");if(!0===n.hasField(o))n.setField(o,ee(t,r.operator,n.field(o),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");n.setField(o,ee(t,r.operator,null,r))}}else{if(!(n instanceof D))throw v(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===I(o))throw new Error("Feature accessor must be a string");if(!0===n.hasField(o))n.setField(o,ee(t,r.operator,n.field(o),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");n.setField(o,ee(t,r.operator,null,r))}}return E}if(n=r.left.name.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[n])return e.localScope[n]={value:ee(t,r.operator,e.localScope[n].value,r),valueset:!0,node:r.right},E;if(void 0!==e.globalScope[n])return e.globalScope[n]={value:ee(t,r.operator,e.globalScope[n].value,r),valueset:!0,node:r.right},E;throw new Error("Variable not recognised")}(e,t);case"UpdateExpression":return function(e,r){let t,n=null,o="";if("MemberExpression"===r.argument.type){if(n=Q(e,r.argument.object),!0===r.argument.computed?o=Q(e,r.argument.property):"Identifier"===r.argument.property.type&&(o=r.argument.property.name),y(n)){if(!T(o))throw new Error("Invalid Parameter");if(o<0&&(o=n.length+o),o<0||o>=n.length)throw new Error("Assignment outside of array bounds");t=R(n[o]),n[o]="++"===r.operator?t+1:t-1}else if(n instanceof x){if(!1===I(o))throw new Error("Dictionary accessor must be a string");if(!0!==n.hasField(o))throw new Error("Invalid Parameter");t=R(n.field(o)),n.setField(o,"++"===r.operator?t+1:t-1)}else{if(!(n instanceof D))throw v(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===I(o))throw new Error("Feature accessor must be a string");if(!0!==n.hasField(o))throw new Error("Invalid Parameter");t=R(n.field(o)),n.setField(o,"++"===r.operator?t+1:t-1)}return!1===r.prefix?t:"++"===r.operator?t+1:t-1}if(n="Identifier"===r.argument.type?r.argument.name.toLowerCase():"",!n)throw new Error("Invalid identifier");if(null!==e.localScope&&void 0!==e.localScope[n])return t=R(e.localScope[n].value),e.localScope[n]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;if(void 0!==e.globalScope[n])return t=R(e.globalScope[n].value),e.globalScope[n]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;throw new Error("Variable not recognised")}(e,t);case"BreakStatement":return d;case"ContinueStatement":return g;case"TemplateElement":return function(e,r){return r.value?r.value.cooked:""}(0,t);case"TemplateLiteral":return function(e,r){let t="",n=0;for(const o of r.quasis)if(t+=o.value?o.value.cooked:"",!1===o.tail){t+=r.expressions[n]?O(Q(e,r.expressions[n])):"",n++}return t}(e,t);case"ForStatement":return function(e,r){null!==r.init&&Q(e,r.init);const t={testResult:!0,lastAction:E};do{$(e,r,t)}while(!0===t.testResult);if(t.lastAction instanceof w)return t.lastAction;return E}(e,t);case"ForInStatement":return function(e,r){const t=Q(e,r.right);"VariableDeclaration"===r.left.type&&Q(e,r.left);let n=null,o="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(o=e.name)}else"Identifier"===r.left.type&&(o=r.left.name);if(!o)throw new Error(Y(r,"RUNTIME","INVALIDVARIABLE"));o=o.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[o]&&(n=e.localScope[o]);null===n&&void 0!==e.globalScope[o]&&(n=e.globalScope[o]);if(null===n)throw new Error(Y(r,"RUNTIME","VARIABLENOTDECLARED"));if(y(t)||I(t)){const o=t.length;for(let t=0;t<o;t++){n.value=t;const o=Q(e,r.body);if(o===d)break;if(o instanceof w)return o}return E}if(v(t)){for(let o=0;o<t.length();o++){n.value=o;const t=Q(e,r.body);if(t===d)break;if(t instanceof w)return t}return E}if(!(t instanceof x||t instanceof D))return E;{const o=t.keys();for(let t=0;t<o.length;t++){n.value=o[t];const a=Q(e,r.body);if(a===d)break;if(a instanceof w)return a}}}(e,t);case"Identifier":return ne(e,t);case"MemberExpression":return function(e,t){try{const n=Q(e,t.object);if(null===n)throw new Error(Y(t,"RUNTIME","NOTFOUND"));if(!1===t.computed){if("Identifier"===t.property.type){if(n instanceof x||n instanceof D)return n.field(t.property.name);if(n instanceof r)return te(n,t.property.name,t)}throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}{let o=Q(e,t.property);if(n instanceof x||n instanceof D){if(I(o))return n.field(o);throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}if(n instanceof r){if(I(o))return te(n,o,t);throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}if(y(n)){if(T(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new Error(Y(t,"RUNTIME","OUTOFBOUNDS"));return n[o]}throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}if(I(n)){if(T(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new Error(Y(t,"RUNTIME","OUTOFBOUNDS"));return n[o]}throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}if(v(n)){if(T(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length()+o),o>=n.length()||o<0)throw new Error(Y(t,"RUNTIME","OUTOFBOUNDS"));return n.get(o)}throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}throw new Error(Y(t,"RUNTIME","INVALIDTYPE"))}}catch(e){throw e}}(e,t);case"Literal":return t.value;case"CallExpression":return function(e,r){try{if("Identifier"!==r.callee.type)throw new Error(Y(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if(t.value instanceof h)return t.value.fn(e,r);if(t.value instanceof s)return ue(e,r,t.value.definition);throw new Error(Y(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if(t.value instanceof h)return t.value.fn(e,r);if(t.value instanceof s)return ue(e,r,t.value.definition);throw new Error(Y(r,"RUNTIME","NOTAFUNCTION"))}throw new Error(Y(r,"RUNTIME","NOTFOUND"))}catch(e){throw e}}(e,t);case"UnaryExpression":return function(e,r){try{const t=Q(e,r.argument);if(f(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*R(t);if("+"===r.operator)return 1*R(t);if("~"===r.operator)return~R(t);throw new Error(Y(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("~"===r.operator)return~R(t);if("-"===r.operator)return-1*R(t);if("+"===r.operator)return 1*R(t);throw new Error(Y(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}catch(e){throw e}}(e,t);case"BinaryExpression":return function(e,r){try{const t=[Q(e,r.left),Q(e,r.right)],n=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return b(R(n),R(o),r.operator);case"==":return p(n,o);case"!=":return!p(n,o);case"<":case">":case"<=":case">=":return S(n,o,r.operator);case"+":return I(n)||I(o)?O(n)+O(o):R(n)+R(o);case"-":return R(n)-R(o);case"*":return R(n)*R(o);case"/":return R(n)/R(o);case"%":return R(n)%R(o);default:throw new Error(Y(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}catch(e){throw e}}(e,t);case"LogicalExpression":return function(e,r){try{if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error(Y(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error(Y(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=Q(e,r.left);if(f(t))switch(r.operator){case"||":if(!0===t)return t;{const t=Q(e,r.right);if(f(t))return t;throw new Error(Y(r,"RUNTIME","ONLYORORAND"))}case"&&":if(!1===t)return t;{const t=Q(e,r.right);if(f(t))return t;throw new Error(Y(r,"RUNTIME","ONLYORORAND"))}default:throw new Error(Y(r,"RUNTIME","ONLYORORAND"))}throw new Error(Y(r,"RUNTIME","ONLYBOOLEAN"))}catch(e){throw e}}(e,t);case"ConditionalExpression":throw new Error(Y(t,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(e,r){try{const t=[];for(let n=0;n<r.elements.length;n++){const o=Q(e,r.elements[n]);if(N(o))throw new Error(Y(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));o===E?t.push(null):t.push(o)}return t}catch(e){throw e}}(e,t);case"ObjectExpression":return function(e,r){const t={};for(let n=0;n<r.properties.length;n++){const o=Q(e,r.properties[n]);if(N(o.value))throw new Error("Illegal Argument");if(!1===I(o.key))throw new Error("Illegal Argument");o.value===E?t[o.key.toString()]=null:t[o.key.toString()]=o.value}const n=new x(t);return n.immutable=!1,n}(e,t);case"Property":return function(e,r){return{key:"Identifier"===r.key.type?r.key.name:Q(e,r.key),value:Q(e,r.value)}}(e,t);default:throw new Error(Y(t,"RUNTIME","UNREOGNISED"))}}catch(e){throw e}}function $(e,r,t){if(null!==r.test){if(t.testResult=Q(e,r.test),!1===t.testResult)return;if(!0!==t.testResult)throw new Error(Y(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}t.lastAction=Q(e,r.body),t.lastAction!==d?t.lastAction instanceof w?t.testResult=!1:null!==r.update&&Q(e,r.update):t.testResult=!1}function ee(e,r,t,n){switch(r){case"=":return e===E?null:e;case"/=":return R(t)/R(e);case"*=":return R(t)*R(e);case"-=":return R(t)-R(e);case"+=":return I(t)||I(e)?O(t)+O(e):R(t)+R(e);case"%=":return R(t)%R(e);default:throw new Error(Y(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}let re=0;function te(e,r,t){let n;switch(r=r.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let r=e.spatialReference._arcadeCacheId;if(void 0===r){let t=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(t=!1),t&&(re++,e.spatialReference._arcadeCacheId=re,r=re)}const t=new x({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==r&&(t._arcadeCacheId="SPREF"+r.toString()),t}}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const t=e[r];return void 0!==t?t:null}case"type":return"Extent"}break;case"polygon":switch(r){case"rings":n=e.cache._arcadeCacheId,void 0===n&&(re++,n=re,e.cache._arcadeCacheId=n);return new c(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":n=e.cache._arcadeCacheId,void 0===n&&(re++,n=re,e.cache._arcadeCacheId=n);return new c(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":n=e.cache._arcadeCacheId,void 0===n&&(re++,n=re,e.cache._arcadeCacheId=n);return new l(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,n,1);case"type":return"Multipoint"}}throw new Error(Y(t,"RUNTIME","PROPERTYNOTFOUND"))}function ne(e,r){let t;try{const n=r.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[n])return t=e.localScope[n],!0===t.valueset||(t.value=Q(e,t.node),t.valueset=!0),t.value;if(void 0!==e.globalScope[n])return t=e.globalScope[n],!0===t.valueset||(t.value=Q(e,t.node),t.valueset=!0),t.value;throw new Error(Y(r,"RUNTIME","VARIABLENOTFOUND"))}catch(e){throw e}}const oe={};function ae(e){return null==e?"":y(e)||v(e)?"Array":A(e)?"Date":I(e)?"String":f(e)?"Boolean":T(e)?"Number":e instanceof P?"Attachment":e instanceof F?"Portal":e instanceof x?"Dictionary":e instanceof D?"Feature":e instanceof t?"Point":e instanceof a?"Polygon":e instanceof i?"Polyline":e instanceof o?"Multipoint":e instanceof n?"Extent":N(e)?"Function":C(e)?"FeatureSet":M(e)?"FeatureSetCollection":e===E?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function ie(e,r,t,n){try{const o=Q(e,r.arguments[t]);if(p(o,n))return Q(e,r.arguments[t+1]);{const o=r.arguments.length-t;return 1===o?Q(e,r.arguments[t]):2===o?null:3===o?Q(e,r.arguments[t+2]):ie(e,r,t+2,n)}}catch(e){throw e}}function se(e,r,t,n){try{if(!0===n)return Q(e,r.arguments[t+1]);if(3===r.arguments.length-t)return Q(e,r.arguments[t+2]);{const n=Q(e,r.arguments[t+2]);if(!1===f(n))throw new Error("WHEN needs boolean test conditions");return se(e,r,t+2,n)}}catch(e){throw e}}function le(e,r){const t=e.length,n=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:function(e,r,t){const n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){let o=t(e[0],r[0]);isNaN(o)&&(o=0),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}(le(e.slice(0,n),r),le(e.slice(n,t),r),r)}function ce(e,r,t){try{const n=e.body;if(t.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(let n=0;n<t.length;n++)r.localScope[e.params[n].name.toLowerCase()]={value:t[n],valueset:!0,node:null};const o=Q(r,n);if(o instanceof w)return o.value;if(o===d)throw new Error("Cannot Break from a Function");if(o===g)throw new Error("Cannot Continue from a Function");return o instanceof m?o.value:o}catch(e){throw e}}function ue(e,r,t){return J(e,r,(function(r,n,o){const a={spatialReference:e.spatialReference,globalScope:e.globalScope,depthCounter:e.depthCounter+1,console:e.console,lrucache:e.lrucache,localScope:{}};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return ce(t,a,o)}))}function fe(e){return function(){const r={spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,localScope:{},depthCounter:e.context.depthCounter+1,globalScope:e.context.globalScope};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return ce(e.definition,r,arguments)}}G(oe,J),z(oe,J),K(oe,J),H(oe,J),q(oe,J),W(oe,J),Z(oe,J),oe.typeof=function(e,r){return J(e,r,(function(e,r,t){u(t,1,1);const n=ae(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},oe.iif=function(e,r){try{u(null===r.arguments?[]:r.arguments,3,3);const t=Q(e,r.arguments[0]);if(!1===f(t))throw new Error("IF Function must have a boolean test condition");const n=Q(e,r.arguments[1]),o=Q(e,r.arguments[2]);return!0===t?n:o}catch(e){throw e}},oe.decode=function(e,r){try{if(r.arguments.length<2)throw new Error("Missing Parameters");if(2===r.arguments.length)return Q(e,r.arguments[1]);{if((r.arguments.length-1)%2==0)throw new Error("Must have a default value result.");const t=Q(e,r.arguments[0]);return ie(e,r,1,t)}}catch(e){throw e}},oe.when=function(e,r){try{if(r.arguments.length<3)throw new Error("Missing Parameters");if(r.arguments.length%2==0)throw new Error("Must have a default value result.");const t=Q(e,r.arguments[0]);if(!1===f(t))throw new Error("WHEN needs boolean test conditions");return se(e,r,0,t)}catch(e){throw e}},oe.top=function(e,r){return J(e,r,(function(e,r,t){if(u(t,2,2),y(t[0]))return R(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,R(t[1]));if(v(t[0]))return R(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,R(t[1]));throw new Error("Top cannot accept this parameter type")}))},oe.first=function(e,r){return J(e,r,(function(e,r,t){return u(t,1,1),y(t[0])?0===t[0].length?null:t[0][0]:v(t[0])?0===t[0].length()?null:t[0].get(0):null}))},oe.sort=function(e,r){return J(e,r,(function(e,r,t){u(t,1,2);let n=t[0];if(v(n)&&(n=n.toArray()),!1===y(n))throw new Error("Illegal Argument");if(t.length>1){if(!1===N(t[1]))throw new Error("Illegal Argument");let e=n;const r=fe(t[1]);return e=le(e,(function(e,t){return r(e,t)})),e}{let e=n;if(0===e.length)return[];const r={};for(let t=0;t<e.length;t++){const n=ae(e[t]);""!==n&&(r[n]=!0)}if(!0===r.Array||!0===r.Dictionary||!0===r.Feature||!0===r.Point||!0===r.Polygon||!0===r.Polyline||!0===r.Multipoint||!0===r.Extent||!0===r.Function)return e.slice(0);let t=0,o="";for(const e in r)t++,o=e;return e=t>1||"String"===o?le(e,(function(e,r){if(null==e||e===E)return null==r||r===E?0:1;if(null==r||r===E)return-1;const t=O(e),n=O(r);return t<n?-1:t===n?0:1})):"Number"===o?le(e,(function(e,r){return e-r})):"Boolean"===o?le(e,(function(e,r){return e===r?0:r?-1:1})):"Date"===o?le(e,(function(e,r){return r-e})):e.slice(0),e}}))};for(const e in oe)oe[e]={value:new h(oe[e]),valueset:!0,node:null};const pe=function(){};(pe.prototype=oe).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},pe.prototype.pi={value:Math.PI,valueset:!0,node:null};const he={fixSpatialReference:U,parseArguments:X,standardFunction:J};function we(e){console.log(e)}function me(e){const r={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:J,evaluateIdentifier:ne,arcadeCustomFunctionHandler:fe};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const e in r.functions)oe[e]={value:new h(r.functions[e]),valueset:!0,node:null},pe.prototype[e]=oe[e];for(let e=0;e<r.signatures.length;e++)L(r.signatures[e],"async")}function Ee(r,t){let n=t.spatialReference;null==n&&(n=new e({wkid:102100}));let o=Q({spatialReference:n,globalScope:function(e,r){const t=new pe;e||(e={}),r||(r={});const n=new x({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});n.immutable=!1,t.textformatting={value:n,valueset:!0,node:null};for(const e in r)t[e]={value:new h(r[e]),native:!0,valueset:!0,node:null};for(const r in e)e[r]&&"esri.Graphic"===e[r].declaredClass?t[r]={value:D.createFromGraphic(e[r]),valueset:!0,node:null}:t[r]={value:e[r],valueset:!0,node:null};return t}(t.vars,t.customfunctions),localScope:null,console:t.console?t.console:we,lrucache:t.lrucache,depthCounter:1},r.body[0].body);if(o instanceof w&&(o=o.value),o instanceof m&&(o=o.value),o===E&&(o=null),o===d)throw new Error("Cannot return BREAK");if(o===g)throw new Error("Cannot return CONTINUE");if(o instanceof s)throw new Error("Cannot return FUNCTION");if(o instanceof h)throw new Error("Cannot return FUNCTION");return o}function de(e,r){return _(e)}function ge(e,r){return j(e,r,"simple")}function Ne(e,r){return k(e,r)}function Ie(e,r){return V(e,r)}function ye(e){return B(e)}export{Ee as executeScript,me as extend,de as extractFieldLiterals,ye as findFunctionCalls,he as functionHelper,Ie as referencesFunction,Ne as referencesMember,ge as validateScript};
