/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import t from"../../Logger.js";import{ensureArrayTyped as r,ensureOneOfType as e,isLongFormType as n,ensureLongFormType as o,isOneOf as i,ensureOneOf as s,ensureNArrayTyped as a,ensureArray as u,ensureNArray as c,ensureType as p}from"../ensureType.js";import{get as f}from"../get.js";import{getOwnPropertyMetadata as l,mergeProperty as m}from"../metadata.js";import{set as d}from"../set.js";const g=t.getLogger("esri.core.accessorSupport.decorators.property");function y(t={}){return(y,h,j)=>{if(y===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${y.name}.${h}. Accessor does not support static properties.`);const O=l(y,h);j&&(j.get||j.set?(O.get=j.get||O.get,O.set=j.set||O.set):"value"in j&&("value"in t&&g.warn(`@property() will redefine the value of "${h}" on "${y.constructor.name}" already defined in the metadata`,t),O.value=t.value=j.value)),null!=t.readOnly&&(O.readOnly=t.readOnly);const{aliasOf:A}=t;if(A){const t="string"==typeof A?A:A.source,r="string"==typeof A?null:!0===A.overridable;let e;O.dependsOn=[t],O.get=function(){let r=f(this,t);if("function"==typeof r){e||(e=t.split(".").slice(0,-1).join("."));const n=f(this,e);n&&(r=r.bind(n))}return r},O.readOnly||(O.set=r?function(t){void 0!==t?this._override(h,t):this._clearOverride(h)}:function(r){d(this,t,r)})}const w=t.type,x=t.types;O.cast||(w?O.cast=function(t){let r=0,e=t;if(n(t))return o(t);for(;Array.isArray(e)&&1===e.length&&"string"!=typeof e[0]&&"number"!=typeof e[0];)e=e[0],r++;const f=e;if(i(f))return 0===r?s(f):a(s(f),r);if(1===r)return u(f);if(r>1)return c(f,r);const l=t;if(l.from)return l.from;return p(l)}(w):x&&(Array.isArray(x)?O.cast=r(e(x[0])):O.cast=e(x))),t.range&&(O.cast=v(O.cast,t.range)),m(O,t)}}function h(t,r,e){const n=l(t,e);n.json||(n.json={});let o=n.json;return void 0!==r&&(o.origins||(o.origins={}),o.origins[r]||(o.origins[r]={}),o=o.origins[r]),o}function v(t,r){return e=>{let n=+t(e);return null!=r.step&&(n=Math.round(n/r.step)*r.step),null!=r.min&&(n=Math.max(r.min,n)),null!=r.max&&(n=Math.min(r.max,n)),n}}export{v as ensureRange,y as property,h as propertyJSONMeta};
