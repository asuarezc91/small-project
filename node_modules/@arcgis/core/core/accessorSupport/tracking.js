/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"../has.js";import t from"../Logger.js";import{pathToArray as n,getProperties as o}from"./utils.js";let e,r=[];const s=t.getLogger("esri.core.Accessor");function c(){r=[]}function i(t){void 0!==e&&e.onPropertyAccessed(t)}let l=!1,f=!1;function a(t,n,o){if(l)return g(t,n,o);u(t);const e=n.call(o);return p(),e}function g(t,n,o){const e=l;l=!0,u(t);let r=null;try{r=n.call(o)}catch(t){f&&s.error(t)}return p(),l=e,r}function u(t){e=t,r.push(t)}function p(){const t=r.pop();e=r.length>0?r[r.length-1]:void 0,void 0!==t&&t.onTrackingEnd()}function d(t,n){if(32&n.flags)return;const o=f;f=!1,64&n.flags?g(n,n.metadata.get,t):h(t,n),f=o}const m=[];function h(t,o){128&o.flags||(o.flags|=128,g(o,(()=>{const e=o.metadata.dependsOn||m;for(const o of e)if("string"==typeof o&&-1===o.indexOf("."))y(t,o,!1);else{const e=n(o);for(let n=0,o=t;n<e.length&&null!=o&&"object"==typeof o;++n)o=y(o,e[n],n!==e.length-1)}})),o.flags&=-129)}function y(t,n,e){const r="?"===n[n.length-1]?n.slice(0,-1):n;if(null!=t.getItemAt||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.getItemAt(n)}const s=o(t),c=null==s?void 0:s.properties.get(r);return c&&(i(c),d(t,c)),e?t[r]:void 0}export{d as initializeDependencyTracking,c as resetGlobalTarget,a as runTracked,g as runTrackedNoThrow,h as trackExplicitDependencies,i as trackPropertyAccess};
