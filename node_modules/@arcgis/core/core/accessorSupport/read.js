/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{getProperties as e}from"./utils.js";import{valueOf as t,exists as r}from"./get.js";import{originSpecificReadPropertyDefinition as o,originSpecificPropertyDefinition as n}from"./extensions/serializableProperty.js";function s(e,t,o){if(!e||!e.read||!1===e.read.enabled||!e.read.source)return!1;const n=e.read.source;if("string"==typeof n){if(n===t)return!0;if(n.indexOf(".")>-1&&0===n.indexOf(t)&&r(n,o))return!0}else for(const e of n){if(e===t)return!0;if(e.indexOf(".")>-1&&0===e.indexOf(t)&&r(e,o))return!0}return!1}function i(e,t,r,n,i){let f=o(t[r],i);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(f)&&(e[r]=!0);for(const a of Object.getOwnPropertyNames(t))f=o(t[a],i),s(f,r,n)&&(e[a]=!0)}function f(e,t,r,o){const s=r.metadatas,i=n(s[t],"any",o),f=i&&i.default;if(void 0===f)return;const a="function"==typeof f?f.call(e,t,o):f;void 0!==a&&r.set(t,a)}const a={origin:"service"};function c(r,n,s=a){if(!n||"object"!=typeof n)return;const c=e(r),u=c.metadatas,d={};for(const e of Object.getOwnPropertyNames(n))i(d,u,e,n,s);c.setDefaultOrigin(s.origin);for(const e of Object.getOwnPropertyNames(d)){const i=o(u[e],s).read,f=i&&i.source;let a;a=f&&"string"==typeof f?t(n,f):n[e],i&&i.reader&&(a=i.reader.call(r,a,n,s)),void 0!==a&&c.set(e,a)}if(!s||!s.ignoreDefaults)for(const e of Object.getOwnPropertyNames(u))d[e]||f(r,e,c,s);c.setDefaultOrigin("user")}function u(e,t,r,o=a){var n;const s={...o,messages:[]};r(s),null==(n=s.messages)||n.forEach((t=>{"warning"!==t.type||e.loaded?o&&o.messages&&o.messages.push(t):e.loadWarnings.push(t)}))}export default c;export{c as read,u as readLoadable};
