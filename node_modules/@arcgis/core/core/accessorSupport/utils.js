/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{clone as r}from"../lang.js";import{assumeNonNull as n}from"../maybe.js";import{handlesGroup as t}from"../handleUtils.js";function e(r){return r?r.__accessor__?r.__accessor__:r.propertyInvalidated?r:null:null}function i(r,n){return null!=r&&r.metadatas&&null!=r.metadatas[n]}function o(r,n,t){const i=e(r);return i?i.getDependsInfo(r,n,t,""):""}function u(r,n,t){if(t){return a(r,n,{policy:t,path:""})}return a(r,n,null)}function a(t,e,i){return e?Object.keys(e).reduce((function(t,o){let u=null,l="merge";if(i&&(u=i.path?`${i.path}.${o}`:o,l=i.policy(u)),"replace"===l)return t[o]=e[o],t;if(void 0===t[o])return t[o]=r(e[o]),t;let f=t[o],s=e[o];if(f===s)return t;if(Array.isArray(s)||Array.isArray(t))f=f?Array.isArray(f)?t[o]=f.concat():t[o]=[f]:t[o]=[],s&&(Array.isArray(s)||(s=[s]),s.forEach((r=>{-1===f.indexOf(r)&&f.push(r)})));else if(s&&"object"==typeof s)if(i){const r=i.path;i.path=n(u),t[o]=a(f,s,i),i.path=r}else t[o]=a(f,s,null);else t.hasOwnProperty(o)&&!e.hasOwnProperty(o)||(t[o]=s);return t}),t||{}):t}function l(r){return r?"string"==typeof r&&-1===r.indexOf(".")?r:f(r):r}function f(r){return Array.isArray(r)?r:r.split(".")}function s(r){return r.indexOf(",")>-1?r.split(",").map((r=>r.trim())):[r.trim()]}function c(r){if(Array.isArray(r)){const n=[];for(const t of r)n.push(...s(t));return n}return s(r)}function p(r){if(-1===r.indexOf("?"))return null;const n=f(r),t=new Array(n.length);for(let r=0;r<n.length;r++){const e=n[r];t[r]="?"===e[e.length-1],t[r]&&(n[r]=e.slice(0,-1))}return{fullPath:n.join("."),conditional:t}}function y(r,n,e,i){const o=c(n);if(1!==o.length){const n=o.map((n=>i(r,n,e)));return t(n)}return i(r,o[0],e)}function h(r){let n=!1;return()=>{n||(n=!0,r())}}export{o as getDependsInfo,e as getProperties,i as isPropertyDeclared,u as merge,h as once,y as parse,p as parseConditionalPath,f as pathToArray,l as pathToStringOrArray,c as splitPath};
