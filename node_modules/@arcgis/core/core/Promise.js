/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as s}from"../chunks/tslib.es6.js";import{assumeNonNull as e}from"./maybe.js";import{subclass as i}from"./accessorSupport/decorators/subclass.js";import{resolve as r,create as t,createDeferred as o,createAbortError as l,all as h,isAbortError as n}from"./promiseUtils.js";import m from"./Accessor.js";class _{constructor(s){this.instance=s,this._resolver=o(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=1,this._cleanUp()}),(()=>{this._status=2,this._cleanUp()}))}addResolvingPromise(s){this._resolvingPromises.push(s),this._tryResolve()}isResolved(){return 1===this._status}isRejected(){return 2===this._status}isFulfilled(){return 0!==this._status}abort(){this._resolver.reject(l())}when(s,e){return this._resolver.promise.then(s,e)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const s=o(),i=[...this._resolvingPromises,e(s.promise)],r=this._allPromise=h(i);r.then((()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)}),(s=>{this.isFulfilled()||this._allPromise!==r||n(s)||this._resolver.reject(s)})),s.resolve()}}const p=e=>{let o=class extends e{constructor(...s){super(...s),this._promiseProps=new _(this),this.addResolvingPromise(r())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(s,e){return t(((s,e)=>{this._promiseProps.when(s,e)})).then(s,e)}catch(s){return this.when(null,s)}addResolvingPromise(s){s&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in s?s.when():s)}};return o=s([i("esri.core.Promise")],o),o};let u=class extends(p(m)){};u=s([i("esri.core.Promise")],u);export{u as EsriPromise,p as EsriPromiseMixin};
