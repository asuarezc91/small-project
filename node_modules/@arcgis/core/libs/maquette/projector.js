/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{applyDefaultProjectionOptions as e,dom as r}from"./dom.js";const t=(e,r)=>{const t=[];for(;e!==r;)t.push(e),e=e.parentNode;return t};let n;n=Array.prototype.find?(e,r)=>e.find(r):(e,r)=>e.filter(r)[0];const o=(e,r)=>{let t=e;return r.forEach((e=>{t=t&&t.children?n(t.children,(r=>r.domNode===e)):void 0})),t},d=(e,r,n)=>{const d=function(d){n("domEvent",d);const s=r(),c=t(d.currentTarget,s.domNode);c.reverse();const i=o(s.getLastRender(),c);let p;return e.scheduleRender(),i&&(p=i.properties[`on${d.type}`].apply(i.properties.bind||this,arguments)),n("domEventProcessed",d),p};return()=>d};let s=t=>{let n;const o=e(t),s=o.performanceLogger;let c,i=!0,p=!1;const l=[],a=[],u=(e,r,t)=>{let c;o.eventHandlerInterceptor=d(n,(()=>c),s),c=e(r,t(),o),l.push(c),a.push(t)},f=()=>{if(c=void 0,i){i=!1,s("renderStart",void 0);for(let e=0;e<l.length;e++){const r=a[e]();s("rendered",void 0),l[e].update(r),s("patched",void 0)}s("renderDone",void 0),i=!0}};return n={renderNow:f,scheduleRender:()=>{c||p||(c=requestAnimationFrame(f))},stop:()=>{c&&(cancelAnimationFrame(c),c=void 0),p=!0},resume:()=>{p=!1,i=!0,n.scheduleRender()},append:(e,t)=>{u(r.append,e,t)},insertBefore:(e,t)=>{u(r.insertBefore,e,t)},merge:(e,t)=>{u(r.merge,e,t)},replace:(e,t)=>{u(r.replace,e,t)},detach:e=>{for(let r=0;r<a.length;r++)if(a[r]===e)return a.splice(r,1),l.splice(r,1)[0];throw new Error("renderFunction was not found")}},n};export{s as createProjector};
